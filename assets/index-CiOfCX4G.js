var tu=Object.defineProperty;var Ms=l=>{throw TypeError(l)};var ru=(l,e,t)=>e in l?tu(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var M=(l,e,t)=>ru(l,typeof e!="symbol"?e+"":e,t),Gn=(l,e,t)=>e.has(l)||Ms("Cannot "+t);var W=(l,e,t)=>(Gn(l,e,"read from private field"),t?t.call(l):e.get(l)),je=(l,e,t)=>e.has(l)?Ms("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,t),Be=(l,e,t,i)=>(Gn(l,e,"write to private field"),i?i.call(l,t):e.set(l,t),t),Ce=(l,e,t)=>(Gn(l,e,"access private method"),t);var zr=(l,e,t,i)=>({set _(r){Be(l,e,r,t)},get _(){return W(l,e,i)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();class nu{constructor(e){M(this,"container");M(this,"currentScreen",null);M(this,"mainMenuFactory",null);M(this,"networkLobbyFactory",null);M(this,"placeholderGameFactory",null);this.container=e}setScreenFactories(e){this.mainMenuFactory=e.mainMenu,this.networkLobbyFactory=e.networkLobby,this.placeholderGameFactory=e.placeholderGame}init(){const t=new URLSearchParams(window.location.search).get("room");t?this.showNetworkLobby({mode:"guest",roomId:t.toLowerCase()}):this.showMainMenu()}showMainMenu(){if(!this.mainMenuFactory){console.error("MainMenu factory not set");return}this.transition(this.mainMenuFactory()),window.history.pushState({},"",window.location.pathname)}showNetworkLobby(e){if(!this.networkLobbyFactory){console.error("NetworkLobby factory not set");return}this.transition(this.networkLobbyFactory(e))}showGame(e,t){if(!this.placeholderGameFactory){console.error("PlaceholderGame factory not set");return}this.transition(this.placeholderGameFactory(e,t))}getContainer(){return this.container}transition(e){this.currentScreen&&this.currentScreen.cleanup(),this.container.innerHTML="",this.currentScreen=e,this.currentScreen.render()}}class iu{constructor(e,t){M(this,"container");M(this,"screenManager");M(this,"showingSubmenu",!1);M(this,"showingJoinInput",!1);this.container=e,this.screenManager=t}render(){this.container.innerHTML=`
      <div style="
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 2rem;
      ">
        <h1 style="
          font-size: 4rem;
          color: #0ff;
          text-shadow: 0 0 20px #0ff, 0 0 40px #0ff;
          margin-bottom: 3rem;
          letter-spacing: 0.5rem;
          font-family: monospace;
        ">TERATRON</h1>

        <div style="
          display: flex;
          flex-direction: column;
          gap: 1rem;
          align-items: center;
        ">
          <button id="localGameBtn" style="
            padding: 1rem 3rem;
            font-size: 1.2rem;
            font-family: monospace;
            background: #333;
            color: #666;
            border: 2px solid #444;
            cursor: not-allowed;
            position: relative;
          " disabled>
            LOCAL GAME
            <span style="
              position: absolute;
              top: -10px;
              right: -10px;
              background: #444;
              color: #888;
              font-size: 0.6rem;
              padding: 2px 6px;
              border-radius: 3px;
            ">COMING SOON</span>
          </button>

          <button id="networkGameBtn" style="
            padding: 1rem 3rem;
            font-size: 1.2rem;
            font-family: monospace;
            background: #111;
            color: #0ff;
            border: 2px solid #0ff;
            cursor: pointer;
            transition: all 0.2s;
          ">
            NETWORK GAME
          </button>

          <div id="submenu" style="
            display: none;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding: 1rem;
            background: #111;
            border: 1px solid #333;
            border-radius: 4px;
          ">
            <button id="createRoomBtn" style="
              padding: 0.75rem 2rem;
              font-size: 1rem;
              font-family: monospace;
              background: #020;
              color: #0f0;
              border: 1px solid #0f0;
              cursor: pointer;
            ">
              CREATE ROOM
            </button>
            <button id="joinRoomBtn" style="
              padding: 0.75rem 2rem;
              font-size: 1rem;
              font-family: monospace;
              background: #002;
              color: #08f;
              border: 1px solid #08f;
              cursor: pointer;
            ">
              JOIN ROOM
            </button>
          </div>

          <div id="joinInputSection" style="
            display: none;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding: 1rem;
            background: #111;
            border: 1px solid #333;
            border-radius: 4px;
            align-items: center;
          ">
            <label style="color: #888; font-size: 0.9rem;">Enter room code or paste link:</label>
            <input id="roomCodeInput" type="text" placeholder="red-bear-moon" style="
              padding: 0.5rem;
              font-size: 1rem;
              font-family: monospace;
              background: #000;
              color: #0ff;
              border: 1px solid #0ff;
              width: 250px;
              text-align: center;
            " />
            <div style="display: flex; gap: 0.5rem;">
              <button id="joinConfirmBtn" style="
                padding: 0.5rem 1.5rem;
                font-family: monospace;
                background: #020;
                color: #0f0;
                border: 1px solid #0f0;
                cursor: pointer;
              ">JOIN</button>
              <button id="joinCancelBtn" style="
                padding: 0.5rem 1.5rem;
                font-family: monospace;
                background: #200;
                color: #f44;
                border: 1px solid #f44;
                cursor: pointer;
              ">CANCEL</button>
            </div>
            <div id="joinError" style="color: #f44; font-size: 0.8rem; display: none;"></div>
          </div>
        </div>
      </div>
    `,this.setupEventListeners()}setupEventListeners(){const e=document.getElementById("networkGameBtn"),t=document.getElementById("submenu"),i=document.getElementById("createRoomBtn"),r=document.getElementById("joinRoomBtn"),n=document.getElementById("joinInputSection"),o=document.getElementById("roomCodeInput"),a=document.getElementById("joinConfirmBtn"),s=document.getElementById("joinCancelBtn"),c=document.getElementById("joinError");e?.addEventListener("click",()=>{this.showingJoinInput?(n&&(n.style.display="none"),t&&(t.style.display="flex"),this.showingJoinInput=!1,this.showingSubmenu=!0):this.showingSubmenu?(t&&(t.style.display="none"),this.showingSubmenu=!1):(t&&(t.style.display="flex"),this.showingSubmenu=!0)}),i?.addEventListener("click",()=>{this.screenManager.showNetworkLobby({mode:"host"})}),r?.addEventListener("click",()=>{t&&(t.style.display="none"),n&&(n.style.display="flex"),this.showingSubmenu=!1,this.showingJoinInput=!0,o?.focus()}),a?.addEventListener("click",()=>{this.handleJoin(o,c)}),o?.addEventListener("keypress",u=>{u.key==="Enter"&&this.handleJoin(o,c)}),s?.addEventListener("click",()=>{n&&(n.style.display="none"),t&&(t.style.display="flex"),o&&(o.value=""),c&&(c.style.display="none"),this.showingJoinInput=!1,this.showingSubmenu=!0}),e?.addEventListener("mouseenter",()=>{e.style.background="#022",e.style.boxShadow="0 0 10px #0ff"}),e?.addEventListener("mouseleave",()=>{e.style.background="#111",e.style.boxShadow="none"})}handleJoin(e,t){const i=e?.value.trim()??"",r=this.extractRoomId(i);if(!r){t&&(t.textContent="Please enter a valid room code or link",t.style.display="block");return}this.screenManager.showNetworkLobby({mode:"guest",roomId:r})}extractRoomId(e){if(!e)return null;if(e.includes("?room=")||e.includes("&room="))try{return new URL(e.startsWith("http")?e:`https://example.com${e}`).searchParams.get("room")}catch{return null}const t=e.toLowerCase().replace(/\s+/g,"-").replace(/-+/g,"-");return t.length>0?t:null}cleanup(){}}var hs=Object.defineProperty,ou=Object.getOwnPropertyDescriptor,su=Object.getOwnPropertyNames,au=Object.prototype.hasOwnProperty,ut=(l,e)=>()=>(l&&(e=l(l=0)),e),we=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports),fr=(l,e)=>{for(var t in e)hs(l,t,{get:e[t],enumerable:!0})},lu=(l,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of su(e))!au.call(l,r)&&r!==t&&hs(l,r,{get:()=>e[r],enumerable:!(i=ou(e,r))||i.enumerable});return l},We=l=>lu(hs({},"__esModule",{value:!0}),l),de=ut(()=>{}),$e={};fr($e,{_debugEnd:()=>Di,_debugProcess:()=>Ui,_events:()=>Qi,_eventsCount:()=>Zi,_exiting:()=>Si,_fatalExceptions:()=>Ri,_getActiveHandles:()=>wl,_getActiveRequests:()=>vl,_kill:()=>Ii,_linkedBinding:()=>gl,_maxListeners:()=>Ji,_preload_modules:()=>Vi,_rawDebug:()=>vi,_startProfilerIdleNotifier:()=>Ni,_stopProfilerIdleNotifier:()=>ji,_tickCallback:()=>Bi,abort:()=>zi,addListener:()=>eo,allowedNodeEnvironmentFlags:()=>Oi,arch:()=>oi,argv:()=>li,argv0:()=>Yi,assert:()=>_l,binding:()=>di,browser:()=>bi,chdir:()=>yi,config:()=>xi,cpuUsage:()=>Er,cwd:()=>mi,debugPort:()=>Ki,default:()=>ds,dlopen:()=>bl,domain:()=>_i,emit:()=>oo,emitWarning:()=>fi,env:()=>ai,execArgv:()=>ci,execPath:()=>Gi,exit:()=>Pi,features:()=>Ci,hasUncaughtExceptionCaptureCallback:()=>Sl,hrtime:()=>Qr,kill:()=>Ti,listeners:()=>El,memoryUsage:()=>ki,moduleLoadList:()=>wi,nextTick:()=>ml,off:()=>ro,on:()=>vt,once:()=>to,openStdin:()=>Mi,pid:()=>qi,platform:()=>si,ppid:()=>Hi,prependListener:()=>so,prependOnceListener:()=>ao,reallyExit:()=>Ei,release:()=>gi,removeAllListeners:()=>io,removeListener:()=>no,resourceUsage:()=>Ai,setSourceMapsEnabled:()=>Xi,setUncaughtExceptionCaptureCallback:()=>Li,stderr:()=>Wi,stdin:()=>$i,stdout:()=>Fi,title:()=>ii,umask:()=>pi,uptime:()=>xl,version:()=>ui,versions:()=>hi});function fs(l){throw new Error("Node.js process "+l+" is not supported by JSPM core outside of Node.js")}function cu(){!Jt||!Yt||(Jt=!1,Yt.length?yt=Yt.concat(yt):Cr=-1,yt.length&&pl())}function pl(){if(!Jt){var l=setTimeout(cu,0);Jt=!0;for(var e=yt.length;e;){for(Yt=yt,yt=[];++Cr<e;)Yt&&Yt[Cr].run();Cr=-1,e=yt.length}Yt=null,Jt=!1,clearTimeout(l)}}function ml(l){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];yt.push(new yl(l,e)),yt.length===1&&!Jt&&setTimeout(pl,0)}function yl(l,e){this.fun=l,this.array=e}function rt(){}function gl(l){fs("_linkedBinding")}function bl(l){fs("dlopen")}function vl(){return[]}function wl(){return[]}function _l(l,e){if(!l)throw new Error(e||"assertion error")}function Sl(){return!1}function xl(){return _t.now()/1e3}function Qr(l){var e=Math.floor((Date.now()-_t.now())*.001),t=_t.now()*.001,i=Math.floor(t)+e,r=Math.floor(t%1*1e9);return l&&(i=i-l[0],r=r-l[1],r<0&&(i--,r+=Zr)),[i,r]}function vt(){return ds}function El(l){return[]}var yt,Jt,Yt,Cr,ii,oi,si,ai,li,ci,ui,hi,fi,di,pi,mi,yi,gi,bi,vi,wi,_i,Si,xi,Ei,Ii,Er,Ai,ki,Ti,Pi,Mi,Oi,Ci,Ri,Li,Bi,Ui,Di,Ni,ji,Fi,Wi,$i,zi,qi,Hi,Gi,Ki,Yi,Vi,Xi,_t,Kn,Zr,Ji,Qi,Zi,eo,to,ro,no,io,oo,so,ao,ds,uu=ut(()=>{de(),me(),pe(),yt=[],Jt=!1,Cr=-1,yl.prototype.run=function(){this.fun.apply(null,this.array)},ii="browser",oi="x64",si="browser",ai={PATH:"/usr/bin",LANG:typeof navigator<"u"?navigator.language+".UTF-8":void 0,PWD:"/",HOME:"/home",TMP:"/tmp"},li=["/usr/bin/node"],ci=[],ui="v16.8.0",hi={},fi=function(l,e){console.warn((e?e+": ":"")+l)},di=function(l){fs("binding")},pi=function(l){return 0},mi=function(){return"/"},yi=function(l){},gi={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},bi=!0,vi=rt,wi=[],_i={},Si=!1,xi={},Ei=rt,Ii=rt,Er=function(){return{}},Ai=Er,ki=Er,Ti=rt,Pi=rt,Mi=rt,Oi={},Ci={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},Ri=rt,Li=rt,Bi=rt,Ui=rt,Di=rt,Ni=rt,ji=rt,Fi=void 0,Wi=void 0,$i=void 0,zi=rt,qi=2,Hi=1,Gi="/bin/usr/node",Ki=9229,Yi="node",Vi=[],Xi=rt,_t={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0},_t.now===void 0&&(Kn=Date.now(),_t.timing&&_t.timing.navigationStart&&(Kn=_t.timing.navigationStart),_t.now=()=>Date.now()-Kn),Zr=1e9,Qr.bigint=function(l){var e=Qr(l);return typeof BigInt>"u"?e[0]*Zr+e[1]:BigInt(e[0]*Zr)+BigInt(e[1])},Ji=10,Qi={},Zi=0,eo=vt,to=vt,ro=vt,no=vt,io=vt,oo=rt,so=vt,ao=vt,ds={version:ui,versions:hi,arch:oi,platform:si,browser:bi,release:gi,_rawDebug:vi,moduleLoadList:wi,binding:di,_linkedBinding:gl,_events:Qi,_eventsCount:Zi,_maxListeners:Ji,on:vt,addListener:eo,once:to,off:ro,removeListener:no,removeAllListeners:io,emit:oo,prependListener:so,prependOnceListener:ao,listeners:El,domain:_i,_exiting:Si,config:xi,dlopen:bl,uptime:xl,_getActiveRequests:vl,_getActiveHandles:wl,reallyExit:Ei,_kill:Ii,cpuUsage:Er,resourceUsage:Ai,memoryUsage:ki,kill:Ti,exit:Pi,openStdin:Mi,allowedNodeEnvironmentFlags:Oi,assert:_l,features:Ci,_fatalExceptions:Ri,setUncaughtExceptionCaptureCallback:Li,hasUncaughtExceptionCaptureCallback:Sl,emitWarning:fi,nextTick:ml,_tickCallback:Bi,_debugProcess:Ui,_debugEnd:Di,_startProfilerIdleNotifier:Ni,_stopProfilerIdleNotifier:ji,stdout:Fi,stdin:$i,stderr:Wi,abort:zi,umask:pi,chdir:yi,cwd:mi,env:ai,title:ii,argv:li,execArgv:ci,pid:qi,ppid:Hi,execPath:Gi,debugPort:Ki,hrtime:Qr,argv0:Yi,_preload_modules:Vi,setSourceMapsEnabled:Xi}}),pe=ut(()=>{uu()});function hu(){if(lo)return sr;lo=!0,sr.byteLength=a,sr.toByteArray=c,sr.fromByteArray=d;for(var l=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,n=i.length;r<n;++r)l[r]=i[r],e[i.charCodeAt(r)]=r;e[45]=62,e[95]=63;function o(m){var g=m.length;if(g%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var b=m.indexOf("=");b===-1&&(b=g);var w=b===g?0:4-b%4;return[b,w]}function a(m){var g=o(m),b=g[0],w=g[1];return(b+w)*3/4-w}function s(m,g,b){return(g+b)*3/4-b}function c(m){var g,b=o(m),w=b[0],x=b[1],y=new t(s(m,w,x)),S=0,E=x>0?w-4:w,_;for(_=0;_<E;_+=4)g=e[m.charCodeAt(_)]<<18|e[m.charCodeAt(_+1)]<<12|e[m.charCodeAt(_+2)]<<6|e[m.charCodeAt(_+3)],y[S++]=g>>16&255,y[S++]=g>>8&255,y[S++]=g&255;return x===2&&(g=e[m.charCodeAt(_)]<<2|e[m.charCodeAt(_+1)]>>4,y[S++]=g&255),x===1&&(g=e[m.charCodeAt(_)]<<10|e[m.charCodeAt(_+1)]<<4|e[m.charCodeAt(_+2)]>>2,y[S++]=g>>8&255,y[S++]=g&255),y}function u(m){return l[m>>18&63]+l[m>>12&63]+l[m>>6&63]+l[m&63]}function f(m,g,b){for(var w,x=[],y=g;y<b;y+=3)w=(m[y]<<16&16711680)+(m[y+1]<<8&65280)+(m[y+2]&255),x.push(u(w));return x.join("")}function d(m){for(var g,b=m.length,w=b%3,x=[],y=16383,S=0,E=b-w;S<E;S+=y)x.push(f(m,S,S+y>E?E:S+y));return w===1?(g=m[b-1],x.push(l[g>>2]+l[g<<4&63]+"==")):w===2&&(g=(m[b-2]<<8)+m[b-1],x.push(l[g>>10]+l[g>>4&63]+l[g<<2&63]+"=")),x.join("")}return sr}function fu(){return co?Ir:(co=!0,Ir.read=function(l,e,t,i,r){var n,o,a=r*8-i-1,s=(1<<a)-1,c=s>>1,u=-7,f=t?r-1:0,d=t?-1:1,m=l[e+f];for(f+=d,n=m&(1<<-u)-1,m>>=-u,u+=a;u>0;n=n*256+l[e+f],f+=d,u-=8);for(o=n&(1<<-u)-1,n>>=-u,u+=i;u>0;o=o*256+l[e+f],f+=d,u-=8);if(n===0)n=1-c;else{if(n===s)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,i),n=n-c}return(m?-1:1)*o*Math.pow(2,n-i)},Ir.write=function(l,e,t,i,r,n){var o,a,s,c=n*8-r-1,u=(1<<c)-1,f=u>>1,d=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=i?0:n-1,g=i?1:-1,b=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(s=Math.pow(2,-o))<1&&(o--,s*=2),o+f>=1?e+=d/s:e+=d*Math.pow(2,1-f),e*s>=2&&(o++,s/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*s-1)*Math.pow(2,r),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,r),o=0));r>=8;l[t+m]=a&255,m+=g,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;l[t+m]=o&255,m+=g,o/=256,c-=8);l[t+m-g]|=b*128},Ir)}function du(){if(uo)return Lt;uo=!0;let l=hu(),e=fu(),t=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Lt.Buffer=o,Lt.SlowBuffer=x,Lt.INSPECT_MAX_BYTES=50;let i=2147483647;Lt.kMaxLength=i,o.TYPED_ARRAY_SUPPORT=r(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function r(){try{let h=new Uint8Array(1),p={foo:function(){return 42}};return Object.setPrototypeOf(p,Uint8Array.prototype),Object.setPrototypeOf(h,p),h.foo()===42}catch{return!1}}Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}});function n(h){if(h>i)throw new RangeError('The value "'+h+'" is invalid for option "size"');let p=new Uint8Array(h);return Object.setPrototypeOf(p,o.prototype),p}function o(h,p,v){if(typeof h=="number"){if(typeof p=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return u(h)}return a(h,p,v)}o.poolSize=8192;function a(h,p,v){if(typeof h=="string")return f(h,p);if(ArrayBuffer.isView(h))return m(h);if(h==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h);if(ee(h,ArrayBuffer)||h&&ee(h.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ee(h,SharedArrayBuffer)||h&&ee(h.buffer,SharedArrayBuffer)))return g(h,p,v);if(typeof h=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let C=h.valueOf&&h.valueOf();if(C!=null&&C!==h)return o.from(C,p,v);let N=b(h);if(N)return N;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof h[Symbol.toPrimitive]=="function")return o.from(h[Symbol.toPrimitive]("string"),p,v);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h)}o.from=function(h,p,v){return a(h,p,v)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array);function s(h){if(typeof h!="number")throw new TypeError('"size" argument must be of type number');if(h<0)throw new RangeError('The value "'+h+'" is invalid for option "size"')}function c(h,p,v){return s(h),h<=0?n(h):p!==void 0?typeof v=="string"?n(h).fill(p,v):n(h).fill(p):n(h)}o.alloc=function(h,p,v){return c(h,p,v)};function u(h){return s(h),n(h<0?0:w(h)|0)}o.allocUnsafe=function(h){return u(h)},o.allocUnsafeSlow=function(h){return u(h)};function f(h,p){if((typeof p!="string"||p==="")&&(p="utf8"),!o.isEncoding(p))throw new TypeError("Unknown encoding: "+p);let v=y(h,p)|0,C=n(v),N=C.write(h,p);return N!==v&&(C=C.slice(0,N)),C}function d(h){let p=h.length<0?0:w(h.length)|0,v=n(p);for(let C=0;C<p;C+=1)v[C]=h[C]&255;return v}function m(h){if(ee(h,Uint8Array)){let p=new Uint8Array(h);return g(p.buffer,p.byteOffset,p.byteLength)}return d(h)}function g(h,p,v){if(p<0||h.byteLength<p)throw new RangeError('"offset" is outside of buffer bounds');if(h.byteLength<p+(v||0))throw new RangeError('"length" is outside of buffer bounds');let C;return p===void 0&&v===void 0?C=new Uint8Array(h):v===void 0?C=new Uint8Array(h,p):C=new Uint8Array(h,p,v),Object.setPrototypeOf(C,o.prototype),C}function b(h){if(o.isBuffer(h)){let p=w(h.length)|0,v=n(p);return v.length===0||h.copy(v,0,0,p),v}if(h.length!==void 0)return typeof h.length!="number"||_e(h.length)?n(0):d(h);if(h.type==="Buffer"&&Array.isArray(h.data))return d(h.data)}function w(h){if(h>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return h|0}function x(h){return+h!=h&&(h=0),o.alloc(+h)}o.isBuffer=function(h){return h!=null&&h._isBuffer===!0&&h!==o.prototype},o.compare=function(h,p){if(ee(h,Uint8Array)&&(h=o.from(h,h.offset,h.byteLength)),ee(p,Uint8Array)&&(p=o.from(p,p.offset,p.byteLength)),!o.isBuffer(h)||!o.isBuffer(p))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(h===p)return 0;let v=h.length,C=p.length;for(let N=0,X=Math.min(v,C);N<X;++N)if(h[N]!==p[N]){v=h[N],C=p[N];break}return v<C?-1:C<v?1:0},o.isEncoding=function(h){switch(String(h).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(h,p){if(!Array.isArray(h))throw new TypeError('"list" argument must be an Array of Buffers');if(h.length===0)return o.alloc(0);let v;if(p===void 0)for(p=0,v=0;v<h.length;++v)p+=h[v].length;let C=o.allocUnsafe(p),N=0;for(v=0;v<h.length;++v){let X=h[v];if(ee(X,Uint8Array))N+X.length>C.length?(o.isBuffer(X)||(X=o.from(X)),X.copy(C,N)):Uint8Array.prototype.set.call(C,X,N);else if(o.isBuffer(X))X.copy(C,N);else throw new TypeError('"list" argument must be an Array of Buffers');N+=X.length}return C};function y(h,p){if(o.isBuffer(h))return h.length;if(ArrayBuffer.isView(h)||ee(h,ArrayBuffer))return h.byteLength;if(typeof h!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof h);let v=h.length,C=arguments.length>2&&arguments[2]===!0;if(!C&&v===0)return 0;let N=!1;for(;;)switch(p){case"ascii":case"latin1":case"binary":return v;case"utf8":case"utf-8":return Q(h).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v*2;case"hex":return v>>>1;case"base64":return ge(h).length;default:if(N)return C?-1:Q(h).length;p=(""+p).toLowerCase(),N=!0}}o.byteLength=y;function S(h,p,v){let C=!1;if((p===void 0||p<0)&&(p=0),p>this.length||((v===void 0||v>this.length)&&(v=this.length),v<=0)||(v>>>=0,p>>>=0,v<=p))return"";for(h||(h="utf8");;)switch(h){case"hex":return Y(this,p,v);case"utf8":case"utf-8":return B(this,p,v);case"ascii":return J(this,p,v);case"latin1":case"binary":return G(this,p,v);case"base64":return I(this,p,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ce(this,p,v);default:if(C)throw new TypeError("Unknown encoding: "+h);h=(h+"").toLowerCase(),C=!0}}o.prototype._isBuffer=!0;function E(h,p,v){let C=h[p];h[p]=h[v],h[v]=C}o.prototype.swap16=function(){let h=this.length;if(h%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let p=0;p<h;p+=2)E(this,p,p+1);return this},o.prototype.swap32=function(){let h=this.length;if(h%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let p=0;p<h;p+=4)E(this,p,p+3),E(this,p+1,p+2);return this},o.prototype.swap64=function(){let h=this.length;if(h%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let p=0;p<h;p+=8)E(this,p,p+7),E(this,p+1,p+6),E(this,p+2,p+5),E(this,p+3,p+4);return this},o.prototype.toString=function(){let h=this.length;return h===0?"":arguments.length===0?B(this,0,h):S.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(h){if(!o.isBuffer(h))throw new TypeError("Argument must be a Buffer");return this===h?!0:o.compare(this,h)===0},o.prototype.inspect=function(){let h="",p=Lt.INSPECT_MAX_BYTES;return h=this.toString("hex",0,p).replace(/(.{2})/g,"$1 ").trim(),this.length>p&&(h+=" ... "),"<Buffer "+h+">"},t&&(o.prototype[t]=o.prototype.inspect),o.prototype.compare=function(h,p,v,C,N){if(ee(h,Uint8Array)&&(h=o.from(h,h.offset,h.byteLength)),!o.isBuffer(h))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof h);if(p===void 0&&(p=0),v===void 0&&(v=h?h.length:0),C===void 0&&(C=0),N===void 0&&(N=this.length),p<0||v>h.length||C<0||N>this.length)throw new RangeError("out of range index");if(C>=N&&p>=v)return 0;if(C>=N)return-1;if(p>=v)return 1;if(p>>>=0,v>>>=0,C>>>=0,N>>>=0,this===h)return 0;let X=N-C,fe=v-p,q=Math.min(X,fe),ae=this.slice(C,N),Te=h.slice(p,v);for(let Ie=0;Ie<q;++Ie)if(ae[Ie]!==Te[Ie]){X=ae[Ie],fe=Te[Ie];break}return X<fe?-1:fe<X?1:0};function _(h,p,v,C,N){if(h.length===0)return-1;if(typeof v=="string"?(C=v,v=0):v>2147483647?v=2147483647:v<-2147483648&&(v=-2147483648),v=+v,_e(v)&&(v=N?0:h.length-1),v<0&&(v=h.length+v),v>=h.length){if(N)return-1;v=h.length-1}else if(v<0)if(N)v=0;else return-1;if(typeof p=="string"&&(p=o.from(p,C)),o.isBuffer(p))return p.length===0?-1:O(h,p,v,C,N);if(typeof p=="number")return p=p&255,typeof Uint8Array.prototype.indexOf=="function"?N?Uint8Array.prototype.indexOf.call(h,p,v):Uint8Array.prototype.lastIndexOf.call(h,p,v):O(h,[p],v,C,N);throw new TypeError("val must be string, number or Buffer")}function O(h,p,v,C,N){let X=1,fe=h.length,q=p.length;if(C!==void 0&&(C=String(C).toLowerCase(),C==="ucs2"||C==="ucs-2"||C==="utf16le"||C==="utf-16le")){if(h.length<2||p.length<2)return-1;X=2,fe/=2,q/=2,v/=2}function ae(Ie,Re){return X===1?Ie[Re]:Ie.readUInt16BE(Re*X)}let Te;if(N){let Ie=-1;for(Te=v;Te<fe;Te++)if(ae(h,Te)===ae(p,Ie===-1?0:Te-Ie)){if(Ie===-1&&(Ie=Te),Te-Ie+1===q)return Ie*X}else Ie!==-1&&(Te-=Te-Ie),Ie=-1}else for(v+q>fe&&(v=fe-q),Te=v;Te>=0;Te--){let Ie=!0;for(let Re=0;Re<q;Re++)if(ae(h,Te+Re)!==ae(p,Re)){Ie=!1;break}if(Ie)return Te}return-1}o.prototype.includes=function(h,p,v){return this.indexOf(h,p,v)!==-1},o.prototype.indexOf=function(h,p,v){return _(this,h,p,v,!0)},o.prototype.lastIndexOf=function(h,p,v){return _(this,h,p,v,!1)};function k(h,p,v,C){v=Number(v)||0;let N=h.length-v;C?(C=Number(C),C>N&&(C=N)):C=N;let X=p.length;C>X/2&&(C=X/2);let fe;for(fe=0;fe<C;++fe){let q=parseInt(p.substr(fe*2,2),16);if(_e(q))return fe;h[v+fe]=q}return fe}function T(h,p,v,C){return Se(Q(p,h.length-v),h,v,C)}function P(h,p,v,C){return Se(le(p),h,v,C)}function A(h,p,v,C){return Se(ge(p),h,v,C)}function U(h,p,v,C){return Se(ye(p,h.length-v),h,v,C)}o.prototype.write=function(h,p,v,C){if(p===void 0)C="utf8",v=this.length,p=0;else if(v===void 0&&typeof p=="string")C=p,v=this.length,p=0;else if(isFinite(p))p=p>>>0,isFinite(v)?(v=v>>>0,C===void 0&&(C="utf8")):(C=v,v=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let N=this.length-p;if((v===void 0||v>N)&&(v=N),h.length>0&&(v<0||p<0)||p>this.length)throw new RangeError("Attempt to write outside buffer bounds");C||(C="utf8");let X=!1;for(;;)switch(C){case"hex":return k(this,h,p,v);case"utf8":case"utf-8":return T(this,h,p,v);case"ascii":case"latin1":case"binary":return P(this,h,p,v);case"base64":return A(this,h,p,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,h,p,v);default:if(X)throw new TypeError("Unknown encoding: "+C);C=(""+C).toLowerCase(),X=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function I(h,p,v){return p===0&&v===h.length?l.fromByteArray(h):l.fromByteArray(h.slice(p,v))}function B(h,p,v){v=Math.min(h.length,v);let C=[],N=p;for(;N<v;){let X=h[N],fe=null,q=X>239?4:X>223?3:X>191?2:1;if(N+q<=v){let ae,Te,Ie,Re;switch(q){case 1:X<128&&(fe=X);break;case 2:ae=h[N+1],(ae&192)===128&&(Re=(X&31)<<6|ae&63,Re>127&&(fe=Re));break;case 3:ae=h[N+1],Te=h[N+2],(ae&192)===128&&(Te&192)===128&&(Re=(X&15)<<12|(ae&63)<<6|Te&63,Re>2047&&(Re<55296||Re>57343)&&(fe=Re));break;case 4:ae=h[N+1],Te=h[N+2],Ie=h[N+3],(ae&192)===128&&(Te&192)===128&&(Ie&192)===128&&(Re=(X&15)<<18|(ae&63)<<12|(Te&63)<<6|Ie&63,Re>65535&&Re<1114112&&(fe=Re))}}fe===null?(fe=65533,q=1):fe>65535&&(fe-=65536,C.push(fe>>>10&1023|55296),fe=56320|fe&1023),C.push(fe),N+=q}return D(C)}let F=4096;function D(h){let p=h.length;if(p<=F)return String.fromCharCode.apply(String,h);let v="",C=0;for(;C<p;)v+=String.fromCharCode.apply(String,h.slice(C,C+=F));return v}function J(h,p,v){let C="";v=Math.min(h.length,v);for(let N=p;N<v;++N)C+=String.fromCharCode(h[N]&127);return C}function G(h,p,v){let C="";v=Math.min(h.length,v);for(let N=p;N<v;++N)C+=String.fromCharCode(h[N]);return C}function Y(h,p,v){let C=h.length;(!p||p<0)&&(p=0),(!v||v<0||v>C)&&(v=C);let N="";for(let X=p;X<v;++X)N+=xe[h[X]];return N}function ce(h,p,v){let C=h.slice(p,v),N="";for(let X=0;X<C.length-1;X+=2)N+=String.fromCharCode(C[X]+C[X+1]*256);return N}o.prototype.slice=function(h,p){let v=this.length;h=~~h,p=p===void 0?v:~~p,h<0?(h+=v,h<0&&(h=0)):h>v&&(h=v),p<0?(p+=v,p<0&&(p=0)):p>v&&(p=v),p<h&&(p=h);let C=this.subarray(h,p);return Object.setPrototypeOf(C,o.prototype),C};function H(h,p,v){if(h%1!==0||h<0)throw new RangeError("offset is not uint");if(h+p>v)throw new RangeError("Trying to access beyond buffer length")}o.prototype.readUintLE=o.prototype.readUIntLE=function(h,p,v){h=h>>>0,p=p>>>0,v||H(h,p,this.length);let C=this[h],N=1,X=0;for(;++X<p&&(N*=256);)C+=this[h+X]*N;return C},o.prototype.readUintBE=o.prototype.readUIntBE=function(h,p,v){h=h>>>0,p=p>>>0,v||H(h,p,this.length);let C=this[h+--p],N=1;for(;p>0&&(N*=256);)C+=this[h+--p]*N;return C},o.prototype.readUint8=o.prototype.readUInt8=function(h,p){return h=h>>>0,p||H(h,1,this.length),this[h]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(h,p){return h=h>>>0,p||H(h,2,this.length),this[h]|this[h+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(h,p){return h=h>>>0,p||H(h,2,this.length),this[h]<<8|this[h+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(h,p){return h=h>>>0,p||H(h,4,this.length),(this[h]|this[h+1]<<8|this[h+2]<<16)+this[h+3]*16777216},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(h,p){return h=h>>>0,p||H(h,4,this.length),this[h]*16777216+(this[h+1]<<16|this[h+2]<<8|this[h+3])},o.prototype.readBigUInt64LE=ue(function(h){h=h>>>0,ne(h,"offset");let p=this[h],v=this[h+7];(p===void 0||v===void 0)&&ve(h,this.length-8);let C=p+this[++h]*2**8+this[++h]*2**16+this[++h]*2**24,N=this[++h]+this[++h]*2**8+this[++h]*2**16+v*2**24;return BigInt(C)+(BigInt(N)<<BigInt(32))}),o.prototype.readBigUInt64BE=ue(function(h){h=h>>>0,ne(h,"offset");let p=this[h],v=this[h+7];(p===void 0||v===void 0)&&ve(h,this.length-8);let C=p*2**24+this[++h]*2**16+this[++h]*2**8+this[++h],N=this[++h]*2**24+this[++h]*2**16+this[++h]*2**8+v;return(BigInt(C)<<BigInt(32))+BigInt(N)}),o.prototype.readIntLE=function(h,p,v){h=h>>>0,p=p>>>0,v||H(h,p,this.length);let C=this[h],N=1,X=0;for(;++X<p&&(N*=256);)C+=this[h+X]*N;return N*=128,C>=N&&(C-=Math.pow(2,8*p)),C},o.prototype.readIntBE=function(h,p,v){h=h>>>0,p=p>>>0,v||H(h,p,this.length);let C=p,N=1,X=this[h+--C];for(;C>0&&(N*=256);)X+=this[h+--C]*N;return N*=128,X>=N&&(X-=Math.pow(2,8*p)),X},o.prototype.readInt8=function(h,p){return h=h>>>0,p||H(h,1,this.length),this[h]&128?(255-this[h]+1)*-1:this[h]},o.prototype.readInt16LE=function(h,p){h=h>>>0,p||H(h,2,this.length);let v=this[h]|this[h+1]<<8;return v&32768?v|4294901760:v},o.prototype.readInt16BE=function(h,p){h=h>>>0,p||H(h,2,this.length);let v=this[h+1]|this[h]<<8;return v&32768?v|4294901760:v},o.prototype.readInt32LE=function(h,p){return h=h>>>0,p||H(h,4,this.length),this[h]|this[h+1]<<8|this[h+2]<<16|this[h+3]<<24},o.prototype.readInt32BE=function(h,p){return h=h>>>0,p||H(h,4,this.length),this[h]<<24|this[h+1]<<16|this[h+2]<<8|this[h+3]},o.prototype.readBigInt64LE=ue(function(h){h=h>>>0,ne(h,"offset");let p=this[h],v=this[h+7];(p===void 0||v===void 0)&&ve(h,this.length-8);let C=this[h+4]+this[h+5]*2**8+this[h+6]*2**16+(v<<24);return(BigInt(C)<<BigInt(32))+BigInt(p+this[++h]*2**8+this[++h]*2**16+this[++h]*2**24)}),o.prototype.readBigInt64BE=ue(function(h){h=h>>>0,ne(h,"offset");let p=this[h],v=this[h+7];(p===void 0||v===void 0)&&ve(h,this.length-8);let C=(p<<24)+this[++h]*2**16+this[++h]*2**8+this[++h];return(BigInt(C)<<BigInt(32))+BigInt(this[++h]*2**24+this[++h]*2**16+this[++h]*2**8+v)}),o.prototype.readFloatLE=function(h,p){return h=h>>>0,p||H(h,4,this.length),e.read(this,h,!0,23,4)},o.prototype.readFloatBE=function(h,p){return h=h>>>0,p||H(h,4,this.length),e.read(this,h,!1,23,4)},o.prototype.readDoubleLE=function(h,p){return h=h>>>0,p||H(h,8,this.length),e.read(this,h,!0,52,8)},o.prototype.readDoubleBE=function(h,p){return h=h>>>0,p||H(h,8,this.length),e.read(this,h,!1,52,8)};function oe(h,p,v,C,N,X){if(!o.isBuffer(h))throw new TypeError('"buffer" argument must be a Buffer instance');if(p>N||p<X)throw new RangeError('"value" argument is out of bounds');if(v+C>h.length)throw new RangeError("Index out of range")}o.prototype.writeUintLE=o.prototype.writeUIntLE=function(h,p,v,C){if(h=+h,p=p>>>0,v=v>>>0,!C){let fe=Math.pow(2,8*v)-1;oe(this,h,p,v,fe,0)}let N=1,X=0;for(this[p]=h&255;++X<v&&(N*=256);)this[p+X]=h/N&255;return p+v},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(h,p,v,C){if(h=+h,p=p>>>0,v=v>>>0,!C){let fe=Math.pow(2,8*v)-1;oe(this,h,p,v,fe,0)}let N=v-1,X=1;for(this[p+N]=h&255;--N>=0&&(X*=256);)this[p+N]=h/X&255;return p+v},o.prototype.writeUint8=o.prototype.writeUInt8=function(h,p,v){return h=+h,p=p>>>0,v||oe(this,h,p,1,255,0),this[p]=h&255,p+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(h,p,v){return h=+h,p=p>>>0,v||oe(this,h,p,2,65535,0),this[p]=h&255,this[p+1]=h>>>8,p+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(h,p,v){return h=+h,p=p>>>0,v||oe(this,h,p,2,65535,0),this[p]=h>>>8,this[p+1]=h&255,p+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(h,p,v){return h=+h,p=p>>>0,v||oe(this,h,p,4,4294967295,0),this[p+3]=h>>>24,this[p+2]=h>>>16,this[p+1]=h>>>8,this[p]=h&255,p+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(h,p,v){return h=+h,p=p>>>0,v||oe(this,h,p,4,4294967295,0),this[p]=h>>>24,this[p+1]=h>>>16,this[p+2]=h>>>8,this[p+3]=h&255,p+4};function R(h,p,v,C,N){re(p,C,N,h,v,7);let X=Number(p&BigInt(4294967295));h[v++]=X,X=X>>8,h[v++]=X,X=X>>8,h[v++]=X,X=X>>8,h[v++]=X;let fe=Number(p>>BigInt(32)&BigInt(4294967295));return h[v++]=fe,fe=fe>>8,h[v++]=fe,fe=fe>>8,h[v++]=fe,fe=fe>>8,h[v++]=fe,v}function V(h,p,v,C,N){re(p,C,N,h,v,7);let X=Number(p&BigInt(4294967295));h[v+7]=X,X=X>>8,h[v+6]=X,X=X>>8,h[v+5]=X,X=X>>8,h[v+4]=X;let fe=Number(p>>BigInt(32)&BigInt(4294967295));return h[v+3]=fe,fe=fe>>8,h[v+2]=fe,fe=fe>>8,h[v+1]=fe,fe=fe>>8,h[v]=fe,v+8}o.prototype.writeBigUInt64LE=ue(function(h,p=0){return R(this,h,p,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeBigUInt64BE=ue(function(h,p=0){return V(this,h,p,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeIntLE=function(h,p,v,C){if(h=+h,p=p>>>0,!C){let q=Math.pow(2,8*v-1);oe(this,h,p,v,q-1,-q)}let N=0,X=1,fe=0;for(this[p]=h&255;++N<v&&(X*=256);)h<0&&fe===0&&this[p+N-1]!==0&&(fe=1),this[p+N]=(h/X>>0)-fe&255;return p+v},o.prototype.writeIntBE=function(h,p,v,C){if(h=+h,p=p>>>0,!C){let q=Math.pow(2,8*v-1);oe(this,h,p,v,q-1,-q)}let N=v-1,X=1,fe=0;for(this[p+N]=h&255;--N>=0&&(X*=256);)h<0&&fe===0&&this[p+N+1]!==0&&(fe=1),this[p+N]=(h/X>>0)-fe&255;return p+v},o.prototype.writeInt8=function(h,p,v){return h=+h,p=p>>>0,v||oe(this,h,p,1,127,-128),h<0&&(h=255+h+1),this[p]=h&255,p+1},o.prototype.writeInt16LE=function(h,p,v){return h=+h,p=p>>>0,v||oe(this,h,p,2,32767,-32768),this[p]=h&255,this[p+1]=h>>>8,p+2},o.prototype.writeInt16BE=function(h,p,v){return h=+h,p=p>>>0,v||oe(this,h,p,2,32767,-32768),this[p]=h>>>8,this[p+1]=h&255,p+2},o.prototype.writeInt32LE=function(h,p,v){return h=+h,p=p>>>0,v||oe(this,h,p,4,2147483647,-2147483648),this[p]=h&255,this[p+1]=h>>>8,this[p+2]=h>>>16,this[p+3]=h>>>24,p+4},o.prototype.writeInt32BE=function(h,p,v){return h=+h,p=p>>>0,v||oe(this,h,p,4,2147483647,-2147483648),h<0&&(h=4294967295+h+1),this[p]=h>>>24,this[p+1]=h>>>16,this[p+2]=h>>>8,this[p+3]=h&255,p+4},o.prototype.writeBigInt64LE=ue(function(h,p=0){return R(this,h,p,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeBigInt64BE=ue(function(h,p=0){return V(this,h,p,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function te(h,p,v,C,N,X){if(v+C>h.length)throw new RangeError("Index out of range");if(v<0)throw new RangeError("Index out of range")}function se(h,p,v,C,N){return p=+p,v=v>>>0,N||te(h,p,v,4),e.write(h,p,v,C,23,4),v+4}o.prototype.writeFloatLE=function(h,p,v){return se(this,h,p,!0,v)},o.prototype.writeFloatBE=function(h,p,v){return se(this,h,p,!1,v)};function be(h,p,v,C,N){return p=+p,v=v>>>0,N||te(h,p,v,8),e.write(h,p,v,C,52,8),v+8}o.prototype.writeDoubleLE=function(h,p,v){return be(this,h,p,!0,v)},o.prototype.writeDoubleBE=function(h,p,v){return be(this,h,p,!1,v)},o.prototype.copy=function(h,p,v,C){if(!o.isBuffer(h))throw new TypeError("argument should be a Buffer");if(v||(v=0),!C&&C!==0&&(C=this.length),p>=h.length&&(p=h.length),p||(p=0),C>0&&C<v&&(C=v),C===v||h.length===0||this.length===0)return 0;if(p<0)throw new RangeError("targetStart out of bounds");if(v<0||v>=this.length)throw new RangeError("Index out of range");if(C<0)throw new RangeError("sourceEnd out of bounds");C>this.length&&(C=this.length),h.length-p<C-v&&(C=h.length-p+v);let N=C-v;return this===h&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(p,v,C):Uint8Array.prototype.set.call(h,this.subarray(v,C),p),N},o.prototype.fill=function(h,p,v,C){if(typeof h=="string"){if(typeof p=="string"?(C=p,p=0,v=this.length):typeof v=="string"&&(C=v,v=this.length),C!==void 0&&typeof C!="string")throw new TypeError("encoding must be a string");if(typeof C=="string"&&!o.isEncoding(C))throw new TypeError("Unknown encoding: "+C);if(h.length===1){let X=h.charCodeAt(0);(C==="utf8"&&X<128||C==="latin1")&&(h=X)}}else typeof h=="number"?h=h&255:typeof h=="boolean"&&(h=Number(h));if(p<0||this.length<p||this.length<v)throw new RangeError("Out of range index");if(v<=p)return this;p=p>>>0,v=v===void 0?this.length:v>>>0,h||(h=0);let N;if(typeof h=="number")for(N=p;N<v;++N)this[N]=h;else{let X=o.isBuffer(h)?h:o.from(h,C),fe=X.length;if(fe===0)throw new TypeError('The value "'+h+'" is invalid for argument "value"');for(N=0;N<v-p;++N)this[N+p]=X[N%fe]}return this};let K={};function j(h,p,v){K[h]=class extends v{constructor(){super(),Object.defineProperty(this,"message",{value:p.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${h}]`,this.stack,delete this.name}get code(){return h}set code(C){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:C,writable:!0})}toString(){return`${this.name} [${h}]: ${this.message}`}}}j("ERR_BUFFER_OUT_OF_BOUNDS",function(h){return h?`${h} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),j("ERR_INVALID_ARG_TYPE",function(h,p){return`The "${h}" argument must be of type number. Received type ${typeof p}`},TypeError),j("ERR_OUT_OF_RANGE",function(h,p,v){let C=`The value of "${h}" is out of range.`,N=v;return Number.isInteger(v)&&Math.abs(v)>2**32?N=ie(String(v)):typeof v=="bigint"&&(N=String(v),(v>BigInt(2)**BigInt(32)||v<-(BigInt(2)**BigInt(32)))&&(N=ie(N)),N+="n"),C+=` It must be ${p}. Received ${N}`,C},RangeError);function ie(h){let p="",v=h.length,C=h[0]==="-"?1:0;for(;v>=C+4;v-=3)p=`_${h.slice(v-3,v)}${p}`;return`${h.slice(0,v)}${p}`}function Z(h,p,v){ne(p,"offset"),(h[p]===void 0||h[p+v]===void 0)&&ve(p,h.length-(v+1))}function re(h,p,v,C,N,X){if(h>v||h<p){let fe=typeof p=="bigint"?"n":"",q;throw p===0||p===BigInt(0)?q=`>= 0${fe} and < 2${fe} ** ${(X+1)*8}${fe}`:q=`>= -(2${fe} ** ${(X+1)*8-1}${fe}) and < 2 ** ${(X+1)*8-1}${fe}`,new K.ERR_OUT_OF_RANGE("value",q,h)}Z(C,N,X)}function ne(h,p){if(typeof h!="number")throw new K.ERR_INVALID_ARG_TYPE(p,"number",h)}function ve(h,p,v){throw Math.floor(h)!==h?(ne(h,v),new K.ERR_OUT_OF_RANGE("offset","an integer",h)):p<0?new K.ERR_BUFFER_OUT_OF_BOUNDS:new K.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${p}`,h)}let he=/[^+/0-9A-Za-z-_]/g;function $(h){if(h=h.split("=")[0],h=h.trim().replace(he,""),h.length<2)return"";for(;h.length%4!==0;)h=h+"=";return h}function Q(h,p){p=p||1/0;let v,C=h.length,N=null,X=[];for(let fe=0;fe<C;++fe){if(v=h.charCodeAt(fe),v>55295&&v<57344){if(!N){if(v>56319){(p-=3)>-1&&X.push(239,191,189);continue}else if(fe+1===C){(p-=3)>-1&&X.push(239,191,189);continue}N=v;continue}if(v<56320){(p-=3)>-1&&X.push(239,191,189),N=v;continue}v=(N-55296<<10|v-56320)+65536}else N&&(p-=3)>-1&&X.push(239,191,189);if(N=null,v<128){if((p-=1)<0)break;X.push(v)}else if(v<2048){if((p-=2)<0)break;X.push(v>>6|192,v&63|128)}else if(v<65536){if((p-=3)<0)break;X.push(v>>12|224,v>>6&63|128,v&63|128)}else if(v<1114112){if((p-=4)<0)break;X.push(v>>18|240,v>>12&63|128,v>>6&63|128,v&63|128)}else throw new Error("Invalid code point")}return X}function le(h){let p=[];for(let v=0;v<h.length;++v)p.push(h.charCodeAt(v)&255);return p}function ye(h,p){let v,C,N,X=[];for(let fe=0;fe<h.length&&!((p-=2)<0);++fe)v=h.charCodeAt(fe),C=v>>8,N=v%256,X.push(N),X.push(C);return X}function ge(h){return l.toByteArray($(h))}function Se(h,p,v,C){let N;for(N=0;N<C&&!(N+v>=p.length||N>=h.length);++N)p[N+v]=h[N];return N}function ee(h,p){return h instanceof p||h!=null&&h.constructor!=null&&h.constructor.name!=null&&h.constructor.name===p.name}function _e(h){return h!==h}let xe=(function(){let h="0123456789abcdef",p=new Array(256);for(let v=0;v<16;++v){let C=v*16;for(let N=0;N<16;++N)p[C+N]=h[v]+h[N]}return p})();function ue(h){return typeof BigInt>"u"?Oe:h}function Oe(){throw new Error("BigInt not supported")}return Lt}var sr,lo,Ir,co,Lt,uo,pu=ut(()=>{de(),me(),pe(),sr={},lo=!1,Ir={},co=!1,Lt={},uo=!1}),Ze={};fr(Ze,{Buffer:()=>Cn,INSPECT_MAX_BYTES:()=>Il,default:()=>wt,kMaxLength:()=>Al});var wt,Cn,Il,Al,et=ut(()=>{de(),me(),pe(),pu(),wt=du(),wt.Buffer,wt.SlowBuffer,wt.INSPECT_MAX_BYTES,wt.kMaxLength,Cn=wt.Buffer,Il=wt.INSPECT_MAX_BYTES,Al=wt.kMaxLength}),me=ut(()=>{et()}),Ge=we((l,e)=>{de(),me(),pe();var t=class extends Error{constructor(i){if(!Array.isArray(i))throw new TypeError(`Expected input to be an Array, got ${typeof i}`);let r="";for(let n=0;n<i.length;n++)r+=`    ${i[n].stack}
`;super(r),this.name="AggregateError",this.errors=i}};e.exports={AggregateError:t,ArrayIsArray(i){return Array.isArray(i)},ArrayPrototypeIncludes(i,r){return i.includes(r)},ArrayPrototypeIndexOf(i,r){return i.indexOf(r)},ArrayPrototypeJoin(i,r){return i.join(r)},ArrayPrototypeMap(i,r){return i.map(r)},ArrayPrototypePop(i,r){return i.pop(r)},ArrayPrototypePush(i,r){return i.push(r)},ArrayPrototypeSlice(i,r,n){return i.slice(r,n)},Error,FunctionPrototypeCall(i,r,...n){return i.call(r,...n)},FunctionPrototypeSymbolHasInstance(i,r){return Function.prototype[Symbol.hasInstance].call(i,r)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(i,r){return Object.defineProperties(i,r)},ObjectDefineProperty(i,r,n){return Object.defineProperty(i,r,n)},ObjectGetOwnPropertyDescriptor(i,r){return Object.getOwnPropertyDescriptor(i,r)},ObjectKeys(i){return Object.keys(i)},ObjectSetPrototypeOf(i,r){return Object.setPrototypeOf(i,r)},Promise,PromisePrototypeCatch(i,r){return i.catch(r)},PromisePrototypeThen(i,r,n){return i.then(r,n)},PromiseReject(i){return Promise.reject(i)},PromiseResolve(i){return Promise.resolve(i)},ReflectApply:Reflect.apply,RegExpPrototypeTest(i,r){return i.test(r)},SafeSet:Set,String,StringPrototypeSlice(i,r,n){return i.slice(r,n)},StringPrototypeToLowerCase(i){return i.toLowerCase()},StringPrototypeToUpperCase(i){return i.toUpperCase()},StringPrototypeTrim(i){return i.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(i,r,n){return i.set(r,n)},Boolean,Uint8Array}}),kl=we((l,e)=>{de(),me(),pe(),e.exports={format(t,...i){return t.replace(/%([sdifj])/g,function(...[r,n]){let o=i.shift();return n==="f"?o.toFixed(6):n==="j"?JSON.stringify(o):n==="s"&&typeof o=="object"?`${o.constructor!==Object?o.constructor.name:""} {}`.trim():o.toString()})},inspect(t){switch(typeof t){case"string":if(t.includes("'"))if(t.includes('"')){if(!t.includes("`")&&!t.includes("${"))return`\`${t}\``}else return`"${t}"`;return`'${t}'`;case"number":return isNaN(t)?"NaN":Object.is(t,-0)?String(t):t;case"bigint":return`${String(t)}n`;case"boolean":case"undefined":return String(t);case"object":return"{}"}}}}),at=we((l,e)=>{de(),me(),pe();var{format:t,inspect:i}=kl(),{AggregateError:r}=Ge(),n=globalThis.AggregateError||r,o=Symbol("kIsNodeError"),a=["string","function","number","object","Function","Object","boolean","bigint","symbol"],s=/^([A-Z][a-z0-9]*)+$/,c="__node_internal_",u={};function f(y,S){if(!y)throw new u.ERR_INTERNAL_ASSERTION(S)}function d(y){let S="",E=y.length,_=y[0]==="-"?1:0;for(;E>=_+4;E-=3)S=`_${y.slice(E-3,E)}${S}`;return`${y.slice(0,E)}${S}`}function m(y,S,E){if(typeof S=="function")return f(S.length<=E.length,`Code: ${y}; The provided arguments length (${E.length}) does not match the required ones (${S.length}).`),S(...E);let _=(S.match(/%[dfijoOs]/g)||[]).length;return f(_===E.length,`Code: ${y}; The provided arguments length (${E.length}) does not match the required ones (${_}).`),E.length===0?S:t(S,...E)}function g(y,S,E){E||(E=Error);class _ extends E{constructor(...k){super(m(y,S,k))}toString(){return`${this.name} [${y}]: ${this.message}`}}Object.defineProperties(_.prototype,{name:{value:E.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${y}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),_.prototype.code=y,_.prototype[o]=!0,u[y]=_}function b(y){let S=c+y.name;return Object.defineProperty(y,"name",{value:S}),y}function w(y,S){if(y&&S&&y!==S){if(Array.isArray(S.errors))return S.errors.push(y),S;let E=new n([S,y],S.message);return E.code=S.code,E}return y||S}var x=class extends Error{constructor(y="The operation was aborted",S=void 0){if(S!==void 0&&typeof S!="object")throw new u.ERR_INVALID_ARG_TYPE("options","Object",S);super(y,S),this.code="ABORT_ERR",this.name="AbortError"}};g("ERR_ASSERTION","%s",Error),g("ERR_INVALID_ARG_TYPE",(y,S,E)=>{f(typeof y=="string","'name' must be a string"),Array.isArray(S)||(S=[S]);let _="The ";y.endsWith(" argument")?_+=`${y} `:_+=`"${y}" ${y.includes(".")?"property":"argument"} `,_+="must be ";let O=[],k=[],T=[];for(let A of S)f(typeof A=="string","All expected entries have to be of type string"),a.includes(A)?O.push(A.toLowerCase()):s.test(A)?k.push(A):(f(A!=="object",'The value "object" should be written as "Object"'),T.push(A));if(k.length>0){let A=O.indexOf("object");A!==-1&&(O.splice(O,A,1),k.push("Object"))}if(O.length>0){switch(O.length){case 1:_+=`of type ${O[0]}`;break;case 2:_+=`one of type ${O[0]} or ${O[1]}`;break;default:{let A=O.pop();_+=`one of type ${O.join(", ")}, or ${A}`}}(k.length>0||T.length>0)&&(_+=" or ")}if(k.length>0){switch(k.length){case 1:_+=`an instance of ${k[0]}`;break;case 2:_+=`an instance of ${k[0]} or ${k[1]}`;break;default:{let A=k.pop();_+=`an instance of ${k.join(", ")}, or ${A}`}}T.length>0&&(_+=" or ")}switch(T.length){case 0:break;case 1:T[0].toLowerCase()!==T[0]&&(_+="an "),_+=`${T[0]}`;break;case 2:_+=`one of ${T[0]} or ${T[1]}`;break;default:{let A=T.pop();_+=`one of ${T.join(", ")}, or ${A}`}}if(E==null)_+=`. Received ${E}`;else if(typeof E=="function"&&E.name)_+=`. Received function ${E.name}`;else if(typeof E=="object"){var P;if((P=E.constructor)!==null&&P!==void 0&&P.name)_+=`. Received an instance of ${E.constructor.name}`;else{let A=i(E,{depth:-1});_+=`. Received ${A}`}}else{let A=i(E,{colors:!1});A.length>25&&(A=`${A.slice(0,25)}...`),_+=`. Received type ${typeof E} (${A})`}return _},TypeError),g("ERR_INVALID_ARG_VALUE",(y,S,E="is invalid")=>{let _=i(S);return _.length>128&&(_=_.slice(0,128)+"..."),`The ${y.includes(".")?"property":"argument"} '${y}' ${E}. Received ${_}`},TypeError),g("ERR_INVALID_RETURN_VALUE",(y,S,E)=>{var _;let O=E!=null&&(_=E.constructor)!==null&&_!==void 0&&_.name?`instance of ${E.constructor.name}`:`type ${typeof E}`;return`Expected ${y} to be returned from the "${S}" function but got ${O}.`},TypeError),g("ERR_MISSING_ARGS",(...y)=>{f(y.length>0,"At least one arg needs to be specified");let S,E=y.length;switch(y=(Array.isArray(y)?y:[y]).map(_=>`"${_}"`).join(" or "),E){case 1:S+=`The ${y[0]} argument`;break;case 2:S+=`The ${y[0]} and ${y[1]} arguments`;break;default:{let _=y.pop();S+=`The ${y.join(", ")}, and ${_} arguments`}break}return`${S} must be specified`},TypeError),g("ERR_OUT_OF_RANGE",(y,S,E)=>{f(S,'Missing "range" argument');let _;if(Number.isInteger(E)&&Math.abs(E)>2**32)_=d(String(E));else if(typeof E=="bigint"){_=String(E);let O=BigInt(2)**BigInt(32);(E>O||E<-O)&&(_=d(_)),_+="n"}else _=i(E);return`The value of "${y}" is out of range. It must be ${S}. Received ${_}`},RangeError),g("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),g("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),g("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),g("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),g("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),g("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),g("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),g("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),g("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),g("ERR_STREAM_WRITE_AFTER_END","write after end",Error),g("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),e.exports={AbortError:x,aggregateTwoErrors:b(w),hideStackFrames:b,codes:u}}),Br=we((l,e)=>{de(),me(),pe();var{AbortController:t,AbortSignal:i}=typeof self<"u"?self:typeof window<"u"?window:void 0;e.exports=t,e.exports.AbortSignal=i,e.exports.default=t}),Wt={};fr(Wt,{EventEmitter:()=>Tl,default:()=>ar,defaultMaxListeners:()=>Pl,init:()=>Ml,listenerCount:()=>Ol,on:()=>Cl,once:()=>Rl});function mu(){if(ho)return Ar;ho=!0;var l=typeof Reflect=="object"?Reflect:null,e=l&&typeof l.apply=="function"?l.apply:function(E,_,O){return Function.prototype.apply.call(E,_,O)},t;l&&typeof l.ownKeys=="function"?t=l.ownKeys:Object.getOwnPropertySymbols?t=function(E){return Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E))}:t=function(E){return Object.getOwnPropertyNames(E)};function i(E){console&&console.warn&&console.warn(E)}var r=Number.isNaN||function(E){return E!==E};function n(){n.init.call(this)}Ar=n,Ar.once=x,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var o=10;function a(E){if(typeof E!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(E){if(typeof E!="number"||E<0||r(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");o=E}}),n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(E){if(typeof E!="number"||E<0||r(E))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+E+".");return this._maxListeners=E,this};function s(E){return E._maxListeners===void 0?n.defaultMaxListeners:E._maxListeners}n.prototype.getMaxListeners=function(){return s(this)},n.prototype.emit=function(E){for(var _=[],O=1;O<arguments.length;O++)_.push(arguments[O]);var k=E==="error",T=this._events;if(T!==void 0)k=k&&T.error===void 0;else if(!k)return!1;if(k){var P;if(_.length>0&&(P=_[0]),P instanceof Error)throw P;var A=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw A.context=P,A}var U=T[E];if(U===void 0)return!1;if(typeof U=="function")e(U,this,_);else for(var I=U.length,B=g(U,I),O=0;O<I;++O)e(B[O],this,_);return!0};function c(E,_,O,k){var T,P,A;if(a(O),P=E._events,P===void 0?(P=E._events=Object.create(null),E._eventsCount=0):(P.newListener!==void 0&&(E.emit("newListener",_,O.listener?O.listener:O),P=E._events),A=P[_]),A===void 0)A=P[_]=O,++E._eventsCount;else if(typeof A=="function"?A=P[_]=k?[O,A]:[A,O]:k?A.unshift(O):A.push(O),T=s(E),T>0&&A.length>T&&!A.warned){A.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+A.length+" "+String(_)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.emitter=E,U.type=_,U.count=A.length,i(U)}return E}n.prototype.addListener=function(E,_){return c(this,E,_,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(E,_){return c(this,E,_,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(E,_,O){var k={fired:!1,wrapFn:void 0,target:E,type:_,listener:O},T=u.bind(k);return T.listener=O,k.wrapFn=T,T}n.prototype.once=function(E,_){return a(_),this.on(E,f(this,E,_)),this},n.prototype.prependOnceListener=function(E,_){return a(_),this.prependListener(E,f(this,E,_)),this},n.prototype.removeListener=function(E,_){var O,k,T,P,A;if(a(_),k=this._events,k===void 0)return this;if(O=k[E],O===void 0)return this;if(O===_||O.listener===_)--this._eventsCount===0?this._events=Object.create(null):(delete k[E],k.removeListener&&this.emit("removeListener",E,O.listener||_));else if(typeof O!="function"){for(T=-1,P=O.length-1;P>=0;P--)if(O[P]===_||O[P].listener===_){A=O[P].listener,T=P;break}if(T<0)return this;T===0?O.shift():b(O,T),O.length===1&&(k[E]=O[0]),k.removeListener!==void 0&&this.emit("removeListener",E,A||_)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(E){var _,O,k;if(O=this._events,O===void 0)return this;if(O.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):O[E]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete O[E]),this;if(arguments.length===0){var T=Object.keys(O),P;for(k=0;k<T.length;++k)P=T[k],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(_=O[E],typeof _=="function")this.removeListener(E,_);else if(_!==void 0)for(k=_.length-1;k>=0;k--)this.removeListener(E,_[k]);return this};function d(E,_,O){var k=E._events;if(k===void 0)return[];var T=k[_];return T===void 0?[]:typeof T=="function"?O?[T.listener||T]:[T]:O?w(T):g(T,T.length)}n.prototype.listeners=function(E){return d(this,E,!0)},n.prototype.rawListeners=function(E){return d(this,E,!1)},n.listenerCount=function(E,_){return typeof E.listenerCount=="function"?E.listenerCount(_):m.call(E,_)},n.prototype.listenerCount=m;function m(E){var _=this._events;if(_!==void 0){var O=_[E];if(typeof O=="function")return 1;if(O!==void 0)return O.length}return 0}n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function g(E,_){for(var O=new Array(_),k=0;k<_;++k)O[k]=E[k];return O}function b(E,_){for(;_+1<E.length;_++)E[_]=E[_+1];E.pop()}function w(E){for(var _=new Array(E.length),O=0;O<_.length;++O)_[O]=E[O].listener||E[O];return _}function x(E,_){return new Promise(function(O,k){function T(A){E.removeListener(_,P),k(A)}function P(){typeof E.removeListener=="function"&&E.removeListener("error",T),O([].slice.call(arguments))}S(E,_,P,{once:!0}),_!=="error"&&y(E,T,{once:!0})})}function y(E,_,O){typeof E.on=="function"&&S(E,"error",_,O)}function S(E,_,O,k){if(typeof E.on=="function")k.once?E.once(_,O):E.on(_,O);else if(typeof E.addEventListener=="function")E.addEventListener(_,function T(P){k.once&&E.removeEventListener(_,T),O(P)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E)}return Ar}var Ar,ho,ar,Tl,Pl,Ml,Ol,Cl,Rl,Zt=ut(()=>{de(),me(),pe(),Ar={},ho=!1,ar=mu(),ar.once,ar.once=function(l,e){return new Promise((t,i)=>{function r(...o){n!==void 0&&l.removeListener("error",n),t(o)}let n;e!=="error"&&(n=o=>{l.removeListener(name,r),i(o)},l.once("error",n)),l.once(e,r)})},ar.on=function(l,e){let t=[],i=[],r=null,n=!1,o={async next(){let c=t.shift();if(c)return createIterResult(c,!1);if(r){let u=Promise.reject(r);return r=null,u}return n?createIterResult(void 0,!0):new Promise((u,f)=>i.push({resolve:u,reject:f}))},async return(){l.removeListener(e,a),l.removeListener("error",s),n=!0;for(let c of i)c.resolve(createIterResult(void 0,!0));return createIterResult(void 0,!0)},throw(c){r=c,l.removeListener(e,a),l.removeListener("error",s)},[Symbol.asyncIterator](){return this}};return l.on(e,a),l.on("error",s),o;function a(...c){let u=i.shift();u?u.resolve(createIterResult(c,!1)):t.push(c)}function s(c){n=!0;let u=i.shift();u?u.reject(c):r=c,o.return()}},{EventEmitter:Tl,defaultMaxListeners:Pl,init:Ml,listenerCount:Ol,on:Cl,once:Rl}=ar}),ct=we((l,e)=>{de(),me(),pe();var t=(et(),We(Ze)),{format:i,inspect:r}=kl(),{codes:{ERR_INVALID_ARG_TYPE:n}}=at(),{kResistStopPropagation:o,AggregateError:a,SymbolDispose:s}=Ge(),c=globalThis.AbortSignal||Br().AbortSignal,u=globalThis.AbortController||Br().AbortController,f=Object.getPrototypeOf(async function(){}).constructor,d=globalThis.Blob||t.Blob,m=typeof d<"u"?function(w){return w instanceof d}:function(w){return!1},g=(w,x)=>{if(w!==void 0&&(w===null||typeof w!="object"||!("aborted"in w)))throw new n(x,"AbortSignal",w)},b=(w,x)=>{if(typeof w!="function")throw new n(x,"Function",w)};e.exports={AggregateError:a,kEmptyObject:Object.freeze({}),once(w){let x=!1;return function(...y){x||(x=!0,w.apply(this,y))}},createDeferredPromise:function(){let w,x;return{promise:new Promise((y,S)=>{w=y,x=S}),resolve:w,reject:x}},promisify(w){return new Promise((x,y)=>{w((S,...E)=>S?y(S):x(...E))})},debuglog(){return function(){}},format:i,inspect:r,types:{isAsyncFunction(w){return w instanceof f},isArrayBufferView(w){return ArrayBuffer.isView(w)}},isBlob:m,deprecate(w,x){return w},addAbortListener:(Zt(),We(Wt)).addAbortListener||function(w,x){if(w===void 0)throw new n("signal","AbortSignal",w);g(w,"signal"),b(x,"listener");let y;return w.aborted?queueMicrotask(()=>x()):(w.addEventListener("abort",x,{__proto__:null,once:!0,[o]:!0}),y=()=>{w.removeEventListener("abort",x)}),{__proto__:null,[s](){var S;(S=y)===null||S===void 0||S()}}},AbortSignalAny:c.any||function(w){if(w.length===1)return w[0];let x=new u,y=()=>x.abort();return w.forEach(S=>{g(S,"signals"),S.addEventListener("abort",y,{once:!0})}),x.signal.addEventListener("abort",()=>{w.forEach(S=>S.removeEventListener("abort",y))},{once:!0}),x.signal}},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")}),Fr=we((l,e)=>{de(),me(),pe();var{ArrayIsArray:t,ArrayPrototypeIncludes:i,ArrayPrototypeJoin:r,ArrayPrototypeMap:n,NumberIsInteger:o,NumberIsNaN:a,NumberMAX_SAFE_INTEGER:s,NumberMIN_SAFE_INTEGER:c,NumberParseInt:u,ObjectPrototypeHasOwnProperty:f,RegExpPrototypeExec:d,String:m,StringPrototypeToUpperCase:g,StringPrototypeTrim:b}=Ge(),{hideStackFrames:w,codes:{ERR_SOCKET_BAD_PORT:x,ERR_INVALID_ARG_TYPE:y,ERR_INVALID_ARG_VALUE:S,ERR_OUT_OF_RANGE:E,ERR_UNKNOWN_SIGNAL:_}}=at(),{normalizeEncoding:O}=ct(),{isAsyncFunction:k,isArrayBufferView:T}=ct().types,P={};function A(ee){return ee===(ee|0)}function U(ee){return ee===ee>>>0}var I=/^[0-7]+$/,B="must be a 32-bit unsigned integer or an octal string";function F(ee,_e,xe){if(typeof ee>"u"&&(ee=xe),typeof ee=="string"){if(d(I,ee)===null)throw new S(_e,ee,B);ee=u(ee,8)}return G(ee,_e),ee}var D=w((ee,_e,xe=c,ue=s)=>{if(typeof ee!="number")throw new y(_e,"number",ee);if(!o(ee))throw new E(_e,"an integer",ee);if(ee<xe||ee>ue)throw new E(_e,`>= ${xe} && <= ${ue}`,ee)}),J=w((ee,_e,xe=-2147483648,ue=2147483647)=>{if(typeof ee!="number")throw new y(_e,"number",ee);if(!o(ee))throw new E(_e,"an integer",ee);if(ee<xe||ee>ue)throw new E(_e,`>= ${xe} && <= ${ue}`,ee)}),G=w((ee,_e,xe=!1)=>{if(typeof ee!="number")throw new y(_e,"number",ee);if(!o(ee))throw new E(_e,"an integer",ee);let ue=xe?1:0,Oe=4294967295;if(ee<ue||ee>Oe)throw new E(_e,`>= ${ue} && <= ${Oe}`,ee)});function Y(ee,_e){if(typeof ee!="string")throw new y(_e,"string",ee)}function ce(ee,_e,xe=void 0,ue){if(typeof ee!="number")throw new y(_e,"number",ee);if(xe!=null&&ee<xe||ue!=null&&ee>ue||(xe!=null||ue!=null)&&a(ee))throw new E(_e,`${xe!=null?`>= ${xe}`:""}${xe!=null&&ue!=null?" && ":""}${ue!=null?`<= ${ue}`:""}`,ee)}var H=w((ee,_e,xe)=>{if(!i(xe,ee)){let ue="must be one of: "+r(n(xe,Oe=>typeof Oe=="string"?`'${Oe}'`:m(Oe)),", ");throw new S(_e,ee,ue)}});function oe(ee,_e){if(typeof ee!="boolean")throw new y(_e,"boolean",ee)}function R(ee,_e,xe){return ee==null||!f(ee,_e)?xe:ee[_e]}var V=w((ee,_e,xe=null)=>{let ue=R(xe,"allowArray",!1),Oe=R(xe,"allowFunction",!1);if(!R(xe,"nullable",!1)&&ee===null||!ue&&t(ee)||typeof ee!="object"&&(!Oe||typeof ee!="function"))throw new y(_e,"Object",ee)}),te=w((ee,_e)=>{if(ee!=null&&typeof ee!="object"&&typeof ee!="function")throw new y(_e,"a dictionary",ee)}),se=w((ee,_e,xe=0)=>{if(!t(ee))throw new y(_e,"Array",ee);if(ee.length<xe){let ue=`must be longer than ${xe}`;throw new S(_e,ee,ue)}});function be(ee,_e){se(ee,_e);for(let xe=0;xe<ee.length;xe++)Y(ee[xe],`${_e}[${xe}]`)}function K(ee,_e){se(ee,_e);for(let xe=0;xe<ee.length;xe++)oe(ee[xe],`${_e}[${xe}]`)}function j(ee,_e){se(ee,_e);for(let xe=0;xe<ee.length;xe++){let ue=ee[xe],Oe=`${_e}[${xe}]`;if(ue==null)throw new y(Oe,"AbortSignal",ue);ve(ue,Oe)}}function ie(ee,_e="signal"){if(Y(ee,_e),P[ee]===void 0)throw P[g(ee)]!==void 0?new _(ee+" (signals must use all capital letters)"):new _(ee)}var Z=w((ee,_e="buffer")=>{if(!T(ee))throw new y(_e,["Buffer","TypedArray","DataView"],ee)});function re(ee,_e){let xe=O(_e),ue=ee.length;if(xe==="hex"&&ue%2!==0)throw new S("encoding",_e,`is invalid for data of length ${ue}`)}function ne(ee,_e="Port",xe=!0){if(typeof ee!="number"&&typeof ee!="string"||typeof ee=="string"&&b(ee).length===0||+ee!==+ee>>>0||ee>65535||ee===0&&!xe)throw new x(_e,ee,xe);return ee|0}var ve=w((ee,_e)=>{if(ee!==void 0&&(ee===null||typeof ee!="object"||!("aborted"in ee)))throw new y(_e,"AbortSignal",ee)}),he=w((ee,_e)=>{if(typeof ee!="function")throw new y(_e,"Function",ee)}),$=w((ee,_e)=>{if(typeof ee!="function"||k(ee))throw new y(_e,"Function",ee)}),Q=w((ee,_e)=>{if(ee!==void 0)throw new y(_e,"undefined",ee)});function le(ee,_e,xe){if(!i(xe,ee))throw new y(_e,`('${r(xe,"|")}')`,ee)}var ye=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function ge(ee,_e){if(typeof ee>"u"||!d(ye,ee))throw new S(_e,ee,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function Se(ee){if(typeof ee=="string")return ge(ee,"hints"),ee;if(t(ee)){let _e=ee.length,xe="";if(_e===0)return xe;for(let ue=0;ue<_e;ue++){let Oe=ee[ue];ge(Oe,"hints"),xe+=Oe,ue!==_e-1&&(xe+=", ")}return xe}throw new S("hints",ee,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}e.exports={isInt32:A,isUint32:U,parseFileMode:F,validateArray:se,validateStringArray:be,validateBooleanArray:K,validateAbortSignalArray:j,validateBoolean:oe,validateBuffer:Z,validateDictionary:te,validateEncoding:re,validateFunction:he,validateInt32:J,validateInteger:D,validateNumber:ce,validateObject:V,validateOneOf:H,validatePlainFunction:$,validatePort:ne,validateSignalName:ie,validateString:Y,validateUint32:G,validateUndefined:Q,validateUnion:le,validateAbortSignal:ve,validateLinkHeaderValue:Se}}),er=we((l,e)=>{de(),me(),pe();var t=e.exports={},i,r;function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?i=setTimeout:i=n}catch{i=n}try{typeof clearTimeout=="function"?r=clearTimeout:r=o}catch{r=o}})();function a(x){if(i===setTimeout)return setTimeout(x,0);if((i===n||!i)&&setTimeout)return i=setTimeout,setTimeout(x,0);try{return i(x,0)}catch{try{return i.call(null,x,0)}catch{return i.call(this,x,0)}}}function s(x){if(r===clearTimeout)return clearTimeout(x);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(x);try{return r(x)}catch{try{return r.call(null,x)}catch{return r.call(this,x)}}}var c=[],u=!1,f,d=-1;function m(){!u||!f||(u=!1,f.length?c=f.concat(c):d=-1,c.length&&g())}function g(){if(!u){var x=a(m);u=!0;for(var y=c.length;y;){for(f=c,c=[];++d<y;)f&&f[d].run();d=-1,y=c.length}f=null,u=!1,s(x)}}t.nextTick=function(x){var y=new Array(arguments.length-1);if(arguments.length>1)for(var S=1;S<arguments.length;S++)y[S-1]=arguments[S];c.push(new b(x,y)),c.length===1&&!u&&a(g)};function b(x,y){this.fun=x,this.array=y}b.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={};function w(){}t.on=w,t.addListener=w,t.once=w,t.off=w,t.removeListener=w,t.removeAllListeners=w,t.emit=w,t.prependListener=w,t.prependOnceListener=w,t.listeners=function(x){return[]},t.binding=function(x){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(x){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}}),At=we((l,e)=>{de(),me(),pe();var{SymbolAsyncIterator:t,SymbolIterator:i,SymbolFor:r}=Ge(),n=r("nodejs.stream.destroyed"),o=r("nodejs.stream.errored"),a=r("nodejs.stream.readable"),s=r("nodejs.stream.writable"),c=r("nodejs.stream.disturbed"),u=r("nodejs.webstream.isClosedPromise"),f=r("nodejs.webstream.controllerErrorFunction");function d(R,V=!1){var te;return!!(R&&typeof R.pipe=="function"&&typeof R.on=="function"&&(!V||typeof R.pause=="function"&&typeof R.resume=="function")&&(!R._writableState||((te=R._readableState)===null||te===void 0?void 0:te.readable)!==!1)&&(!R._writableState||R._readableState))}function m(R){var V;return!!(R&&typeof R.write=="function"&&typeof R.on=="function"&&(!R._readableState||((V=R._writableState)===null||V===void 0?void 0:V.writable)!==!1))}function g(R){return!!(R&&typeof R.pipe=="function"&&R._readableState&&typeof R.on=="function"&&typeof R.write=="function")}function b(R){return R&&(R._readableState||R._writableState||typeof R.write=="function"&&typeof R.on=="function"||typeof R.pipe=="function"&&typeof R.on=="function")}function w(R){return!!(R&&!b(R)&&typeof R.pipeThrough=="function"&&typeof R.getReader=="function"&&typeof R.cancel=="function")}function x(R){return!!(R&&!b(R)&&typeof R.getWriter=="function"&&typeof R.abort=="function")}function y(R){return!!(R&&!b(R)&&typeof R.readable=="object"&&typeof R.writable=="object")}function S(R){return w(R)||x(R)||y(R)}function E(R,V){return R==null?!1:V===!0?typeof R[t]=="function":V===!1?typeof R[i]=="function":typeof R[t]=="function"||typeof R[i]=="function"}function _(R){if(!b(R))return null;let V=R._writableState,te=R._readableState,se=V||te;return!!(R.destroyed||R[n]||se!=null&&se.destroyed)}function O(R){if(!m(R))return null;if(R.writableEnded===!0)return!0;let V=R._writableState;return V!=null&&V.errored?!1:typeof V?.ended!="boolean"?null:V.ended}function k(R,V){if(!m(R))return null;if(R.writableFinished===!0)return!0;let te=R._writableState;return te!=null&&te.errored?!1:typeof te?.finished!="boolean"?null:!!(te.finished||V===!1&&te.ended===!0&&te.length===0)}function T(R){if(!d(R))return null;if(R.readableEnded===!0)return!0;let V=R._readableState;return!V||V.errored?!1:typeof V?.ended!="boolean"?null:V.ended}function P(R,V){if(!d(R))return null;let te=R._readableState;return te!=null&&te.errored?!1:typeof te?.endEmitted!="boolean"?null:!!(te.endEmitted||V===!1&&te.ended===!0&&te.length===0)}function A(R){return R&&R[a]!=null?R[a]:typeof R?.readable!="boolean"?null:_(R)?!1:d(R)&&R.readable&&!P(R)}function U(R){return R&&R[s]!=null?R[s]:typeof R?.writable!="boolean"?null:_(R)?!1:m(R)&&R.writable&&!O(R)}function I(R,V){return b(R)?_(R)?!0:!(V?.readable!==!1&&A(R)||V?.writable!==!1&&U(R)):null}function B(R){var V,te;return b(R)?R.writableErrored?R.writableErrored:(V=(te=R._writableState)===null||te===void 0?void 0:te.errored)!==null&&V!==void 0?V:null:null}function F(R){var V,te;return b(R)?R.readableErrored?R.readableErrored:(V=(te=R._readableState)===null||te===void 0?void 0:te.errored)!==null&&V!==void 0?V:null:null}function D(R){if(!b(R))return null;if(typeof R.closed=="boolean")return R.closed;let V=R._writableState,te=R._readableState;return typeof V?.closed=="boolean"||typeof te?.closed=="boolean"?V?.closed||te?.closed:typeof R._closed=="boolean"&&J(R)?R._closed:null}function J(R){return typeof R._closed=="boolean"&&typeof R._defaultKeepAlive=="boolean"&&typeof R._removedConnection=="boolean"&&typeof R._removedContLen=="boolean"}function G(R){return typeof R._sent100=="boolean"&&J(R)}function Y(R){var V;return typeof R._consuming=="boolean"&&typeof R._dumped=="boolean"&&((V=R.req)===null||V===void 0?void 0:V.upgradeOrConnect)===void 0}function ce(R){if(!b(R))return null;let V=R._writableState,te=R._readableState,se=V||te;return!se&&G(R)||!!(se&&se.autoDestroy&&se.emitClose&&se.closed===!1)}function H(R){var V;return!!(R&&((V=R[c])!==null&&V!==void 0?V:R.readableDidRead||R.readableAborted))}function oe(R){var V,te,se,be,K,j,ie,Z,re,ne;return!!(R&&((V=(te=(se=(be=(K=(j=R[o])!==null&&j!==void 0?j:R.readableErrored)!==null&&K!==void 0?K:R.writableErrored)!==null&&be!==void 0?be:(ie=R._readableState)===null||ie===void 0?void 0:ie.errorEmitted)!==null&&se!==void 0?se:(Z=R._writableState)===null||Z===void 0?void 0:Z.errorEmitted)!==null&&te!==void 0?te:(re=R._readableState)===null||re===void 0?void 0:re.errored)!==null&&V!==void 0?V:!((ne=R._writableState)===null||ne===void 0)&&ne.errored))}e.exports={isDestroyed:_,kIsDestroyed:n,isDisturbed:H,kIsDisturbed:c,isErrored:oe,kIsErrored:o,isReadable:A,kIsReadable:a,kIsClosedPromise:u,kControllerErrorFunction:f,kIsWritable:s,isClosed:D,isDuplexNodeStream:g,isFinished:I,isIterable:E,isReadableNodeStream:d,isReadableStream:w,isReadableEnded:T,isReadableFinished:P,isReadableErrored:F,isNodeStream:b,isWebStream:S,isWritable:U,isWritableNodeStream:m,isWritableStream:x,isWritableEnded:O,isWritableFinished:k,isWritableErrored:B,isServerRequest:Y,isServerResponse:G,willEmitClose:ce,isTransformStream:y}}),$t=we((l,e)=>{de(),me(),pe();var t=er(),{AbortError:i,codes:r}=at(),{ERR_INVALID_ARG_TYPE:n,ERR_STREAM_PREMATURE_CLOSE:o}=r,{kEmptyObject:a,once:s}=ct(),{validateAbortSignal:c,validateFunction:u,validateObject:f,validateBoolean:d}=Fr(),{Promise:m,PromisePrototypeThen:g,SymbolDispose:b}=Ge(),{isClosed:w,isReadable:x,isReadableNodeStream:y,isReadableStream:S,isReadableFinished:E,isReadableErrored:_,isWritable:O,isWritableNodeStream:k,isWritableStream:T,isWritableFinished:P,isWritableErrored:A,isNodeStream:U,willEmitClose:I,kIsClosedPromise:B}=At(),F;function D(H){return H.setHeader&&typeof H.abort=="function"}var J=()=>{};function G(H,oe,R){var V,te;if(arguments.length===2?(R=oe,oe=a):oe==null?oe=a:f(oe,"options"),u(R,"callback"),c(oe.signal,"options.signal"),R=s(R),S(H)||T(H))return Y(H,oe,R);if(!U(H))throw new n("stream",["ReadableStream","WritableStream","Stream"],H);let se=(V=oe.readable)!==null&&V!==void 0?V:y(H),be=(te=oe.writable)!==null&&te!==void 0?te:k(H),K=H._writableState,j=H._readableState,ie=()=>{H.writable||ne()},Z=I(H)&&y(H)===se&&k(H)===be,re=P(H,!1),ne=()=>{re=!0,H.destroyed&&(Z=!1),!(Z&&(!H.readable||se))&&(!se||ve)&&R.call(H)},ve=E(H,!1),he=()=>{ve=!0,H.destroyed&&(Z=!1),!(Z&&(!H.writable||be))&&(!be||re)&&R.call(H)},$=ee=>{R.call(H,ee)},Q=w(H),le=()=>{Q=!0;let ee=A(H)||_(H);if(ee&&typeof ee!="boolean")return R.call(H,ee);if(se&&!ve&&y(H,!0)&&!E(H,!1))return R.call(H,new o);if(be&&!re&&!P(H,!1))return R.call(H,new o);R.call(H)},ye=()=>{Q=!0;let ee=A(H)||_(H);if(ee&&typeof ee!="boolean")return R.call(H,ee);R.call(H)},ge=()=>{H.req.on("finish",ne)};D(H)?(H.on("complete",ne),Z||H.on("abort",le),H.req?ge():H.on("request",ge)):be&&!K&&(H.on("end",ie),H.on("close",ie)),!Z&&typeof H.aborted=="boolean"&&H.on("aborted",le),H.on("end",he),H.on("finish",ne),oe.error!==!1&&H.on("error",$),H.on("close",le),Q?t.nextTick(le):K!=null&&K.errorEmitted||j!=null&&j.errorEmitted?Z||t.nextTick(ye):(!se&&(!Z||x(H))&&(re||O(H)===!1)||!be&&(!Z||O(H))&&(ve||x(H)===!1)||j&&H.req&&H.aborted)&&t.nextTick(ye);let Se=()=>{R=J,H.removeListener("aborted",le),H.removeListener("complete",ne),H.removeListener("abort",le),H.removeListener("request",ge),H.req&&H.req.removeListener("finish",ne),H.removeListener("end",ie),H.removeListener("close",ie),H.removeListener("finish",ne),H.removeListener("end",he),H.removeListener("error",$),H.removeListener("close",le)};if(oe.signal&&!Q){let ee=()=>{let _e=R;Se(),_e.call(H,new i(void 0,{cause:oe.signal.reason}))};if(oe.signal.aborted)t.nextTick(ee);else{F=F||ct().addAbortListener;let _e=F(oe.signal,ee),xe=R;R=s((...ue)=>{_e[b](),xe.apply(H,ue)})}}return Se}function Y(H,oe,R){let V=!1,te=J;if(oe.signal)if(te=()=>{V=!0,R.call(H,new i(void 0,{cause:oe.signal.reason}))},oe.signal.aborted)t.nextTick(te);else{F=F||ct().addAbortListener;let be=F(oe.signal,te),K=R;R=s((...j)=>{be[b](),K.apply(H,j)})}let se=(...be)=>{V||t.nextTick(()=>R.apply(H,be))};return g(H[B].promise,se,se),J}function ce(H,oe){var R;let V=!1;return oe===null&&(oe=a),(R=oe)!==null&&R!==void 0&&R.cleanup&&(d(oe.cleanup,"cleanup"),V=oe.cleanup),new m((te,se)=>{let be=G(H,oe,K=>{V&&be(),K?se(K):te()})})}e.exports=G,e.exports.finished=ce}),dr=we((l,e)=>{de(),me(),pe();var t=er(),{aggregateTwoErrors:i,codes:{ERR_MULTIPLE_CALLBACK:r},AbortError:n}=at(),{Symbol:o}=Ge(),{kIsDestroyed:a,isDestroyed:s,isFinished:c,isServerRequest:u}=At(),f=o("kDestroy"),d=o("kConstruct");function m(I,B,F){I&&(I.stack,B&&!B.errored&&(B.errored=I),F&&!F.errored&&(F.errored=I))}function g(I,B){let F=this._readableState,D=this._writableState,J=D||F;return D!=null&&D.destroyed||F!=null&&F.destroyed?(typeof B=="function"&&B(),this):(m(I,D,F),D&&(D.destroyed=!0),F&&(F.destroyed=!0),J.constructed?b(this,I,B):this.once(f,function(G){b(this,i(G,I),B)}),this)}function b(I,B,F){let D=!1;function J(G){if(D)return;D=!0;let Y=I._readableState,ce=I._writableState;m(G,ce,Y),ce&&(ce.closed=!0),Y&&(Y.closed=!0),typeof F=="function"&&F(G),G?t.nextTick(w,I,G):t.nextTick(x,I)}try{I._destroy(B||null,J)}catch(G){J(G)}}function w(I,B){y(I,B),x(I)}function x(I){let B=I._readableState,F=I._writableState;F&&(F.closeEmitted=!0),B&&(B.closeEmitted=!0),(F!=null&&F.emitClose||B!=null&&B.emitClose)&&I.emit("close")}function y(I,B){let F=I._readableState,D=I._writableState;D!=null&&D.errorEmitted||F!=null&&F.errorEmitted||(D&&(D.errorEmitted=!0),F&&(F.errorEmitted=!0),I.emit("error",B))}function S(){let I=this._readableState,B=this._writableState;I&&(I.constructed=!0,I.closed=!1,I.closeEmitted=!1,I.destroyed=!1,I.errored=null,I.errorEmitted=!1,I.reading=!1,I.ended=I.readable===!1,I.endEmitted=I.readable===!1),B&&(B.constructed=!0,B.destroyed=!1,B.closed=!1,B.closeEmitted=!1,B.errored=null,B.errorEmitted=!1,B.finalCalled=!1,B.prefinished=!1,B.ended=B.writable===!1,B.ending=B.writable===!1,B.finished=B.writable===!1)}function E(I,B,F){let D=I._readableState,J=I._writableState;if(J!=null&&J.destroyed||D!=null&&D.destroyed)return this;D!=null&&D.autoDestroy||J!=null&&J.autoDestroy?I.destroy(B):B&&(B.stack,J&&!J.errored&&(J.errored=B),D&&!D.errored&&(D.errored=B),F?t.nextTick(y,I,B):y(I,B))}function _(I,B){if(typeof I._construct!="function")return;let F=I._readableState,D=I._writableState;F&&(F.constructed=!1),D&&(D.constructed=!1),I.once(d,B),!(I.listenerCount(d)>1)&&t.nextTick(O,I)}function O(I){let B=!1;function F(D){if(B){E(I,D??new r);return}B=!0;let J=I._readableState,G=I._writableState,Y=G||J;J&&(J.constructed=!0),G&&(G.constructed=!0),Y.destroyed?I.emit(f,D):D?E(I,D,!0):t.nextTick(k,I)}try{I._construct(D=>{t.nextTick(F,D)})}catch(D){t.nextTick(F,D)}}function k(I){I.emit(d)}function T(I){return I?.setHeader&&typeof I.abort=="function"}function P(I){I.emit("close")}function A(I,B){I.emit("error",B),t.nextTick(P,I)}function U(I,B){!I||s(I)||(!B&&!c(I)&&(B=new n),u(I)?(I.socket=null,I.destroy(B)):T(I)?I.abort():T(I.req)?I.req.abort():typeof I.destroy=="function"?I.destroy(B):typeof I.close=="function"?I.close():B?t.nextTick(A,I,B):t.nextTick(P,I),I.destroyed||(I[a]=!0))}e.exports={construct:_,destroyer:U,destroy:g,undestroy:S,errorOrDestroy:E}}),ps=we((l,e)=>{de(),me(),pe();var{ArrayIsArray:t,ObjectSetPrototypeOf:i}=Ge(),{EventEmitter:r}=(Zt(),We(Wt));function n(a){r.call(this,a)}i(n.prototype,r.prototype),i(n,r),n.prototype.pipe=function(a,s){let c=this;function u(x){a.writable&&a.write(x)===!1&&c.pause&&c.pause()}c.on("data",u);function f(){c.readable&&c.resume&&c.resume()}a.on("drain",f),!a._isStdio&&(!s||s.end!==!1)&&(c.on("end",m),c.on("close",g));let d=!1;function m(){d||(d=!0,a.end())}function g(){d||(d=!0,typeof a.destroy=="function"&&a.destroy())}function b(x){w(),r.listenerCount(this,"error")===0&&this.emit("error",x)}o(c,"error",b),o(a,"error",b);function w(){c.removeListener("data",u),a.removeListener("drain",f),c.removeListener("end",m),c.removeListener("close",g),c.removeListener("error",b),a.removeListener("error",b),c.removeListener("end",w),c.removeListener("close",w),a.removeListener("close",w)}return c.on("end",w),c.on("close",w),a.on("close",w),a.emit("pipe",c),a};function o(a,s,c){if(typeof a.prependListener=="function")return a.prependListener(s,c);!a._events||!a._events[s]?a.on(s,c):t(a._events[s])?a._events[s].unshift(c):a._events[s]=[c,a._events[s]]}e.exports={Stream:n,prependListener:o}}),Fn=we((l,e)=>{de(),me(),pe();var{SymbolDispose:t}=Ge(),{AbortError:i,codes:r}=at(),{isNodeStream:n,isWebStream:o,kControllerErrorFunction:a}=At(),s=$t(),{ERR_INVALID_ARG_TYPE:c}=r,u,f=(d,m)=>{if(typeof d!="object"||!("aborted"in d))throw new c(m,"AbortSignal",d)};e.exports.addAbortSignal=function(d,m){if(f(d,"signal"),!n(m)&&!o(m))throw new c("stream",["ReadableStream","WritableStream","Stream"],m);return e.exports.addAbortSignalNoValidate(d,m)},e.exports.addAbortSignalNoValidate=function(d,m){if(typeof d!="object"||!("aborted"in d))return m;let g=n(m)?()=>{m.destroy(new i(void 0,{cause:d.reason}))}:()=>{m[a](new i(void 0,{cause:d.reason}))};if(d.aborted)g();else{u=u||ct().addAbortListener;let b=u(d,g);s(m,b[t])}return m}}),yu=we((l,e)=>{de(),me(),pe();var{StringPrototypeSlice:t,SymbolIterator:i,TypedArrayPrototypeSet:r,Uint8Array:n}=Ge(),{Buffer:o}=(et(),We(Ze)),{inspect:a}=ct();e.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(s){let c={data:s,next:null};this.length>0?this.tail.next=c:this.head=c,this.tail=c,++this.length}unshift(s){let c={data:s,next:this.head};this.length===0&&(this.tail=c),this.head=c,++this.length}shift(){if(this.length===0)return;let s=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,s}clear(){this.head=this.tail=null,this.length=0}join(s){if(this.length===0)return"";let c=this.head,u=""+c.data;for(;(c=c.next)!==null;)u+=s+c.data;return u}concat(s){if(this.length===0)return o.alloc(0);let c=o.allocUnsafe(s>>>0),u=this.head,f=0;for(;u;)r(c,u.data,f),f+=u.data.length,u=u.next;return c}consume(s,c){let u=this.head.data;if(s<u.length){let f=u.slice(0,s);return this.head.data=u.slice(s),f}return s===u.length?this.shift():c?this._getString(s):this._getBuffer(s)}first(){return this.head.data}*[i](){for(let s=this.head;s;s=s.next)yield s.data}_getString(s){let c="",u=this.head,f=0;do{let d=u.data;if(s>d.length)c+=d,s-=d.length;else{s===d.length?(c+=d,++f,u.next?this.head=u.next:this.head=this.tail=null):(c+=t(d,0,s),this.head=u,u.data=t(d,s));break}++f}while((u=u.next)!==null);return this.length-=f,c}_getBuffer(s){let c=o.allocUnsafe(s),u=s,f=this.head,d=0;do{let m=f.data;if(s>m.length)r(c,m,u-s),s-=m.length;else{s===m.length?(r(c,m,u-s),++d,f.next?this.head=f.next:this.head=this.tail=null):(r(c,new n(m.buffer,m.byteOffset,s),u-s),this.head=f,f.data=m.slice(s));break}++d}while((f=f.next)!==null);return this.length-=d,c}[Symbol.for("nodejs.util.inspect.custom")](s,c){return a(this,{...c,depth:0,customInspect:!1})}}}),Wn=we((l,e)=>{de(),me(),pe();var{MathFloor:t,NumberIsInteger:i}=Ge(),{validateInteger:r}=Fr(),{ERR_INVALID_ARG_VALUE:n}=at().codes,o=16*1024,a=16;function s(d,m,g){return d.highWaterMark!=null?d.highWaterMark:m?d[g]:null}function c(d){return d?a:o}function u(d,m){r(m,"value",0),d?a=m:o=m}function f(d,m,g,b){let w=s(m,b,g);if(w!=null){if(!i(w)||w<0){let x=b?`options.${g}`:"options.highWaterMark";throw new n(x,w)}return t(w)}return c(d.objectMode)}e.exports={getHighWaterMark:f,getDefaultHighWaterMark:c,setDefaultHighWaterMark:u}}),gu=we((l,e)=>{de(),me(),pe();var t=(et(),We(Ze)),i=t.Buffer;function r(o,a){for(var s in o)a[s]=o[s]}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=t:(r(t,l),l.Buffer=n);function n(o,a,s){return i(o,a,s)}n.prototype=Object.create(i.prototype),r(i,n),n.from=function(o,a,s){if(typeof o=="number")throw new TypeError("Argument must not be a number");return i(o,a,s)},n.alloc=function(o,a,s){if(typeof o!="number")throw new TypeError("Argument must be a number");var c=i(o);return a!==void 0?typeof s=="string"?c.fill(a,s):c.fill(a):c.fill(0),c},n.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return i(o)},n.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(o)}}),bu=we(l=>{de(),me(),pe();var e=gu().Buffer,t=e.isEncoding||function(y){switch(y=""+y,y&&y.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(y){if(!y)return"utf8";for(var S;;)switch(y){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return y;default:if(S)return;y=(""+y).toLowerCase(),S=!0}}function r(y){var S=i(y);if(typeof S!="string"&&(e.isEncoding===t||!t(y)))throw new Error("Unknown encoding: "+y);return S||y}l.StringDecoder=n;function n(y){this.encoding=r(y);var S;switch(this.encoding){case"utf16le":this.text=d,this.end=m,S=4;break;case"utf8":this.fillLast=c,S=4;break;case"base64":this.text=g,this.end=b,S=3;break;default:this.write=w,this.end=x;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=e.allocUnsafe(S)}n.prototype.write=function(y){if(y.length===0)return"";var S,E;if(this.lastNeed){if(S=this.fillLast(y),S===void 0)return"";E=this.lastNeed,this.lastNeed=0}else E=0;return E<y.length?S?S+this.text(y,E):this.text(y,E):S||""},n.prototype.end=f,n.prototype.text=u,n.prototype.fillLast=function(y){if(this.lastNeed<=y.length)return y.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);y.copy(this.lastChar,this.lastTotal-this.lastNeed,0,y.length),this.lastNeed-=y.length};function o(y){return y<=127?0:y>>5===6?2:y>>4===14?3:y>>3===30?4:y>>6===2?-1:-2}function a(y,S,E){var _=S.length-1;if(_<E)return 0;var O=o(S[_]);return O>=0?(O>0&&(y.lastNeed=O-1),O):--_<E||O===-2?0:(O=o(S[_]),O>=0?(O>0&&(y.lastNeed=O-2),O):--_<E||O===-2?0:(O=o(S[_]),O>=0?(O>0&&(O===2?O=0:y.lastNeed=O-3),O):0))}function s(y,S,E){if((S[0]&192)!==128)return y.lastNeed=0,"";if(y.lastNeed>1&&S.length>1){if((S[1]&192)!==128)return y.lastNeed=1,"";if(y.lastNeed>2&&S.length>2&&(S[2]&192)!==128)return y.lastNeed=2,""}}function c(y){var S=this.lastTotal-this.lastNeed,E=s(this,y);if(E!==void 0)return E;if(this.lastNeed<=y.length)return y.copy(this.lastChar,S,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);y.copy(this.lastChar,S,0,y.length),this.lastNeed-=y.length}function u(y,S){var E=a(this,y,S);if(!this.lastNeed)return y.toString("utf8",S);this.lastTotal=E;var _=y.length-(E-this.lastNeed);return y.copy(this.lastChar,0,_),y.toString("utf8",S,_)}function f(y){var S=y&&y.length?this.write(y):"";return this.lastNeed?S+"":S}function d(y,S){if((y.length-S)%2===0){var E=y.toString("utf16le",S);if(E){var _=E.charCodeAt(E.length-1);if(_>=55296&&_<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=y[y.length-2],this.lastChar[1]=y[y.length-1],E.slice(0,-1)}return E}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=y[y.length-1],y.toString("utf16le",S,y.length-1)}function m(y){var S=y&&y.length?this.write(y):"";if(this.lastNeed){var E=this.lastTotal-this.lastNeed;return S+this.lastChar.toString("utf16le",0,E)}return S}function g(y,S){var E=(y.length-S)%3;return E===0?y.toString("base64",S):(this.lastNeed=3-E,this.lastTotal=3,E===1?this.lastChar[0]=y[y.length-1]:(this.lastChar[0]=y[y.length-2],this.lastChar[1]=y[y.length-1]),y.toString("base64",S,y.length-E))}function b(y){var S=y&&y.length?this.write(y):"";return this.lastNeed?S+this.lastChar.toString("base64",0,3-this.lastNeed):S}function w(y){return y.toString(this.encoding)}function x(y){return y&&y.length?this.write(y):""}}),Ll=we((l,e)=>{de(),me(),pe();var t=er(),{PromisePrototypeThen:i,SymbolAsyncIterator:r,SymbolIterator:n}=Ge(),{Buffer:o}=(et(),We(Ze)),{ERR_INVALID_ARG_TYPE:a,ERR_STREAM_NULL_VALUES:s}=at().codes;function c(u,f,d){let m;if(typeof f=="string"||f instanceof o)return new u({objectMode:!0,...d,read(){this.push(f),this.push(null)}});let g;if(f&&f[r])g=!0,m=f[r]();else if(f&&f[n])g=!1,m=f[n]();else throw new a("iterable",["Iterable"],f);let b=new u({objectMode:!0,highWaterMark:1,...d}),w=!1;b._read=function(){w||(w=!0,y())},b._destroy=function(S,E){i(x(S),()=>t.nextTick(E,S),_=>t.nextTick(E,_||S))};async function x(S){let E=S!=null,_=typeof m.throw=="function";if(E&&_){let{value:O,done:k}=await m.throw(S);if(await O,k)return}if(typeof m.return=="function"){let{value:O}=await m.return();await O}}async function y(){for(;;){try{let{value:S,done:E}=g?await m.next():m.next();if(E)b.push(null);else{let _=S&&typeof S.then=="function"?await S:S;if(_===null)throw w=!1,new s;if(b.push(_))continue;w=!1}}catch(S){b.destroy(S)}break}}return b}e.exports=c}),$n=we((l,e)=>{de(),me(),pe();var t=er(),{ArrayPrototypeIndexOf:i,NumberIsInteger:r,NumberIsNaN:n,NumberParseInt:o,ObjectDefineProperties:a,ObjectKeys:s,ObjectSetPrototypeOf:c,Promise:u,SafeSet:f,SymbolAsyncDispose:d,SymbolAsyncIterator:m,Symbol:g}=Ge();e.exports=ue,ue.ReadableState=xe;var{EventEmitter:b}=(Zt(),We(Wt)),{Stream:w,prependListener:x}=ps(),{Buffer:y}=(et(),We(Ze)),{addAbortSignal:S}=Fn(),E=$t(),_=ct().debuglog("stream",L=>{_=L}),O=yu(),k=dr(),{getHighWaterMark:T,getDefaultHighWaterMark:P}=Wn(),{aggregateTwoErrors:A,codes:{ERR_INVALID_ARG_TYPE:U,ERR_METHOD_NOT_IMPLEMENTED:I,ERR_OUT_OF_RANGE:B,ERR_STREAM_PUSH_AFTER_EOF:F,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:D},AbortError:J}=at(),{validateObject:G}=Fr(),Y=g("kPaused"),{StringDecoder:ce}=bu(),H=Ll();c(ue.prototype,w.prototype),c(ue,w);var oe=()=>{},{errorOrDestroy:R}=k,V=1,te=2,se=4,be=8,K=16,j=32,ie=64,Z=128,re=256,ne=512,ve=1024,he=2048,$=4096,Q=8192,le=16384,ye=32768,ge=65536,Se=1<<17,ee=1<<18;function _e(L){return{enumerable:!1,get(){return(this.state&L)!==0},set(z){z?this.state|=L:this.state&=~L}}}a(xe.prototype,{objectMode:_e(V),ended:_e(te),endEmitted:_e(se),reading:_e(be),constructed:_e(K),sync:_e(j),needReadable:_e(ie),emittedReadable:_e(Z),readableListening:_e(re),resumeScheduled:_e(ne),errorEmitted:_e(ve),emitClose:_e(he),autoDestroy:_e($),destroyed:_e(Q),closed:_e(le),closeEmitted:_e(ye),multiAwaitDrain:_e(ge),readingMore:_e(Se),dataEmitted:_e(ee)});function xe(L,z,Ee){typeof Ee!="boolean"&&(Ee=z instanceof Et()),this.state=he|$|K|j,L&&L.objectMode&&(this.state|=V),Ee&&L&&L.readableObjectMode&&(this.state|=V),this.highWaterMark=L?T(this,L,"readableHighWaterMark",Ee):P(!1),this.buffer=new O,this.length=0,this.pipes=[],this.flowing=null,this[Y]=null,L&&L.emitClose===!1&&(this.state&=~he),L&&L.autoDestroy===!1&&(this.state&=~$),this.errored=null,this.defaultEncoding=L&&L.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,L&&L.encoding&&(this.decoder=new ce(L.encoding),this.encoding=L.encoding)}function ue(L){if(!(this instanceof ue))return new ue(L);let z=this instanceof Et();this._readableState=new xe(L,this,z),L&&(typeof L.read=="function"&&(this._read=L.read),typeof L.destroy=="function"&&(this._destroy=L.destroy),typeof L.construct=="function"&&(this._construct=L.construct),L.signal&&!z&&S(L.signal,this)),w.call(this,L),k.construct(this,()=>{this._readableState.needReadable&&q(this,this._readableState)})}ue.prototype.destroy=k.destroy,ue.prototype._undestroy=k.undestroy,ue.prototype._destroy=function(L,z){z(L)},ue.prototype[b.captureRejectionSymbol]=function(L){this.destroy(L)},ue.prototype[d]=function(){let L;return this.destroyed||(L=this.readableEnded?null:new J,this.destroy(L)),new u((z,Ee)=>E(this,ke=>ke&&ke!==L?Ee(ke):z(null)))},ue.prototype.push=function(L,z){return Oe(this,L,z,!1)},ue.prototype.unshift=function(L,z){return Oe(this,L,z,!0)};function Oe(L,z,Ee,ke){_("readableAddChunk",z);let Me=L._readableState,Xe;if((Me.state&V)===0&&(typeof z=="string"?(Ee=Ee||Me.defaultEncoding,Me.encoding!==Ee&&(ke&&Me.encoding?z=y.from(z,Ee).toString(Me.encoding):(z=y.from(z,Ee),Ee=""))):z instanceof y?Ee="":w._isUint8Array(z)?(z=w._uint8ArrayToBuffer(z),Ee=""):z!=null&&(Xe=new U("chunk",["string","Buffer","Uint8Array"],z))),Xe)R(L,Xe);else if(z===null)Me.state&=~be,N(L,Me);else if((Me.state&V)!==0||z&&z.length>0)if(ke)if((Me.state&se)!==0)R(L,new D);else{if(Me.destroyed||Me.errored)return!1;h(L,Me,z,!0)}else if(Me.ended)R(L,new F);else{if(Me.destroyed||Me.errored)return!1;Me.state&=~be,Me.decoder&&!Ee?(z=Me.decoder.write(z),Me.objectMode||z.length!==0?h(L,Me,z,!1):q(L,Me)):h(L,Me,z,!1)}else ke||(Me.state&=~be,q(L,Me));return!Me.ended&&(Me.length<Me.highWaterMark||Me.length===0)}function h(L,z,Ee,ke){z.flowing&&z.length===0&&!z.sync&&L.listenerCount("data")>0?((z.state&ge)!==0?z.awaitDrainWriters.clear():z.awaitDrainWriters=null,z.dataEmitted=!0,L.emit("data",Ee)):(z.length+=z.objectMode?1:Ee.length,ke?z.buffer.unshift(Ee):z.buffer.push(Ee),(z.state&ie)!==0&&X(L)),q(L,z)}ue.prototype.isPaused=function(){let L=this._readableState;return L[Y]===!0||L.flowing===!1},ue.prototype.setEncoding=function(L){let z=new ce(L);this._readableState.decoder=z,this._readableState.encoding=this._readableState.decoder.encoding;let Ee=this._readableState.buffer,ke="";for(let Me of Ee)ke+=z.write(Me);return Ee.clear(),ke!==""&&Ee.push(ke),this._readableState.length=ke.length,this};var p=1073741824;function v(L){if(L>p)throw new B("size","<= 1GiB",L);return L--,L|=L>>>1,L|=L>>>2,L|=L>>>4,L|=L>>>8,L|=L>>>16,L++,L}function C(L,z){return L<=0||z.length===0&&z.ended?0:(z.state&V)!==0?1:n(L)?z.flowing&&z.length?z.buffer.first().length:z.length:L<=z.length?L:z.ended?z.length:0}ue.prototype.read=function(L){_("read",L),L===void 0?L=NaN:r(L)||(L=o(L,10));let z=this._readableState,Ee=L;if(L>z.highWaterMark&&(z.highWaterMark=v(L)),L!==0&&(z.state&=~Z),L===0&&z.needReadable&&((z.highWaterMark!==0?z.length>=z.highWaterMark:z.length>0)||z.ended))return _("read: emitReadable",z.length,z.ended),z.length===0&&z.ended?ze(this):X(this),null;if(L=C(L,z),L===0&&z.ended)return z.length===0&&ze(this),null;let ke=(z.state&ie)!==0;if(_("need readable",ke),(z.length===0||z.length-L<z.highWaterMark)&&(ke=!0,_("length less than watermark",ke)),z.ended||z.reading||z.destroyed||z.errored||!z.constructed)ke=!1,_("reading, ended or constructing",ke);else if(ke){_("do read"),z.state|=be|j,z.length===0&&(z.state|=ie);try{this._read(z.highWaterMark)}catch(Xe){R(this,Xe)}z.state&=~j,z.reading||(L=C(Ee,z))}let Me;return L>0?Me=Ve(L,z):Me=null,Me===null?(z.needReadable=z.length<=z.highWaterMark,L=0):(z.length-=L,z.multiAwaitDrain?z.awaitDrainWriters.clear():z.awaitDrainWriters=null),z.length===0&&(z.ended||(z.needReadable=!0),Ee!==L&&z.ended&&ze(this)),Me!==null&&!z.errorEmitted&&!z.closeEmitted&&(z.dataEmitted=!0,this.emit("data",Me)),Me};function N(L,z){if(_("onEofChunk"),!z.ended){if(z.decoder){let Ee=z.decoder.end();Ee&&Ee.length&&(z.buffer.push(Ee),z.length+=z.objectMode?1:Ee.length)}z.ended=!0,z.sync?X(L):(z.needReadable=!1,z.emittedReadable=!0,fe(L))}}function X(L){let z=L._readableState;_("emitReadable",z.needReadable,z.emittedReadable),z.needReadable=!1,z.emittedReadable||(_("emitReadable",z.flowing),z.emittedReadable=!0,t.nextTick(fe,L))}function fe(L){let z=L._readableState;_("emitReadable_",z.destroyed,z.length,z.ended),!z.destroyed&&!z.errored&&(z.length||z.ended)&&(L.emit("readable"),z.emittedReadable=!1),z.needReadable=!z.flowing&&!z.ended&&z.length<=z.highWaterMark,Ue(L)}function q(L,z){!z.readingMore&&z.constructed&&(z.readingMore=!0,t.nextTick(ae,L,z))}function ae(L,z){for(;!z.reading&&!z.ended&&(z.length<z.highWaterMark||z.flowing&&z.length===0);){let Ee=z.length;if(_("maybeReadMore read 0"),L.read(0),Ee===z.length)break}z.readingMore=!1}ue.prototype._read=function(L){throw new I("_read()")},ue.prototype.pipe=function(L,z){let Ee=this,ke=this._readableState;ke.pipes.length===1&&(ke.multiAwaitDrain||(ke.multiAwaitDrain=!0,ke.awaitDrainWriters=new f(ke.awaitDrainWriters?[ke.awaitDrainWriters]:[]))),ke.pipes.push(L),_("pipe count=%d opts=%j",ke.pipes.length,z);let Me=(!z||z.end!==!1)&&L!==t.stdout&&L!==t.stderr?ot:qt;ke.endEmitted?t.nextTick(Me):Ee.once("end",Me),L.on("unpipe",Xe);function Xe(mt,bt){_("onunpipe"),mt===Ee&&bt&&bt.hasUnpiped===!1&&(bt.hasUnpiped=!0,gr())}function ot(){_("onend"),L.end()}let dt,yr=!1;function gr(){_("cleanup"),L.removeListener("close",pt),L.removeListener("finish",Mt),dt&&L.removeListener("drain",dt),L.removeListener("error",zt),L.removeListener("unpipe",Xe),Ee.removeListener("end",ot),Ee.removeListener("end",qt),Ee.removeListener("data",$r),yr=!0,dt&&ke.awaitDrainWriters&&(!L._writableState||L._writableState.needDrain)&&dt()}function br(){yr||(ke.pipes.length===1&&ke.pipes[0]===L?(_("false write response, pause",0),ke.awaitDrainWriters=L,ke.multiAwaitDrain=!1):ke.pipes.length>1&&ke.pipes.includes(L)&&(_("false write response, pause",ke.awaitDrainWriters.size),ke.awaitDrainWriters.add(L)),Ee.pause()),dt||(dt=Te(Ee,L),L.on("drain",dt))}Ee.on("data",$r);function $r(mt){_("ondata");let bt=L.write(mt);_("dest.write",bt),bt===!1&&br()}function zt(mt){if(_("onerror",mt),qt(),L.removeListener("error",zt),L.listenerCount("error")===0){let bt=L._writableState||L._readableState;bt&&!bt.errorEmitted?R(L,mt):L.emit("error",mt)}}x(L,"error",zt);function pt(){L.removeListener("finish",Mt),qt()}L.once("close",pt);function Mt(){_("onfinish"),L.removeListener("close",pt),qt()}L.once("finish",Mt);function qt(){_("unpipe"),Ee.unpipe(L)}return L.emit("pipe",Ee),L.writableNeedDrain===!0?br():ke.flowing||(_("pipe resume"),Ee.resume()),L};function Te(L,z){return function(){let Ee=L._readableState;Ee.awaitDrainWriters===z?(_("pipeOnDrain",1),Ee.awaitDrainWriters=null):Ee.multiAwaitDrain&&(_("pipeOnDrain",Ee.awaitDrainWriters.size),Ee.awaitDrainWriters.delete(z)),(!Ee.awaitDrainWriters||Ee.awaitDrainWriters.size===0)&&L.listenerCount("data")&&L.resume()}}ue.prototype.unpipe=function(L){let z=this._readableState,Ee={hasUnpiped:!1};if(z.pipes.length===0)return this;if(!L){let Me=z.pipes;z.pipes=[],this.pause();for(let Xe=0;Xe<Me.length;Xe++)Me[Xe].emit("unpipe",this,{hasUnpiped:!1});return this}let ke=i(z.pipes,L);return ke===-1?this:(z.pipes.splice(ke,1),z.pipes.length===0&&this.pause(),L.emit("unpipe",this,Ee),this)},ue.prototype.on=function(L,z){let Ee=w.prototype.on.call(this,L,z),ke=this._readableState;return L==="data"?(ke.readableListening=this.listenerCount("readable")>0,ke.flowing!==!1&&this.resume()):L==="readable"&&!ke.endEmitted&&!ke.readableListening&&(ke.readableListening=ke.needReadable=!0,ke.flowing=!1,ke.emittedReadable=!1,_("on readable",ke.length,ke.reading),ke.length?X(this):ke.reading||t.nextTick(Re,this)),Ee},ue.prototype.addListener=ue.prototype.on,ue.prototype.removeListener=function(L,z){let Ee=w.prototype.removeListener.call(this,L,z);return L==="readable"&&t.nextTick(Ie,this),Ee},ue.prototype.off=ue.prototype.removeListener,ue.prototype.removeAllListeners=function(L){let z=w.prototype.removeAllListeners.apply(this,arguments);return(L==="readable"||L===void 0)&&t.nextTick(Ie,this),z};function Ie(L){let z=L._readableState;z.readableListening=L.listenerCount("readable")>0,z.resumeScheduled&&z[Y]===!1?z.flowing=!0:L.listenerCount("data")>0?L.resume():z.readableListening||(z.flowing=null)}function Re(L){_("readable nexttick read 0"),L.read(0)}ue.prototype.resume=function(){let L=this._readableState;return L.flowing||(_("resume"),L.flowing=!L.readableListening,Le(this,L)),L[Y]=!1,this};function Le(L,z){z.resumeScheduled||(z.resumeScheduled=!0,t.nextTick(Ke,L,z))}function Ke(L,z){_("resume",z.reading),z.reading||L.read(0),z.resumeScheduled=!1,L.emit("resume"),Ue(L),z.flowing&&!z.reading&&L.read(0)}ue.prototype.pause=function(){return _("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(_("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[Y]=!0,this};function Ue(L){let z=L._readableState;for(_("flow",z.flowing);z.flowing&&L.read()!==null;);}ue.prototype.wrap=function(L){let z=!1;L.on("data",ke=>{!this.push(ke)&&L.pause&&(z=!0,L.pause())}),L.on("end",()=>{this.push(null)}),L.on("error",ke=>{R(this,ke)}),L.on("close",()=>{this.destroy()}),L.on("destroy",()=>{this.destroy()}),this._read=()=>{z&&L.resume&&(z=!1,L.resume())};let Ee=s(L);for(let ke=1;ke<Ee.length;ke++){let Me=Ee[ke];this[Me]===void 0&&typeof L[Me]=="function"&&(this[Me]=L[Me].bind(L))}return this},ue.prototype[m]=function(){return Ne(this)},ue.prototype.iterator=function(L){return L!==void 0&&G(L,"options"),Ne(this,L)};function Ne(L,z){typeof L.read!="function"&&(L=ue.wrap(L,{objectMode:!0}));let Ee=De(L,z);return Ee.stream=L,Ee}async function*De(L,z){let Ee=oe;function ke(ot){this===L?(Ee(),Ee=oe):Ee=ot}L.on("readable",ke);let Me,Xe=E(L,{writable:!1},ot=>{Me=ot?A(Me,ot):null,Ee(),Ee=oe});try{for(;;){let ot=L.destroyed?null:L.read();if(ot!==null)yield ot;else{if(Me)throw Me;if(Me===null)return;await new u(ke)}}}catch(ot){throw Me=A(Me,ot),Me}finally{(Me||z?.destroyOnReturn!==!1)&&(Me===void 0||L._readableState.autoDestroy)?k.destroyer(L,null):(L.off("readable",ke),Xe())}}a(ue.prototype,{readable:{__proto__:null,get(){let L=this._readableState;return!!L&&L.readable!==!1&&!L.destroyed&&!L.errorEmitted&&!L.endEmitted},set(L){this._readableState&&(this._readableState.readable=!!L)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(L){this._readableState&&(this._readableState.flowing=L)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(L){this._readableState&&(this._readableState.destroyed=L)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),a(xe.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[Y]!==!1},set(L){this[Y]=!!L}}}),ue._fromList=Ve;function Ve(L,z){if(z.length===0)return null;let Ee;return z.objectMode?Ee=z.buffer.shift():!L||L>=z.length?(z.decoder?Ee=z.buffer.join(""):z.buffer.length===1?Ee=z.buffer.first():Ee=z.buffer.concat(z.length),z.buffer.clear()):Ee=z.buffer.consume(L,z.decoder),Ee}function ze(L){let z=L._readableState;_("endReadable",z.endEmitted),z.endEmitted||(z.ended=!0,t.nextTick(Fe,z,L))}function Fe(L,z){if(_("endReadableNT",L.endEmitted,L.length),!L.errored&&!L.closeEmitted&&!L.endEmitted&&L.length===0){if(L.endEmitted=!0,z.emit("end"),z.writable&&z.allowHalfOpen===!1)t.nextTick(tt,z);else if(L.autoDestroy){let Ee=z._writableState;(!Ee||Ee.autoDestroy&&(Ee.finished||Ee.writable===!1))&&z.destroy()}}}function tt(L){L.writable&&!L.writableEnded&&!L.destroyed&&L.end()}ue.from=function(L,z){return H(ue,L,z)};var ft;function lt(){return ft===void 0&&(ft={}),ft}ue.fromWeb=function(L,z){return lt().newStreamReadableFromReadableStream(L,z)},ue.toWeb=function(L,z){return lt().newReadableStreamFromStreamReadable(L,z)},ue.wrap=function(L,z){var Ee,ke;return new ue({objectMode:(Ee=(ke=L.readableObjectMode)!==null&&ke!==void 0?ke:L.objectMode)!==null&&Ee!==void 0?Ee:!0,...z,destroy(Me,Xe){k.destroyer(L,Me),Xe(Me)}}).wrap(L)}}),ms=we((l,e)=>{de(),me(),pe();var t=er(),{ArrayPrototypeSlice:i,Error:r,FunctionPrototypeSymbolHasInstance:n,ObjectDefineProperty:o,ObjectDefineProperties:a,ObjectSetPrototypeOf:s,StringPrototypeToLowerCase:c,Symbol:u,SymbolHasInstance:f}=Ge();e.exports=G,G.WritableState=D;var{EventEmitter:d}=(Zt(),We(Wt)),m=ps().Stream,{Buffer:g}=(et(),We(Ze)),b=dr(),{addAbortSignal:w}=Fn(),{getHighWaterMark:x,getDefaultHighWaterMark:y}=Wn(),{ERR_INVALID_ARG_TYPE:S,ERR_METHOD_NOT_IMPLEMENTED:E,ERR_MULTIPLE_CALLBACK:_,ERR_STREAM_CANNOT_PIPE:O,ERR_STREAM_DESTROYED:k,ERR_STREAM_ALREADY_FINISHED:T,ERR_STREAM_NULL_VALUES:P,ERR_STREAM_WRITE_AFTER_END:A,ERR_UNKNOWN_ENCODING:U}=at().codes,{errorOrDestroy:I}=b;s(G.prototype,m.prototype),s(G,m);function B(){}var F=u("kOnFinished");function D($,Q,le){typeof le!="boolean"&&(le=Q instanceof Et()),this.objectMode=!!($&&$.objectMode),le&&(this.objectMode=this.objectMode||!!($&&$.writableObjectMode)),this.highWaterMark=$?x(this,$,"writableHighWaterMark",le):y(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;let ye=!!($&&$.decodeStrings===!1);this.decodeStrings=!ye,this.defaultEncoding=$&&$.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=R.bind(void 0,Q),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,J(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!$||$.emitClose!==!1,this.autoDestroy=!$||$.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[F]=[]}function J($){$.buffered=[],$.bufferedIndex=0,$.allBuffers=!0,$.allNoop=!0}D.prototype.getBuffer=function(){return i(this.buffered,this.bufferedIndex)},o(D.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function G($){let Q=this instanceof Et();if(!Q&&!n(G,this))return new G($);this._writableState=new D($,this,Q),$&&(typeof $.write=="function"&&(this._write=$.write),typeof $.writev=="function"&&(this._writev=$.writev),typeof $.destroy=="function"&&(this._destroy=$.destroy),typeof $.final=="function"&&(this._final=$.final),typeof $.construct=="function"&&(this._construct=$.construct),$.signal&&w($.signal,this)),m.call(this,$),b.construct(this,()=>{let le=this._writableState;le.writing||be(this,le),Z(this,le)})}o(G,f,{__proto__:null,value:function($){return n(this,$)?!0:this!==G?!1:$&&$._writableState instanceof D}}),G.prototype.pipe=function(){I(this,new O)};function Y($,Q,le,ye){let ge=$._writableState;if(typeof le=="function")ye=le,le=ge.defaultEncoding;else{if(!le)le=ge.defaultEncoding;else if(le!=="buffer"&&!g.isEncoding(le))throw new U(le);typeof ye!="function"&&(ye=B)}if(Q===null)throw new P;if(!ge.objectMode)if(typeof Q=="string")ge.decodeStrings!==!1&&(Q=g.from(Q,le),le="buffer");else if(Q instanceof g)le="buffer";else if(m._isUint8Array(Q))Q=m._uint8ArrayToBuffer(Q),le="buffer";else throw new S("chunk",["string","Buffer","Uint8Array"],Q);let Se;return ge.ending?Se=new A:ge.destroyed&&(Se=new k("write")),Se?(t.nextTick(ye,Se),I($,Se,!0),Se):(ge.pendingcb++,ce($,ge,Q,le,ye))}G.prototype.write=function($,Q,le){return Y(this,$,Q,le)===!0},G.prototype.cork=function(){this._writableState.corked++},G.prototype.uncork=function(){let $=this._writableState;$.corked&&($.corked--,$.writing||be(this,$))},G.prototype.setDefaultEncoding=function($){if(typeof $=="string"&&($=c($)),!g.isEncoding($))throw new U($);return this._writableState.defaultEncoding=$,this};function ce($,Q,le,ye,ge){let Se=Q.objectMode?1:le.length;Q.length+=Se;let ee=Q.length<Q.highWaterMark;return ee||(Q.needDrain=!0),Q.writing||Q.corked||Q.errored||!Q.constructed?(Q.buffered.push({chunk:le,encoding:ye,callback:ge}),Q.allBuffers&&ye!=="buffer"&&(Q.allBuffers=!1),Q.allNoop&&ge!==B&&(Q.allNoop=!1)):(Q.writelen=Se,Q.writecb=ge,Q.writing=!0,Q.sync=!0,$._write(le,ye,Q.onwrite),Q.sync=!1),ee&&!Q.errored&&!Q.destroyed}function H($,Q,le,ye,ge,Se,ee){Q.writelen=ye,Q.writecb=ee,Q.writing=!0,Q.sync=!0,Q.destroyed?Q.onwrite(new k("write")):le?$._writev(ge,Q.onwrite):$._write(ge,Se,Q.onwrite),Q.sync=!1}function oe($,Q,le,ye){--Q.pendingcb,ye(le),se(Q),I($,le)}function R($,Q){let le=$._writableState,ye=le.sync,ge=le.writecb;if(typeof ge!="function"){I($,new _);return}le.writing=!1,le.writecb=null,le.length-=le.writelen,le.writelen=0,Q?(Q.stack,le.errored||(le.errored=Q),$._readableState&&!$._readableState.errored&&($._readableState.errored=Q),ye?t.nextTick(oe,$,le,Q,ge):oe($,le,Q,ge)):(le.buffered.length>le.bufferedIndex&&be($,le),ye?le.afterWriteTickInfo!==null&&le.afterWriteTickInfo.cb===ge?le.afterWriteTickInfo.count++:(le.afterWriteTickInfo={count:1,cb:ge,stream:$,state:le},t.nextTick(V,le.afterWriteTickInfo)):te($,le,1,ge))}function V({stream:$,state:Q,count:le,cb:ye}){return Q.afterWriteTickInfo=null,te($,Q,le,ye)}function te($,Q,le,ye){for(!Q.ending&&!$.destroyed&&Q.length===0&&Q.needDrain&&(Q.needDrain=!1,$.emit("drain"));le-- >0;)Q.pendingcb--,ye();Q.destroyed&&se(Q),Z($,Q)}function se($){if($.writing)return;for(let ge=$.bufferedIndex;ge<$.buffered.length;++ge){var Q;let{chunk:Se,callback:ee}=$.buffered[ge],_e=$.objectMode?1:Se.length;$.length-=_e,ee((Q=$.errored)!==null&&Q!==void 0?Q:new k("write"))}let le=$[F].splice(0);for(let ge=0;ge<le.length;ge++){var ye;le[ge]((ye=$.errored)!==null&&ye!==void 0?ye:new k("end"))}J($)}function be($,Q){if(Q.corked||Q.bufferProcessing||Q.destroyed||!Q.constructed)return;let{buffered:le,bufferedIndex:ye,objectMode:ge}=Q,Se=le.length-ye;if(!Se)return;let ee=ye;if(Q.bufferProcessing=!0,Se>1&&$._writev){Q.pendingcb-=Se-1;let _e=Q.allNoop?B:ue=>{for(let Oe=ee;Oe<le.length;++Oe)le[Oe].callback(ue)},xe=Q.allNoop&&ee===0?le:i(le,ee);xe.allBuffers=Q.allBuffers,H($,Q,!0,Q.length,xe,"",_e),J(Q)}else{do{let{chunk:_e,encoding:xe,callback:ue}=le[ee];le[ee++]=null;let Oe=ge?1:_e.length;H($,Q,!1,Oe,_e,xe,ue)}while(ee<le.length&&!Q.writing);ee===le.length?J(Q):ee>256?(le.splice(0,ee),Q.bufferedIndex=0):Q.bufferedIndex=ee}Q.bufferProcessing=!1}G.prototype._write=function($,Q,le){if(this._writev)this._writev([{chunk:$,encoding:Q}],le);else throw new E("_write()")},G.prototype._writev=null,G.prototype.end=function($,Q,le){let ye=this._writableState;typeof $=="function"?(le=$,$=null,Q=null):typeof Q=="function"&&(le=Q,Q=null);let ge;if($!=null){let Se=Y(this,$,Q);Se instanceof r&&(ge=Se)}return ye.corked&&(ye.corked=1,this.uncork()),ge||(!ye.errored&&!ye.ending?(ye.ending=!0,Z(this,ye,!0),ye.ended=!0):ye.finished?ge=new T("end"):ye.destroyed&&(ge=new k("end"))),typeof le=="function"&&(ge||ye.finished?t.nextTick(le,ge):ye[F].push(le)),this};function K($){return $.ending&&!$.destroyed&&$.constructed&&$.length===0&&!$.errored&&$.buffered.length===0&&!$.finished&&!$.writing&&!$.errorEmitted&&!$.closeEmitted}function j($,Q){let le=!1;function ye(ge){if(le){I($,ge??_());return}if(le=!0,Q.pendingcb--,ge){let Se=Q[F].splice(0);for(let ee=0;ee<Se.length;ee++)Se[ee](ge);I($,ge,Q.sync)}else K(Q)&&(Q.prefinished=!0,$.emit("prefinish"),Q.pendingcb++,t.nextTick(re,$,Q))}Q.sync=!0,Q.pendingcb++;try{$._final(ye)}catch(ge){ye(ge)}Q.sync=!1}function ie($,Q){!Q.prefinished&&!Q.finalCalled&&(typeof $._final=="function"&&!Q.destroyed?(Q.finalCalled=!0,j($,Q)):(Q.prefinished=!0,$.emit("prefinish")))}function Z($,Q,le){K(Q)&&(ie($,Q),Q.pendingcb===0&&(le?(Q.pendingcb++,t.nextTick((ye,ge)=>{K(ge)?re(ye,ge):ge.pendingcb--},$,Q)):K(Q)&&(Q.pendingcb++,re($,Q))))}function re($,Q){Q.pendingcb--,Q.finished=!0;let le=Q[F].splice(0);for(let ye=0;ye<le.length;ye++)le[ye]();if($.emit("finish"),Q.autoDestroy){let ye=$._readableState;(!ye||ye.autoDestroy&&(ye.endEmitted||ye.readable===!1))&&$.destroy()}}a(G.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set($){this._writableState&&(this._writableState.destroyed=$)}},writable:{__proto__:null,get(){let $=this._writableState;return!!$&&$.writable!==!1&&!$.destroyed&&!$.errored&&!$.ending&&!$.ended},set($){this._writableState&&(this._writableState.writable=!!$)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){let $=this._writableState;return $?!$.destroyed&&!$.ending&&$.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});var ne=b.destroy;G.prototype.destroy=function($,Q){let le=this._writableState;return!le.destroyed&&(le.bufferedIndex<le.buffered.length||le[F].length)&&t.nextTick(se,le),ne.call(this,$,Q),this},G.prototype._undestroy=b.undestroy,G.prototype._destroy=function($,Q){Q($)},G.prototype[d.captureRejectionSymbol]=function($){this.destroy($)};var ve;function he(){return ve===void 0&&(ve={}),ve}G.fromWeb=function($,Q){return he().newStreamWritableFromWritableStream($,Q)},G.toWeb=function($){return he().newWritableStreamFromStreamWritable($)}}),vu=we((l,e)=>{de(),me(),pe();var t=er(),i=(et(),We(Ze)),{isReadable:r,isWritable:n,isIterable:o,isNodeStream:a,isReadableNodeStream:s,isWritableNodeStream:c,isDuplexNodeStream:u,isReadableStream:f,isWritableStream:d}=At(),m=$t(),{AbortError:g,codes:{ERR_INVALID_ARG_TYPE:b,ERR_INVALID_RETURN_VALUE:w}}=at(),{destroyer:x}=dr(),y=Et(),S=$n(),E=ms(),{createDeferredPromise:_}=ct(),O=Ll(),k=globalThis.Blob||i.Blob,T=typeof k<"u"?function(F){return F instanceof k}:function(F){return!1},P=globalThis.AbortController||Br().AbortController,{FunctionPrototypeCall:A}=Ge(),U=class extends y{constructor(F){super(F),F?.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),F?.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}};e.exports=function F(D,J){if(u(D))return D;if(s(D))return B({readable:D});if(c(D))return B({writable:D});if(a(D))return B({writable:!1,readable:!1});if(f(D))return B({readable:S.fromWeb(D)});if(d(D))return B({writable:E.fromWeb(D)});if(typeof D=="function"){let{value:Y,write:ce,final:H,destroy:oe}=I(D);if(o(Y))return O(U,Y,{objectMode:!0,write:ce,final:H,destroy:oe});let R=Y?.then;if(typeof R=="function"){let V,te=A(R,Y,se=>{if(se!=null)throw new w("nully","body",se)},se=>{x(V,se)});return V=new U({objectMode:!0,readable:!1,write:ce,final(se){H(async()=>{try{await te,t.nextTick(se,null)}catch(be){t.nextTick(se,be)}})},destroy:oe})}throw new w("Iterable, AsyncIterable or AsyncFunction",J,Y)}if(T(D))return F(D.arrayBuffer());if(o(D))return O(U,D,{objectMode:!0,writable:!1});if(f(D?.readable)&&d(D?.writable))return U.fromWeb(D);if(typeof D?.writable=="object"||typeof D?.readable=="object"){let Y=D!=null&&D.readable?s(D?.readable)?D?.readable:F(D.readable):void 0,ce=D!=null&&D.writable?c(D?.writable)?D?.writable:F(D.writable):void 0;return B({readable:Y,writable:ce})}let G=D?.then;if(typeof G=="function"){let Y;return A(G,D,ce=>{ce!=null&&Y.push(ce),Y.push(null)},ce=>{x(Y,ce)}),Y=new U({objectMode:!0,writable:!1,read(){}})}throw new b(J,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],D)};function I(F){let{promise:D,resolve:J}=_(),G=new P,Y=G.signal;return{value:F((async function*(){for(;;){let ce=D;D=null;let{chunk:H,done:oe,cb:R}=await ce;if(t.nextTick(R),oe)return;if(Y.aborted)throw new g(void 0,{cause:Y.reason});({promise:D,resolve:J}=_()),yield H}})(),{signal:Y}),write(ce,H,oe){let R=J;J=null,R({chunk:ce,done:!1,cb:oe})},final(ce){let H=J;J=null,H({done:!0,cb:ce})},destroy(ce,H){G.abort(),H(ce)}}}function B(F){let D=F.readable&&typeof F.readable.read!="function"?S.wrap(F.readable):F.readable,J=F.writable,G=!!r(D),Y=!!n(J),ce,H,oe,R,V;function te(se){let be=R;R=null,be?be(se):se&&V.destroy(se)}return V=new U({readableObjectMode:!!(D!=null&&D.readableObjectMode),writableObjectMode:!!(J!=null&&J.writableObjectMode),readable:G,writable:Y}),Y&&(m(J,se=>{Y=!1,se&&x(D,se),te(se)}),V._write=function(se,be,K){J.write(se,be)?K():ce=K},V._final=function(se){J.end(),H=se},J.on("drain",function(){if(ce){let se=ce;ce=null,se()}}),J.on("finish",function(){if(H){let se=H;H=null,se()}})),G&&(m(D,se=>{G=!1,se&&x(D,se),te(se)}),D.on("readable",function(){if(oe){let se=oe;oe=null,se()}}),D.on("end",function(){V.push(null)}),V._read=function(){for(;;){let se=D.read();if(se===null){oe=V._read;return}if(!V.push(se))return}}),V._destroy=function(se,be){!se&&R!==null&&(se=new g),oe=null,ce=null,H=null,R===null?be(se):(R=be,x(J,se),x(D,se))},V}}),Et=we((l,e)=>{de(),me(),pe();var{ObjectDefineProperties:t,ObjectGetOwnPropertyDescriptor:i,ObjectKeys:r,ObjectSetPrototypeOf:n}=Ge();e.exports=s;var o=$n(),a=ms();n(s.prototype,o.prototype),n(s,o);{let d=r(a.prototype);for(let m=0;m<d.length;m++){let g=d[m];s.prototype[g]||(s.prototype[g]=a.prototype[g])}}function s(d){if(!(this instanceof s))return new s(d);o.call(this,d),a.call(this,d),d?(this.allowHalfOpen=d.allowHalfOpen!==!1,d.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),d.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}t(s.prototype,{writable:{__proto__:null,...i(a.prototype,"writable")},writableHighWaterMark:{__proto__:null,...i(a.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...i(a.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...i(a.prototype,"writableBuffer")},writableLength:{__proto__:null,...i(a.prototype,"writableLength")},writableFinished:{__proto__:null,...i(a.prototype,"writableFinished")},writableCorked:{__proto__:null,...i(a.prototype,"writableCorked")},writableEnded:{__proto__:null,...i(a.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...i(a.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(d){this._readableState&&this._writableState&&(this._readableState.destroyed=d,this._writableState.destroyed=d)}}});var c;function u(){return c===void 0&&(c={}),c}s.fromWeb=function(d,m){return u().newStreamDuplexFromReadableWritablePair(d,m)},s.toWeb=function(d){return u().newReadableWritablePairFromDuplex(d)};var f;s.from=function(d){return f||(f=vu()),f(d,"body")}}),Bl=we((l,e)=>{de(),me(),pe();var{ObjectSetPrototypeOf:t,Symbol:i}=Ge();e.exports=s;var{ERR_METHOD_NOT_IMPLEMENTED:r}=at().codes,n=Et(),{getHighWaterMark:o}=Wn();t(s.prototype,n.prototype),t(s,n);var a=i("kCallback");function s(f){if(!(this instanceof s))return new s(f);let d=f?o(this,f,"readableHighWaterMark",!0):null;d===0&&(f={...f,highWaterMark:null,readableHighWaterMark:d,writableHighWaterMark:f.writableHighWaterMark||0}),n.call(this,f),this._readableState.sync=!1,this[a]=null,f&&(typeof f.transform=="function"&&(this._transform=f.transform),typeof f.flush=="function"&&(this._flush=f.flush)),this.on("prefinish",u)}function c(f){typeof this._flush=="function"&&!this.destroyed?this._flush((d,m)=>{if(d){f?f(d):this.destroy(d);return}m!=null&&this.push(m),this.push(null),f&&f()}):(this.push(null),f&&f())}function u(){this._final!==c&&c.call(this)}s.prototype._final=c,s.prototype._transform=function(f,d,m){throw new r("_transform()")},s.prototype._write=function(f,d,m){let g=this._readableState,b=this._writableState,w=g.length;this._transform(f,d,(x,y)=>{if(x){m(x);return}y!=null&&this.push(y),b.ended||w===g.length||g.length<g.highWaterMark?m():this[a]=m})},s.prototype._read=function(){if(this[a]){let f=this[a];this[a]=null,f()}}}),Ul=we((l,e)=>{de(),me(),pe();var{ObjectSetPrototypeOf:t}=Ge();e.exports=r;var i=Bl();t(r.prototype,i.prototype),t(r,i);function r(n){if(!(this instanceof r))return new r(n);i.call(this,n)}r.prototype._transform=function(n,o,a){a(null,n)}}),ys=we((l,e)=>{de(),me(),pe();var t=er(),{ArrayIsArray:i,Promise:r,SymbolAsyncIterator:n,SymbolDispose:o}=Ge(),a=$t(),{once:s}=ct(),c=dr(),u=Et(),{aggregateTwoErrors:f,codes:{ERR_INVALID_ARG_TYPE:d,ERR_INVALID_RETURN_VALUE:m,ERR_MISSING_ARGS:g,ERR_STREAM_DESTROYED:b,ERR_STREAM_PREMATURE_CLOSE:w},AbortError:x}=at(),{validateFunction:y,validateAbortSignal:S}=Fr(),{isIterable:E,isReadable:_,isReadableNodeStream:O,isNodeStream:k,isTransformStream:T,isWebStream:P,isReadableStream:A,isReadableFinished:U}=At(),I=globalThis.AbortController||Br().AbortController,B,F,D;function J(se,be,K){let j=!1;se.on("close",()=>{j=!0});let ie=a(se,{readable:be,writable:K},Z=>{j=!Z});return{destroy:Z=>{j||(j=!0,c.destroyer(se,Z||new b("pipe")))},cleanup:ie}}function G(se){return y(se[se.length-1],"streams[stream.length - 1]"),se.pop()}function Y(se){if(E(se))return se;if(O(se))return ce(se);throw new d("val",["Readable","Iterable","AsyncIterable"],se)}async function*ce(se){F||(F=$n()),yield*F.prototype[n].call(se)}async function H(se,be,K,{end:j}){let ie,Z=null,re=he=>{if(he&&(ie=he),Z){let $=Z;Z=null,$()}},ne=()=>new r((he,$)=>{ie?$(ie):Z=()=>{ie?$(ie):he()}});be.on("drain",re);let ve=a(be,{readable:!1},re);try{be.writableNeedDrain&&await ne();for await(let he of se)be.write(he)||await ne();j&&(be.end(),await ne()),K()}catch(he){K(ie!==he?f(ie,he):he)}finally{ve(),be.off("drain",re)}}async function oe(se,be,K,{end:j}){T(be)&&(be=be.writable);let ie=be.getWriter();try{for await(let Z of se)await ie.ready,ie.write(Z).catch(()=>{});await ie.ready,j&&await ie.close(),K()}catch(Z){try{await ie.abort(Z),K(Z)}catch(re){K(re)}}}function R(...se){return V(se,s(G(se)))}function V(se,be,K){if(se.length===1&&i(se[0])&&(se=se[0]),se.length<2)throw new g("streams");let j=new I,ie=j.signal,Z=K?.signal,re=[];S(Z,"options.signal");function ne(){ge(new x)}D=D||ct().addAbortListener;let ve;Z&&(ve=D(Z,ne));let he,$,Q=[],le=0;function ye(xe){ge(xe,--le===0)}function ge(xe,ue){var Oe;if(xe&&(!he||he.code==="ERR_STREAM_PREMATURE_CLOSE")&&(he=xe),!(!he&&!ue)){for(;Q.length;)Q.shift()(he);(Oe=ve)===null||Oe===void 0||Oe[o](),j.abort(),ue&&(he||re.forEach(h=>h()),t.nextTick(be,he,$))}}let Se;for(let xe=0;xe<se.length;xe++){let ue=se[xe],Oe=xe<se.length-1,h=xe>0,p=Oe||K?.end!==!1,v=xe===se.length-1;if(k(ue)){let C=function(N){N&&N.name!=="AbortError"&&N.code!=="ERR_STREAM_PREMATURE_CLOSE"&&ye(N)};if(p){let{destroy:N,cleanup:X}=J(ue,Oe,h);Q.push(N),_(ue)&&v&&re.push(X)}ue.on("error",C),_(ue)&&v&&re.push(()=>{ue.removeListener("error",C)})}if(xe===0)if(typeof ue=="function"){if(Se=ue({signal:ie}),!E(Se))throw new m("Iterable, AsyncIterable or Stream","source",Se)}else E(ue)||O(ue)||T(ue)?Se=ue:Se=u.from(ue);else if(typeof ue=="function"){if(T(Se)){var ee;Se=Y((ee=Se)===null||ee===void 0?void 0:ee.readable)}else Se=Y(Se);if(Se=ue(Se,{signal:ie}),Oe){if(!E(Se,!0))throw new m("AsyncIterable",`transform[${xe-1}]`,Se)}else{var _e;B||(B=Ul());let C=new B({objectMode:!0}),N=(_e=Se)===null||_e===void 0?void 0:_e.then;if(typeof N=="function")le++,N.call(Se,q=>{$=q,q!=null&&C.write(q),p&&C.end(),t.nextTick(ye)},q=>{C.destroy(q),t.nextTick(ye,q)});else if(E(Se,!0))le++,H(Se,C,ye,{end:p});else if(A(Se)||T(Se)){let q=Se.readable||Se;le++,H(q,C,ye,{end:p})}else throw new m("AsyncIterable or Promise","destination",Se);Se=C;let{destroy:X,cleanup:fe}=J(Se,!1,!0);Q.push(X),v&&re.push(fe)}}else if(k(ue)){if(O(Se)){le+=2;let C=te(Se,ue,ye,{end:p});_(ue)&&v&&re.push(C)}else if(T(Se)||A(Se)){let C=Se.readable||Se;le++,H(C,ue,ye,{end:p})}else if(E(Se))le++,H(Se,ue,ye,{end:p});else throw new d("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Se);Se=ue}else if(P(ue)){if(O(Se))le++,oe(Y(Se),ue,ye,{end:p});else if(A(Se)||E(Se))le++,oe(Se,ue,ye,{end:p});else if(T(Se))le++,oe(Se.readable,ue,ye,{end:p});else throw new d("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Se);Se=ue}else Se=u.from(ue)}return(ie!=null&&ie.aborted||Z!=null&&Z.aborted)&&t.nextTick(ne),Se}function te(se,be,K,{end:j}){let ie=!1;if(be.on("close",()=>{ie||K(new w)}),se.pipe(be,{end:!1}),j){let Z=function(){ie=!0,be.end()};U(se)?t.nextTick(Z):se.once("end",Z)}else K();return a(se,{readable:!0,writable:!1},Z=>{let re=se._readableState;Z&&Z.code==="ERR_STREAM_PREMATURE_CLOSE"&&re&&re.ended&&!re.errored&&!re.errorEmitted?se.once("end",K).once("error",K):K(Z)}),a(be,{readable:!1,writable:!0},K)}e.exports={pipelineImpl:V,pipeline:R}}),Dl=we((l,e)=>{de(),me(),pe();var{pipeline:t}=ys(),i=Et(),{destroyer:r}=dr(),{isNodeStream:n,isReadable:o,isWritable:a,isWebStream:s,isTransformStream:c,isWritableStream:u,isReadableStream:f}=At(),{AbortError:d,codes:{ERR_INVALID_ARG_VALUE:m,ERR_MISSING_ARGS:g}}=at(),b=$t();e.exports=function(...w){if(w.length===0)throw new g("streams");if(w.length===1)return i.from(w[0]);let x=[...w];if(typeof w[0]=="function"&&(w[0]=i.from(w[0])),typeof w[w.length-1]=="function"){let I=w.length-1;w[I]=i.from(w[I])}for(let I=0;I<w.length;++I)if(!(!n(w[I])&&!s(w[I]))){if(I<w.length-1&&!(o(w[I])||f(w[I])||c(w[I])))throw new m(`streams[${I}]`,x[I],"must be readable");if(I>0&&!(a(w[I])||u(w[I])||c(w[I])))throw new m(`streams[${I}]`,x[I],"must be writable")}let y,S,E,_,O;function k(I){let B=_;_=null,B?B(I):I?O.destroy(I):!U&&!A&&O.destroy()}let T=w[0],P=t(w,k),A=!!(a(T)||u(T)||c(T)),U=!!(o(P)||f(P)||c(P));if(O=new i({writableObjectMode:!!(T!=null&&T.writableObjectMode),readableObjectMode:!!(P!=null&&P.readableObjectMode),writable:A,readable:U}),A){if(n(T))O._write=function(B,F,D){T.write(B,F)?D():y=D},O._final=function(B){T.end(),S=B},T.on("drain",function(){if(y){let B=y;y=null,B()}});else if(s(T)){let B=(c(T)?T.writable:T).getWriter();O._write=async function(F,D,J){try{await B.ready,B.write(F).catch(()=>{}),J()}catch(G){J(G)}},O._final=async function(F){try{await B.ready,B.close().catch(()=>{}),S=F}catch(D){F(D)}}}let I=c(P)?P.readable:P;b(I,()=>{if(S){let B=S;S=null,B()}})}if(U){if(n(P))P.on("readable",function(){if(E){let I=E;E=null,I()}}),P.on("end",function(){O.push(null)}),O._read=function(){for(;;){let I=P.read();if(I===null){E=O._read;return}if(!O.push(I))return}};else if(s(P)){let I=(c(P)?P.readable:P).getReader();O._read=async function(){for(;;)try{let{value:B,done:F}=await I.read();if(!O.push(B))return;if(F){O.push(null);return}}catch{return}}}}return O._destroy=function(I,B){!I&&_!==null&&(I=new d),E=null,y=null,S=null,_===null?B(I):(_=B,n(P)&&r(P,I))},O}}),wu=we((l,e)=>{de(),me(),pe();var t=globalThis.AbortController||Br().AbortController,{codes:{ERR_INVALID_ARG_VALUE:i,ERR_INVALID_ARG_TYPE:r,ERR_MISSING_ARGS:n,ERR_OUT_OF_RANGE:o},AbortError:a}=at(),{validateAbortSignal:s,validateInteger:c,validateObject:u}=Fr(),f=Ge().Symbol("kWeak"),d=Ge().Symbol("kResistStopPropagation"),{finished:m}=$t(),g=Dl(),{addAbortSignalNoValidate:b}=Fn(),{isWritable:w,isNodeStream:x}=At(),{deprecate:y}=ct(),{ArrayPrototypePush:S,Boolean:E,MathFloor:_,Number:O,NumberIsNaN:k,Promise:T,PromiseReject:P,PromiseResolve:A,PromisePrototypeThen:U,Symbol:I}=Ge(),B=I("kEmpty"),F=I("kEof");function D(Z,re){if(re!=null&&u(re,"options"),re?.signal!=null&&s(re.signal,"options.signal"),x(Z)&&!w(Z))throw new i("stream",Z,"must be writable");let ne=g(this,Z);return re!=null&&re.signal&&b(re.signal,ne),ne}function J(Z,re){if(typeof Z!="function")throw new r("fn",["Function","AsyncFunction"],Z);re!=null&&u(re,"options"),re?.signal!=null&&s(re.signal,"options.signal");let ne=1;re?.concurrency!=null&&(ne=_(re.concurrency));let ve=ne-1;return re?.highWaterMark!=null&&(ve=_(re.highWaterMark)),c(ne,"options.concurrency",1),c(ve,"options.highWaterMark",0),ve+=ne,async function*(){let he=ct().AbortSignalAny([re?.signal].filter(E)),$=this,Q=[],le={signal:he},ye,ge,Se=!1,ee=0;function _e(){Se=!0,xe()}function xe(){ee-=1,ue()}function ue(){ge&&!Se&&ee<ne&&Q.length<ve&&(ge(),ge=null)}async function Oe(){try{for await(let h of $){if(Se)return;if(he.aborted)throw new a;try{if(h=Z(h,le),h===B)continue;h=A(h)}catch(p){h=P(p)}ee+=1,U(h,xe,_e),Q.push(h),ye&&(ye(),ye=null),!Se&&(Q.length>=ve||ee>=ne)&&await new T(p=>{ge=p})}Q.push(F)}catch(h){let p=P(h);U(p,xe,_e),Q.push(p)}finally{Se=!0,ye&&(ye(),ye=null)}}Oe();try{for(;;){for(;Q.length>0;){let h=await Q[0];if(h===F)return;if(he.aborted)throw new a;h!==B&&(yield h),Q.shift(),ue()}await new T(h=>{ye=h})}}finally{Se=!0,ge&&(ge(),ge=null)}}.call(this)}function G(Z=void 0){return Z!=null&&u(Z,"options"),Z?.signal!=null&&s(Z.signal,"options.signal"),async function*(){let re=0;for await(let ve of this){var ne;if(Z!=null&&(ne=Z.signal)!==null&&ne!==void 0&&ne.aborted)throw new a({cause:Z.signal.reason});yield[re++,ve]}}.call(this)}async function Y(Z,re=void 0){for await(let ne of R.call(this,Z,re))return!0;return!1}async function ce(Z,re=void 0){if(typeof Z!="function")throw new r("fn",["Function","AsyncFunction"],Z);return!await Y.call(this,async(...ne)=>!await Z(...ne),re)}async function H(Z,re){for await(let ne of R.call(this,Z,re))return ne}async function oe(Z,re){if(typeof Z!="function")throw new r("fn",["Function","AsyncFunction"],Z);async function ne(ve,he){return await Z(ve,he),B}for await(let ve of J.call(this,ne,re));}function R(Z,re){if(typeof Z!="function")throw new r("fn",["Function","AsyncFunction"],Z);async function ne(ve,he){return await Z(ve,he)?ve:B}return J.call(this,ne,re)}var V=class extends n{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};async function te(Z,re,ne){var ve;if(typeof Z!="function")throw new r("reducer",["Function","AsyncFunction"],Z);ne!=null&&u(ne,"options"),ne?.signal!=null&&s(ne.signal,"options.signal");let he=arguments.length>1;if(ne!=null&&(ve=ne.signal)!==null&&ve!==void 0&&ve.aborted){let ge=new a(void 0,{cause:ne.signal.reason});throw this.once("error",()=>{}),await m(this.destroy(ge)),ge}let $=new t,Q=$.signal;if(ne!=null&&ne.signal){let ge={once:!0,[f]:this,[d]:!0};ne.signal.addEventListener("abort",()=>$.abort(),ge)}let le=!1;try{for await(let ge of this){var ye;if(le=!0,ne!=null&&(ye=ne.signal)!==null&&ye!==void 0&&ye.aborted)throw new a;he?re=await Z(re,ge,{signal:Q}):(re=ge,he=!0)}if(!le&&!he)throw new V}finally{$.abort()}return re}async function se(Z){Z!=null&&u(Z,"options"),Z?.signal!=null&&s(Z.signal,"options.signal");let re=[];for await(let ve of this){var ne;if(Z!=null&&(ne=Z.signal)!==null&&ne!==void 0&&ne.aborted)throw new a(void 0,{cause:Z.signal.reason});S(re,ve)}return re}function be(Z,re){let ne=J.call(this,Z,re);return async function*(){for await(let ve of ne)yield*ve}.call(this)}function K(Z){if(Z=O(Z),k(Z))return 0;if(Z<0)throw new o("number",">= 0",Z);return Z}function j(Z,re=void 0){return re!=null&&u(re,"options"),re?.signal!=null&&s(re.signal,"options.signal"),Z=K(Z),async function*(){var ne;if(re!=null&&(ne=re.signal)!==null&&ne!==void 0&&ne.aborted)throw new a;for await(let he of this){var ve;if(re!=null&&(ve=re.signal)!==null&&ve!==void 0&&ve.aborted)throw new a;Z--<=0&&(yield he)}}.call(this)}function ie(Z,re=void 0){return re!=null&&u(re,"options"),re?.signal!=null&&s(re.signal,"options.signal"),Z=K(Z),async function*(){var ne;if(re!=null&&(ne=re.signal)!==null&&ne!==void 0&&ne.aborted)throw new a;for await(let he of this){var ve;if(re!=null&&(ve=re.signal)!==null&&ve!==void 0&&ve.aborted)throw new a;if(Z-- >0&&(yield he),Z<=0)return}}.call(this)}e.exports.streamReturningOperators={asIndexedPairs:y(G,"readable.asIndexedPairs will be removed in a future version."),drop:j,filter:R,flatMap:be,map:J,take:ie,compose:D},e.exports.promiseReturningOperators={every:ce,forEach:oe,reduce:te,toArray:se,some:Y,find:H}}),Nl=we((l,e)=>{de(),me(),pe();var{ArrayPrototypePop:t,Promise:i}=Ge(),{isIterable:r,isNodeStream:n,isWebStream:o}=At(),{pipelineImpl:a}=ys(),{finished:s}=$t();jl();function c(...u){return new i((f,d)=>{let m,g,b=u[u.length-1];if(b&&typeof b=="object"&&!n(b)&&!r(b)&&!o(b)){let w=t(u);m=w.signal,g=w.end}a(u,(w,x)=>{w?d(w):f(x)},{signal:m,end:g})})}e.exports={finished:s,pipeline:c}}),jl=we((l,e)=>{de(),me(),pe();var{Buffer:t}=(et(),We(Ze)),{ObjectDefineProperty:i,ObjectKeys:r,ReflectApply:n}=Ge(),{promisify:{custom:o}}=ct(),{streamReturningOperators:a,promiseReturningOperators:s}=wu(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:c}}=at(),u=Dl(),{setDefaultHighWaterMark:f,getDefaultHighWaterMark:d}=Wn(),{pipeline:m}=ys(),{destroyer:g}=dr(),b=$t(),w=Nl(),x=At(),y=e.exports=ps().Stream;y.isDestroyed=x.isDestroyed,y.isDisturbed=x.isDisturbed,y.isErrored=x.isErrored,y.isReadable=x.isReadable,y.isWritable=x.isWritable,y.Readable=$n();for(let E of r(a)){let _=function(...k){if(new.target)throw c();return y.Readable.from(n(O,this,k))},O=a[E];i(_,"name",{__proto__:null,value:O.name}),i(_,"length",{__proto__:null,value:O.length}),i(y.Readable.prototype,E,{__proto__:null,value:_,enumerable:!1,configurable:!0,writable:!0})}for(let E of r(s)){let _=function(...k){if(new.target)throw c();return n(O,this,k)},O=s[E];i(_,"name",{__proto__:null,value:O.name}),i(_,"length",{__proto__:null,value:O.length}),i(y.Readable.prototype,E,{__proto__:null,value:_,enumerable:!1,configurable:!0,writable:!0})}y.Writable=ms(),y.Duplex=Et(),y.Transform=Bl(),y.PassThrough=Ul(),y.pipeline=m;var{addAbortSignal:S}=Fn();y.addAbortSignal=S,y.finished=b,y.destroy=g,y.compose=u,y.setDefaultHighWaterMark=f,y.getDefaultHighWaterMark=d,i(y,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return w}}),i(m,o,{__proto__:null,enumerable:!0,get(){return w.pipeline}}),i(b,o,{__proto__:null,enumerable:!0,get(){return w.finished}}),y.Stream=y,y._isUint8Array=function(E){return E instanceof Uint8Array},y._uint8ArrayToBuffer=function(E){return t.from(E.buffer,E.byteOffset,E.byteLength)}}),tr=we((l,e)=>{de(),me(),pe();var t=jl(),i=Nl(),r=t.Readable.destroy;e.exports=t.Readable,e.exports._uint8ArrayToBuffer=t._uint8ArrayToBuffer,e.exports._isUint8Array=t._isUint8Array,e.exports.isDisturbed=t.isDisturbed,e.exports.isErrored=t.isErrored,e.exports.isReadable=t.isReadable,e.exports.Readable=t.Readable,e.exports.Writable=t.Writable,e.exports.Duplex=t.Duplex,e.exports.Transform=t.Transform,e.exports.PassThrough=t.PassThrough,e.exports.addAbortSignal=t.addAbortSignal,e.exports.finished=t.finished,e.exports.destroy=t.destroy,e.exports.destroy=r,e.exports.pipeline=t.pipeline,e.exports.compose=t.compose,Object.defineProperty(t,"promises",{configurable:!0,enumerable:!0,get(){return i}}),e.exports.Stream=t.Stream,e.exports.default=e.exports}),_u=we((l,e)=>{de(),me(),pe(),typeof Object.create=="function"?e.exports=function(t,i){i&&(t.super_=i,t.prototype=Object.create(i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,i){if(i){t.super_=i;var r=function(){};r.prototype=i.prototype,t.prototype=new r,t.prototype.constructor=t}}}),Su=we((l,e)=>{de(),me(),pe();var{Buffer:t}=(et(),We(Ze)),i=Symbol.for("BufferList");function r(n){if(!(this instanceof r))return new r(n);r._init.call(this,n)}r._init=function(n){Object.defineProperty(this,i,{value:!0}),this._bufs=[],this.length=0,n&&this.append(n)},r.prototype._new=function(n){return new r(n)},r.prototype._offset=function(n){if(n===0)return[0,0];let o=0;for(let a=0;a<this._bufs.length;a++){let s=o+this._bufs[a].length;if(n<s||a===this._bufs.length-1)return[a,n-o];o=s}},r.prototype._reverseOffset=function(n){let o=n[0],a=n[1];for(let s=0;s<o;s++)a+=this._bufs[s].length;return a},r.prototype.getBuffers=function(){return this._bufs},r.prototype.get=function(n){if(n>this.length||n<0)return;let o=this._offset(n);return this._bufs[o[0]][o[1]]},r.prototype.slice=function(n,o){return typeof n=="number"&&n<0&&(n+=this.length),typeof o=="number"&&o<0&&(o+=this.length),this.copy(null,0,n,o)},r.prototype.copy=function(n,o,a,s){if((typeof a!="number"||a<0)&&(a=0),(typeof s!="number"||s>this.length)&&(s=this.length),a>=this.length||s<=0)return n||t.alloc(0);let c=!!n,u=this._offset(a),f=s-a,d=f,m=c&&o||0,g=u[1];if(a===0&&s===this.length){if(!c)return this._bufs.length===1?this._bufs[0]:t.concat(this._bufs,this.length);for(let b=0;b<this._bufs.length;b++)this._bufs[b].copy(n,m),m+=this._bufs[b].length;return n}if(d<=this._bufs[u[0]].length-g)return c?this._bufs[u[0]].copy(n,o,g,g+d):this._bufs[u[0]].slice(g,g+d);c||(n=t.allocUnsafe(f));for(let b=u[0];b<this._bufs.length;b++){let w=this._bufs[b].length-g;if(d>w)this._bufs[b].copy(n,m,g),m+=w;else{this._bufs[b].copy(n,m,g,g+d),m+=w;break}d-=w,g&&(g=0)}return n.length>m?n.slice(0,m):n},r.prototype.shallowSlice=function(n,o){if(n=n||0,o=typeof o!="number"?this.length:o,n<0&&(n+=this.length),o<0&&(o+=this.length),n===o)return this._new();let a=this._offset(n),s=this._offset(o),c=this._bufs.slice(a[0],s[0]+1);return s[1]===0?c.pop():c[c.length-1]=c[c.length-1].slice(0,s[1]),a[1]!==0&&(c[0]=c[0].slice(a[1])),this._new(c)},r.prototype.toString=function(n,o,a){return this.slice(o,a).toString(n)},r.prototype.consume=function(n){if(n=Math.trunc(n),Number.isNaN(n)||n<=0)return this;for(;this._bufs.length;)if(n>=this._bufs[0].length)n-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(n),this.length-=n;break}return this},r.prototype.duplicate=function(){let n=this._new();for(let o=0;o<this._bufs.length;o++)n.append(this._bufs[o]);return n},r.prototype.append=function(n){return this._attach(n,r.prototype._appendBuffer)},r.prototype.prepend=function(n){return this._attach(n,r.prototype._prependBuffer,!0)},r.prototype._attach=function(n,o,a){if(n==null)return this;if(n.buffer)o.call(this,t.from(n.buffer,n.byteOffset,n.byteLength));else if(Array.isArray(n)){let[s,c]=a?[n.length-1,-1]:[0,1];for(let u=s;u>=0&&u<n.length;u+=c)this._attach(n[u],o,a)}else if(this._isBufferList(n)){let[s,c]=a?[n._bufs.length-1,-1]:[0,1];for(let u=s;u>=0&&u<n._bufs.length;u+=c)this._attach(n._bufs[u],o,a)}else typeof n=="number"&&(n=n.toString()),o.call(this,t.from(n));return this},r.prototype._appendBuffer=function(n){this._bufs.push(n),this.length+=n.length},r.prototype._prependBuffer=function(n){this._bufs.unshift(n),this.length+=n.length},r.prototype.indexOf=function(n,o,a){if(a===void 0&&typeof o=="string"&&(a=o,o=void 0),typeof n=="function"||Array.isArray(n))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof n=="number"?n=t.from([n]):typeof n=="string"?n=t.from(n,a):this._isBufferList(n)?n=n.slice():Array.isArray(n.buffer)?n=t.from(n.buffer,n.byteOffset,n.byteLength):t.isBuffer(n)||(n=t.from(n)),o=Number(o||0),isNaN(o)&&(o=0),o<0&&(o=this.length+o),o<0&&(o=0),n.length===0)return o>this.length?this.length:o;let s=this._offset(o),c=s[0],u=s[1];for(;c<this._bufs.length;c++){let f=this._bufs[c];for(;u<f.length;)if(f.length-u>=n.length){let d=f.indexOf(n,u);if(d!==-1)return this._reverseOffset([c,d]);u=f.length-n.length+1}else{let d=this._reverseOffset([c,u]);if(this._match(d,n))return d;u++}u=0}return-1},r.prototype._match=function(n,o){if(this.length-n<o.length)return!1;for(let a=0;a<o.length;a++)if(this.get(n+a)!==o[a])return!1;return!0},(function(){let n={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readBigInt64BE:8,readBigInt64LE:8,readBigUInt64BE:8,readBigUInt64LE:8,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let o in n)(function(a){n[a]===null?r.prototype[a]=function(s,c){return this.slice(s,s+c)[a](0,c)}:r.prototype[a]=function(s=0){return this.slice(s,s+n[a])[a](0)}})(o)})(),r.prototype._isBufferList=function(n){return n instanceof r||r.isBufferList(n)},r.isBufferList=function(n){return n!=null&&n[i]},e.exports=r}),xu=we((l,e)=>{de(),me(),pe();var t=tr().Duplex,i=_u(),r=Su();function n(o){if(!(this instanceof n))return new n(o);if(typeof o=="function"){this._callback=o;let a=function(s){this._callback&&(this._callback(s),this._callback=null)}.bind(this);this.on("pipe",function(s){s.on("error",a)}),this.on("unpipe",function(s){s.removeListener("error",a)}),o=null}r._init.call(this,o),t.call(this)}i(n,t),Object.assign(n.prototype,r.prototype),n.prototype._new=function(o){return new n(o)},n.prototype._write=function(o,a,s){this._appendBuffer(o),typeof s=="function"&&s()},n.prototype._read=function(o){if(!this.length)return this.push(null);o=Math.min(o,this.length),this.push(this.slice(0,o)),this.consume(o)},n.prototype.end=function(o){t.prototype.end.call(this,o),this._callback&&(this._callback(null,this.slice()),this._callback=null)},n.prototype._destroy=function(o,a){this._bufs.length=0,this.length=0,a(o)},n.prototype._isBufferList=function(o){return o instanceof n||o instanceof r||n.isBufferList(o)},n.isBufferList=r.isBufferList,e.exports=n,e.exports.BufferListStream=n,e.exports.BufferList=r}),Eu=we((l,e)=>{de(),me(),pe();var t=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}};e.exports=t}),Fl=we((l,e)=>{de(),me(),pe();var t=e.exports,{Buffer:i}=(et(),We(Ze));t.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},t.requiredHeaderFlags={1:0,2:0,4:0,5:0,6:2,7:0,8:2,9:0,10:2,11:0,12:0,13:0,14:0,15:0},t.requiredHeaderFlagsErrors={};for(let n in t.requiredHeaderFlags){let o=t.requiredHeaderFlags[n];t.requiredHeaderFlagsErrors[n]="Invalid header flag bits, must be 0x"+o.toString(16)+" for "+t.types[n]+" packet"}t.codes={};for(let n in t.types){let o=t.types[n];t.codes[o]=n}t.CMD_SHIFT=4,t.CMD_MASK=240,t.DUP_MASK=8,t.QOS_MASK=3,t.QOS_SHIFT=1,t.RETAIN_MASK=1,t.VARBYTEINT_MASK=127,t.VARBYTEINT_FIN_MASK=128,t.VARBYTEINT_MAX=268435455,t.SESSIONPRESENT_MASK=1,t.SESSIONPRESENT_HEADER=i.from([t.SESSIONPRESENT_MASK]),t.CONNACK_HEADER=i.from([t.codes.connack<<t.CMD_SHIFT]),t.USERNAME_MASK=128,t.PASSWORD_MASK=64,t.WILL_RETAIN_MASK=32,t.WILL_QOS_MASK=24,t.WILL_QOS_SHIFT=3,t.WILL_FLAG_MASK=4,t.CLEAN_SESSION_MASK=2,t.CONNECT_HEADER=i.from([t.codes.connect<<t.CMD_SHIFT]),t.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},t.propertiesCodes={};for(let n in t.properties){let o=t.properties[n];t.propertiesCodes[o]=n}t.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"};function r(n){return[0,1,2].map(o=>[0,1].map(a=>[0,1].map(s=>{let c=i.alloc(1);return c.writeUInt8(t.codes[n]<<t.CMD_SHIFT|(a?t.DUP_MASK:0)|o<<t.QOS_SHIFT|s,0,!0),c})))}t.PUBLISH_HEADER=r("publish"),t.SUBSCRIBE_HEADER=r("subscribe"),t.SUBSCRIBE_OPTIONS_QOS_MASK=3,t.SUBSCRIBE_OPTIONS_NL_MASK=1,t.SUBSCRIBE_OPTIONS_NL_SHIFT=2,t.SUBSCRIBE_OPTIONS_RAP_MASK=1,t.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,t.SUBSCRIBE_OPTIONS_RH_MASK=3,t.SUBSCRIBE_OPTIONS_RH_SHIFT=4,t.SUBSCRIBE_OPTIONS_RH=[0,16,32],t.SUBSCRIBE_OPTIONS_NL=4,t.SUBSCRIBE_OPTIONS_RAP=8,t.SUBSCRIBE_OPTIONS_QOS=[0,1,2],t.UNSUBSCRIBE_HEADER=r("unsubscribe"),t.ACKS={unsuback:r("unsuback"),puback:r("puback"),pubcomp:r("pubcomp"),pubrel:r("pubrel"),pubrec:r("pubrec")},t.SUBACK_HEADER=i.from([t.codes.suback<<t.CMD_SHIFT]),t.VERSION3=i.from([3]),t.VERSION4=i.from([4]),t.VERSION5=i.from([5]),t.VERSION131=i.from([131]),t.VERSION132=i.from([132]),t.QOS=[0,1,2].map(n=>i.from([n])),t.EMPTY={pingreq:i.from([t.codes.pingreq<<4,0]),pingresp:i.from([t.codes.pingresp<<4,0]),disconnect:i.from([t.codes.disconnect<<4,0])},t.MQTT5_PUBACK_PUBREC_CODES={0:"Success",16:"No matching subscribers",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",144:"Topic Name invalid",145:"Packet identifier in use",151:"Quota exceeded",153:"Payload format invalid"},t.MQTT5_PUBREL_PUBCOMP_CODES={0:"Success",146:"Packet Identifier not found"},t.MQTT5_SUBACK_CODES={0:"Granted QoS 0",1:"Granted QoS 1",2:"Granted QoS 2",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use",151:"Quota exceeded",158:"Shared Subscriptions not supported",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},t.MQTT5_UNSUBACK_CODES={0:"Success",17:"No subscription existed",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use"},t.MQTT5_DISCONNECT_CODES={0:"Normal disconnection",4:"Disconnect with Will Message",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",135:"Not authorized",137:"Server busy",139:"Server shutting down",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},t.MQTT5_AUTH_CODES={0:"Success",24:"Continue authentication",25:"Re-authenticate"}}),Iu=we((l,e)=>{de(),me(),pe();var t=1e3,i=t*60,r=i*60,n=r*24,o=n*7,a=n*365.25;e.exports=function(d,m){m=m||{};var g=typeof d;if(g==="string"&&d.length>0)return s(d);if(g==="number"&&isFinite(d))return m.long?u(d):c(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function s(d){if(d=String(d),!(d.length>100)){var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(m){var g=parseFloat(m[1]),b=(m[2]||"ms").toLowerCase();switch(b){case"years":case"year":case"yrs":case"yr":case"y":return g*a;case"weeks":case"week":case"w":return g*o;case"days":case"day":case"d":return g*n;case"hours":case"hour":case"hrs":case"hr":case"h":return g*r;case"minutes":case"minute":case"mins":case"min":case"m":return g*i;case"seconds":case"second":case"secs":case"sec":case"s":return g*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return g;default:return}}}}function c(d){var m=Math.abs(d);return m>=n?Math.round(d/n)+"d":m>=r?Math.round(d/r)+"h":m>=i?Math.round(d/i)+"m":m>=t?Math.round(d/t)+"s":d+"ms"}function u(d){var m=Math.abs(d);return m>=n?f(d,m,n,"day"):m>=r?f(d,m,r,"hour"):m>=i?f(d,m,i,"minute"):m>=t?f(d,m,t,"second"):d+" ms"}function f(d,m,g,b){var w=m>=g*1.5;return Math.round(d/g)+" "+b+(w?"s":"")}}),Au=we((l,e)=>{de(),me(),pe();function t(i){n.debug=n,n.default=n,n.coerce=f,n.disable=c,n.enable=a,n.enabled=u,n.humanize=Iu(),n.destroy=d,Object.keys(i).forEach(m=>{n[m]=i[m]}),n.names=[],n.skips=[],n.formatters={};function r(m){let g=0;for(let b=0;b<m.length;b++)g=(g<<5)-g+m.charCodeAt(b),g|=0;return n.colors[Math.abs(g)%n.colors.length]}n.selectColor=r;function n(m){let g,b=null,w,x;function y(...S){if(!y.enabled)return;let E=y,_=Number(new Date),O=_-(g||_);E.diff=O,E.prev=g,E.curr=_,g=_,S[0]=n.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let k=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(T,P)=>{if(T==="%%")return"%";k++;let A=n.formatters[P];if(typeof A=="function"){let U=S[k];T=A.call(E,U),S.splice(k,1),k--}return T}),n.formatArgs.call(E,S),(E.log||n.log).apply(E,S)}return y.namespace=m,y.useColors=n.useColors(),y.color=n.selectColor(m),y.extend=o,y.destroy=n.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>b!==null?b:(w!==n.namespaces&&(w=n.namespaces,x=n.enabled(m)),x),set:S=>{b=S}}),typeof n.init=="function"&&n.init(y),y}function o(m,g){let b=n(this.namespace+(typeof g>"u"?":":g)+m);return b.log=this.log,b}function a(m){n.save(m),n.namespaces=m,n.names=[],n.skips=[];let g=(typeof m=="string"?m:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let b of g)b[0]==="-"?n.skips.push(b.slice(1)):n.names.push(b)}function s(m,g){let b=0,w=0,x=-1,y=0;for(;b<m.length;)if(w<g.length&&(g[w]===m[b]||g[w]==="*"))g[w]==="*"?(x=w,y=b,w++):(b++,w++);else if(x!==-1)w=x+1,y++,b=y;else return!1;for(;w<g.length&&g[w]==="*";)w++;return w===g.length}function c(){let m=[...n.names,...n.skips.map(g=>"-"+g)].join(",");return n.enable(""),m}function u(m){for(let g of n.skips)if(s(m,g))return!1;for(let g of n.names)if(s(m,g))return!0;return!1}function f(m){return m instanceof Error?m.stack||m.message:m}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}e.exports=t}),It=we((l,e)=>{de(),me(),pe(),l.formatArgs=i,l.save=r,l.load=n,l.useColors=t,l.storage=o(),l.destroy=(()=>{let s=!1;return()=>{s||(s=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),l.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let s;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(s=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(s[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let c="color: "+this.color;s.splice(1,0,c,"color: inherit");let u=0,f=0;s[0].replace(/%[a-zA-Z%]/g,d=>{d!=="%%"&&(u++,d==="%c"&&(f=u))}),s.splice(f,0,c)}l.log=console.debug||console.log||(()=>{});function r(s){try{s?l.storage.setItem("debug",s):l.storage.removeItem("debug")}catch{}}function n(){let s;try{s=l.storage.getItem("debug")||l.storage.getItem("DEBUG")}catch{}return!s&&typeof $e<"u"&&"env"in $e&&(s=$e.env.DEBUG),s}function o(){try{return localStorage}catch{}}e.exports=Au()(l);var{formatters:a}=e.exports;a.j=function(s){try{return JSON.stringify(s)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}}),ku=we((l,e)=>{de(),me(),pe();var t=xu(),{EventEmitter:i}=(Zt(),We(Wt)),r=Eu(),n=Fl(),o=It()("mqtt-packet:parser"),a=class fo extends i{constructor(){super(),this.parser=this.constructor.parser}static parser(c){return this instanceof fo?(this.settings=c||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new fo().parser(c)}_resetState(){o("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new r,this.error=null,this._list=t(),this._stateCounter=0}parse(c){for(this.error&&this._resetState(),this._list.append(c),o("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,o("parse: state complete. _stateCounter is now: %d",this._stateCounter),o("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return o("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){let c=this._list.readUInt8(0),u=c>>n.CMD_SHIFT;this.packet.cmd=n.types[u];let f=c&15,d=n.requiredHeaderFlags[u];return d!=null&&f!==d?this._emitError(new Error(n.requiredHeaderFlagsErrors[u])):(this.packet.retain=(c&n.RETAIN_MASK)!==0,this.packet.qos=c>>n.QOS_SHIFT&n.QOS_MASK,this.packet.qos>2?this._emitError(new Error("Packet must not have both QoS bits set to 1")):(this.packet.dup=(c&n.DUP_MASK)!==0,o("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0))}_parseLength(){let c=this._parseVarByteNum(!0);return c&&(this.packet.length=c.value,this._list.consume(c.bytes)),o("_parseLength %d",c.value),!!c}_parsePayload(){o("_parsePayload: payload %O",this._list);let c=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}c=!0}return o("_parsePayload complete result: %s",c),c}_parseConnect(){o("_parseConnect");let c,u,f,d,m={},g=this.packet,b=this._parseString();if(b===null)return this._emitError(new Error("Cannot parse protocolId"));if(b!=="MQTT"&&b!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(g.protocolId=b,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(g.protocolVersion=this._list.readUInt8(this._pos),g.protocolVersion>=128&&(g.bridgeMode=!0,g.protocolVersion=g.protocolVersion-128),g.protocolVersion!==3&&g.protocolVersion!==4&&g.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(this._list.readUInt8(this._pos)&1)return this._emitError(new Error("Connect flag bit 0 must be 0, but got 1"));m.username=this._list.readUInt8(this._pos)&n.USERNAME_MASK,m.password=this._list.readUInt8(this._pos)&n.PASSWORD_MASK,m.will=this._list.readUInt8(this._pos)&n.WILL_FLAG_MASK;let w=!!(this._list.readUInt8(this._pos)&n.WILL_RETAIN_MASK),x=(this._list.readUInt8(this._pos)&n.WILL_QOS_MASK)>>n.WILL_QOS_SHIFT;if(m.will)g.will={},g.will.retain=w,g.will.qos=x;else{if(w)return this._emitError(new Error("Will Retain Flag must be set to zero when Will Flag is set to 0"));if(x)return this._emitError(new Error("Will QoS must be set to zero when Will Flag is set to 0"))}if(g.clean=(this._list.readUInt8(this._pos)&n.CLEAN_SESSION_MASK)!==0,this._pos++,g.keepalive=this._parseNum(),g.keepalive===-1)return this._emitError(new Error("Packet too short"));if(g.protocolVersion===5){let S=this._parseProperties();Object.getOwnPropertyNames(S).length&&(g.properties=S)}let y=this._parseString();if(y===null)return this._emitError(new Error("Packet too short"));if(g.clientId=y,o("_parseConnect: packet.clientId: %s",g.clientId),m.will){if(g.protocolVersion===5){let S=this._parseProperties();Object.getOwnPropertyNames(S).length&&(g.will.properties=S)}if(c=this._parseString(),c===null)return this._emitError(new Error("Cannot parse will topic"));if(g.will.topic=c,o("_parseConnect: packet.will.topic: %s",g.will.topic),u=this._parseBuffer(),u===null)return this._emitError(new Error("Cannot parse will payload"));g.will.payload=u,o("_parseConnect: packet.will.paylaod: %s",g.will.payload)}if(m.username){if(d=this._parseString(),d===null)return this._emitError(new Error("Cannot parse username"));g.username=d,o("_parseConnect: packet.username: %s",g.username)}if(m.password){if(f=this._parseBuffer(),f===null)return this._emitError(new Error("Cannot parse password"));g.password=f}return this.settings=g,o("_parseConnect: complete"),g}_parseConnack(){o("_parseConnack");let c=this.packet;if(this._list.length<1)return null;let u=this._list.readUInt8(this._pos++);if(u>1)return this._emitError(new Error("Invalid connack flags, bits 7-1 must be set to 0"));if(c.sessionPresent=!!(u&n.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?c.reasonCode=this._list.readUInt8(this._pos++):c.reasonCode=0;else{if(this._list.length<2)return null;c.returnCode=this._list.readUInt8(this._pos++)}if(c.returnCode===-1||c.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){let f=this._parseProperties();Object.getOwnPropertyNames(f).length&&(c.properties=f)}o("_parseConnack: complete")}_parsePublish(){o("_parsePublish");let c=this.packet;if(c.topic=this._parseString(),c.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(c.qos>0&&!this._parseMessageId())){if(this.settings.protocolVersion===5){let u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(c.properties=u)}c.payload=this._list.slice(this._pos,c.length),o("_parsePublish: payload from buffer list: %o",c.payload)}}_parseSubscribe(){o("_parseSubscribe");let c=this.packet,u,f,d,m,g,b,w;if(c.subscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let x=this._parseProperties();Object.getOwnPropertyNames(x).length&&(c.properties=x)}if(c.length<=0)return this._emitError(new Error("Malformed subscribe, no payload specified"));for(;this._pos<c.length;){if(u=this._parseString(),u===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=c.length)return this._emitError(new Error("Malformed Subscribe Payload"));if(f=this._parseByte(),this.settings.protocolVersion===5){if(f&192)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-6 must be 0"))}else if(f&252)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-2 must be 0"));if(d=f&n.SUBSCRIBE_OPTIONS_QOS_MASK,d>2)return this._emitError(new Error("Invalid subscribe QoS, must be <= 2"));if(b=(f>>n.SUBSCRIBE_OPTIONS_NL_SHIFT&n.SUBSCRIBE_OPTIONS_NL_MASK)!==0,g=(f>>n.SUBSCRIBE_OPTIONS_RAP_SHIFT&n.SUBSCRIBE_OPTIONS_RAP_MASK)!==0,m=f>>n.SUBSCRIBE_OPTIONS_RH_SHIFT&n.SUBSCRIBE_OPTIONS_RH_MASK,m>2)return this._emitError(new Error("Invalid retain handling, must be <= 2"));w={topic:u,qos:d},this.settings.protocolVersion===5?(w.nl=b,w.rap=g,w.rh=m):this.settings.bridgeMode&&(w.rh=0,w.rap=!0,w.nl=!0),o("_parseSubscribe: push subscription `%s` to subscription",w),c.subscriptions.push(w)}}}_parseSuback(){o("_parseSuback");let c=this.packet;if(this.packet.granted=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(c.properties=u)}if(c.length<=0)return this._emitError(new Error("Malformed suback, no payload specified"));for(;this._pos<this.packet.length;){let u=this._list.readUInt8(this._pos++);if(this.settings.protocolVersion===5){if(!n.MQTT5_SUBACK_CODES[u])return this._emitError(new Error("Invalid suback code"))}else if(u>2&&u!==128)return this._emitError(new Error("Invalid suback QoS, must be 0, 1, 2 or 128"));this.packet.granted.push(u)}}}_parseUnsubscribe(){o("_parseUnsubscribe");let c=this.packet;if(c.unsubscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(c.properties=u)}if(c.length<=0)return this._emitError(new Error("Malformed unsubscribe, no payload specified"));for(;this._pos<c.length;){let u=this._parseString();if(u===null)return this._emitError(new Error("Cannot parse topic"));o("_parseUnsubscribe: push topic `%s` to unsubscriptions",u),c.unsubscriptions.push(u)}}}_parseUnsuback(){o("_parseUnsuback");let c=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if((this.settings.protocolVersion===3||this.settings.protocolVersion===4)&&c.length!==2)return this._emitError(new Error("Malformed unsuback, payload length must be 2"));if(c.length<=0)return this._emitError(new Error("Malformed unsuback, no payload specified"));if(this.settings.protocolVersion===5){let u=this._parseProperties();for(Object.getOwnPropertyNames(u).length&&(c.properties=u),c.granted=[];this._pos<this.packet.length;){let f=this._list.readUInt8(this._pos++);if(!n.MQTT5_UNSUBACK_CODES[f])return this._emitError(new Error("Invalid unsuback code"));this.packet.granted.push(f)}}}_parseConfirmation(){o("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);let c=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5){if(c.length>2){switch(c.reasonCode=this._parseByte(),this.packet.cmd){case"puback":case"pubrec":if(!n.MQTT5_PUBACK_PUBREC_CODES[c.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break;case"pubrel":case"pubcomp":if(!n.MQTT5_PUBREL_PUBCOMP_CODES[c.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break}o("_parseConfirmation: packet.reasonCode `%d`",c.reasonCode)}else c.reasonCode=0;if(c.length>3){let u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(c.properties=u)}}return!0}_parseDisconnect(){let c=this.packet;if(o("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?(c.reasonCode=this._parseByte(),n.MQTT5_DISCONNECT_CODES[c.reasonCode]||this._emitError(new Error("Invalid disconnect reason code"))):c.reasonCode=0;let u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(c.properties=u)}return o("_parseDisconnect result: true"),!0}_parseAuth(){o("_parseAuth");let c=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));if(c.reasonCode=this._parseByte(),!n.MQTT5_AUTH_CODES[c.reasonCode])return this._emitError(new Error("Invalid auth reason code"));let u=this._parseProperties();return Object.getOwnPropertyNames(u).length&&(c.properties=u),o("_parseAuth: result: true"),!0}_parseMessageId(){let c=this.packet;return c.messageId=this._parseNum(),c.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(o("_parseMessageId: packet.messageId %d",c.messageId),!0)}_parseString(c){let u=this._parseNum(),f=u+this._pos;if(u===-1||f>this._list.length||f>this.packet.length)return null;let d=this._list.toString("utf8",this._pos,f);return this._pos+=u,o("_parseString: result: %s",d),d}_parseStringPair(){return o("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){let c=this._parseNum(),u=c+this._pos;if(c===-1||u>this._list.length||u>this.packet.length)return null;let f=this._list.slice(this._pos,u);return this._pos+=c,o("_parseBuffer: result: %o",f),f}_parseNum(){if(this._list.length-this._pos<2)return-1;let c=this._list.readUInt16BE(this._pos);return this._pos+=2,o("_parseNum: result: %s",c),c}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;let c=this._list.readUInt32BE(this._pos);return this._pos+=4,o("_parse4ByteNum: result: %s",c),c}_parseVarByteNum(c){o("_parseVarByteNum");let u=4,f=0,d=1,m=0,g=!1,b,w=this._pos?this._pos:0;for(;f<u&&w+f<this._list.length;){if(b=this._list.readUInt8(w+f++),m+=d*(b&n.VARBYTEINT_MASK),d*=128,(b&n.VARBYTEINT_FIN_MASK)===0){g=!0;break}if(this._list.length<=f)break}return!g&&f===u&&this._list.length>=f&&this._emitError(new Error("Invalid variable byte integer")),w&&(this._pos+=f),g?c?g={bytes:f,value:m}:g=m:g=!1,o("_parseVarByteNum: result: %o",g),g}_parseByte(){let c;return this._pos<this._list.length&&(c=this._list.readUInt8(this._pos),this._pos++),o("_parseByte: result: %o",c),c}_parseByType(c){switch(o("_parseByType: type: %s",c),c){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){o("_parseProperties");let c=this._parseVarByteNum(),u=this._pos+c,f={};for(;this._pos<u;){let d=this._parseByte();if(!d)return this._emitError(new Error("Cannot parse property code type")),!1;let m=n.propertiesCodes[d];if(!m)return this._emitError(new Error("Unknown property")),!1;if(m==="userProperties"){f[m]||(f[m]=Object.create(null));let g=this._parseByType(n.propertiesTypes[m]);if(f[m][g.name])if(Array.isArray(f[m][g.name]))f[m][g.name].push(g.value);else{let b=f[m][g.name];f[m][g.name]=[b],f[m][g.name].push(g.value)}else f[m][g.name]=g.value;continue}f[m]?Array.isArray(f[m])?f[m].push(this._parseByType(n.propertiesTypes[m])):(f[m]=[f[m]],f[m].push(this._parseByType(n.propertiesTypes[m]))):f[m]=this._parseByType(n.propertiesTypes[m])}return f}_newPacket(){return o("_newPacket"),this.packet&&(this._list.consume(this.packet.length),o("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),o("_newPacket: new packet"),this.packet=new r,this._pos=0,!0}_emitError(c){o("_emitError",c),this.error=c,this.emit("error",c)}};e.exports=a}),Tu=we((l,e)=>{de(),me(),pe();var{Buffer:t}=(et(),We(Ze)),i=65536,r={},n=t.isBuffer(t.from([1,2]).subarray(0,1));function o(u){let f=t.allocUnsafe(2);return f.writeUInt8(u>>8,0),f.writeUInt8(u&255,1),f}function a(){for(let u=0;u<i;u++)r[u]=o(u)}function s(u){let f=0,d=0,m=t.allocUnsafe(4);do f=u%128|0,u=u/128|0,u>0&&(f=f|128),m.writeUInt8(f,d++);while(u>0&&d<4);return u>0&&(d=0),n?m.subarray(0,d):m.slice(0,d)}function c(u){let f=t.allocUnsafe(4);return f.writeUInt32BE(u,0),f}e.exports={cache:r,generateCache:a,generateNumber:o,genBufVariableByteInt:s,generate4ByteBuffer:c}}),Pu=we((l,e)=>{de(),me(),pe(),typeof $e>"u"||!$e.version||$e.version.indexOf("v0.")===0||$e.version.indexOf("v1.")===0&&$e.version.indexOf("v1.8.")!==0?e.exports={nextTick:t}:e.exports=$e;function t(i,r,n,o){if(typeof i!="function")throw new TypeError('"callback" argument must be a function');var a=arguments.length,s,c;switch(a){case 0:case 1:return $e.nextTick(i);case 2:return $e.nextTick(function(){i.call(null,r)});case 3:return $e.nextTick(function(){i.call(null,r,n)});case 4:return $e.nextTick(function(){i.call(null,r,n,o)});default:for(s=new Array(a-1),c=0;c<s.length;)s[c++]=arguments[c];return $e.nextTick(function(){i.apply(null,s)})}}}),Wl=we((l,e)=>{de(),me(),pe();var t=Fl(),{Buffer:i}=(et(),We(Ze)),r=i.allocUnsafe(0),n=i.from([0]),o=Tu(),a=Pu().nextTick,s=It()("mqtt-packet:writeToStream"),c=o.cache,u=o.generateNumber,f=o.generateCache,d=o.genBufVariableByteInt,m=o.generate4ByteBuffer,g=G,b=!0;function w(K,j,ie){switch(s("generate called"),j.cork&&(j.cork(),a(x,j)),b&&(b=!1,f()),s("generate: packet.cmd: %s",K.cmd),K.cmd){case"connect":return y(K,j);case"connack":return S(K,j,ie);case"publish":return E(K,j,ie);case"puback":case"pubrec":case"pubrel":case"pubcomp":return _(K,j,ie);case"subscribe":return O(K,j,ie);case"suback":return k(K,j,ie);case"unsubscribe":return T(K,j,ie);case"unsuback":return P(K,j,ie);case"pingreq":case"pingresp":return A(K,j);case"disconnect":return U(K,j,ie);case"auth":return I(K,j,ie);default:return j.destroy(new Error("Unknown command")),!1}}Object.defineProperty(w,"cacheNumbers",{get(){return g===G},set(K){K?((!c||Object.keys(c).length===0)&&(b=!0),g=G):(b=!1,g=Y)}});function x(K){K.uncork()}function y(K,j,ie){let Z=K||{},re=Z.protocolId||"MQTT",ne=Z.protocolVersion||4,ve=Z.will,he=Z.clean,$=Z.keepalive||0,Q=Z.clientId||"",le=Z.username,ye=Z.password,ge=Z.properties;he===void 0&&(he=!0);let Se=0;if(typeof re!="string"&&!i.isBuffer(re))return j.destroy(new Error("Invalid protocolId")),!1;if(Se+=re.length+2,ne!==3&&ne!==4&&ne!==5)return j.destroy(new Error("Invalid protocol version")),!1;if(Se+=1,(typeof Q=="string"||i.isBuffer(Q))&&(Q||ne>=4)&&(Q||he))Se+=i.byteLength(Q)+2;else{if(ne<4)return j.destroy(new Error("clientId must be supplied before 3.1.1")),!1;if(he*1===0)return j.destroy(new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof $!="number"||$<0||$>65535||$%1!==0)return j.destroy(new Error("Invalid keepalive")),!1;Se+=2,Se+=1;let ee,_e;if(ne===5){if(ee=oe(j,ge),!ee)return!1;Se+=ee.length}if(ve){if(typeof ve!="object")return j.destroy(new Error("Invalid will")),!1;if(!ve.topic||typeof ve.topic!="string")return j.destroy(new Error("Invalid will topic")),!1;if(Se+=i.byteLength(ve.topic)+2,Se+=2,ve.payload)if(ve.payload.length>=0)typeof ve.payload=="string"?Se+=i.byteLength(ve.payload):Se+=ve.payload.length;else return j.destroy(new Error("Invalid will payload")),!1;if(_e={},ne===5){if(_e=oe(j,ve.properties),!_e)return!1;Se+=_e.length}}let xe=!1;if(le!=null)if(be(le))xe=!0,Se+=i.byteLength(le)+2;else return j.destroy(new Error("Invalid username")),!1;if(ye!=null){if(!xe)return j.destroy(new Error("Username is required to use password")),!1;if(be(ye))Se+=se(ye)+2;else return j.destroy(new Error("Invalid password")),!1}j.write(t.CONNECT_HEADER),F(j,Se),H(j,re),Z.bridgeMode&&(ne+=128),j.write(ne===131?t.VERSION131:ne===132?t.VERSION132:ne===4?t.VERSION4:ne===5?t.VERSION5:t.VERSION3);let ue=0;return ue|=le!=null?t.USERNAME_MASK:0,ue|=ye!=null?t.PASSWORD_MASK:0,ue|=ve&&ve.retain?t.WILL_RETAIN_MASK:0,ue|=ve&&ve.qos?ve.qos<<t.WILL_QOS_SHIFT:0,ue|=ve?t.WILL_FLAG_MASK:0,ue|=he?t.CLEAN_SESSION_MASK:0,j.write(i.from([ue])),g(j,$),ne===5&&ee.write(),H(j,Q),ve&&(ne===5&&_e.write(),D(j,ve.topic),H(j,ve.payload)),le!=null&&H(j,le),ye!=null&&H(j,ye),!0}function S(K,j,ie){let Z=ie?ie.protocolVersion:4,re=K||{},ne=Z===5?re.reasonCode:re.returnCode,ve=re.properties,he=2;if(typeof ne!="number")return j.destroy(new Error("Invalid return code")),!1;let $=null;if(Z===5){if($=oe(j,ve),!$)return!1;he+=$.length}return j.write(t.CONNACK_HEADER),F(j,he),j.write(re.sessionPresent?t.SESSIONPRESENT_HEADER:n),j.write(i.from([ne])),$?.write(),!0}function E(K,j,ie){s("publish: packet: %o",K);let Z=ie?ie.protocolVersion:4,re=K||{},ne=re.qos||0,ve=re.retain?t.RETAIN_MASK:0,he=re.topic,$=re.payload||r,Q=re.messageId,le=re.properties,ye=0;if(typeof he=="string")ye+=i.byteLength(he)+2;else if(i.isBuffer(he))ye+=he.length+2;else return j.destroy(new Error("Invalid topic")),!1;if(i.isBuffer($)?ye+=$.length:ye+=i.byteLength($),ne&&typeof Q!="number")return j.destroy(new Error("Invalid messageId")),!1;ne&&(ye+=2);let ge=null;if(Z===5){if(ge=oe(j,le),!ge)return!1;ye+=ge.length}return j.write(t.PUBLISH_HEADER[ne][re.dup?1:0][ve?1:0]),F(j,ye),g(j,se(he)),j.write(he),ne>0&&g(j,Q),ge?.write(),s("publish: payload: %o",$),j.write($)}function _(K,j,ie){let Z=ie?ie.protocolVersion:4,re=K||{},ne=re.cmd||"puback",ve=re.messageId,he=re.dup&&ne==="pubrel"?t.DUP_MASK:0,$=0,Q=re.reasonCode,le=re.properties,ye=Z===5?3:2;if(ne==="pubrel"&&($=1),typeof ve!="number")return j.destroy(new Error("Invalid messageId")),!1;let ge=null;if(Z===5&&typeof le=="object"){if(ge=R(j,le,ie,ye),!ge)return!1;ye+=ge.length}return j.write(t.ACKS[ne][$][he][0]),ye===3&&(ye+=Q!==0?1:-1),F(j,ye),g(j,ve),Z===5&&ye!==2&&j.write(i.from([Q])),ge!==null?ge.write():ye===4&&j.write(i.from([0])),!0}function O(K,j,ie){s("subscribe: packet: ");let Z=ie?ie.protocolVersion:4,re=K||{},ne=re.dup?t.DUP_MASK:0,ve=re.messageId,he=re.subscriptions,$=re.properties,Q=0;if(typeof ve!="number")return j.destroy(new Error("Invalid messageId")),!1;Q+=2;let le=null;if(Z===5){if(le=oe(j,$),!le)return!1;Q+=le.length}if(typeof he=="object"&&he.length)for(let ge=0;ge<he.length;ge+=1){let Se=he[ge].topic,ee=he[ge].qos;if(typeof Se!="string")return j.destroy(new Error("Invalid subscriptions - invalid topic")),!1;if(typeof ee!="number")return j.destroy(new Error("Invalid subscriptions - invalid qos")),!1;if(Z===5){if(typeof(he[ge].nl||!1)!="boolean")return j.destroy(new Error("Invalid subscriptions - invalid No Local")),!1;if(typeof(he[ge].rap||!1)!="boolean")return j.destroy(new Error("Invalid subscriptions - invalid Retain as Published")),!1;let _e=he[ge].rh||0;if(typeof _e!="number"||_e>2)return j.destroy(new Error("Invalid subscriptions - invalid Retain Handling")),!1}Q+=i.byteLength(Se)+2+1}else return j.destroy(new Error("Invalid subscriptions")),!1;s("subscribe: writing to stream: %o",t.SUBSCRIBE_HEADER),j.write(t.SUBSCRIBE_HEADER[1][ne?1:0][0]),F(j,Q),g(j,ve),le!==null&&le.write();let ye=!0;for(let ge of he){let Se=ge.topic,ee=ge.qos,_e=+ge.nl,xe=+ge.rap,ue=ge.rh,Oe;D(j,Se),Oe=t.SUBSCRIBE_OPTIONS_QOS[ee],Z===5&&(Oe|=_e?t.SUBSCRIBE_OPTIONS_NL:0,Oe|=xe?t.SUBSCRIBE_OPTIONS_RAP:0,Oe|=ue?t.SUBSCRIBE_OPTIONS_RH[ue]:0),ye=j.write(i.from([Oe]))}return ye}function k(K,j,ie){let Z=ie?ie.protocolVersion:4,re=K||{},ne=re.messageId,ve=re.granted,he=re.properties,$=0;if(typeof ne!="number")return j.destroy(new Error("Invalid messageId")),!1;if($+=2,typeof ve=="object"&&ve.length)for(let le=0;le<ve.length;le+=1){if(typeof ve[le]!="number")return j.destroy(new Error("Invalid qos vector")),!1;$+=1}else return j.destroy(new Error("Invalid qos vector")),!1;let Q=null;if(Z===5){if(Q=R(j,he,ie,$),!Q)return!1;$+=Q.length}return j.write(t.SUBACK_HEADER),F(j,$),g(j,ne),Q!==null&&Q.write(),j.write(i.from(ve))}function T(K,j,ie){let Z=ie?ie.protocolVersion:4,re=K||{},ne=re.messageId,ve=re.dup?t.DUP_MASK:0,he=re.unsubscriptions,$=re.properties,Q=0;if(typeof ne!="number")return j.destroy(new Error("Invalid messageId")),!1;if(Q+=2,typeof he=="object"&&he.length)for(let ge=0;ge<he.length;ge+=1){if(typeof he[ge]!="string")return j.destroy(new Error("Invalid unsubscriptions")),!1;Q+=i.byteLength(he[ge])+2}else return j.destroy(new Error("Invalid unsubscriptions")),!1;let le=null;if(Z===5){if(le=oe(j,$),!le)return!1;Q+=le.length}j.write(t.UNSUBSCRIBE_HEADER[1][ve?1:0][0]),F(j,Q),g(j,ne),le!==null&&le.write();let ye=!0;for(let ge=0;ge<he.length;ge++)ye=D(j,he[ge]);return ye}function P(K,j,ie){let Z=ie?ie.protocolVersion:4,re=K||{},ne=re.messageId,ve=re.dup?t.DUP_MASK:0,he=re.granted,$=re.properties,Q=re.cmd,le=0,ye=2;if(typeof ne!="number")return j.destroy(new Error("Invalid messageId")),!1;if(Z===5)if(typeof he=="object"&&he.length)for(let Se=0;Se<he.length;Se+=1){if(typeof he[Se]!="number")return j.destroy(new Error("Invalid qos vector")),!1;ye+=1}else return j.destroy(new Error("Invalid qos vector")),!1;let ge=null;if(Z===5){if(ge=R(j,$,ie,ye),!ge)return!1;ye+=ge.length}return j.write(t.ACKS[Q][le][ve][0]),F(j,ye),g(j,ne),ge!==null&&ge.write(),Z===5&&j.write(i.from(he)),!0}function A(K,j,ie){return j.write(t.EMPTY[K.cmd])}function U(K,j,ie){let Z=ie?ie.protocolVersion:4,re=K||{},ne=re.reasonCode,ve=re.properties,he=Z===5?1:0,$=null;if(Z===5){if($=R(j,ve,ie,he),!$)return!1;he+=$.length}return j.write(i.from([t.codes.disconnect<<4])),F(j,he),Z===5&&j.write(i.from([ne])),$!==null&&$.write(),!0}function I(K,j,ie){let Z=ie?ie.protocolVersion:4,re=K||{},ne=re.reasonCode,ve=re.properties,he=Z===5?1:0;Z!==5&&j.destroy(new Error("Invalid mqtt version for auth packet"));let $=R(j,ve,ie,he);return $?(he+=$.length,j.write(i.from([t.codes.auth<<4])),F(j,he),j.write(i.from([ne])),$!==null&&$.write(),!0):!1}var B={};function F(K,j){if(j>t.VARBYTEINT_MAX)return K.destroy(new Error(`Invalid variable byte integer: ${j}`)),!1;let ie=B[j];return ie||(ie=d(j),j<16384&&(B[j]=ie)),s("writeVarByteInt: writing to stream: %o",ie),K.write(ie)}function D(K,j){let ie=i.byteLength(j);return g(K,ie),s("writeString: %s",j),K.write(j,"utf8")}function J(K,j,ie){D(K,j),D(K,ie)}function G(K,j){return s("writeNumberCached: number: %d",j),s("writeNumberCached: %o",c[j]),K.write(c[j])}function Y(K,j){let ie=u(j);return s("writeNumberGenerated: %o",ie),K.write(ie)}function ce(K,j){let ie=m(j);return s("write4ByteNumber: %o",ie),K.write(ie)}function H(K,j){typeof j=="string"?D(K,j):j?(g(K,j.length),K.write(j)):g(K,0)}function oe(K,j){if(typeof j!="object"||j.length!=null)return{length:1,write(){te(K,{},0)}};let ie=0;function Z(re,ne){let ve=t.propertiesTypes[re],he=0;switch(ve){case"byte":{if(typeof ne!="boolean")return K.destroy(new Error(`Invalid ${re}: ${ne}`)),!1;he+=2;break}case"int8":{if(typeof ne!="number"||ne<0||ne>255)return K.destroy(new Error(`Invalid ${re}: ${ne}`)),!1;he+=2;break}case"binary":{if(ne&&ne===null)return K.destroy(new Error(`Invalid ${re}: ${ne}`)),!1;he+=1+i.byteLength(ne)+2;break}case"int16":{if(typeof ne!="number"||ne<0||ne>65535)return K.destroy(new Error(`Invalid ${re}: ${ne}`)),!1;he+=3;break}case"int32":{if(typeof ne!="number"||ne<0||ne>4294967295)return K.destroy(new Error(`Invalid ${re}: ${ne}`)),!1;he+=5;break}case"var":{if(typeof ne!="number"||ne<0||ne>268435455)return K.destroy(new Error(`Invalid ${re}: ${ne}`)),!1;he+=1+i.byteLength(d(ne));break}case"string":{if(typeof ne!="string")return K.destroy(new Error(`Invalid ${re}: ${ne}`)),!1;he+=3+i.byteLength(ne.toString());break}case"pair":{if(typeof ne!="object")return K.destroy(new Error(`Invalid ${re}: ${ne}`)),!1;he+=Object.getOwnPropertyNames(ne).reduce(($,Q)=>{let le=ne[Q];return Array.isArray(le)?$+=le.reduce((ye,ge)=>(ye+=3+i.byteLength(Q.toString())+2+i.byteLength(ge.toString()),ye),0):$+=3+i.byteLength(Q.toString())+2+i.byteLength(ne[Q].toString()),$},0);break}default:return K.destroy(new Error(`Invalid property ${re}: ${ne}`)),!1}return he}if(j)for(let re in j){let ne=0,ve=0,he=j[re];if(he!==void 0){if(Array.isArray(he))for(let $=0;$<he.length;$++){if(ve=Z(re,he[$]),!ve)return!1;ne+=ve}else{if(ve=Z(re,he),!ve)return!1;ne=ve}if(!ne)return!1;ie+=ne}}return{length:i.byteLength(d(ie))+ie,write(){te(K,j,ie)}}}function R(K,j,ie,Z){let re=["reasonString","userProperties"],ne=ie&&ie.properties&&ie.properties.maximumPacketSize?ie.properties.maximumPacketSize:0,ve=oe(K,j);if(ne)for(;Z+ve.length>ne;){let he=re.shift();if(he&&j[he])delete j[he],ve=oe(K,j);else return!1}return ve}function V(K,j,ie){switch(t.propertiesTypes[j]){case"byte":{K.write(i.from([t.properties[j]])),K.write(i.from([+ie]));break}case"int8":{K.write(i.from([t.properties[j]])),K.write(i.from([ie]));break}case"binary":{K.write(i.from([t.properties[j]])),H(K,ie);break}case"int16":{K.write(i.from([t.properties[j]])),g(K,ie);break}case"int32":{K.write(i.from([t.properties[j]])),ce(K,ie);break}case"var":{K.write(i.from([t.properties[j]])),F(K,ie);break}case"string":{K.write(i.from([t.properties[j]])),D(K,ie);break}case"pair":{Object.getOwnPropertyNames(ie).forEach(Z=>{let re=ie[Z];Array.isArray(re)?re.forEach(ne=>{K.write(i.from([t.properties[j]])),J(K,Z.toString(),ne.toString())}):(K.write(i.from([t.properties[j]])),J(K,Z.toString(),re.toString()))});break}default:return K.destroy(new Error(`Invalid property ${j} value: ${ie}`)),!1}}function te(K,j,ie){F(K,ie);for(let Z in j)if(Object.prototype.hasOwnProperty.call(j,Z)&&j[Z]!=null){let re=j[Z];if(Array.isArray(re))for(let ne=0;ne<re.length;ne++)V(K,Z,re[ne]);else V(K,Z,re)}}function se(K){return K?K instanceof i?K.length:i.byteLength(K):0}function be(K){return typeof K=="string"||K instanceof i}e.exports=w}),Mu=we((l,e)=>{de(),me(),pe();var t=Wl(),{EventEmitter:i}=(Zt(),We(Wt)),{Buffer:r}=(et(),We(Ze));function n(a,s){let c=new o;return t(a,c,s),c.concat()}var o=class extends i{constructor(){super(),this._array=new Array(20),this._i=0}write(a){return this._array[this._i++]=a,!0}concat(){let a=0,s=new Array(this._array.length),c=this._array,u=0,f;for(f=0;f<c.length&&c[f]!==void 0;f++)typeof c[f]!="string"?s[f]=c[f].length:s[f]=r.byteLength(c[f]),a+=s[f];let d=r.allocUnsafe(a);for(f=0;f<c.length&&c[f]!==void 0;f++)typeof c[f]!="string"?(c[f].copy(d,u),u+=s[f]):(d.write(c[f],u),u+=s[f]);return d}destroy(a){a&&this.emit("error",a)}};e.exports=n}),Ou=we(l=>{de(),me(),pe(),l.parser=ku().parser,l.generate=Mu(),l.writeToStream=Wl()}),Cu=we((l,e)=>{de(),me(),pe(),e.exports=i;function t(n){return n instanceof Cn?Cn.from(n):new n.constructor(n.buffer.slice(),n.byteOffset,n.length)}function i(n){if(n=n||{},n.circles)return r(n);let o=new Map;if(o.set(Date,f=>new Date(f)),o.set(Map,(f,d)=>new Map(s(Array.from(f),d))),o.set(Set,(f,d)=>new Set(s(Array.from(f),d))),n.constructorHandlers)for(let f of n.constructorHandlers)o.set(f[0],f[1]);let a=null;return n.proto?u:c;function s(f,d){let m=Object.keys(f),g=new Array(m.length);for(let b=0;b<m.length;b++){let w=m[b],x=f[w];typeof x!="object"||x===null?g[w]=x:x.constructor!==Object&&(a=o.get(x.constructor))?g[w]=a(x,d):ArrayBuffer.isView(x)?g[w]=t(x):g[w]=d(x)}return g}function c(f){if(typeof f!="object"||f===null)return f;if(Array.isArray(f))return s(f,c);if(f.constructor!==Object&&(a=o.get(f.constructor)))return a(f,c);let d={};for(let m in f){if(Object.hasOwnProperty.call(f,m)===!1)continue;let g=f[m];typeof g!="object"||g===null?d[m]=g:g.constructor!==Object&&(a=o.get(g.constructor))?d[m]=a(g,c):ArrayBuffer.isView(g)?d[m]=t(g):d[m]=c(g)}return d}function u(f){if(typeof f!="object"||f===null)return f;if(Array.isArray(f))return s(f,u);if(f.constructor!==Object&&(a=o.get(f.constructor)))return a(f,u);let d={};for(let m in f){let g=f[m];typeof g!="object"||g===null?d[m]=g:g.constructor!==Object&&(a=o.get(g.constructor))?d[m]=a(g,u):ArrayBuffer.isView(g)?d[m]=t(g):d[m]=u(g)}return d}}function r(n){let o=[],a=[],s=new Map;if(s.set(Date,m=>new Date(m)),s.set(Map,(m,g)=>new Map(u(Array.from(m),g))),s.set(Set,(m,g)=>new Set(u(Array.from(m),g))),n.constructorHandlers)for(let m of n.constructorHandlers)s.set(m[0],m[1]);let c=null;return n.proto?d:f;function u(m,g){let b=Object.keys(m),w=new Array(b.length);for(let x=0;x<b.length;x++){let y=b[x],S=m[y];if(typeof S!="object"||S===null)w[y]=S;else if(S.constructor!==Object&&(c=s.get(S.constructor)))w[y]=c(S,g);else if(ArrayBuffer.isView(S))w[y]=t(S);else{let E=o.indexOf(S);E!==-1?w[y]=a[E]:w[y]=g(S)}}return w}function f(m){if(typeof m!="object"||m===null)return m;if(Array.isArray(m))return u(m,f);if(m.constructor!==Object&&(c=s.get(m.constructor)))return c(m,f);let g={};o.push(m),a.push(g);for(let b in m){if(Object.hasOwnProperty.call(m,b)===!1)continue;let w=m[b];if(typeof w!="object"||w===null)g[b]=w;else if(w.constructor!==Object&&(c=s.get(w.constructor)))g[b]=c(w,f);else if(ArrayBuffer.isView(w))g[b]=t(w);else{let x=o.indexOf(w);x!==-1?g[b]=a[x]:g[b]=f(w)}}return o.pop(),a.pop(),g}function d(m){if(typeof m!="object"||m===null)return m;if(Array.isArray(m))return u(m,d);if(m.constructor!==Object&&(c=s.get(m.constructor)))return c(m,d);let g={};o.push(m),a.push(g);for(let b in m){let w=m[b];if(typeof w!="object"||w===null)g[b]=w;else if(w.constructor!==Object&&(c=s.get(w.constructor)))g[b]=c(w,d);else if(ArrayBuffer.isView(w))g[b]=t(w);else{let x=o.indexOf(w);x!==-1?g[b]=a[x]:g[b]=d(w)}}return o.pop(),a.pop(),g}}}),Ru=we((l,e)=>{de(),me(),pe(),e.exports=Cu()()}),Lu=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0}),l.validateTopic=e,l.validateTopics=t;function e(i){let r=i.split("/");for(let n=0;n<r.length;n++)if(r[n]!=="+"){if(r[n]==="#")return n===r.length-1;if(r[n].indexOf("+")!==-1||r[n].indexOf("#")!==-1)return!1}return!0}function t(i){if(i.length===0)return"empty_topic_list";for(let r=0;r<i.length;r++)if(!e(i[r]))return i[r];return null}}),$l=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0});var e=tr(),t={objectMode:!0},i={clean:!0},r=class{constructor(n){M(this,"options");M(this,"_inflights");this.options=n||{},this.options={...i,...n},this._inflights=new Map}put(n,o){return this._inflights.set(n.messageId,n),o&&o(),this}createStream(){let n=new e.Readable(t),o=[],a=!1,s=0;return this._inflights.forEach((c,u)=>{o.push(c)}),n._read=()=>{!a&&s<o.length?n.push(o[s++]):n.push(null)},n.destroy=c=>{if(!a)return a=!0,setTimeout(()=>{n.emit("close")},0),n},n}del(n,o){let a=this._inflights.get(n.messageId);return a?(this._inflights.delete(n.messageId),o(null,a)):o&&o(new Error("missing packet")),this}get(n,o){let a=this._inflights.get(n.messageId);return a?o(null,a):o&&o(new Error("missing packet")),this}close(n){this.options.clean&&(this._inflights=null),n&&n()}};l.default=r}),Bu=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0});var e=[0,16,128,131,135,144,145,151,153],t=(i,r,n)=>{i.log("handlePublish: packet %o",r),n=typeof n<"u"?n:i.noop;let o=r.topic.toString(),a=r.payload,{qos:s}=r,{messageId:c}=r,{options:u}=i;if(i.options.protocolVersion===5){let f;if(r.properties&&(f=r.properties.topicAlias),typeof f<"u")if(o.length===0)if(f>0&&f<=65535){let d=i.topicAliasRecv.getTopicByAlias(f);if(d)o=d,i.log("handlePublish :: topic complemented by alias. topic: %s - alias: %d",o,f);else{i.log("handlePublish :: unregistered topic alias. alias: %d",f),i.emit("error",new Error("Received unregistered Topic Alias"));return}}else{i.log("handlePublish :: topic alias out of range. alias: %d",f),i.emit("error",new Error("Received Topic Alias is out of range"));return}else if(i.topicAliasRecv.put(o,f))i.log("handlePublish :: registered topic: %s - alias: %d",o,f);else{i.log("handlePublish :: topic alias out of range. alias: %d",f),i.emit("error",new Error("Received Topic Alias is out of range"));return}}switch(i.log("handlePublish: qos %d",s),s){case 2:{u.customHandleAcks(o,a,r,(f,d)=>{if(typeof f=="number"&&(d=f,f=null),f)return i.emit("error",f);if(e.indexOf(d)===-1)return i.emit("error",new Error("Wrong reason code for pubrec"));d?i._sendPacket({cmd:"pubrec",messageId:c,reasonCode:d},n):i.incomingStore.put(r,()=>{i._sendPacket({cmd:"pubrec",messageId:c},n)})});break}case 1:{u.customHandleAcks(o,a,r,(f,d)=>{if(typeof f=="number"&&(d=f,f=null),f)return i.emit("error",f);if(e.indexOf(d)===-1)return i.emit("error",new Error("Wrong reason code for puback"));d||i.emit("message",o,a,r),i.handleMessage(r,m=>{if(m)return n&&n(m);i._sendPacket({cmd:"puback",messageId:c,reasonCode:d},n)})});break}case 0:i.emit("message",o,a,r),i.handleMessage(r,n);break;default:i.log("handlePublish: unknown QoS. Doing nothing.");break}};l.default=t}),Uu=we((l,e)=>{e.exports={version:"5.14.1"}}),pr=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0}),l.MQTTJS_VERSION=l.nextTick=l.ErrorWithSubackPacket=l.ErrorWithReasonCode=void 0,l.applyMixin=i;var e=class zl extends Error{constructor(o,a){super(o);M(this,"code");this.code=a,Object.setPrototypeOf(this,zl.prototype),Object.getPrototypeOf(this).name="ErrorWithReasonCode"}};l.ErrorWithReasonCode=e;var t=class ql extends Error{constructor(o,a){super(o);M(this,"packet");this.packet=a,Object.setPrototypeOf(this,ql.prototype),Object.getPrototypeOf(this).name="ErrorWithSubackPacket"}};l.ErrorWithSubackPacket=t;function i(r,n,o=!1){let a=[n];for(;;){let s=a[0],c=Object.getPrototypeOf(s);if(c?.prototype)a.unshift(c);else break}for(let s of a)for(let c of Object.getOwnPropertyNames(s.prototype))(o||c!=="constructor")&&Object.defineProperty(r.prototype,c,Object.getOwnPropertyDescriptor(s.prototype,c)??Object.create(null))}l.nextTick=typeof $e?.nextTick=="function"?$e.nextTick:r=>{setTimeout(r,0)},l.MQTTJS_VERSION=Uu().version}),zn=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0}),l.ReasonCodes=void 0;var e=pr();l.ReasonCodes={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};var t=(i,r)=>{let{messageId:n}=r,o=r.cmd,a=null,s=i.outgoing[n]?i.outgoing[n].cb:null,c=null;if(!s){i.log("_handleAck :: Server sent an ack in error. Ignoring.");return}switch(i.log("_handleAck :: packet type",o),o){case"pubcomp":case"puback":{let u=r.reasonCode;u&&u>0&&u!==16?(c=new e.ErrorWithReasonCode(`Publish error: ${l.ReasonCodes[u]}`,u),i._removeOutgoingAndStoreMessage(n,()=>{s(c,r)})):i._removeOutgoingAndStoreMessage(n,s);break}case"pubrec":{a={cmd:"pubrel",qos:2,messageId:n};let u=r.reasonCode;u&&u>0&&u!==16?(c=new e.ErrorWithReasonCode(`Publish error: ${l.ReasonCodes[u]}`,u),i._removeOutgoingAndStoreMessage(n,()=>{s(c,r)})):i._sendPacket(a);break}case"suback":{delete i.outgoing[n],i.messageIdProvider.deallocate(n);let u=r.granted;for(let f=0;f<u.length;f++){let d=u[f];if((d&128)!==0){c=new Error(`Subscribe error: ${l.ReasonCodes[d]}`),c.code=d;let m=i.messageIdToTopic[n];m&&m.forEach(g=>{delete i._resubscribeTopics[g]})}}delete i.messageIdToTopic[n],i._invokeStoreProcessingQueue(),s(c,r);break}case"unsuback":{delete i.outgoing[n],i.messageIdProvider.deallocate(n),i._invokeStoreProcessingQueue(),s(null,r);break}default:i.emit("error",new Error("unrecognized packet type"))}i.disconnecting&&Object.keys(i.outgoing).length===0&&i.emit("outgoingEmpty")};l.default=t}),Du=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0});var e=pr(),t=zn(),i=(r,n)=>{let{options:o}=r,a=o.protocolVersion,s=a===5?n.reasonCode:n.returnCode;if(a!==5){let c=new e.ErrorWithReasonCode(`Protocol error: Auth packets are only supported in MQTT 5. Your version:${a}`,s);r.emit("error",c);return}r.handleAuth(n,(c,u)=>{if(c){r.emit("error",c);return}if(s===24)r.reconnecting=!1,r._sendPacket(u);else{let f=new e.ErrorWithReasonCode(`Connection refused: ${t.ReasonCodes[s]}`,s);r.emit("error",f)}})};l.default=i}),Nu=we(l=>{var m,g,b,w,x,y,S,E,_,O,k,T,P,A,U,I,B,F,D,J,G,Y,ce,H,oe,R,V,te,po,be,K,j,ie,Hl,re,ne,ve,Bt,Ut,mo,en,tn,qe,yo,kr,Dt,go,ue;de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0}),l.LRUCache=void 0;var e=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,t=new Set,i=typeof $e=="object"&&$e?$e:{},r=(Oe,h,p,v)=>{typeof i.emitWarning=="function"?i.emitWarning(Oe,h,p,v):console.error(`[${p}] ${h}: ${Oe}`)},n=globalThis.AbortController,o=globalThis.AbortSignal;if(typeof n>"u"){o=class{constructor(){M(this,"onabort");M(this,"_onabort",[]);M(this,"reason");M(this,"aborted",!1)}addEventListener(p,v){this._onabort.push(v)}},n=class{constructor(){M(this,"signal",new o);h()}abort(p){if(!this.signal.aborted){this.signal.reason=p,this.signal.aborted=!0;for(let v of this.signal._onabort)v(p);this.signal.onabort?.(p)}}};let Oe=i.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",h=()=>{Oe&&(Oe=!1,r("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",h))}}var a=Oe=>!t.has(Oe),s=Oe=>Oe&&Oe===Math.floor(Oe)&&Oe>0&&isFinite(Oe),c=Oe=>s(Oe)?Oe<=Math.pow(2,8)?Uint8Array:Oe<=Math.pow(2,16)?Uint16Array:Oe<=Math.pow(2,32)?Uint32Array:Oe<=Number.MAX_SAFE_INTEGER?u:null:null,u=class extends Array{constructor(Oe){super(Oe),this.fill(0)}},f=(m=class{constructor(h,p){M(this,"heap");M(this,"length");if(!W(m,g))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new p(h),this.length=0}static create(h){let p=c(h);if(!p)return[];Be(m,g,!0);let v=new m(h,p);return Be(m,g,!1),v}push(h){this.heap[this.length++]=h}pop(){return this.heap[--this.length]}},g=new WeakMap,je(m,g,!1),m),d=(ue=class{constructor(h){je(this,te);je(this,x);je(this,y);je(this,S);je(this,E);je(this,_);je(this,O);M(this,"ttl");M(this,"ttlResolution");M(this,"ttlAutopurge");M(this,"updateAgeOnGet");M(this,"updateAgeOnHas");M(this,"allowStale");M(this,"noDisposeOnSet");M(this,"noUpdateTTL");M(this,"maxEntrySize");M(this,"sizeCalculation");M(this,"noDeleteOnFetchRejection");M(this,"noDeleteOnStaleGet");M(this,"allowStaleOnFetchAbort");M(this,"allowStaleOnFetchRejection");M(this,"ignoreFetchAbort");je(this,k);je(this,T);je(this,P);je(this,A);je(this,U);je(this,I);je(this,B);je(this,F);je(this,D);je(this,J);je(this,G);je(this,Y);je(this,ce);je(this,H);je(this,oe);je(this,R);je(this,V);je(this,be,()=>{});je(this,K,()=>{});je(this,j,()=>{});je(this,ie,()=>!1);je(this,re,h=>{});je(this,ne,(h,p,v)=>{});je(this,ve,(h,p,v,C)=>{if(v||C)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});M(this,b,"LRUCache");let{max:p=0,ttl:v,ttlResolution:C=1,ttlAutopurge:N,updateAgeOnGet:X,updateAgeOnHas:fe,allowStale:q,dispose:ae,disposeAfter:Te,noDisposeOnSet:Ie,noUpdateTTL:Re,maxSize:Le=0,maxEntrySize:Ke=0,sizeCalculation:Ue,fetchMethod:Ne,memoMethod:De,noDeleteOnFetchRejection:Ve,noDeleteOnStaleGet:ze,allowStaleOnFetchRejection:Fe,allowStaleOnFetchAbort:tt,ignoreFetchAbort:ft}=h;if(p!==0&&!s(p))throw new TypeError("max option must be a nonnegative integer");let lt=p?c(p):Array;if(!lt)throw new Error("invalid max value: "+p);if(Be(this,x,p),Be(this,y,Le),this.maxEntrySize=Ke||W(this,y),this.sizeCalculation=Ue,this.sizeCalculation){if(!W(this,y)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(De!==void 0&&typeof De!="function")throw new TypeError("memoMethod must be a function if defined");if(Be(this,O,De),Ne!==void 0&&typeof Ne!="function")throw new TypeError("fetchMethod must be a function if specified");if(Be(this,_,Ne),Be(this,R,!!Ne),Be(this,P,new Map),Be(this,A,new Array(p).fill(void 0)),Be(this,U,new Array(p).fill(void 0)),Be(this,I,new lt(p)),Be(this,B,new lt(p)),Be(this,F,0),Be(this,D,0),Be(this,J,f.create(p)),Be(this,k,0),Be(this,T,0),typeof ae=="function"&&Be(this,S,ae),typeof Te=="function"?(Be(this,E,Te),Be(this,G,[])):(Be(this,E,void 0),Be(this,G,void 0)),Be(this,oe,!!W(this,S)),Be(this,V,!!W(this,E)),this.noDisposeOnSet=!!Ie,this.noUpdateTTL=!!Re,this.noDeleteOnFetchRejection=!!Ve,this.allowStaleOnFetchRejection=!!Fe,this.allowStaleOnFetchAbort=!!tt,this.ignoreFetchAbort=!!ft,this.maxEntrySize!==0){if(W(this,y)!==0&&!s(W(this,y)))throw new TypeError("maxSize must be a positive integer if specified");if(!s(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");Ce(this,te,Hl).call(this)}if(this.allowStale=!!q,this.noDeleteOnStaleGet=!!ze,this.updateAgeOnGet=!!X,this.updateAgeOnHas=!!fe,this.ttlResolution=s(C)||C===0?C:1,this.ttlAutopurge=!!N,this.ttl=v||0,this.ttl){if(!s(this.ttl))throw new TypeError("ttl must be a positive integer if specified");Ce(this,te,po).call(this)}if(W(this,x)===0&&this.ttl===0&&W(this,y)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!W(this,x)&&!W(this,y)){let L="LRU_CACHE_UNBOUNDED";a(L)&&(t.add(L),r("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",L,ue))}}static unsafeExposeInternals(h){return{starts:W(h,ce),ttls:W(h,H),sizes:W(h,Y),keyMap:W(h,P),keyList:W(h,A),valList:W(h,U),next:W(h,I),prev:W(h,B),get head(){return W(h,F)},get tail(){return W(h,D)},free:W(h,J),isBackgroundFetch:p=>{var v;return Ce(v=h,te,qe).call(v,p)},backgroundFetch:(p,v,C,N)=>{var X;return Ce(X=h,te,tn).call(X,p,v,C,N)},moveToTail:p=>{var v;return Ce(v=h,te,kr).call(v,p)},indexes:p=>{var v;return Ce(v=h,te,Bt).call(v,p)},rindexes:p=>{var v;return Ce(v=h,te,Ut).call(v,p)},isStale:p=>{var v;return W(v=h,ie).call(v,p)}}}get max(){return W(this,x)}get maxSize(){return W(this,y)}get calculatedSize(){return W(this,T)}get size(){return W(this,k)}get fetchMethod(){return W(this,_)}get memoMethod(){return W(this,O)}get dispose(){return W(this,S)}get disposeAfter(){return W(this,E)}getRemainingTTL(h){return W(this,P).has(h)?1/0:0}*entries(){for(let h of Ce(this,te,Bt).call(this))W(this,U)[h]!==void 0&&W(this,A)[h]!==void 0&&!Ce(this,te,qe).call(this,W(this,U)[h])&&(yield[W(this,A)[h],W(this,U)[h]])}*rentries(){for(let h of Ce(this,te,Ut).call(this))W(this,U)[h]!==void 0&&W(this,A)[h]!==void 0&&!Ce(this,te,qe).call(this,W(this,U)[h])&&(yield[W(this,A)[h],W(this,U)[h]])}*keys(){for(let h of Ce(this,te,Bt).call(this)){let p=W(this,A)[h];p!==void 0&&!Ce(this,te,qe).call(this,W(this,U)[h])&&(yield p)}}*rkeys(){for(let h of Ce(this,te,Ut).call(this)){let p=W(this,A)[h];p!==void 0&&!Ce(this,te,qe).call(this,W(this,U)[h])&&(yield p)}}*values(){for(let h of Ce(this,te,Bt).call(this))W(this,U)[h]!==void 0&&!Ce(this,te,qe).call(this,W(this,U)[h])&&(yield W(this,U)[h])}*rvalues(){for(let h of Ce(this,te,Ut).call(this))W(this,U)[h]!==void 0&&!Ce(this,te,qe).call(this,W(this,U)[h])&&(yield W(this,U)[h])}[(w=Symbol.iterator,b=Symbol.toStringTag,w)](){return this.entries()}find(h,p={}){for(let v of Ce(this,te,Bt).call(this)){let C=W(this,U)[v],N=Ce(this,te,qe).call(this,C)?C.__staleWhileFetching:C;if(N!==void 0&&h(N,W(this,A)[v],this))return this.get(W(this,A)[v],p)}}forEach(h,p=this){for(let v of Ce(this,te,Bt).call(this)){let C=W(this,U)[v],N=Ce(this,te,qe).call(this,C)?C.__staleWhileFetching:C;N!==void 0&&h.call(p,N,W(this,A)[v],this)}}rforEach(h,p=this){for(let v of Ce(this,te,Ut).call(this)){let C=W(this,U)[v],N=Ce(this,te,qe).call(this,C)?C.__staleWhileFetching:C;N!==void 0&&h.call(p,N,W(this,A)[v],this)}}purgeStale(){let h=!1;for(let p of Ce(this,te,Ut).call(this,{allowStale:!0}))W(this,ie).call(this,p)&&(Ce(this,te,Dt).call(this,W(this,A)[p],"expire"),h=!0);return h}info(h){let p=W(this,P).get(h);if(p===void 0)return;let v=W(this,U)[p],C=Ce(this,te,qe).call(this,v)?v.__staleWhileFetching:v;if(C===void 0)return;let N={value:C};if(W(this,H)&&W(this,ce)){let X=W(this,H)[p],fe=W(this,ce)[p];if(X&&fe){let q=X-(e.now()-fe);N.ttl=q,N.start=Date.now()}}return W(this,Y)&&(N.size=W(this,Y)[p]),N}dump(){let h=[];for(let p of Ce(this,te,Bt).call(this,{allowStale:!0})){let v=W(this,A)[p],C=W(this,U)[p],N=Ce(this,te,qe).call(this,C)?C.__staleWhileFetching:C;if(N===void 0||v===void 0)continue;let X={value:N};if(W(this,H)&&W(this,ce)){X.ttl=W(this,H)[p];let fe=e.now()-W(this,ce)[p];X.start=Math.floor(Date.now()-fe)}W(this,Y)&&(X.size=W(this,Y)[p]),h.unshift([v,X])}return h}load(h){this.clear();for(let[p,v]of h){if(v.start){let C=Date.now()-v.start;v.start=e.now()-C}this.set(p,v.value,v)}}set(h,p,v={}){var Re,Le,Ke;if(p===void 0)return this.delete(h),this;let{ttl:C=this.ttl,start:N,noDisposeOnSet:X=this.noDisposeOnSet,sizeCalculation:fe=this.sizeCalculation,status:q}=v,{noUpdateTTL:ae=this.noUpdateTTL}=v,Te=W(this,ve).call(this,h,p,v.size||0,fe);if(this.maxEntrySize&&Te>this.maxEntrySize)return q&&(q.set="miss",q.maxEntrySizeExceeded=!0),Ce(this,te,Dt).call(this,h,"set"),this;let Ie=W(this,k)===0?void 0:W(this,P).get(h);if(Ie===void 0)Ie=W(this,k)===0?W(this,D):W(this,J).length!==0?W(this,J).pop():W(this,k)===W(this,x)?Ce(this,te,en).call(this,!1):W(this,k),W(this,A)[Ie]=h,W(this,U)[Ie]=p,W(this,P).set(h,Ie),W(this,I)[W(this,D)]=Ie,W(this,B)[Ie]=W(this,D),Be(this,D,Ie),zr(this,k)._++,W(this,ne).call(this,Ie,Te,q),q&&(q.set="add"),ae=!1;else{Ce(this,te,kr).call(this,Ie);let Ue=W(this,U)[Ie];if(p!==Ue){if(W(this,R)&&Ce(this,te,qe).call(this,Ue)){Ue.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:Ne}=Ue;Ne!==void 0&&!X&&(W(this,oe)&&((Re=W(this,S))==null||Re.call(this,Ne,h,"set")),W(this,V)&&W(this,G)?.push([Ne,h,"set"]))}else X||(W(this,oe)&&((Le=W(this,S))==null||Le.call(this,Ue,h,"set")),W(this,V)&&W(this,G)?.push([Ue,h,"set"]));if(W(this,re).call(this,Ie),W(this,ne).call(this,Ie,Te,q),W(this,U)[Ie]=p,q){q.set="replace";let Ne=Ue&&Ce(this,te,qe).call(this,Ue)?Ue.__staleWhileFetching:Ue;Ne!==void 0&&(q.oldValue=Ne)}}else q&&(q.set="update")}if(C!==0&&!W(this,H)&&Ce(this,te,po).call(this),W(this,H)&&(ae||W(this,j).call(this,Ie,C,N),q&&W(this,K).call(this,q,Ie)),!X&&W(this,V)&&W(this,G)){let Ue=W(this,G),Ne;for(;Ne=Ue?.shift();)(Ke=W(this,E))==null||Ke.call(this,...Ne)}return this}pop(){var h;try{for(;W(this,k);){let p=W(this,U)[W(this,F)];if(Ce(this,te,en).call(this,!0),Ce(this,te,qe).call(this,p)){if(p.__staleWhileFetching)return p.__staleWhileFetching}else if(p!==void 0)return p}}finally{if(W(this,V)&&W(this,G)){let p=W(this,G),v;for(;v=p?.shift();)(h=W(this,E))==null||h.call(this,...v)}}}has(h,p={}){let{updateAgeOnHas:v=this.updateAgeOnHas,status:C}=p,N=W(this,P).get(h);if(N!==void 0){let X=W(this,U)[N];if(Ce(this,te,qe).call(this,X)&&X.__staleWhileFetching===void 0)return!1;if(W(this,ie).call(this,N))C&&(C.has="stale",W(this,K).call(this,C,N));else return v&&W(this,be).call(this,N),C&&(C.has="hit",W(this,K).call(this,C,N)),!0}else C&&(C.has="miss");return!1}peek(h,p={}){let{allowStale:v=this.allowStale}=p,C=W(this,P).get(h);if(C===void 0||!v&&W(this,ie).call(this,C))return;let N=W(this,U)[C];return Ce(this,te,qe).call(this,N)?N.__staleWhileFetching:N}async fetch(h,p={}){let{allowStale:v=this.allowStale,updateAgeOnGet:C=this.updateAgeOnGet,noDeleteOnStaleGet:N=this.noDeleteOnStaleGet,ttl:X=this.ttl,noDisposeOnSet:fe=this.noDisposeOnSet,size:q=0,sizeCalculation:ae=this.sizeCalculation,noUpdateTTL:Te=this.noUpdateTTL,noDeleteOnFetchRejection:Ie=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:Re=this.allowStaleOnFetchRejection,ignoreFetchAbort:Le=this.ignoreFetchAbort,allowStaleOnFetchAbort:Ke=this.allowStaleOnFetchAbort,context:Ue,forceRefresh:Ne=!1,status:De,signal:Ve}=p;if(!W(this,R))return De&&(De.fetch="get"),this.get(h,{allowStale:v,updateAgeOnGet:C,noDeleteOnStaleGet:N,status:De});let ze={allowStale:v,updateAgeOnGet:C,noDeleteOnStaleGet:N,ttl:X,noDisposeOnSet:fe,size:q,sizeCalculation:ae,noUpdateTTL:Te,noDeleteOnFetchRejection:Ie,allowStaleOnFetchRejection:Re,allowStaleOnFetchAbort:Ke,ignoreFetchAbort:Le,status:De,signal:Ve},Fe=W(this,P).get(h);if(Fe===void 0){De&&(De.fetch="miss");let tt=Ce(this,te,tn).call(this,h,Fe,ze,Ue);return tt.__returned=tt}else{let tt=W(this,U)[Fe];if(Ce(this,te,qe).call(this,tt)){let z=v&&tt.__staleWhileFetching!==void 0;return De&&(De.fetch="inflight",z&&(De.returnedStale=!0)),z?tt.__staleWhileFetching:tt.__returned=tt}let ft=W(this,ie).call(this,Fe);if(!Ne&&!ft)return De&&(De.fetch="hit"),Ce(this,te,kr).call(this,Fe),C&&W(this,be).call(this,Fe),De&&W(this,K).call(this,De,Fe),tt;let lt=Ce(this,te,tn).call(this,h,Fe,ze,Ue),L=lt.__staleWhileFetching!==void 0&&v;return De&&(De.fetch=ft?"stale":"refresh",L&&ft&&(De.returnedStale=!0)),L?lt.__staleWhileFetching:lt.__returned=lt}}async forceFetch(h,p={}){let v=await this.fetch(h,p);if(v===void 0)throw new Error("fetch() returned undefined");return v}memo(h,p={}){let v=W(this,O);if(!v)throw new Error("no memoMethod provided to constructor");let{context:C,forceRefresh:N,...X}=p,fe=this.get(h,X);if(!N&&fe!==void 0)return fe;let q=v(h,fe,{options:X,context:C});return this.set(h,q,X),q}get(h,p={}){let{allowStale:v=this.allowStale,updateAgeOnGet:C=this.updateAgeOnGet,noDeleteOnStaleGet:N=this.noDeleteOnStaleGet,status:X}=p,fe=W(this,P).get(h);if(fe!==void 0){let q=W(this,U)[fe],ae=Ce(this,te,qe).call(this,q);return X&&W(this,K).call(this,X,fe),W(this,ie).call(this,fe)?(X&&(X.get="stale"),ae?(X&&v&&q.__staleWhileFetching!==void 0&&(X.returnedStale=!0),v?q.__staleWhileFetching:void 0):(N||Ce(this,te,Dt).call(this,h,"expire"),X&&v&&(X.returnedStale=!0),v?q:void 0)):(X&&(X.get="hit"),ae?q.__staleWhileFetching:(Ce(this,te,kr).call(this,fe),C&&W(this,be).call(this,fe),q))}else X&&(X.get="miss")}delete(h){return Ce(this,te,Dt).call(this,h,"delete")}clear(){return Ce(this,te,go).call(this,"delete")}},x=new WeakMap,y=new WeakMap,S=new WeakMap,E=new WeakMap,_=new WeakMap,O=new WeakMap,k=new WeakMap,T=new WeakMap,P=new WeakMap,A=new WeakMap,U=new WeakMap,I=new WeakMap,B=new WeakMap,F=new WeakMap,D=new WeakMap,J=new WeakMap,G=new WeakMap,Y=new WeakMap,ce=new WeakMap,H=new WeakMap,oe=new WeakMap,R=new WeakMap,V=new WeakMap,te=new WeakSet,po=function(){let h=new u(W(this,x)),p=new u(W(this,x));Be(this,H,h),Be(this,ce,p),Be(this,j,(N,X,fe=e.now())=>{if(p[N]=X!==0?fe:0,h[N]=X,X!==0&&this.ttlAutopurge){let q=setTimeout(()=>{W(this,ie).call(this,N)&&Ce(this,te,Dt).call(this,W(this,A)[N],"expire")},X+1);q.unref&&q.unref()}}),Be(this,be,N=>{p[N]=h[N]!==0?e.now():0}),Be(this,K,(N,X)=>{if(h[X]){let fe=h[X],q=p[X];if(!fe||!q)return;N.ttl=fe,N.start=q,N.now=v||C();let ae=N.now-q;N.remainingTTL=fe-ae}});let v=0,C=()=>{let N=e.now();if(this.ttlResolution>0){v=N;let X=setTimeout(()=>v=0,this.ttlResolution);X.unref&&X.unref()}return N};this.getRemainingTTL=N=>{let X=W(this,P).get(N);if(X===void 0)return 0;let fe=h[X],q=p[X];if(!fe||!q)return 1/0;let ae=(v||C())-q;return fe-ae},Be(this,ie,N=>{let X=p[N],fe=h[N];return!!fe&&!!X&&(v||C())-X>fe})},be=new WeakMap,K=new WeakMap,j=new WeakMap,ie=new WeakMap,Hl=function(){let h=new u(W(this,x));Be(this,T,0),Be(this,Y,h),Be(this,re,p=>{Be(this,T,W(this,T)-h[p]),h[p]=0}),Be(this,ve,(p,v,C,N)=>{if(Ce(this,te,qe).call(this,v))return 0;if(!s(C))if(N){if(typeof N!="function")throw new TypeError("sizeCalculation must be a function");if(C=N(v,p),!s(C))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return C}),Be(this,ne,(p,v,C)=>{if(h[p]=v,W(this,y)){let N=W(this,y)-h[p];for(;W(this,T)>N;)Ce(this,te,en).call(this,!0)}Be(this,T,W(this,T)+h[p]),C&&(C.entrySize=v,C.totalCalculatedSize=W(this,T))})},re=new WeakMap,ne=new WeakMap,ve=new WeakMap,Bt=function*({allowStale:h=this.allowStale}={}){if(W(this,k))for(let p=W(this,D);!(!Ce(this,te,mo).call(this,p)||((h||!W(this,ie).call(this,p))&&(yield p),p===W(this,F)));)p=W(this,B)[p]},Ut=function*({allowStale:h=this.allowStale}={}){if(W(this,k))for(let p=W(this,F);!(!Ce(this,te,mo).call(this,p)||((h||!W(this,ie).call(this,p))&&(yield p),p===W(this,D)));)p=W(this,I)[p]},mo=function(h){return h!==void 0&&W(this,P).get(W(this,A)[h])===h},en=function(h){var N;let p=W(this,F),v=W(this,A)[p],C=W(this,U)[p];return W(this,R)&&Ce(this,te,qe).call(this,C)?C.__abortController.abort(new Error("evicted")):(W(this,oe)||W(this,V))&&(W(this,oe)&&((N=W(this,S))==null||N.call(this,C,v,"evict")),W(this,V)&&W(this,G)?.push([C,v,"evict"])),W(this,re).call(this,p),h&&(W(this,A)[p]=void 0,W(this,U)[p]=void 0,W(this,J).push(p)),W(this,k)===1?(Be(this,F,Be(this,D,0)),W(this,J).length=0):Be(this,F,W(this,I)[p]),W(this,P).delete(v),zr(this,k)._--,p},tn=function(h,p,v,C){let N=p===void 0?void 0:W(this,U)[p];if(Ce(this,te,qe).call(this,N))return N;let X=new n,{signal:fe}=v;fe?.addEventListener("abort",()=>X.abort(fe.reason),{signal:X.signal});let q={signal:X.signal,options:v,context:C},ae=(Ue,Ne=!1)=>{let{aborted:De}=X.signal,Ve=v.ignoreFetchAbort&&Ue!==void 0;if(v.status&&(De&&!Ne?(v.status.fetchAborted=!0,v.status.fetchError=X.signal.reason,Ve&&(v.status.fetchAbortIgnored=!0)):v.status.fetchResolved=!0),De&&!Ve&&!Ne)return Ie(X.signal.reason);let ze=Le;return W(this,U)[p]===Le&&(Ue===void 0?ze.__staleWhileFetching?W(this,U)[p]=ze.__staleWhileFetching:Ce(this,te,Dt).call(this,h,"fetch"):(v.status&&(v.status.fetchUpdated=!0),this.set(h,Ue,q.options))),Ue},Te=Ue=>(v.status&&(v.status.fetchRejected=!0,v.status.fetchError=Ue),Ie(Ue)),Ie=Ue=>{let{aborted:Ne}=X.signal,De=Ne&&v.allowStaleOnFetchAbort,Ve=De||v.allowStaleOnFetchRejection,ze=Ve||v.noDeleteOnFetchRejection,Fe=Le;if(W(this,U)[p]===Le&&(!ze||Fe.__staleWhileFetching===void 0?Ce(this,te,Dt).call(this,h,"fetch"):De||(W(this,U)[p]=Fe.__staleWhileFetching)),Ve)return v.status&&Fe.__staleWhileFetching!==void 0&&(v.status.returnedStale=!0),Fe.__staleWhileFetching;if(Fe.__returned===Fe)throw Ue},Re=(Ue,Ne)=>{var Ve;let De=(Ve=W(this,_))==null?void 0:Ve.call(this,h,N,q);De&&De instanceof Promise&&De.then(ze=>Ue(ze===void 0?void 0:ze),Ne),X.signal.addEventListener("abort",()=>{(!v.ignoreFetchAbort||v.allowStaleOnFetchAbort)&&(Ue(void 0),v.allowStaleOnFetchAbort&&(Ue=ze=>ae(ze,!0)))})};v.status&&(v.status.fetchDispatched=!0);let Le=new Promise(Re).then(ae,Te),Ke=Object.assign(Le,{__abortController:X,__staleWhileFetching:N,__returned:void 0});return p===void 0?(this.set(h,Ke,{...q.options,status:void 0}),p=W(this,P).get(h)):W(this,U)[p]=Ke,Ke},qe=function(h){if(!W(this,R))return!1;let p=h;return!!p&&p instanceof Promise&&p.hasOwnProperty("__staleWhileFetching")&&p.__abortController instanceof n},yo=function(h,p){W(this,B)[p]=h,W(this,I)[h]=p},kr=function(h){h!==W(this,D)&&(h===W(this,F)?Be(this,F,W(this,I)[h]):Ce(this,te,yo).call(this,W(this,B)[h],W(this,I)[h]),Ce(this,te,yo).call(this,W(this,D),h),Be(this,D,h))},Dt=function(h,p){var C,N;let v=!1;if(W(this,k)!==0){let X=W(this,P).get(h);if(X!==void 0)if(v=!0,W(this,k)===1)Ce(this,te,go).call(this,p);else{W(this,re).call(this,X);let fe=W(this,U)[X];if(Ce(this,te,qe).call(this,fe)?fe.__abortController.abort(new Error("deleted")):(W(this,oe)||W(this,V))&&(W(this,oe)&&((C=W(this,S))==null||C.call(this,fe,h,p)),W(this,V)&&W(this,G)?.push([fe,h,p])),W(this,P).delete(h),W(this,A)[X]=void 0,W(this,U)[X]=void 0,X===W(this,D))Be(this,D,W(this,B)[X]);else if(X===W(this,F))Be(this,F,W(this,I)[X]);else{let q=W(this,B)[X];W(this,I)[q]=W(this,I)[X];let ae=W(this,I)[X];W(this,B)[ae]=W(this,B)[X]}zr(this,k)._--,W(this,J).push(X)}}if(W(this,V)&&W(this,G)?.length){let X=W(this,G),fe;for(;fe=X?.shift();)(N=W(this,E))==null||N.call(this,...fe)}return v},go=function(h){var p,v;for(let C of Ce(this,te,Ut).call(this,{allowStale:!0})){let N=W(this,U)[C];if(Ce(this,te,qe).call(this,N))N.__abortController.abort(new Error("deleted"));else{let X=W(this,A)[C];W(this,oe)&&((p=W(this,S))==null||p.call(this,N,X,h)),W(this,V)&&W(this,G)?.push([N,X,h])}}if(W(this,P).clear(),W(this,U).fill(void 0),W(this,A).fill(void 0),W(this,H)&&W(this,ce)&&(W(this,H).fill(0),W(this,ce).fill(0)),W(this,Y)&&W(this,Y).fill(0),Be(this,F,0),Be(this,D,0),W(this,J).length=0,Be(this,T,0),Be(this,k,0),W(this,V)&&W(this,G)){let C=W(this,G),N;for(;N=C?.shift();)(v=W(this,E))==null||v.call(this,...N)}},ue);l.LRUCache=d}),kt=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.ContainerIterator=l.Container=l.Base=void 0;var e=class{constructor(r=0){this.iteratorType=r}equals(r){return this.o===r.o}};l.ContainerIterator=e;var t=class{constructor(){this.i=0}get length(){return this.i}size(){return this.i}empty(){return this.i===0}};l.Base=t;var i=class extends t{};l.Container=i}),ju=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=kt(),t=class extends e.Base{constructor(r=[]){super(),this.S=[];let n=this;r.forEach(function(o){n.push(o)})}clear(){this.i=0,this.S=[]}push(r){return this.S.push(r),this.i+=1,this.i}pop(){if(this.i!==0)return this.i-=1,this.S.pop()}top(){return this.S[this.i-1]}},i=t;l.default=i}),Fu=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=kt(),t=class extends e.Base{constructor(r=[]){super(),this.j=0,this.q=[];let n=this;r.forEach(function(o){n.push(o)})}clear(){this.q=[],this.i=this.j=0}push(r){let n=this.q.length;if(this.j/n>.5&&this.j+this.i>=n&&n>4096){let o=this.i;for(let a=0;a<o;++a)this.q[a]=this.q[this.j+a];this.j=0,this.q[this.i]=r}else this.q[this.j+this.i]=r;return++this.i}pop(){if(this.i===0)return;let r=this.q[this.j++];return this.i-=1,r}front(){if(this.i!==0)return this.q[this.j]}},i=t;l.default=i}),Wu=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=kt(),t=class extends e.Base{constructor(r=[],n=function(a,s){return a>s?-1:a<s?1:0},o=!0){if(super(),this.v=n,Array.isArray(r))this.C=o?[...r]:r;else{this.C=[];let s=this;r.forEach(function(c){s.C.push(c)})}this.i=this.C.length;let a=this.i>>1;for(let s=this.i-1>>1;s>=0;--s)this.k(s,a)}m(r){let n=this.C[r];for(;r>0;){let o=r-1>>1,a=this.C[o];if(this.v(a,n)<=0)break;this.C[r]=a,r=o}this.C[r]=n}k(r,n){let o=this.C[r];for(;r<n;){let a=r<<1|1,s=a+1,c=this.C[a];if(s<this.i&&this.v(c,this.C[s])>0&&(a=s,c=this.C[s]),this.v(c,o)>=0)break;this.C[r]=c,r=a}this.C[r]=o}clear(){this.i=0,this.C.length=0}push(r){this.C.push(r),this.m(this.i),this.i+=1}pop(){if(this.i===0)return;let r=this.C[0],n=this.C.pop();return this.i-=1,this.i&&(this.C[0]=n,this.k(0,this.i>>1)),r}top(){return this.C[0]}find(r){return this.C.indexOf(r)>=0}remove(r){let n=this.C.indexOf(r);return n<0?!1:(n===0?this.pop():n===this.i-1?(this.C.pop(),this.i-=1):(this.C.splice(n,1,this.C.pop()),this.i-=1,this.m(n),this.k(n,this.i>>1)),!0)}updateItem(r){let n=this.C.indexOf(r);return n<0?!1:(this.m(n),this.k(n,this.i>>1),!0)}toArray(){return[...this.C]}},i=t;l.default=i}),gs=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=kt(),t=class extends e.Container{},i=t;l.default=i}),Tt=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.throwIteratorAccessError=e;function e(){throw new RangeError("Iterator access denied!")}}),Gl=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.RandomIterator=void 0;var e=kt(),t=Tt(),i=class extends e.ContainerIterator{constructor(r,n){super(n),this.o=r,this.iteratorType===0?(this.pre=function(){return this.o===0&&(0,t.throwIteratorAccessError)(),this.o-=1,this},this.next=function(){return this.o===this.container.size()&&(0,t.throwIteratorAccessError)(),this.o+=1,this}):(this.pre=function(){return this.o===this.container.size()-1&&(0,t.throwIteratorAccessError)(),this.o+=1,this},this.next=function(){return this.o===-1&&(0,t.throwIteratorAccessError)(),this.o-=1,this})}get pointer(){return this.container.getElementByPos(this.o)}set pointer(r){this.container.setElementByPos(this.o,r)}};l.RandomIterator=i}),$u=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=i(gs()),t=Gl();function i(a){return a&&a.t?a:{default:a}}var r=class Kl extends t.RandomIterator{constructor(s,c,u){super(s,u),this.container=c}copy(){return new Kl(this.o,this.container,this.iteratorType)}},n=class extends e.default{constructor(a=[],s=!0){if(super(),Array.isArray(a))this.J=s?[...a]:a,this.i=a.length;else{this.J=[];let c=this;a.forEach(function(u){c.pushBack(u)})}}clear(){this.i=0,this.J.length=0}begin(){return new r(0,this)}end(){return new r(this.i,this)}rBegin(){return new r(this.i-1,this,1)}rEnd(){return new r(-1,this,1)}front(){return this.J[0]}back(){return this.J[this.i-1]}getElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;return this.J[a]}eraseElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;return this.J.splice(a,1),this.i-=1,this.i}eraseElementByValue(a){let s=0;for(let c=0;c<this.i;++c)this.J[c]!==a&&(this.J[s++]=this.J[c]);return this.i=this.J.length=s,this.i}eraseElementByIterator(a){let s=a.o;return a=a.next(),this.eraseElementByPos(s),a}pushBack(a){return this.J.push(a),this.i+=1,this.i}popBack(){if(this.i!==0)return this.i-=1,this.J.pop()}setElementByPos(a,s){if(a<0||a>this.i-1)throw new RangeError;this.J[a]=s}insert(a,s,c=1){if(a<0||a>this.i)throw new RangeError;return this.J.splice(a,0,...new Array(c).fill(s)),this.i+=c,this.i}find(a){for(let s=0;s<this.i;++s)if(this.J[s]===a)return new r(s,this);return this.end()}reverse(){this.J.reverse()}unique(){let a=1;for(let s=1;s<this.i;++s)this.J[s]!==this.J[s-1]&&(this.J[a++]=this.J[s]);return this.i=this.J.length=a,this.i}sort(a){this.J.sort(a)}forEach(a){for(let s=0;s<this.i;++s)a(this.J[s],s,this)}[Symbol.iterator](){return function*(){yield*this.J}.bind(this)()}},o=n;l.default=o}),zu=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=r(gs()),t=kt(),i=Tt();function r(s){return s&&s.t?s:{default:s}}var n=class Yl extends t.ContainerIterator{constructor(c,u,f,d){super(d),this.o=c,this.h=u,this.container=f,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.L,this})}get pointer(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o.l}set pointer(c){this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o.l=c}copy(){return new Yl(this.o,this.h,this.container,this.iteratorType)}},o=class extends e.default{constructor(s=[]){super(),this.h={},this.p=this._=this.h.L=this.h.B=this.h;let c=this;s.forEach(function(u){c.pushBack(u)})}V(s){let{L:c,B:u}=s;c.B=u,u.L=c,s===this.p&&(this.p=u),s===this._&&(this._=c),this.i-=1}G(s,c){let u=c.B,f={l:s,L:c,B:u};c.B=f,u.L=f,c===this.h&&(this.p=f),u===this.h&&(this._=f),this.i+=1}clear(){this.i=0,this.p=this._=this.h.L=this.h.B=this.h}begin(){return new n(this.p,this.h,this)}end(){return new n(this.h,this.h,this)}rBegin(){return new n(this._,this.h,this,1)}rEnd(){return new n(this.h,this.h,this,1)}front(){return this.p.l}back(){return this._.l}getElementByPos(s){if(s<0||s>this.i-1)throw new RangeError;let c=this.p;for(;s--;)c=c.B;return c.l}eraseElementByPos(s){if(s<0||s>this.i-1)throw new RangeError;let c=this.p;for(;s--;)c=c.B;return this.V(c),this.i}eraseElementByValue(s){let c=this.p;for(;c!==this.h;)c.l===s&&this.V(c),c=c.B;return this.i}eraseElementByIterator(s){let c=s.o;return c===this.h&&(0,i.throwIteratorAccessError)(),s=s.next(),this.V(c),s}pushBack(s){return this.G(s,this._),this.i}popBack(){if(this.i===0)return;let s=this._.l;return this.V(this._),s}pushFront(s){return this.G(s,this.h),this.i}popFront(){if(this.i===0)return;let s=this.p.l;return this.V(this.p),s}setElementByPos(s,c){if(s<0||s>this.i-1)throw new RangeError;let u=this.p;for(;s--;)u=u.B;u.l=c}insert(s,c,u=1){if(s<0||s>this.i)throw new RangeError;if(u<=0)return this.i;if(s===0)for(;u--;)this.pushFront(c);else if(s===this.i)for(;u--;)this.pushBack(c);else{let f=this.p;for(let m=1;m<s;++m)f=f.B;let d=f.B;for(this.i+=u;u--;)f.B={l:c,L:f},f.B.L=f,f=f.B;f.B=d,d.L=f}return this.i}find(s){let c=this.p;for(;c!==this.h;){if(c.l===s)return new n(c,this.h,this);c=c.B}return this.end()}reverse(){if(this.i<=1)return;let s=this.p,c=this._,u=0;for(;u<<1<this.i;){let f=s.l;s.l=c.l,c.l=f,s=s.B,c=c.L,u+=1}}unique(){if(this.i<=1)return this.i;let s=this.p;for(;s!==this.h;){let c=s;for(;c.B!==this.h&&c.l===c.B.l;)c=c.B,this.i-=1;s.B=c.B,s.B.L=s,s=s.B}return this.i}sort(s){if(this.i<=1)return;let c=[];this.forEach(function(f){c.push(f)}),c.sort(s);let u=this.p;c.forEach(function(f){u.l=f,u=u.B})}merge(s){let c=this;if(this.i===0)s.forEach(function(u){c.pushBack(u)});else{let u=this.p;s.forEach(function(f){for(;u!==c.h&&u.l<=f;)u=u.B;c.G(f,u.L)})}return this.i}forEach(s){let c=this.p,u=0;for(;c!==this.h;)s(c.l,u++,this),c=c.B}[Symbol.iterator](){return function*(){if(this.i===0)return;let s=this.p;for(;s!==this.h;)yield s.l,s=s.B}.bind(this)()}},a=o;l.default=a}),qu=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=i(gs()),t=Gl();function i(a){return a&&a.t?a:{default:a}}var r=class Vl extends t.RandomIterator{constructor(s,c,u){super(s,u),this.container=c}copy(){return new Vl(this.o,this.container,this.iteratorType)}},n=class extends e.default{constructor(a=[],s=4096){super(),this.j=0,this.D=0,this.R=0,this.N=0,this.P=0,this.A=[];let c=(()=>{if(typeof a.length=="number")return a.length;if(typeof a.size=="number")return a.size;if(typeof a.size=="function")return a.size();throw new TypeError("Cannot get the length or size of the container")})();this.F=s,this.P=Math.max(Math.ceil(c/this.F),1);for(let d=0;d<this.P;++d)this.A.push(new Array(this.F));let u=Math.ceil(c/this.F);this.j=this.R=(this.P>>1)-(u>>1),this.D=this.N=this.F-c%this.F>>1;let f=this;a.forEach(function(d){f.pushBack(d)})}T(){let a=[],s=Math.max(this.P>>1,1);for(let c=0;c<s;++c)a[c]=new Array(this.F);for(let c=this.j;c<this.P;++c)a[a.length]=this.A[c];for(let c=0;c<this.R;++c)a[a.length]=this.A[c];a[a.length]=[...this.A[this.R]],this.j=s,this.R=a.length-1;for(let c=0;c<s;++c)a[a.length]=new Array(this.F);this.A=a,this.P=a.length}O(a){let s=this.D+a+1,c=s%this.F,u=c-1,f=this.j+(s-c)/this.F;return c===0&&(f-=1),f%=this.P,u<0&&(u+=this.F),{curNodeBucketIndex:f,curNodePointerIndex:u}}clear(){this.A=[new Array(this.F)],this.P=1,this.j=this.R=this.i=0,this.D=this.N=this.F>>1}begin(){return new r(0,this)}end(){return new r(this.i,this)}rBegin(){return new r(this.i-1,this,1)}rEnd(){return new r(-1,this,1)}front(){if(this.i!==0)return this.A[this.j][this.D]}back(){if(this.i!==0)return this.A[this.R][this.N]}pushBack(a){return this.i&&(this.N<this.F-1?this.N+=1:this.R<this.P-1?(this.R+=1,this.N=0):(this.R=0,this.N=0),this.R===this.j&&this.N===this.D&&this.T()),this.i+=1,this.A[this.R][this.N]=a,this.i}popBack(){if(this.i===0)return;let a=this.A[this.R][this.N];return this.i!==1&&(this.N>0?this.N-=1:this.R>0?(this.R-=1,this.N=this.F-1):(this.R=this.P-1,this.N=this.F-1)),this.i-=1,a}pushFront(a){return this.i&&(this.D>0?this.D-=1:this.j>0?(this.j-=1,this.D=this.F-1):(this.j=this.P-1,this.D=this.F-1),this.j===this.R&&this.D===this.N&&this.T()),this.i+=1,this.A[this.j][this.D]=a,this.i}popFront(){if(this.i===0)return;let a=this.A[this.j][this.D];return this.i!==1&&(this.D<this.F-1?this.D+=1:this.j<this.P-1?(this.j+=1,this.D=0):(this.j=0,this.D=0)),this.i-=1,a}getElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;let{curNodeBucketIndex:s,curNodePointerIndex:c}=this.O(a);return this.A[s][c]}setElementByPos(a,s){if(a<0||a>this.i-1)throw new RangeError;let{curNodeBucketIndex:c,curNodePointerIndex:u}=this.O(a);this.A[c][u]=s}insert(a,s,c=1){if(a<0||a>this.i)throw new RangeError;if(a===0)for(;c--;)this.pushFront(s);else if(a===this.i)for(;c--;)this.pushBack(s);else{let u=[];for(let f=a;f<this.i;++f)u.push(this.getElementByPos(f));this.cut(a-1);for(let f=0;f<c;++f)this.pushBack(s);for(let f=0;f<u.length;++f)this.pushBack(u[f])}return this.i}cut(a){if(a<0)return this.clear(),0;let{curNodeBucketIndex:s,curNodePointerIndex:c}=this.O(a);return this.R=s,this.N=c,this.i=a+1,this.i}eraseElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;if(a===0)this.popFront();else if(a===this.i-1)this.popBack();else{let s=[];for(let u=a+1;u<this.i;++u)s.push(this.getElementByPos(u));this.cut(a),this.popBack();let c=this;s.forEach(function(u){c.pushBack(u)})}return this.i}eraseElementByValue(a){if(this.i===0)return 0;let s=[];for(let u=0;u<this.i;++u){let f=this.getElementByPos(u);f!==a&&s.push(f)}let c=s.length;for(let u=0;u<c;++u)this.setElementByPos(u,s[u]);return this.cut(c-1)}eraseElementByIterator(a){let s=a.o;return this.eraseElementByPos(s),a=a.next(),a}find(a){for(let s=0;s<this.i;++s)if(this.getElementByPos(s)===a)return new r(s,this);return this.end()}reverse(){let a=0,s=this.i-1;for(;a<s;){let c=this.getElementByPos(a);this.setElementByPos(a,this.getElementByPos(s)),this.setElementByPos(s,c),a+=1,s-=1}}unique(){if(this.i<=1)return this.i;let a=1,s=this.getElementByPos(0);for(let c=1;c<this.i;++c){let u=this.getElementByPos(c);u!==s&&(s=u,this.setElementByPos(a++,u))}for(;this.i>a;)this.popBack();return this.i}sort(a){let s=[];for(let c=0;c<this.i;++c)s.push(this.getElementByPos(c));s.sort(a);for(let c=0;c<this.i;++c)this.setElementByPos(c,s[c])}shrinkToFit(){if(this.i===0)return;let a=[];this.forEach(function(s){a.push(s)}),this.P=Math.max(Math.ceil(this.i/this.F),1),this.i=this.j=this.R=this.D=this.N=0,this.A=[];for(let s=0;s<this.P;++s)this.A.push(new Array(this.F));for(let s=0;s<a.length;++s)this.pushBack(a[s])}forEach(a){for(let s=0;s<this.i;++s)a(this.getElementByPos(s),s,this)}[Symbol.iterator](){return function*(){for(let a=0;a<this.i;++a)yield this.getElementByPos(a)}.bind(this)()}},o=n;l.default=o}),Hu=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.TreeNodeEnableIndex=l.TreeNode=void 0;var e=class{constructor(i,r){this.ee=1,this.u=void 0,this.l=void 0,this.U=void 0,this.W=void 0,this.tt=void 0,this.u=i,this.l=r}L(){let i=this;if(i.ee===1&&i.tt.tt===i)i=i.W;else if(i.U)for(i=i.U;i.W;)i=i.W;else{let r=i.tt;for(;r.U===i;)i=r,r=i.tt;i=r}return i}B(){let i=this;if(i.W){for(i=i.W;i.U;)i=i.U;return i}else{let r=i.tt;for(;r.W===i;)i=r,r=i.tt;return i.W!==r?r:i}}te(){let i=this.tt,r=this.W,n=r.U;return i.tt===this?i.tt=r:i.U===this?i.U=r:i.W=r,r.tt=i,r.U=this,this.tt=r,this.W=n,n&&(n.tt=this),r}se(){let i=this.tt,r=this.U,n=r.W;return i.tt===this?i.tt=r:i.U===this?i.U=r:i.W=r,r.tt=i,r.W=this,this.tt=r,this.U=n,n&&(n.tt=this),r}};l.TreeNode=e;var t=class extends e{constructor(){super(...arguments),this.rt=1}te(){let i=super.te();return this.ie(),i.ie(),i}se(){let i=super.se();return this.ie(),i.ie(),i}ie(){this.rt=1,this.U&&(this.rt+=this.U.rt),this.W&&(this.rt+=this.W.rt)}};l.TreeNodeEnableIndex=t}),Xl=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=Hu(),t=kt(),i=Tt(),r=class extends t.Container{constructor(o=function(s,c){return s<c?-1:s>c?1:0},a=!1){super(),this.Y=void 0,this.v=o,a?(this.re=e.TreeNodeEnableIndex,this.M=function(s,c,u){let f=this.ne(s,c,u);if(f){let d=f.tt;for(;d!==this.h;)d.rt+=1,d=d.tt;let m=this.he(f);if(m){let{parentNode:g,grandParent:b,curNode:w}=m;g.ie(),b.ie(),w.ie()}}return this.i},this.V=function(s){let c=this.fe(s);for(;c!==this.h;)c.rt-=1,c=c.tt}):(this.re=e.TreeNode,this.M=function(s,c,u){let f=this.ne(s,c,u);return f&&this.he(f),this.i},this.V=this.fe),this.h=new this.re}X(o,a){let s=this.h;for(;o;){let c=this.v(o.u,a);if(c<0)o=o.W;else if(c>0)s=o,o=o.U;else return o}return s}Z(o,a){let s=this.h;for(;o;)this.v(o.u,a)<=0?o=o.W:(s=o,o=o.U);return s}$(o,a){let s=this.h;for(;o;){let c=this.v(o.u,a);if(c<0)s=o,o=o.W;else if(c>0)o=o.U;else return o}return s}rr(o,a){let s=this.h;for(;o;)this.v(o.u,a)<0?(s=o,o=o.W):o=o.U;return s}ue(o){for(;;){let a=o.tt;if(a===this.h)return;if(o.ee===1){o.ee=0;return}if(o===a.U){let s=a.W;if(s.ee===1)s.ee=0,a.ee=1,a===this.Y?this.Y=a.te():a.te();else if(s.W&&s.W.ee===1){s.ee=a.ee,a.ee=0,s.W.ee=0,a===this.Y?this.Y=a.te():a.te();return}else s.U&&s.U.ee===1?(s.ee=1,s.U.ee=0,s.se()):(s.ee=1,o=a)}else{let s=a.U;if(s.ee===1)s.ee=0,a.ee=1,a===this.Y?this.Y=a.se():a.se();else if(s.U&&s.U.ee===1){s.ee=a.ee,a.ee=0,s.U.ee=0,a===this.Y?this.Y=a.se():a.se();return}else s.W&&s.W.ee===1?(s.ee=1,s.W.ee=0,s.te()):(s.ee=1,o=a)}}}fe(o){if(this.i===1)return this.clear(),this.h;let a=o;for(;a.U||a.W;){if(a.W)for(a=a.W;a.U;)a=a.U;else a=a.U;[o.u,a.u]=[a.u,o.u],[o.l,a.l]=[a.l,o.l],o=a}this.h.U===a?this.h.U=a.tt:this.h.W===a&&(this.h.W=a.tt),this.ue(a);let s=a.tt;return a===s.U?s.U=void 0:s.W=void 0,this.i-=1,this.Y.ee=0,s}oe(o,a){return o===void 0?!1:this.oe(o.U,a)||a(o)?!0:this.oe(o.W,a)}he(o){for(;;){let a=o.tt;if(a.ee===0)return;let s=a.tt;if(a===s.U){let c=s.W;if(c&&c.ee===1){if(c.ee=a.ee=0,s===this.Y)return;s.ee=1,o=s;continue}else if(o===a.W){if(o.ee=0,o.U&&(o.U.tt=a),o.W&&(o.W.tt=s),a.W=o.U,s.U=o.W,o.U=a,o.W=s,s===this.Y)this.Y=o,this.h.tt=o;else{let u=s.tt;u.U===s?u.U=o:u.W=o}return o.tt=s.tt,a.tt=o,s.tt=o,s.ee=1,{parentNode:a,grandParent:s,curNode:o}}else a.ee=0,s===this.Y?this.Y=s.se():s.se(),s.ee=1}else{let c=s.U;if(c&&c.ee===1){if(c.ee=a.ee=0,s===this.Y)return;s.ee=1,o=s;continue}else if(o===a.U){if(o.ee=0,o.U&&(o.U.tt=s),o.W&&(o.W.tt=a),s.W=o.U,a.U=o.W,o.U=s,o.W=a,s===this.Y)this.Y=o,this.h.tt=o;else{let u=s.tt;u.U===s?u.U=o:u.W=o}return o.tt=s.tt,a.tt=o,s.tt=o,s.ee=1,{parentNode:a,grandParent:s,curNode:o}}else a.ee=0,s===this.Y?this.Y=s.te():s.te(),s.ee=1}return}}ne(o,a,s){if(this.Y===void 0){this.i+=1,this.Y=new this.re(o,a),this.Y.ee=0,this.Y.tt=this.h,this.h.tt=this.Y,this.h.U=this.Y,this.h.W=this.Y;return}let c,u=this.h.U,f=this.v(u.u,o);if(f===0){u.l=a;return}else if(f>0)u.U=new this.re(o,a),u.U.tt=u,c=u.U,this.h.U=c;else{let d=this.h.W,m=this.v(d.u,o);if(m===0){d.l=a;return}else if(m<0)d.W=new this.re(o,a),d.W.tt=d,c=d.W,this.h.W=c;else{if(s!==void 0){let g=s.o;if(g!==this.h){let b=this.v(g.u,o);if(b===0){g.l=a;return}else if(b>0){let w=g.L(),x=this.v(w.u,o);if(x===0){w.l=a;return}else x<0&&(c=new this.re(o,a),w.W===void 0?(w.W=c,c.tt=w):(g.U=c,c.tt=g))}}}if(c===void 0)for(c=this.Y;;){let g=this.v(c.u,o);if(g>0){if(c.U===void 0){c.U=new this.re(o,a),c.U.tt=c,c=c.U;break}c=c.U}else if(g<0){if(c.W===void 0){c.W=new this.re(o,a),c.W.tt=c,c=c.W;break}c=c.W}else{c.l=a;return}}}}return this.i+=1,c}I(o,a){for(;o;){let s=this.v(o.u,a);if(s<0)o=o.W;else if(s>0)o=o.U;else return o}return o||this.h}clear(){this.i=0,this.Y=void 0,this.h.tt=void 0,this.h.U=this.h.W=void 0}updateKeyByIterator(o,a){let s=o.o;if(s===this.h&&(0,i.throwIteratorAccessError)(),this.i===1)return s.u=a,!0;if(s===this.h.U)return this.v(s.B().u,a)>0?(s.u=a,!0):!1;if(s===this.h.W)return this.v(s.L().u,a)<0?(s.u=a,!0):!1;let c=s.L().u;if(this.v(c,a)>=0)return!1;let u=s.B().u;return this.v(u,a)<=0?!1:(s.u=a,!0)}eraseElementByPos(o){if(o<0||o>this.i-1)throw new RangeError;let a=0,s=this;return this.oe(this.Y,function(c){return o===a?(s.V(c),!0):(a+=1,!1)}),this.i}eraseElementByKey(o){if(this.i===0)return!1;let a=this.I(this.Y,o);return a===this.h?!1:(this.V(a),!0)}eraseElementByIterator(o){let a=o.o;a===this.h&&(0,i.throwIteratorAccessError)();let s=a.W===void 0;return o.iteratorType===0?s&&o.next():(!s||a.U===void 0)&&o.next(),this.V(a),o}forEach(o){let a=0;for(let s of this)o(s,a++,this)}getElementByPos(o){if(o<0||o>this.i-1)throw new RangeError;let a,s=0;for(let c of this){if(s===o){a=c;break}s+=1}return a}getHeight(){if(this.i===0)return 0;let o=function(a){return a?Math.max(o(a.U),o(a.W))+1:0};return o(this.Y)}},n=r;l.default=n}),Jl=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=kt(),t=Tt(),i=class extends e.ContainerIterator{constructor(n,o,a){super(a),this.o=n,this.h=o,this.iteratorType===0?(this.pre=function(){return this.o===this.h.U&&(0,t.throwIteratorAccessError)(),this.o=this.o.L(),this},this.next=function(){return this.o===this.h&&(0,t.throwIteratorAccessError)(),this.o=this.o.B(),this}):(this.pre=function(){return this.o===this.h.W&&(0,t.throwIteratorAccessError)(),this.o=this.o.B(),this},this.next=function(){return this.o===this.h&&(0,t.throwIteratorAccessError)(),this.o=this.o.L(),this})}get index(){let n=this.o,o=this.h.tt;if(n===this.h)return o?o.rt-1:0;let a=0;for(n.U&&(a+=n.U.rt);n!==o;){let s=n.tt;n===s.W&&(a+=1,s.U&&(a+=s.U.rt)),n=s}return a}},r=i;l.default=r}),Gu=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=r(Xl()),t=r(Jl()),i=Tt();function r(s){return s&&s.t?s:{default:s}}var n=class Ql extends t.default{constructor(c,u,f,d){super(c,u,d),this.container=f}get pointer(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o.u}copy(){return new Ql(this.o,this.h,this.container,this.iteratorType)}},o=class extends e.default{constructor(s=[],c,u){super(c,u);let f=this;s.forEach(function(d){f.insert(d)})}*K(s){s!==void 0&&(yield*this.K(s.U),yield s.u,yield*this.K(s.W))}begin(){return new n(this.h.U||this.h,this.h,this)}end(){return new n(this.h,this.h,this)}rBegin(){return new n(this.h.W||this.h,this.h,this,1)}rEnd(){return new n(this.h,this.h,this,1)}front(){return this.h.U?this.h.U.u:void 0}back(){return this.h.W?this.h.W.u:void 0}insert(s,c){return this.M(s,void 0,c)}find(s){let c=this.I(this.Y,s);return new n(c,this.h,this)}lowerBound(s){let c=this.X(this.Y,s);return new n(c,this.h,this)}upperBound(s){let c=this.Z(this.Y,s);return new n(c,this.h,this)}reverseLowerBound(s){let c=this.$(this.Y,s);return new n(c,this.h,this)}reverseUpperBound(s){let c=this.rr(this.Y,s);return new n(c,this.h,this)}union(s){let c=this;return s.forEach(function(u){c.insert(u)}),this.i}[Symbol.iterator](){return this.K(this.Y)}},a=o;l.default=a}),Ku=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=r(Xl()),t=r(Jl()),i=Tt();function r(s){return s&&s.t?s:{default:s}}var n=class Zl extends t.default{constructor(c,u,f,d){super(c,u,d),this.container=f}get pointer(){this.o===this.h&&(0,i.throwIteratorAccessError)();let c=this;return new Proxy([],{get(u,f){if(f==="0")return c.o.u;if(f==="1")return c.o.l},set(u,f,d){if(f!=="1")throw new TypeError("props must be 1");return c.o.l=d,!0}})}copy(){return new Zl(this.o,this.h,this.container,this.iteratorType)}},o=class extends e.default{constructor(s=[],c,u){super(c,u);let f=this;s.forEach(function(d){f.setElement(d[0],d[1])})}*K(s){s!==void 0&&(yield*this.K(s.U),yield[s.u,s.l],yield*this.K(s.W))}begin(){return new n(this.h.U||this.h,this.h,this)}end(){return new n(this.h,this.h,this)}rBegin(){return new n(this.h.W||this.h,this.h,this,1)}rEnd(){return new n(this.h,this.h,this,1)}front(){if(this.i===0)return;let s=this.h.U;return[s.u,s.l]}back(){if(this.i===0)return;let s=this.h.W;return[s.u,s.l]}lowerBound(s){let c=this.X(this.Y,s);return new n(c,this.h,this)}upperBound(s){let c=this.Z(this.Y,s);return new n(c,this.h,this)}reverseLowerBound(s){let c=this.$(this.Y,s);return new n(c,this.h,this)}reverseUpperBound(s){let c=this.rr(this.Y,s);return new n(c,this.h,this)}setElement(s,c,u){return this.M(s,c,u)}find(s){let c=this.I(this.Y,s);return new n(c,this.h,this)}getElementByKey(s){return this.I(this.Y,s).l}union(s){let c=this;return s.forEach(function(u){c.setElement(u[0],u[1])}),this.i}[Symbol.iterator](){return this.K(this.Y)}},a=o;l.default=a}),ec=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=e;function e(t){let i=typeof t;return i==="object"&&t!==null||i==="function"}}),tc=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.HashContainerIterator=l.HashContainer=void 0;var e=kt(),t=r(ec()),i=Tt();function r(a){return a&&a.t?a:{default:a}}var n=class extends e.ContainerIterator{constructor(a,s,c){super(c),this.o=a,this.h=s,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.L,this})}};l.HashContainerIterator=n;var o=class extends e.Container{constructor(){super(),this.H=[],this.g={},this.HASH_TAG=Symbol("@@HASH_TAG"),Object.setPrototypeOf(this.g,null),this.h={},this.h.L=this.h.B=this.p=this._=this.h}V(a){let{L:s,B:c}=a;s.B=c,c.L=s,a===this.p&&(this.p=c),a===this._&&(this._=s),this.i-=1}M(a,s,c){c===void 0&&(c=(0,t.default)(a));let u;if(c){let f=a[this.HASH_TAG];if(f!==void 0)return this.H[f].l=s,this.i;Object.defineProperty(a,this.HASH_TAG,{value:this.H.length,configurable:!0}),u={u:a,l:s,L:this._,B:this.h},this.H.push(u)}else{let f=this.g[a];if(f)return f.l=s,this.i;u={u:a,l:s,L:this._,B:this.h},this.g[a]=u}return this.i===0?(this.p=u,this.h.B=u):this._.B=u,this._=u,this.h.L=u,++this.i}I(a,s){if(s===void 0&&(s=(0,t.default)(a)),s){let c=a[this.HASH_TAG];return c===void 0?this.h:this.H[c]}else return this.g[a]||this.h}clear(){let a=this.HASH_TAG;this.H.forEach(function(s){delete s.u[a]}),this.H=[],this.g={},Object.setPrototypeOf(this.g,null),this.i=0,this.p=this._=this.h.L=this.h.B=this.h}eraseElementByKey(a,s){let c;if(s===void 0&&(s=(0,t.default)(a)),s){let u=a[this.HASH_TAG];if(u===void 0)return!1;delete a[this.HASH_TAG],c=this.H[u],delete this.H[u]}else{if(c=this.g[a],c===void 0)return!1;delete this.g[a]}return this.V(c),!0}eraseElementByIterator(a){let s=a.o;return s===this.h&&(0,i.throwIteratorAccessError)(),this.V(s),a.next()}eraseElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;let s=this.p;for(;a--;)s=s.B;return this.V(s),this.i}};l.HashContainer=o}),Yu=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=tc(),t=Tt(),i=class rc extends e.HashContainerIterator{constructor(a,s,c,u){super(a,s,u),this.container=c}get pointer(){return this.o===this.h&&(0,t.throwIteratorAccessError)(),this.o.u}copy(){return new rc(this.o,this.h,this.container,this.iteratorType)}},r=class extends e.HashContainer{constructor(o=[]){super();let a=this;o.forEach(function(s){a.insert(s)})}begin(){return new i(this.p,this.h,this)}end(){return new i(this.h,this.h,this)}rBegin(){return new i(this._,this.h,this,1)}rEnd(){return new i(this.h,this.h,this,1)}front(){return this.p.u}back(){return this._.u}insert(o,a){return this.M(o,void 0,a)}getElementByPos(o){if(o<0||o>this.i-1)throw new RangeError;let a=this.p;for(;o--;)a=a.B;return a.u}find(o,a){let s=this.I(o,a);return new i(s,this.h,this)}forEach(o){let a=0,s=this.p;for(;s!==this.h;)o(s.u,a++,this),s=s.B}[Symbol.iterator](){return function*(){let o=this.p;for(;o!==this.h;)yield o.u,o=o.B}.bind(this)()}},n=r;l.default=n}),Vu=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=tc(),t=r(ec()),i=Tt();function r(s){return s&&s.t?s:{default:s}}var n=class nc extends e.HashContainerIterator{constructor(c,u,f,d){super(c,u,d),this.container=f}get pointer(){this.o===this.h&&(0,i.throwIteratorAccessError)();let c=this;return new Proxy([],{get(u,f){if(f==="0")return c.o.u;if(f==="1")return c.o.l},set(u,f,d){if(f!=="1")throw new TypeError("props must be 1");return c.o.l=d,!0}})}copy(){return new nc(this.o,this.h,this.container,this.iteratorType)}},o=class extends e.HashContainer{constructor(s=[]){super();let c=this;s.forEach(function(u){c.setElement(u[0],u[1])})}begin(){return new n(this.p,this.h,this)}end(){return new n(this.h,this.h,this)}rBegin(){return new n(this._,this.h,this,1)}rEnd(){return new n(this.h,this.h,this,1)}front(){if(this.i!==0)return[this.p.u,this.p.l]}back(){if(this.i!==0)return[this._.u,this._.l]}setElement(s,c,u){return this.M(s,c,u)}getElementByKey(s,c){if(c===void 0&&(c=(0,t.default)(s)),c){let f=s[this.HASH_TAG];return f!==void 0?this.H[f].l:void 0}let u=this.g[s];return u?u.l:void 0}getElementByPos(s){if(s<0||s>this.i-1)throw new RangeError;let c=this.p;for(;s--;)c=c.B;return[c.u,c.l]}find(s,c){let u=this.I(s,c);return new n(u,this.h,this)}forEach(s){let c=0,u=this.p;for(;u!==this.h;)s([u.u,u.l],c++,this),u=u.B}[Symbol.iterator](){return function*(){let s=this.p;for(;s!==this.h;)yield[s.u,s.l],s=s.B}.bind(this)()}},a=o;l.default=a}),Xu=we(l=>{de(),me(),pe(),Object.defineProperty(l,"t",{value:!0}),Object.defineProperty(l,"Deque",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(l,"HashMap",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(l,"HashSet",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(l,"LinkList",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(l,"OrderedMap",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(l,"OrderedSet",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(l,"PriorityQueue",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(l,"Queue",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(l,"Stack",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(l,"Vector",{enumerable:!0,get:function(){return r.default}});var e=f(ju()),t=f(Fu()),i=f(Wu()),r=f($u()),n=f(zu()),o=f(qu()),a=f(Gu()),s=f(Ku()),c=f(Yu()),u=f(Vu());function f(d){return d&&d.t?d:{default:d}}}),Ju=we((l,e)=>{de(),me(),pe();var t=Xu().OrderedSet,i=It()("number-allocator:trace"),r=It()("number-allocator:error");function n(a,s){this.low=a,this.high=s}n.prototype.equals=function(a){return this.low===a.low&&this.high===a.high},n.prototype.compare=function(a){return this.low<a.low&&this.high<a.low?-1:a.low<this.low&&a.high<this.low?1:0};function o(a,s){if(!(this instanceof o))return new o(a,s);this.min=a,this.max=s,this.ss=new t([],(c,u)=>c.compare(u)),i("Create"),this.clear()}o.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low},o.prototype.alloc=function(){if(this.ss.size()===0)return i("alloc():empty"),null;let a=this.ss.begin(),s=a.pointer.low,c=a.pointer.high,u=s;return u+1<=c?this.ss.updateKeyByIterator(a,new n(s+1,c)):this.ss.eraseElementByPos(0),i("alloc():"+u),u},o.prototype.use=function(a){let s=new n(a,a),c=this.ss.lowerBound(s);if(!c.equals(this.ss.end())){let u=c.pointer.low,f=c.pointer.high;return c.pointer.equals(s)?(this.ss.eraseElementByIterator(c),i("use():"+a),!0):u>a?!1:u===a?(this.ss.updateKeyByIterator(c,new n(u+1,f)),i("use():"+a),!0):f===a?(this.ss.updateKeyByIterator(c,new n(u,f-1)),i("use():"+a),!0):(this.ss.updateKeyByIterator(c,new n(a+1,f)),this.ss.insert(new n(u,a-1)),i("use():"+a),!0)}return i("use():failed"),!1},o.prototype.free=function(a){if(a<this.min||a>this.max){r("free():"+a+" is out of range");return}let s=new n(a,a),c=this.ss.upperBound(s);if(c.equals(this.ss.end())){if(c.equals(this.ss.begin())){this.ss.insert(s);return}c.pre();let u=c.pointer.high;c.pointer.high+1===a?this.ss.updateKeyByIterator(c,new n(u,a)):this.ss.insert(s)}else if(c.equals(this.ss.begin()))if(a+1===c.pointer.low){let u=c.pointer.high;this.ss.updateKeyByIterator(c,new n(a,u))}else this.ss.insert(s);else{let u=c.pointer.low,f=c.pointer.high;c.pre();let d=c.pointer.low;c.pointer.high+1===a?a+1===u?(this.ss.eraseElementByIterator(c),this.ss.updateKeyByIterator(c,new n(d,f))):this.ss.updateKeyByIterator(c,new n(d,a)):a+1===u?(this.ss.eraseElementByIterator(c.next()),this.ss.insert(new n(a,f))):this.ss.insert(s)}i("free():"+a)},o.prototype.clear=function(){i("clear()"),this.ss.clear(),this.ss.insert(new n(this.min,this.max))},o.prototype.intervalCount=function(){return this.ss.size()},o.prototype.dump=function(){console.log("length:"+this.ss.size());for(let a of this.ss)console.log(a)},e.exports=o}),ic=we((l,e)=>{de(),me(),pe();var t=Ju();e.exports.NumberAllocator=t}),Qu=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0});var e=Nu(),t=ic(),i=class{constructor(r){M(this,"aliasToTopic");M(this,"topicToAlias");M(this,"max");M(this,"numberAllocator");M(this,"length");r>0&&(this.aliasToTopic=new e.LRUCache({max:r}),this.topicToAlias={},this.numberAllocator=new t.NumberAllocator(1,r),this.max=r,this.length=0)}put(r,n){if(n===0||n>this.max)return!1;let o=this.aliasToTopic.get(n);return o&&delete this.topicToAlias[o],this.aliasToTopic.set(n,r),this.topicToAlias[r]=n,this.numberAllocator.use(n),this.length=this.aliasToTopic.size,!0}getTopicByAlias(r){return this.aliasToTopic.get(r)}getAliasByTopic(r){let n=this.topicToAlias[r];return typeof n<"u"&&this.aliasToTopic.get(n),n}clear(){this.aliasToTopic.clear(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0}getLruAlias(){return this.numberAllocator.firstVacant()||[...this.aliasToTopic.keys()][this.aliasToTopic.size-1]}};l.default=i}),Zu=we(l=>{de(),me(),pe();var e=l&&l.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(l,"__esModule",{value:!0});var t=zn(),i=e(Qu()),r=pr(),n=(o,a)=>{o.log("_handleConnack");let{options:s}=o,c=s.protocolVersion===5?a.reasonCode:a.returnCode;if(clearTimeout(o.connackTimer),delete o.topicAliasSend,a.properties){if(a.properties.topicAliasMaximum){if(a.properties.topicAliasMaximum>65535){o.emit("error",new Error("topicAliasMaximum from broker is out of range"));return}a.properties.topicAliasMaximum>0&&(o.topicAliasSend=new i.default(a.properties.topicAliasMaximum))}a.properties.serverKeepAlive&&s.keepalive&&(s.keepalive=a.properties.serverKeepAlive),a.properties.maximumPacketSize&&(s.properties||(s.properties={}),s.properties.maximumPacketSize=a.properties.maximumPacketSize)}if(c===0)o.reconnecting=!1,o._onConnect(a);else if(c>0){let u=new r.ErrorWithReasonCode(`Connection refused: ${t.ReasonCodes[c]}`,c);o.emit("error",u),o.options.reconnectOnConnackError&&o._cleanUp(!0)}};l.default=n}),eh=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0});var e=(t,i,r)=>{t.log("handling pubrel packet");let n=typeof r<"u"?r:t.noop,{messageId:o}=i,a={cmd:"pubcomp",messageId:o};t.incomingStore.get(i,(s,c)=>{s?t._sendPacket(a,n):(t.emit("message",c.topic,c.payload,c),t.handleMessage(c,u=>{if(u)return n(u);t.incomingStore.del(c,t.noop),t._sendPacket(a,n)}))})};l.default=e}),th=we(l=>{de(),me(),pe();var e=l&&l.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(l,"__esModule",{value:!0});var t=e(Bu()),i=e(Du()),r=e(Zu()),n=e(zn()),o=e(eh()),a=(s,c,u)=>{let{options:f}=s;if(f.protocolVersion===5&&f.properties&&f.properties.maximumPacketSize&&f.properties.maximumPacketSize<c.length)return s.emit("error",new Error(`exceeding packets size ${c.cmd}`)),s.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),s;switch(s.log("_handlePacket :: emitting packetreceive"),s.emit("packetreceive",c),c.cmd){case"publish":(0,t.default)(s,c,u);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":s.reschedulePing(),(0,n.default)(s,c),u();break;case"pubrel":s.reschedulePing(),(0,o.default)(s,c,u);break;case"connack":(0,r.default)(s,c),u();break;case"auth":s.reschedulePing(),(0,i.default)(s,c),u();break;case"pingresp":s.log("_handlePacket :: received pingresp"),s.reschedulePing(!0),u();break;case"disconnect":s.emit("disconnect",c),u();break;default:s.log("_handlePacket :: unknown command"),u();break}};l.default=a}),oc=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0});var e=class{constructor(){M(this,"nextId");this.nextId=Math.max(1,Math.floor(Math.random()*65535))}allocate(){let t=this.nextId++;return this.nextId===65536&&(this.nextId=1),t}getLastAllocated(){return this.nextId===1?65535:this.nextId-1}register(t){return!0}deallocate(t){}clear(){}};l.default=e}),rh=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0});var e=class{constructor(t){M(this,"aliasToTopic");M(this,"max");M(this,"length");this.aliasToTopic={},this.max=t}put(t,i){return i===0||i>this.max?!1:(this.aliasToTopic[i]=t,this.length=Object.keys(this.aliasToTopic).length,!0)}getTopicByAlias(t){return this.aliasToTopic[t]}clear(){this.aliasToTopic={}}};l.default=e}),nh=we(l=>{de(),me(),pe();var e=l&&l.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(l,"__esModule",{value:!0}),l.TypedEventEmitter=void 0;var t=e((Zt(),We(Wt))),i=pr(),r=class{};l.TypedEventEmitter=r,(0,i.applyMixin)(r,t.default)}),qn=we((l,e)=>{de(),me(),pe();function t(i){"@babel/helpers - typeof";return e.exports=t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},e.exports.__esModule=!0,e.exports.default=e.exports,t(i)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),ih=we((l,e)=>{de(),me(),pe();var t=qn().default;function i(r,n){if(t(r)!="object"||!r)return r;var o=r[Symbol.toPrimitive];if(o!==void 0){var a=o.call(r,n||"default");if(t(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports}),oh=we((l,e)=>{de(),me(),pe();var t=qn().default,i=ih();function r(n){var o=i(n,"string");return t(o)=="symbol"?o:o+""}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),sh=we((l,e)=>{de(),me(),pe();var t=oh();function i(r,n,o){return(n=t(n))in r?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o,r}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports}),ah=we((l,e)=>{de(),me(),pe();function t(i){if(Array.isArray(i))return i}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),lh=we((l,e)=>{de(),me(),pe();function t(i,r){var n=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(n!=null){var o,a,s,c,u=[],f=!0,d=!1;try{if(s=(n=n.call(i)).next,r===0){if(Object(n)!==n)return;f=!1}else for(;!(f=(o=s.call(n)).done)&&(u.push(o.value),u.length!==r);f=!0);}catch(m){d=!0,a=m}finally{try{if(!f&&n.return!=null&&(c=n.return(),Object(c)!==c))return}finally{if(d)throw a}}return u}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),ch=we((l,e)=>{de(),me(),pe();function t(i,r){(r==null||r>i.length)&&(r=i.length);for(var n=0,o=Array(r);n<r;n++)o[n]=i[n];return o}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),uh=we((l,e)=>{de(),me(),pe();var t=ch();function i(r,n){if(r){if(typeof r=="string")return t(r,n);var o={}.toString.call(r).slice(8,-1);return o==="Object"&&r.constructor&&(o=r.constructor.name),o==="Map"||o==="Set"?Array.from(r):o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?t(r,n):void 0}}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports}),hh=we((l,e)=>{de(),me(),pe();function t(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),fh=we((l,e)=>{de(),me(),pe();var t=ah(),i=lh(),r=uh(),n=hh();function o(a,s){return t(a)||i(a,s)||r(a,s)||n()}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports}),sc=we((l,e)=>{de(),me(),pe(),(function(t,i){typeof l=="object"&&typeof e<"u"?i(l):typeof define=="function"&&define.amd?define(["exports"],i):(t=typeof globalThis<"u"?globalThis:t||self,i(t.fastUniqueNumbers={}))})(l,function(t){var i=function(m){return function(g){var b=m(g);return g.add(b),b}},r=function(m){return function(g,b){return m.set(g,b),b}},n=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,a=o*2,s=function(m,g){return function(b){var w=g.get(b),x=w===void 0?b.size:w<a?w+1:0;if(!b.has(x))return m(b,x);if(b.size<o){for(;b.has(x);)x=Math.floor(Math.random()*a);return m(b,x)}if(b.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;b.has(x);)x=Math.floor(Math.random()*n);return m(b,x)}},c=new WeakMap,u=r(c),f=s(u,c),d=i(f);t.addUniqueNumber=d,t.generateUniqueNumber=f})}),dh=we((l,e)=>{de(),me(),pe();function t(r,n,o,a,s,c,u){try{var f=r[c](u),d=f.value}catch(m){return void o(m)}f.done?n(d):Promise.resolve(d).then(a,s)}function i(r){return function(){var n=this,o=arguments;return new Promise(function(a,s){var c=r.apply(n,o);function u(d){t(c,a,s,u,f,"next",d)}function f(d){t(c,a,s,u,f,"throw",d)}u(void 0)})}}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports}),ac=we((l,e)=>{de(),me(),pe();function t(i,r){this.v=i,this.k=r}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),lc=we((l,e)=>{de(),me(),pe();function t(i,r,n,o){var a=Object.defineProperty;try{a({},"",{})}catch{a=0}e.exports=t=function(s,c,u,f){function d(m,g){t(s,m,function(b){return this._invoke(m,g,b)})}c?a?a(s,c,{value:u,enumerable:!f,configurable:!f,writable:!f}):s[c]=u:(d("next",0),d("throw",1),d("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(i,r,n,o)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),cc=we((l,e)=>{de(),me(),pe();var t=lc();function i(){var r,n,o=typeof Symbol=="function"?Symbol:{},a=o.iterator||"@@iterator",s=o.toStringTag||"@@toStringTag";function c(x,y,S,E){var _=y&&y.prototype instanceof f?y:f,O=Object.create(_.prototype);return t(O,"_invoke",(function(k,T,P){var A,U,I,B=0,F=P||[],D=!1,J={p:0,n:0,v:r,a:G,f:G.bind(r,4),d:function(Y,ce){return A=Y,U=0,I=r,J.n=ce,u}};function G(Y,ce){for(U=Y,I=ce,n=0;!D&&B&&!H&&n<F.length;n++){var H,oe=F[n],R=J.p,V=oe[2];Y>3?(H=V===ce)&&(I=oe[(U=oe[4])?5:(U=3,3)],oe[4]=oe[5]=r):oe[0]<=R&&((H=Y<2&&R<oe[1])?(U=0,J.v=ce,J.n=oe[1]):R<V&&(H=Y<3||oe[0]>ce||ce>V)&&(oe[4]=Y,oe[5]=ce,J.n=V,U=0))}if(H||Y>1)return u;throw D=!0,ce}return function(Y,ce,H){if(B>1)throw TypeError("Generator is already running");for(D&&ce===1&&G(ce,H),U=ce,I=H;(n=U<2?r:I)||!D;){A||(U?U<3?(U>1&&(J.n=-1),G(U,I)):J.n=I:J.v=I);try{if(B=2,A){if(U||(Y="next"),n=A[Y]){if(!(n=n.call(A,I)))throw TypeError("iterator result is not an object");if(!n.done)return n;I=n.value,U<2&&(U=0)}else U===1&&(n=A.return)&&n.call(A),U<2&&(I=TypeError("The iterator does not provide a '"+Y+"' method"),U=1);A=r}else if((n=(D=J.n<0)?I:k.call(T,J))!==u)break}catch(oe){A=r,U=1,I=oe}finally{B=1}}return{value:n,done:D}}})(x,S,E),!0),O}var u={};function f(){}function d(){}function m(){}n=Object.getPrototypeOf;var g=[][a]?n(n([][a]())):(t(n={},a,function(){return this}),n),b=m.prototype=f.prototype=Object.create(g);function w(x){return Object.setPrototypeOf?Object.setPrototypeOf(x,m):(x.__proto__=m,t(x,s,"GeneratorFunction")),x.prototype=Object.create(b),x}return d.prototype=m,t(b,"constructor",m),t(m,"constructor",d),d.displayName="GeneratorFunction",t(m,s,"GeneratorFunction"),t(b),t(b,s,"Generator"),t(b,a,function(){return this}),t(b,"toString",function(){return"[object Generator]"}),(e.exports=i=function(){return{w:c,m:w}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports}),uc=we((l,e)=>{de(),me(),pe();var t=ac(),i=lc();function r(n,o){function a(c,u,f,d){try{var m=n[c](u),g=m.value;return g instanceof t?o.resolve(g.v).then(function(b){a("next",b,f,d)},function(b){a("throw",b,f,d)}):o.resolve(g).then(function(b){m.value=b,f(m)},function(b){return a("throw",b,f,d)})}catch(b){d(b)}}var s;this.next||(i(r.prototype),i(r.prototype,typeof Symbol=="function"&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),i(this,"_invoke",function(c,u,f){function d(){return new o(function(m,g){a(c,f,m,g)})}return s=s?s.then(d,d):d()},!0)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),hc=we((l,e)=>{de(),me(),pe();var t=cc(),i=uc();function r(n,o,a,s,c){return new i(t().w(n,o,a,s),c||Promise)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),ph=we((l,e)=>{de(),me(),pe();var t=hc();function i(r,n,o,a,s){var c=t(r,n,o,a,s);return c.next().then(function(u){return u.done?u.value:c.next()})}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports}),mh=we((l,e)=>{de(),me(),pe();function t(i){var r=Object(i),n=[];for(var o in r)n.unshift(o);return function a(){for(;n.length;)if((o=n.pop())in r)return a.value=o,a.done=!1,a;return a.done=!0,a}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),yh=we((l,e)=>{de(),me(),pe();var t=qn().default;function i(r){if(r!=null){var n=r[typeof Symbol=="function"&&Symbol.iterator||"@@iterator"],o=0;if(n)return n.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length))return{next:function(){return r&&o>=r.length&&(r=void 0),{value:r&&r[o++],done:!r}}}}throw new TypeError(t(r)+" is not iterable")}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports}),gh=we((l,e)=>{de(),me(),pe();var t=ac(),i=cc(),r=ph(),n=hc(),o=uc(),a=mh(),s=yh();function c(){var u=i(),f=u.m(c),d=(Object.getPrototypeOf?Object.getPrototypeOf(f):f.__proto__).constructor;function m(w){var x=typeof w=="function"&&w.constructor;return!!x&&(x===d||(x.displayName||x.name)==="GeneratorFunction")}var g={throw:1,return:2,break:3,continue:3};function b(w){var x,y;return function(S){x||(x={stop:function(){return y(S.a,2)},catch:function(){return S.v},abrupt:function(E,_){return y(S.a,g[E],_)},delegateYield:function(E,_,O){return x.resultName=_,y(S.d,s(E),O)},finish:function(E){return y(S.f,E)}},y=function(E,_,O){S.p=x.prev,S.n=x.next;try{return E(_,O)}finally{x.next=S.n}}),x.resultName&&(x[x.resultName]=S.v,x.resultName=void 0),x.sent=S.v,x.next=S.n;try{return w.call(this,x)}finally{S.p=x.prev,S.n=x.next}}}return(e.exports=c=function(){return{wrap:function(w,x,y,S){return u.w(b(w),x,y,S&&S.reverse())},isGeneratorFunction:m,mark:u.m,awrap:function(w,x){return new t(w,x)},AsyncIterator:o,async:function(w,x,y,S,E){return(m(x)?n:r)(b(w),x,y,S,E)},keys:a,values:s}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=c,e.exports.__esModule=!0,e.exports.default=e.exports}),bh=we((l,e)=>{de(),me(),pe();var t=gh()();e.exports=t;try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}),vh=we((l,e)=>{de(),me(),pe(),(function(t,i){typeof l=="object"&&typeof e<"u"?i(l,sh(),fh(),sc(),dh(),bh()):typeof define=="function"&&define.amd?define(["exports","@babel/runtime/helpers/defineProperty","@babel/runtime/helpers/slicedToArray","fast-unique-numbers","@babel/runtime/helpers/asyncToGenerator","@babel/runtime/regenerator"],i):(t=typeof globalThis<"u"?globalThis:t||self,i(t.brokerFactory={},t._defineProperty,t._slicedToArray,t.fastUniqueNumbers,t._asyncToGenerator,t._regeneratorRuntime))})(l,function(t,i,r,n,o,a){var s=function(y){return typeof y.start=="function"},c=new WeakMap;function u(y,S){var E=Object.keys(y);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(y);S&&(_=_.filter(function(O){return Object.getOwnPropertyDescriptor(y,O).enumerable})),E.push.apply(E,_)}return E}function f(y){for(var S=1;S<arguments.length;S++){var E=arguments[S]!=null?arguments[S]:{};S%2?u(Object(E),!0).forEach(function(_){i(y,_,E[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(E)):u(Object(E)).forEach(function(_){Object.defineProperty(y,_,Object.getOwnPropertyDescriptor(E,_))})}return y}var d=function(y){return f(f({},y),{},{connect:function(S){var E=S.call;return o(a.mark(function _(){var O,k,T,P;return a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return O=new MessageChannel,k=O.port1,T=O.port2,A.next=1,E("connect",{port:k},[k]);case 1:return P=A.sent,c.set(T,P),A.abrupt("return",T);case 2:case"end":return A.stop()}},_)}))},disconnect:function(S){var E=S.call;return(function(){var _=o(a.mark(function O(k){var T;return a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(T=c.get(k),T!==void 0){P.next=1;break}throw new Error("The given port is not connected.");case 1:return P.next=2,E("disconnect",{portId:T});case 2:case"end":return P.stop()}},O)}));return function(O){return _.apply(this,arguments)}})()},isSupported:function(S){var E=S.call;return function(){return E("isSupported")}}})};function m(y,S){var E=Object.keys(y);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(y);S&&(_=_.filter(function(O){return Object.getOwnPropertyDescriptor(y,O).enumerable})),E.push.apply(E,_)}return E}function g(y){for(var S=1;S<arguments.length;S++){var E=arguments[S]!=null?arguments[S]:{};S%2?m(Object(E),!0).forEach(function(_){i(y,_,E[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(E)):m(Object(E)).forEach(function(_){Object.defineProperty(y,_,Object.getOwnPropertyDescriptor(E,_))})}return y}var b=new WeakMap,w=function(y){if(b.has(y))return b.get(y);var S=new Map;return b.set(y,S),S},x=function(y){var S=d(y);return function(E){var _=w(E);E.addEventListener("message",function(F){var D=F.data,J=D.id;if(J!==null&&_.has(J)){var G=_.get(J),Y=G.reject,ce=G.resolve;_.delete(J),D.error===void 0?ce(D.result):Y(new Error(D.error.message))}}),s(E)&&E.start();for(var O=function(F){var D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return new Promise(function(G,Y){var ce=n.generateUniqueNumber(_);_.set(ce,{reject:Y,resolve:G}),D===null?E.postMessage({id:ce,method:F},J):E.postMessage({id:ce,method:F,params:D},J)})},k=function(F,D){var J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];E.postMessage({id:null,method:F,params:D},J)},T={},P=0,A=Object.entries(S);P<A.length;P++){var U=r(A[P],2),I=U[0],B=U[1];T=g(g({},T),{},i({},I,B({call:O,notify:k})))}return g({},T)}};t.createBroker=x})}),wh=we((l,e)=>{de(),me(),pe(),(function(t,i){typeof l=="object"&&typeof e<"u"?i(l,qn(),vh(),sc()):typeof define=="function"&&define.amd?define(["exports","@babel/runtime/helpers/typeof","broker-factory","fast-unique-numbers"],i):(t=typeof globalThis<"u"?globalThis:t||self,i(t.workerTimersBroker={},t._typeof,t.brokerFactory,t.fastUniqueNumbers))})(l,function(t,i,r,n){var o=new Map([[0,null]]),a=new Map([[0,null]]),s=r.createBroker({clearInterval:function(u){var f=u.call;return function(d){i(o.get(d))==="symbol"&&(o.set(d,null),f("clear",{timerId:d,timerType:"interval"}).then(function(){o.delete(d)}))}},clearTimeout:function(u){var f=u.call;return function(d){i(a.get(d))==="symbol"&&(a.set(d,null),f("clear",{timerId:d,timerType:"timeout"}).then(function(){a.delete(d)}))}},setInterval:function(u){var f=u.call;return function(d){for(var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,g=arguments.length,b=new Array(g>2?g-2:0),w=2;w<g;w++)b[w-2]=arguments[w];var x=Symbol(),y=n.generateUniqueNumber(o);o.set(y,x);var S=function(){return f("set",{delay:m,now:performance.timeOrigin+performance.now(),timerId:y,timerType:"interval"}).then(function(){var E=o.get(y);if(E===void 0)throw new Error("The timer is in an undefined state.");E===x&&(d.apply(void 0,b),o.get(y)===x&&S())})};return S(),y}},setTimeout:function(u){var f=u.call;return function(d){for(var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,g=arguments.length,b=new Array(g>2?g-2:0),w=2;w<g;w++)b[w-2]=arguments[w];var x=Symbol(),y=n.generateUniqueNumber(a);return a.set(y,x),f("set",{delay:m,now:performance.timeOrigin+performance.now(),timerId:y,timerType:"timeout"}).then(function(){var S=a.get(y);if(S===void 0)throw new Error("The timer is in an undefined state.");S===x&&(a.delete(y),d.apply(void 0,b))}),y}}}),c=function(u){var f=new Worker(u);return s(f)};t.load=c,t.wrap=s})}),_h=we((l,e)=>{de(),me(),pe(),(function(t,i){typeof l=="object"&&typeof e<"u"?i(l,wh()):typeof define=="function"&&define.amd?define(["exports","worker-timers-broker"],i):(t=typeof globalThis<"u"?globalThis:t||self,i(t.workerTimers={},t.workerTimersBroker))})(l,function(t,i){var r=function(f,d){var m=null;return function(){if(m!==null)return m;var g=new Blob([d],{type:"application/javascript; charset=utf-8"}),b=URL.createObjectURL(g);return m=f(b),setTimeout(function(){return URL.revokeObjectURL(b)}),m}},n=`(()=>{var e={45:(e,t,r)=>{var n=r(738).default;e.exports=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},79:e=>{e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},122:(e,t,r)=>{var n=r(79);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},156:e=>{e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,u,a,i=[],s=!0,c=!1;try{if(u=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}},e.exports.__esModule=!0,e.exports.default=e.exports},172:e=>{e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},293:e=>{function t(e,t,r,n,o,u,a){try{var i=e[u](a),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(o,u){var a=e.apply(r,n);function i(e){t(a,o,u,i,s,"next",e)}function s(e){t(a,o,u,i,s,"throw",e)}i(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},373:e=>{e.exports=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},389:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,u=2*o,a=function(e,t){return function(r){var a=t.get(r),i=void 0===a?r.size:a<u?a+1:0;if(!r.has(i))return e(r,i);if(r.size<o){for(;r.has(i);)i=Math.floor(Math.random()*u);return e(r,i)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(i);)i=Math.floor(Math.random()*n);return e(r,i)}},i=new WeakMap,s=r(i),c=a(s,i),f=t(c);e.addUniqueNumber=f,e.generateUniqueNumber=c}(t)},472:function(e,t,r){!function(e,t,r,n){"use strict";var o=function(e,t){return function(r){var o=t.get(r);if(void 0===o)return Promise.resolve(!1);var u=n(o,2),a=u[0],i=u[1];return e(a),t.delete(r),i(!1),Promise.resolve(!0)}},u=function(e,t){var r=function(n,o,u,a){var i=n-e.now();i>0?o.set(a,[t(r,i,n,o,u,a),u]):(o.delete(a),u(!0))};return r},a=function(e,t,r,n){return function(o,u,a){var i=o+u-t.timeOrigin,s=i-t.now();return new Promise((function(t){e.set(a,[r(n,s,i,e,t,a),t])}))}},i=new Map,s=o(globalThis.clearTimeout,i),c=new Map,f=o(globalThis.clearTimeout,c),l=u(performance,globalThis.setTimeout),p=a(i,performance,globalThis.setTimeout,l),d=a(c,performance,globalThis.setTimeout,l);r.createWorker(self,{clear:function(){var r=e(t.mark((function e(r){var n,o,u;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.timerId,o=r.timerType,e.next=1,"interval"===o?s(n):f(n);case 1:return u=e.sent,e.abrupt("return",{result:u});case 2:case"end":return e.stop()}}),e)})));function n(e){return r.apply(this,arguments)}return n}(),set:function(){var r=e(t.mark((function e(r){var n,o,u,a,i;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.delay,o=r.now,u=r.timerId,a=r.timerType,e.next=1,("interval"===a?p:d)(n,o,u);case 1:return i=e.sent,e.abrupt("return",{result:i});case 2:case"end":return e.stop()}}),e)})));function n(e){return r.apply(this,arguments)}return n}()})}(r(293),r(756),r(623),r(715))},546:e=>{function t(r,n,o,u){var a=Object.defineProperty;try{a({},"",{})}catch(r){a=0}e.exports=t=function(e,r,n,o){if(r)a?a(e,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[r]=n;else{var u=function(r,n){t(e,r,(function(e){return this._invoke(r,n,e)}))};u("next",0),u("throw",1),u("return",2)}},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n,o,u)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},579:(e,t,r)=>{var n=r(738).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(n(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},623:function(e,t,r){!function(e,t,r,n,o){"use strict";var u={INTERNAL_ERROR:-32603,INVALID_PARAMS:-32602,METHOD_NOT_FOUND:-32601},a=function(e,t){return Object.assign(new Error(e),{status:t})},i=function(e){return a('The requested method called "'.concat(e,'" is not supported.'),u.METHOD_NOT_FOUND)},s=function(e){return a('The handler of the method called "'.concat(e,'" returned no required result.'),u.INTERNAL_ERROR)},c=function(e){return a('The handler of the method called "'.concat(e,'" returned an unexpected result.'),u.INTERNAL_ERROR)},f=function(e){return a('The specified parameter called "portId" with the given value "'.concat(e,'" does not identify a port connected to this worker.'),u.INVALID_PARAMS)},l=function(e,n){return function(){var o=t(r.mark((function t(o){var u,a,f,l,p,d,v,x,y,b,h,m,_,g,w;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u=o.data,a=u.id,f=u.method,l=u.params,p=n[f],t.prev=1,void 0!==p){t.next=2;break}throw i(f);case 2:if(void 0!==(d=void 0===l?p():p(l))){t.next=3;break}throw s(f);case 3:if(!(d instanceof Promise)){t.next=5;break}return t.next=4,d;case 4:g=t.sent,t.next=6;break;case 5:g=d;case 6:if(v=g,null!==a){t.next=8;break}if(void 0===v.result){t.next=7;break}throw c(f);case 7:t.next=10;break;case 8:if(void 0!==v.result){t.next=9;break}throw c(f);case 9:x=v.result,y=v.transferables,b=void 0===y?[]:y,e.postMessage({id:a,result:x},b);case 10:t.next=12;break;case 11:t.prev=11,w=t.catch(1),h=w.message,m=w.status,_=void 0===m?-32603:m,e.postMessage({error:{code:_,message:h},id:a});case 12:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return o.apply(this,arguments)}}()},p=function(){return new Promise((function(e){var t=new ArrayBuffer(0),r=new MessageChannel,n=r.port1,o=r.port2;n.onmessage=function(t){var r=t.data;return e(null!==r)},o.postMessage(t,[t])}))};function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x=new Map,y=function(e,n,u){return v(v({},n),{},{connect:function(t){var r=t.port;r.start();var u=e(r,n),a=o.generateUniqueNumber(x);return x.set(a,(function(){u(),r.close(),x.delete(a)})),{result:a}},disconnect:function(e){var t=e.portId,r=x.get(t);if(void 0===r)throw f(t);return r(),{result:null}},isSupported:function(){var e=t(r.mark((function e(){var t,n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p();case 1:if(!e.sent){e.next=5;break}if(!((t=u())instanceof Promise)){e.next=3;break}return e.next=2,t;case 2:o=e.sent,e.next=4;break;case 3:o=t;case 4:return n=o,e.abrupt("return",{result:n});case 5:return e.abrupt("return",{result:!1});case 6:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()})},b=function(e,t){var r=y(b,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0}),n=l(e,r);return e.addEventListener("message",n),function(){return e.removeEventListener("message",n)}};e.createWorker=b,e.isSupported=p}(t,r(293),r(756),r(693),r(389))},633:(e,t,r)=>{var n=r(172),o=r(993),u=r(869),a=r(887),i=r(791),s=r(373),c=r(579);function f(){"use strict";var t=o(),r=t.m(f),l=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function p(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))}var d={throw:1,return:2,break:3,continue:3};function v(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,d[e],t)},delegateYield:function(e,o,u){return t.resultName=o,r(n.d,c(e),u)},finish:function(e){return r(n.f,e)}},r=function(e,r,o){n.p=t.prev,n.n=t.next;try{return e(r,o)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(e.exports=f=function(){return{wrap:function(e,r,n,o){return t.w(v(e),r,n,o&&o.reverse())},isGeneratorFunction:p,mark:t.m,awrap:function(e,t){return new n(e,t)},AsyncIterator:i,async:function(e,t,r,n,o){return(p(t)?a:u)(v(e),t,r,n,o)},keys:s,values:c}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=f,e.exports.__esModule=!0,e.exports.default=e.exports},693:(e,t,r)=>{var n=r(736);e.exports=function(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},715:(e,t,r)=>{var n=r(987),o=r(156),u=r(122),a=r(752);e.exports=function(e,t){return n(e)||o(e,t)||u(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},736:(e,t,r)=>{var n=r(738).default,o=r(45);e.exports=function(e){var t=o(e,"string");return"symbol"==n(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},738:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},752:e=>{e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},756:(e,t,r)=>{var n=r(633)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},791:(e,t,r)=>{var n=r(172),o=r(546);e.exports=function e(t,r){function u(e,o,a,i){try{var s=t[e](o),c=s.value;return c instanceof n?r.resolve(c.v).then((function(e){u("next",e,a,i)}),(function(e){u("throw",e,a,i)})):r.resolve(c).then((function(e){s.value=e,a(s)}),(function(e){return u("throw",e,a,i)}))}catch(e){i(e)}}var a;this.next||(o(e.prototype),o(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),o(this,"_invoke",(function(e,t,n){function o(){return new r((function(t,r){u(e,n,t,r)}))}return a=a?a.then(o,o):o()}),!0)},e.exports.__esModule=!0,e.exports.default=e.exports},869:(e,t,r)=>{var n=r(887);e.exports=function(e,t,r,o,u){var a=n(e,t,r,o,u);return a.next().then((function(e){return e.done?e.value:a.next()}))},e.exports.__esModule=!0,e.exports.default=e.exports},887:(e,t,r)=>{var n=r(993),o=r(791);e.exports=function(e,t,r,u,a){return new o(n().w(e,t,r,u),a||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},987:e=>{e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},993:(e,t,r)=>{var n=r(546);function o(){var t,r,u="function"==typeof Symbol?Symbol:{},a=u.iterator||"@@iterator",i=u.toStringTag||"@@toStringTag";function s(e,o,u,a){var i=o&&o.prototype instanceof f?o:f,s=Object.create(i.prototype);return n(s,"_invoke",function(e,n,o){var u,a,i,s=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,r){return u=e,a=0,i=t,p.n=r,c}};function d(e,n){for(a=e,i=n,r=0;!l&&s&&!o&&r<f.length;r++){var o,u=f[r],d=p.p,v=u[2];e>3?(o=v===n)&&(i=u[(a=u[4])?5:(a=3,3)],u[4]=u[5]=t):u[0]<=d&&((o=e<2&&d<u[1])?(a=0,p.v=n,p.n=u[1]):d<v&&(o=e<3||u[0]>n||n>v)&&(u[4]=e,u[5]=n,p.n=v,a=0))}if(o||e>1)return c;throw l=!0,n}return function(o,f,v){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&d(f,v),a=f,i=v;(r=a<2?t:i)||!l;){u||(a?a<3?(a>1&&(p.n=-1),d(a,i)):p.n=i:p.v=i);try{if(s=2,u){if(a||(o="next"),r=u[o]){if(!(r=r.call(u,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,a<2&&(a=0)}else 1===a&&(r=u.return)&&r.call(u),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);u=t}else if((r=(l=p.n<0)?i:e.call(n,p))!==c)break}catch(e){u=t,a=1,i=e}finally{s=1}}return{value:r,done:l}}}(e,u,a),!0),s}var c={};function f(){}function l(){}function p(){}r=Object.getPrototypeOf;var d=[][a]?r(r([][a]())):(n(r={},a,(function(){return this})),r),v=p.prototype=f.prototype=Object.create(d);function x(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,n(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e}return l.prototype=p,n(v,"constructor",p),n(p,"constructor",l),l.displayName="GeneratorFunction",n(p,i,"GeneratorFunction"),n(v),n(v,i,"Generator"),n(v,a,(function(){return this})),n(v,"toString",(function(){return"[object Generator]"})),(e.exports=o=function(){return{w:s,m:x}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var u=t[n]={exports:{}};return e[n].call(u.exports,u,u.exports,r),u.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";r(472)})()})();`,o=r(i.load,n),a=function(f){return o().clearInterval(f)},s=function(f){return o().clearTimeout(f)},c=function(){var f;return(f=o()).setInterval.apply(f,arguments)},u=function(){var f;return(f=o()).setTimeout.apply(f,arguments)};t.clearInterval=a,t.clearTimeout=s,t.setInterval=c,t.setTimeout=u})}),Hn=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0}),l.isReactNativeBrowser=l.isWebWorker=void 0;var e=()=>typeof window<"u"?typeof navigator<"u"&&navigator.userAgent?.toLowerCase().indexOf(" electron/")>-1&&$e?.versions?!Object.prototype.hasOwnProperty.call($e.versions,"electron"):typeof window.document<"u":!1,t=()=>!!(typeof self=="object"&&self?.constructor?.name?.includes("WorkerGlobalScope")&&typeof Deno>"u"),i=()=>typeof navigator<"u"&&navigator.product==="ReactNative",r=e()||t()||i();l.isWebWorker=t(),l.isReactNativeBrowser=i(),l.default=r}),Sh=we(l=>{de(),me(),pe();var e=l&&l.__createBinding||(Object.create?function(c,u,f,d){d===void 0&&(d=f);var m=Object.getOwnPropertyDescriptor(u,f);(!m||("get"in m?!u.__esModule:m.writable||m.configurable))&&(m={enumerable:!0,get:function(){return u[f]}}),Object.defineProperty(c,d,m)}:function(c,u,f,d){d===void 0&&(d=f),c[d]=u[f]}),t=l&&l.__setModuleDefault||(Object.create?function(c,u){Object.defineProperty(c,"default",{enumerable:!0,value:u})}:function(c,u){c.default=u}),i=l&&l.__importStar||(function(){var c=function(u){return c=Object.getOwnPropertyNames||function(f){var d=[];for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&(d[d.length]=m);return d},c(u)};return function(u){if(u&&u.__esModule)return u;var f={};if(u!=null)for(var d=c(u),m=0;m<d.length;m++)d[m]!=="default"&&e(f,u,d[m]);return t(f,u),f}})();Object.defineProperty(l,"__esModule",{value:!0});var r=_h(),n=i(Hn()),o={set:r.setInterval,clear:r.clearInterval},a={set:(c,u)=>setInterval(c,u),clear:c=>clearInterval(c)},s=c=>{switch(c){case"native":return a;case"worker":return o;case"auto":default:return n.default&&!n.isWebWorker&&!n.isReactNativeBrowser?o:a}};l.default=s}),fc=we(l=>{de(),me(),pe();var e=l&&l.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(l,"__esModule",{value:!0});var t=e(Sh()),i=class{constructor(r,n){M(this,"_keepalive");M(this,"timerId");M(this,"timer");M(this,"destroyed",!1);M(this,"counter");M(this,"client");M(this,"_keepaliveTimeoutTimestamp");M(this,"_intervalEvery");this.client=r,this.timer=typeof n=="object"&&"set"in n&&"clear"in n?n:(0,t.default)(n),this.setKeepalive(r.options.keepalive)}get keepaliveTimeoutTimestamp(){return this._keepaliveTimeoutTimestamp}get intervalEvery(){return this._intervalEvery}get keepalive(){return this._keepalive}clear(){this.timerId&&(this.timer.clear(this.timerId),this.timerId=null)}setKeepalive(r){if(r*=1e3,isNaN(r)||r<=0||r>2147483647)throw new Error(`Keepalive value must be an integer between 0 and 2147483647. Provided value is ${r}`);this._keepalive=r,this.reschedule(),this.client.log(`KeepaliveManager: set keepalive to ${r}ms`)}destroy(){this.clear(),this.destroyed=!0}reschedule(){if(this.destroyed)return;this.clear(),this.counter=0;let r=Math.ceil(this._keepalive*1.5);this._keepaliveTimeoutTimestamp=Date.now()+r,this._intervalEvery=Math.ceil(this._keepalive/2),this.timerId=this.timer.set(()=>{this.destroyed||(this.counter+=1,this.counter===2?this.client.sendPing():this.counter>2&&this.client.onKeepaliveTimeout())},this._intervalEvery)}};l.default=i}),bo=we(l=>{var _;de(),me(),pe();var e=l&&l.__createBinding||(Object.create?function(O,k,T,P){P===void 0&&(P=T);var A=Object.getOwnPropertyDescriptor(k,T);(!A||("get"in A?!k.__esModule:A.writable||A.configurable))&&(A={enumerable:!0,get:function(){return k[T]}}),Object.defineProperty(O,P,A)}:function(O,k,T,P){P===void 0&&(P=T),O[P]=k[T]}),t=l&&l.__setModuleDefault||(Object.create?function(O,k){Object.defineProperty(O,"default",{enumerable:!0,value:k})}:function(O,k){O.default=k}),i=l&&l.__importStar||(function(){var O=function(k){return O=Object.getOwnPropertyNames||function(T){var P=[];for(var A in T)Object.prototype.hasOwnProperty.call(T,A)&&(P[P.length]=A);return P},O(k)};return function(k){if(k&&k.__esModule)return k;var T={};if(k!=null)for(var P=O(k),A=0;A<P.length;A++)P[A]!=="default"&&e(T,k,P[A]);return t(T,k),T}})(),r=l&&l.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(l,"__esModule",{value:!0});var n=r(Ou()),o=tr(),a=r(Ru()),s=r(It()),c=i(Lu()),u=r($l()),f=r(th()),d=r(oc()),m=r(rh()),g=pr(),b=nh(),w=r(fc()),x=i(Hn()),y=globalThis.setImmediate||((...O)=>{let k=O.shift();(0,g.nextTick)(()=>{k(...O)})}),S={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:30*1e3,clean:!0,resubscribe:!0,subscribeBatchSize:null,writeCache:!0,timerVariant:"auto"},E=(_=class extends b.TypedEventEmitter{constructor(T,P){super();M(this,"connected");M(this,"disconnecting");M(this,"disconnected");M(this,"reconnecting");M(this,"incomingStore");M(this,"outgoingStore");M(this,"options");M(this,"queueQoSZero");M(this,"_reconnectCount");M(this,"log");M(this,"messageIdProvider");M(this,"outgoing");M(this,"messageIdToTopic");M(this,"noop");M(this,"keepaliveManager");M(this,"stream");M(this,"queue");M(this,"streamBuilder");M(this,"_resubscribeTopics");M(this,"connackTimer");M(this,"reconnectTimer");M(this,"_storeProcessing");M(this,"_packetIdsDuringStoreProcessing");M(this,"_storeProcessingQueue");M(this,"_firstConnection");M(this,"topicAliasRecv");M(this,"topicAliasSend");M(this,"_deferredReconnect");M(this,"connackPacket");this.options=P||{};for(let A in S)typeof this.options[A]>"u"?this.options[A]=S[A]:this.options[A]=P[A];this.log=this.options.log||(0,s.default)("mqttjs:client"),this.noop=this._noop.bind(this),this.log("MqttClient :: version:",_.VERSION),x.isWebWorker?this.log("MqttClient :: environment","webworker"):this.log("MqttClient :: environment",x.default?"browser":"node"),this.log("MqttClient :: options.protocol",P.protocol),this.log("MqttClient :: options.protocolVersion",P.protocolVersion),this.log("MqttClient :: options.username",P.username),this.log("MqttClient :: options.keepalive",P.keepalive),this.log("MqttClient :: options.reconnectPeriod",P.reconnectPeriod),this.log("MqttClient :: options.rejectUnauthorized",P.rejectUnauthorized),this.log("MqttClient :: options.properties.topicAliasMaximum",P.properties?P.properties.topicAliasMaximum:void 0),this.options.clientId=typeof P.clientId=="string"?P.clientId:_.defaultId(),this.log("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=P.protocolVersion===5&&P.customHandleAcks?P.customHandleAcks:(...A)=>{A[3](null,0)},this.options.writeCache||(n.default.writeToStream.cacheNumbers=!1),this.streamBuilder=T,this.messageIdProvider=typeof this.options.messageIdProvider>"u"?new d.default:this.options.messageIdProvider,this.outgoingStore=P.outgoingStore||new u.default,this.incomingStore=P.incomingStore||new u.default,this.queueQoSZero=P.queueQoSZero===void 0?!0:P.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.keepaliveManager=null,this.connected=!1,this.disconnecting=!1,this.reconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,P.properties&&P.properties.topicAliasMaximum>0&&(P.properties.topicAliasMaximum>65535?this.log("MqttClient :: options.properties.topicAliasMaximum is out of range"):this.topicAliasRecv=new m.default(P.properties.topicAliasMaximum)),this.on("connect",()=>{let{queue:A}=this,U=()=>{let I=A.shift();this.log("deliver :: entry %o",I);let B=null;if(!I){this._resubscribe();return}B=I.packet,this.log("deliver :: call _sendPacket for %o",B);let F=!0;B.messageId&&B.messageId!==0&&(this.messageIdProvider.register(B.messageId)||(F=!1)),F?this._sendPacket(B,D=>{I.cb&&I.cb(D),U()}):(this.log("messageId: %d has already used. The message is skipped and removed.",B.messageId),U())};this.log("connect :: sending queued packets"),U()}),this.on("close",()=>{this.log("close :: connected set to `false`"),this.connected=!1,this.log("close :: clearing connackTimer"),clearTimeout(this.connackTimer),this._destroyKeepaliveManager(),this.topicAliasRecv&&this.topicAliasRecv.clear(),this.log("close :: calling _setupReconnect"),this._setupReconnect()}),this.options.manualConnect||(this.log("MqttClient :: setting up stream"),this.connect())}static defaultId(){return`mqttjs_${Math.random().toString(16).substr(2,8)}`}handleAuth(T,P){P()}handleMessage(T,P){P()}_nextId(){return this.messageIdProvider.allocate()}getLastMessageId(){return this.messageIdProvider.getLastAllocated()}connect(){let T=new o.Writable,P=n.default.parser(this.options),A=null,U=[];this.log("connect :: calling method to clear reconnect"),this._clearReconnect(),this.disconnected&&!this.reconnecting&&(this.incomingStore=this.options.incomingStore||new u.default,this.outgoingStore=this.options.outgoingStore||new u.default,this.disconnecting=!1,this.disconnected=!1),this.log("connect :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),P.on("packet",J=>{this.log("parser :: on packet push to packets array."),U.push(J)});let I=()=>{this.log("work :: getting next packet in queue");let J=U.shift();if(J)this.log("work :: packet pulled from queue"),(0,f.default)(this,J,B);else{this.log("work :: no packets in queue");let G=A;A=null,this.log("work :: done flag is %s",!!G),G&&G()}},B=()=>{if(U.length)(0,g.nextTick)(I);else{let J=A;A=null,J()}};T._write=(J,G,Y)=>{A=Y,this.log("writable stream :: parsing buffer"),P.parse(J),I()};let F=J=>{this.log("streamErrorHandler :: error",J.message),J.code?(this.log("streamErrorHandler :: emitting error"),this.emit("error",J)):this.noop(J)};this.log("connect :: pipe stream to writable stream"),this.stream.pipe(T),this.stream.on("error",F),this.stream.on("close",()=>{this.log("(%s)stream :: on close",this.options.clientId),this._flushVolatile(),this.log("stream: emit close to MqttClient"),this.emit("close")}),this.log("connect: sending packet `connect`");let D={cmd:"connect",protocolId:this.options.protocolId,protocolVersion:this.options.protocolVersion,clean:this.options.clean,clientId:this.options.clientId,keepalive:this.options.keepalive,username:this.options.username,password:this.options.password,properties:this.options.properties};if(this.options.will&&(D.will={...this.options.will,payload:this.options.will?.payload}),this.topicAliasRecv&&(D.properties||(D.properties={}),this.topicAliasRecv&&(D.properties.topicAliasMaximum=this.topicAliasRecv.max)),this._writePacket(D),P.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"){let J={cmd:"auth",reasonCode:0,...this.options.authPacket};this._writePacket(J)}}return this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(()=>{this.log("!!connectTimeout hit!! Calling _cleanUp with force `true`"),this.emit("error",new Error("connack timeout")),this._cleanUp(!0)},this.options.connectTimeout),this}publish(T,P,A,U){this.log("publish :: message `%s` to topic `%s`",P,T);let{options:I}=this;typeof A=="function"&&(U=A,A=null),A=A||{},A={qos:0,retain:!1,dup:!1,...A};let{qos:B,retain:F,dup:D,properties:J,cbStorePut:G}=A;if(this._checkDisconnecting(U))return this;let Y=()=>{let ce=0;if((B===1||B===2)&&(ce=this._nextId(),ce===null))return this.log("No messageId left"),!1;let H={cmd:"publish",topic:T,payload:P,qos:B,retain:F,messageId:ce,dup:D};switch(I.protocolVersion===5&&(H.properties=J),this.log("publish :: qos",B),B){case 1:case 2:this.outgoing[H.messageId]={volatile:!1,cb:U||this.noop},this.log("MqttClient:publish: packet cmd: %s",H.cmd),this._sendPacket(H,void 0,G);break;default:this.log("MqttClient:publish: packet cmd: %s",H.cmd),this._sendPacket(H,U,G);break}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!Y())&&this._storeProcessingQueue.push({invoke:Y,cbStorePut:A.cbStorePut,callback:U}),this}publishAsync(T,P,A){return new Promise((U,I)=>{this.publish(T,P,A,(B,F)=>{B?I(B):U(F)})})}subscribe(T,P,A){let U=this.options.protocolVersion;typeof P=="function"&&(A=P),A=A||this.noop;let I=!1,B=[];typeof T=="string"?(T=[T],B=T):Array.isArray(T)?B=T:typeof T=="object"&&(I=T.resubscribe,delete T.resubscribe,B=Object.keys(T));let F=c.validateTopics(B);if(F!==null)return y(A,new Error(`Invalid topic ${F}`)),this;if(this._checkDisconnecting(A))return this.log("subscribe: discconecting true"),this;let D={qos:0};U===5&&(D.nl=!1,D.rap=!1,D.rh=0),P={...D,...P};let{properties:J}=P,G=[],Y=(oe,R)=>{if(R=R||P,!Object.prototype.hasOwnProperty.call(this._resubscribeTopics,oe)||this._resubscribeTopics[oe].qos<R.qos||I){let V={topic:oe,qos:R.qos};U===5&&(V.nl=R.nl,V.rap=R.rap,V.rh=R.rh,V.properties=J),this.log("subscribe: pushing topic `%s` and qos `%s` to subs list",V.topic,V.qos),G.push(V)}};if(Array.isArray(T)?T.forEach(oe=>{this.log("subscribe: array topic %s",oe),Y(oe)}):Object.keys(T).forEach(oe=>{this.log("subscribe: object topic %s, %o",oe,T[oe]),Y(oe,T[oe])}),!G.length)return A(null,[]),this;let ce=(oe,R)=>{let V={cmd:"subscribe",subscriptions:oe,messageId:R};if(J&&(V.properties=J),this.options.resubscribe){this.log("subscribe :: resubscribe true");let se=[];oe.forEach(be=>{if(this.options.reconnectPeriod>0){let K={qos:be.qos};U===5&&(K.nl=be.nl||!1,K.rap=be.rap||!1,K.rh=be.rh||0,K.properties=be.properties),this._resubscribeTopics[be.topic]=K,se.push(be.topic)}}),this.messageIdToTopic[V.messageId]=se}let te=new Promise((se,be)=>{this.outgoing[V.messageId]={volatile:!0,cb(K,j){if(!K){let{granted:ie}=j;for(let Z=0;Z<ie.length;Z+=1)oe[Z].qos=ie[Z]}K?be(new g.ErrorWithSubackPacket(K.message,j)):se(j)}}});return this.log("subscribe :: call _sendPacket"),this._sendPacket(V),te},H=()=>{let oe=this.options.subscribeBatchSize??G.length,R=[];for(let V=0;V<G.length;V+=oe){let te=G.slice(V,V+oe),se=this._nextId();if(se===null)return this.log("No messageId left"),!1;R.push(ce(te,se))}return Promise.all(R).then(V=>{A(null,G,V.at(-1))}).catch(V=>{A(V,G,V.packet)}),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!H())&&this._storeProcessingQueue.push({invoke:H,callback:A}),this}subscribeAsync(T,P){return new Promise((A,U)=>{this.subscribe(T,P,(I,B)=>{I?U(I):A(B)})})}unsubscribe(T,P,A){typeof T=="string"&&(T=[T]),typeof P=="function"&&(A=P),A=A||this.noop;let U=c.validateTopics(T);if(U!==null)return y(A,new Error(`Invalid topic ${U}`)),this;if(this._checkDisconnecting(A))return this;let I=()=>{let B=this._nextId();if(B===null)return this.log("No messageId left"),!1;let F={cmd:"unsubscribe",messageId:B,unsubscriptions:[]};return typeof T=="string"?F.unsubscriptions=[T]:Array.isArray(T)&&(F.unsubscriptions=T),this.options.resubscribe&&F.unsubscriptions.forEach(D=>{delete this._resubscribeTopics[D]}),typeof P=="object"&&P.properties&&(F.properties=P.properties),this.outgoing[F.messageId]={volatile:!0,cb:A},this.log("unsubscribe: call _sendPacket"),this._sendPacket(F),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!I())&&this._storeProcessingQueue.push({invoke:I,callback:A}),this}unsubscribeAsync(T,P){return new Promise((A,U)=>{this.unsubscribe(T,P,(I,B)=>{I?U(I):A(B)})})}end(T,P,A){this.log("end :: (%s)",this.options.clientId),(T==null||typeof T!="boolean")&&(A=A||P,P=T,T=!1),typeof P!="object"&&(A=A||P,P=null),this.log("end :: cb? %s",!!A),(!A||typeof A!="function")&&(A=this.noop);let U=()=>{this.log("end :: closeStores: closing incoming and outgoing stores"),this.disconnected=!0,this.incomingStore.close(B=>{this.outgoingStore.close(F=>{if(this.log("end :: closeStores: emitting end"),this.emit("end"),A){let D=B||F;this.log("end :: closeStores: invoking callback with args"),A(D)}})}),this._deferredReconnect?this._deferredReconnect():(this.options.reconnectPeriod===0||this.options.manualConnect)&&(this.disconnecting=!1)},I=()=>{this.log("end :: (%s) :: finish :: calling _cleanUp with force %s",this.options.clientId,T),this._cleanUp(T,()=>{this.log("end :: finish :: calling process.nextTick on closeStores"),(0,g.nextTick)(U)},P)};return this.disconnecting?(A(),this):(this._clearReconnect(),this.disconnecting=!0,!T&&Object.keys(this.outgoing).length>0?(this.log("end :: (%s) :: calling finish in 10ms once outgoing is empty",this.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,I,10))):(this.log("end :: (%s) :: immediately calling finish",this.options.clientId),I()),this)}endAsync(T,P){return new Promise((A,U)=>{this.end(T,P,I=>{I?U(I):A()})})}removeOutgoingMessage(T){if(this.outgoing[T]){let{cb:P}=this.outgoing[T];this._removeOutgoingAndStoreMessage(T,()=>{P(new Error("Message removed"))})}return this}reconnect(T){this.log("client reconnect");let P=()=>{T?(this.options.incomingStore=T.incomingStore,this.options.outgoingStore=T.outgoingStore):(this.options.incomingStore=null,this.options.outgoingStore=null),this.incomingStore=this.options.incomingStore||new u.default,this.outgoingStore=this.options.outgoingStore||new u.default,this.disconnecting=!1,this.disconnected=!1,this._deferredReconnect=null,this._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=P:P(),this}_flushVolatile(){this.outgoing&&(this.log("_flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(this.outgoing).forEach(T=>{this.outgoing[T].volatile&&typeof this.outgoing[T].cb=="function"&&(this.outgoing[T].cb(new Error("Connection closed")),delete this.outgoing[T])}))}_flush(){this.outgoing&&(this.log("_flush: queue exists? %b",!!this.outgoing),Object.keys(this.outgoing).forEach(T=>{typeof this.outgoing[T].cb=="function"&&(this.outgoing[T].cb(new Error("Connection closed")),delete this.outgoing[T])}))}_removeTopicAliasAndRecoverTopicName(T){let P;T.properties&&(P=T.properties.topicAlias);let A=T.topic.toString();if(this.log("_removeTopicAliasAndRecoverTopicName :: alias %d, topic %o",P,A),A.length===0){if(typeof P>"u")return new Error("Unregistered Topic Alias");if(A=this.topicAliasSend.getTopicByAlias(P),typeof A>"u")return new Error("Unregistered Topic Alias");T.topic=A}P&&delete T.properties.topicAlias}_checkDisconnecting(T){return this.disconnecting&&(T&&T!==this.noop?T(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting}_reconnect(){this.log("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this.connect()}),this.log("client already connected. disconnecting first.")):(this.log("_reconnect: calling connect"),this.connect())}_setupReconnect(){!this.disconnecting&&!this.reconnectTimer&&this.options.reconnectPeriod>0?(this.reconnecting||(this.log("_setupReconnect :: emit `offline` state"),this.emit("offline"),this.log("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),this.log("_setupReconnect :: setting reconnectTimer for %d ms",this.options.reconnectPeriod),this.reconnectTimer=setInterval(()=>{this.log("reconnectTimer :: reconnect triggered!"),this._reconnect()},this.options.reconnectPeriod)):this.log("_setupReconnect :: doing nothing...")}_clearReconnect(){this.log("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)}_cleanUp(T,P,A={}){if(P&&(this.log("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",P)),this.log("_cleanUp :: forced? %s",T),T)this.options.reconnectPeriod===0&&this.options.clean&&this._flush(),this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{let U={cmd:"disconnect",...A};this.log("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(U,()=>{this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),y(()=>{this.stream.end(()=>{this.log("_cleanUp :: (%s) :: stream destroyed",this.options.clientId)})})})}!this.disconnecting&&!this.reconnecting&&(this.log("_cleanUp :: client not disconnecting/reconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this._destroyKeepaliveManager(),P&&!this.connected&&(this.log("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",P),P())}_storeAndSend(T,P,A){this.log("storeAndSend :: store packet with cmd %s to outgoingStore",T.cmd);let U=T,I;if(U.cmd==="publish"&&(U=(0,a.default)(T),I=this._removeTopicAliasAndRecoverTopicName(U),I))return P&&P(I);this.outgoingStore.put(U,B=>{if(B)return P&&P(B);A(),this._writePacket(T,P)})}_applyTopicAlias(T){if(this.options.protocolVersion===5&&T.cmd==="publish"){let P;T.properties&&(P=T.properties.topicAlias);let A=T.topic.toString();if(this.topicAliasSend)if(P){if(A.length!==0&&(this.log("applyTopicAlias :: register topic: %s - alias: %d",A,P),!this.topicAliasSend.put(A,P)))return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",A,P),new Error("Sending Topic Alias out of range")}else A.length!==0&&(this.options.autoAssignTopicAlias?(P=this.topicAliasSend.getAliasByTopic(A),P?(T.topic="",T.properties={...T.properties,topicAlias:P},this.log("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",A,P)):(P=this.topicAliasSend.getLruAlias(),this.topicAliasSend.put(A,P),T.properties={...T.properties,topicAlias:P},this.log("applyTopicAlias :: auto assign topic: %s - alias: %d",A,P))):this.options.autoUseTopicAlias&&(P=this.topicAliasSend.getAliasByTopic(A),P&&(T.topic="",T.properties={...T.properties,topicAlias:P},this.log("applyTopicAlias :: auto use topic: %s - alias: %d",A,P))));else if(P)return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",A,P),new Error("Sending Topic Alias out of range")}}_noop(T){this.log("noop ::",T)}_writePacket(T,P){this.log("_writePacket :: packet: %O",T),this.log("_writePacket :: emitting `packetsend`"),this.emit("packetsend",T),this.log("_writePacket :: writing to stream");let A=n.default.writeToStream(T,this.stream,this.options);this.log("_writePacket :: writeToStream result %s",A),!A&&P&&P!==this.noop?(this.log("_writePacket :: handle events on `drain` once through callback."),this.stream.once("drain",P)):P&&(this.log("_writePacket :: invoking cb"),P())}_sendPacket(T,P,A,U){this.log("_sendPacket :: (%s) ::  start",this.options.clientId),A=A||this.noop,P=P||this.noop;let I=this._applyTopicAlias(T);if(I){P(I);return}if(!this.connected){if(T.cmd==="auth"){this._writePacket(T,P);return}this.log("_sendPacket :: client not connected. Storing packet offline."),this._storePacket(T,P,A);return}if(U){this._writePacket(T,P);return}switch(T.cmd){case"publish":break;case"pubrel":this._storeAndSend(T,P,A);return;default:this._writePacket(T,P);return}switch(T.qos){case 2:case 1:this._storeAndSend(T,P,A);break;case 0:default:this._writePacket(T,P);break}this.log("_sendPacket :: (%s) ::  end",this.options.clientId)}_storePacket(T,P,A){this.log("_storePacket :: packet: %o",T),this.log("_storePacket :: cb? %s",!!P),A=A||this.noop;let U=T;if(U.cmd==="publish"){U=(0,a.default)(T);let B=this._removeTopicAliasAndRecoverTopicName(U);if(B)return P&&P(B)}let I=U.qos||0;I===0&&this.queueQoSZero||U.cmd!=="publish"?this.queue.push({packet:U,cb:P}):I>0?(P=this.outgoing[U.messageId]?this.outgoing[U.messageId].cb:null,this.outgoingStore.put(U,B=>{if(B)return P&&P(B);A()})):P&&P(new Error("No connection to broker"))}_setupKeepaliveManager(){this.log("_setupKeepaliveManager :: keepalive %d (seconds)",this.options.keepalive),!this.keepaliveManager&&this.options.keepalive&&(this.keepaliveManager=new w.default(this,this.options.timerVariant))}_destroyKeepaliveManager(){this.keepaliveManager&&(this.log("_destroyKeepaliveManager :: destroying keepalive manager"),this.keepaliveManager.destroy(),this.keepaliveManager=null)}reschedulePing(T=!1){this.keepaliveManager&&this.options.keepalive&&(T||this.options.reschedulePings)&&this._reschedulePing()}_reschedulePing(){this.log("_reschedulePing :: rescheduling ping"),this.keepaliveManager.reschedule()}sendPing(){this.log("_sendPing :: sending pingreq"),this._sendPacket({cmd:"pingreq"})}onKeepaliveTimeout(){this.emit("error",new Error("Keepalive timeout")),this.log("onKeepaliveTimeout :: calling _cleanUp with force true"),this._cleanUp(!0)}_resubscribe(){this.log("_resubscribe");let T=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion>=4&&!this.connackPacket.sessionPresent)&&T.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){this.log("_resubscribe: protocolVersion 5");for(let P=0;P<T.length;P++){let A={};A[T[P]]=this._resubscribeTopics[T[P]],A.resubscribe=!0,this.subscribe(A,{properties:A[T[P]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1}_onConnect(T){if(this.disconnected){this.emit("connect",T);return}this.connackPacket=T,this.messageIdProvider.clear(),this._setupKeepaliveManager(),this.connected=!0;let P=()=>{let A=this.outgoingStore.createStream(),U=()=>{A.destroy(),A=null,this._flushStoreProcessingQueue(),I()},I=()=>{this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={}};this.once("close",U),A.on("error",F=>{I(),this._flushStoreProcessingQueue(),this.removeListener("close",U),this.emit("error",F)});let B=()=>{if(!A)return;let F=A.read(1),D;if(!F){A.once("readable",B);return}if(this._storeProcessing=!0,this._packetIdsDuringStoreProcessing[F.messageId]){B();return}!this.disconnecting&&!this.reconnectTimer?(D=this.outgoing[F.messageId]?this.outgoing[F.messageId].cb:null,this.outgoing[F.messageId]={volatile:!1,cb(J,G){D&&D(J,G),B()}},this._packetIdsDuringStoreProcessing[F.messageId]=!0,this.messageIdProvider.register(F.messageId)?this._sendPacket(F,void 0,void 0,!0):this.log("messageId: %d has already used.",F.messageId)):A.destroy&&A.destroy()};A.on("end",()=>{let F=!0;for(let D in this._packetIdsDuringStoreProcessing)if(!this._packetIdsDuringStoreProcessing[D]){F=!1;break}this.removeListener("close",U),F?(I(),this._invokeAllStoreProcessingQueue(),this.emit("connect",T)):P()}),B()};P()}_invokeStoreProcessingQueue(){if(!this._storeProcessing&&this._storeProcessingQueue.length>0){let T=this._storeProcessingQueue[0];if(T&&T.invoke())return this._storeProcessingQueue.shift(),!0}return!1}_invokeAllStoreProcessingQueue(){for(;this._invokeStoreProcessingQueue(););}_flushStoreProcessingQueue(){for(let T of this._storeProcessingQueue)T.cbStorePut&&T.cbStorePut(new Error("Connection closed")),T.callback&&T.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)}_removeOutgoingAndStoreMessage(T,P){delete this.outgoing[T],this.outgoingStore.del({messageId:T},(A,U)=>{P(A,U),this.messageIdProvider.deallocate(T),this._invokeStoreProcessingQueue()})}},M(_,"VERSION",g.MQTTJS_VERSION),_);l.default=E}),xh=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0});var e=ic(),t=class{constructor(){M(this,"numberAllocator");M(this,"lastId");this.numberAllocator=new e.NumberAllocator(1,65535)}allocate(){return this.lastId=this.numberAllocator.alloc(),this.lastId}getLastAllocated(){return this.lastId}register(i){return this.numberAllocator.use(i)}deallocate(i){this.numberAllocator.free(i)}clear(){this.numberAllocator.clear()}};l.default=t});function Eh(){if(vo)return rn;vo=!0;let l=2147483647,e=36,t=1,i=26,r=38,n=700,o=72,a=128,s="-",c=/^xn--/,u=/[^\0-\x7F]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=e-t,g=Math.floor,b=String.fromCharCode;function w(A){throw new RangeError(d[A])}function x(A,U){let I=[],B=A.length;for(;B--;)I[B]=U(A[B]);return I}function y(A,U){let I=A.split("@"),B="";I.length>1&&(B=I[0]+"@",A=I[1]),A=A.replace(f,".");let F=A.split("."),D=x(F,U).join(".");return B+D}function S(A){let U=[],I=0,B=A.length;for(;I<B;){let F=A.charCodeAt(I++);if(F>=55296&&F<=56319&&I<B){let D=A.charCodeAt(I++);(D&64512)==56320?U.push(((F&1023)<<10)+(D&1023)+65536):(U.push(F),I--)}else U.push(F)}return U}let E=A=>String.fromCodePoint(...A),_=function(A){return A>=48&&A<58?26+(A-48):A>=65&&A<91?A-65:A>=97&&A<123?A-97:e},O=function(A,U){return A+22+75*(A<26)-((U!=0)<<5)},k=function(A,U,I){let B=0;for(A=I?g(A/n):A>>1,A+=g(A/U);A>m*i>>1;B+=e)A=g(A/m);return g(B+(m+1)*A/(A+r))},T=function(A){let U=[],I=A.length,B=0,F=a,D=o,J=A.lastIndexOf(s);J<0&&(J=0);for(let G=0;G<J;++G)A.charCodeAt(G)>=128&&w("not-basic"),U.push(A.charCodeAt(G));for(let G=J>0?J+1:0;G<I;){let Y=B;for(let H=1,oe=e;;oe+=e){G>=I&&w("invalid-input");let R=_(A.charCodeAt(G++));R>=e&&w("invalid-input"),R>g((l-B)/H)&&w("overflow"),B+=R*H;let V=oe<=D?t:oe>=D+i?i:oe-D;if(R<V)break;let te=e-V;H>g(l/te)&&w("overflow"),H*=te}let ce=U.length+1;D=k(B-Y,ce,Y==0),g(B/ce)>l-F&&w("overflow"),F+=g(B/ce),B%=ce,U.splice(B++,0,F)}return String.fromCodePoint(...U)},P=function(A){let U=[];A=S(A);let I=A.length,B=a,F=0,D=o;for(let Y of A)Y<128&&U.push(b(Y));let J=U.length,G=J;for(J&&U.push(s);G<I;){let Y=l;for(let H of A)H>=B&&H<Y&&(Y=H);let ce=G+1;Y-B>g((l-F)/ce)&&w("overflow"),F+=(Y-B)*ce,B=Y;for(let H of A)if(H<B&&++F>l&&w("overflow"),H===B){let oe=F;for(let R=e;;R+=e){let V=R<=D?t:R>=D+i?i:R-D;if(oe<V)break;let te=oe-V,se=e-V;U.push(b(O(V+te%se,0))),oe=g(te/se)}U.push(b(O(oe,0))),D=k(F,ce,G===J),F=0,++G}++F,++B}return U.join("")};return rn={version:"2.3.1",ucs2:{decode:S,encode:E},decode:T,encode:P,toASCII:function(A){return y(A,function(U){return u.test(U)?"xn--"+P(U):U})},toUnicode:function(A){return y(A,function(U){return c.test(U)?T(U.slice(4).toLowerCase()):U})}},rn}var rn,vo,Nt,Ih=ut(()=>{de(),me(),pe(),rn={},vo=!1,Nt=Eh(),Nt.decode,Nt.encode,Nt.toASCII,Nt.toUnicode,Nt.ucs2,Nt.version});function Ah(){return _o||(_o=!0,wo=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var l={},e=Symbol("test"),t=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(t)!=="[object Symbol]")return!1;var i=42;l[e]=i;for(e in l)return!1;if(typeof Object.keys=="function"&&Object.keys(l).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(l).length!==0)return!1;var r=Object.getOwnPropertySymbols(l);if(r.length!==1||r[0]!==e||!Object.prototype.propertyIsEnumerable.call(l,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var n=Object.getOwnPropertyDescriptor(l,e);if(n.value!==i||n.enumerable!==!0)return!1}return!0}),wo}function kh(){return xo||(xo=!0,So=Error),So}function Th(){return Io||(Io=!0,Eo=EvalError),Eo}function Ph(){return ko||(ko=!0,Ao=RangeError),Ao}function Mh(){return Po||(Po=!0,To=ReferenceError),To}function dc(){return Oo||(Oo=!0,Mo=SyntaxError),Mo}function Wr(){return Ro||(Ro=!0,Co=TypeError),Co}function Oh(){return Bo||(Bo=!0,Lo=URIError),Lo}function Ch(){if(Uo)return nn;Uo=!0;var l=typeof Symbol<"u"&&Symbol,e=Ah();return nn=function(){return typeof l!="function"||typeof Symbol!="function"||typeof l("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},nn}function Rh(){if(Do)return on;Do=!0;var l={__proto__:null,foo:{}},e=Object;return on=function(){return{__proto__:l}.foo===l.foo&&!(l instanceof e)},on}function Lh(){if(No)return sn;No=!0;var l="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,i="[object Function]",r=function(a,s){for(var c=[],u=0;u<a.length;u+=1)c[u]=a[u];for(var f=0;f<s.length;f+=1)c[f+a.length]=s[f];return c},n=function(a,s){for(var c=[],u=s,f=0;u<a.length;u+=1,f+=1)c[f]=a[u];return c},o=function(a,s){for(var c="",u=0;u<a.length;u+=1)c+=a[u],u+1<a.length&&(c+=s);return c};return sn=function(a){var s=this;if(typeof s!="function"||e.apply(s)!==i)throw new TypeError(l+s);for(var c=n(arguments,1),u,f=function(){if(this instanceof u){var w=s.apply(this,r(c,arguments));return Object(w)===w?w:this}return s.apply(a,r(c,arguments))},d=t(0,s.length-c.length),m=[],g=0;g<d;g++)m[g]="$"+g;if(u=Function("binder","return function ("+o(m,",")+"){ return binder.apply(this,arguments); }")(f),s.prototype){var b=function(){};b.prototype=s.prototype,u.prototype=new b,b.prototype=null}return u},sn}function bs(){if(jo)return an;jo=!0;var l=Lh();return an=Function.prototype.bind||l,an}function Bh(){if(Fo)return ln;Fo=!0;var l=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=bs();return ln=t.call(l,e),ln}function mr(){if(Wo)return cn;Wo=!0;var l,e=kh(),t=Th(),i=Ph(),r=Mh(),n=dc(),o=Wr(),a=Oh(),s=Function,c=function(G){try{return s('"use strict"; return ('+G+").constructor;")()}catch{}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch{u=null}var f=function(){throw new o},d=u?(function(){try{return arguments.callee,f}catch{try{return u(arguments,"callee").get}catch{return f}}})():f,m=Ch()(),g=Rh()(),b=Object.getPrototypeOf||(g?function(G){return G.__proto__}:null),w={},x=typeof Uint8Array>"u"||!b?l:b(Uint8Array),y={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?l:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?l:ArrayBuffer,"%ArrayIteratorPrototype%":m&&b?b([][Symbol.iterator]()):l,"%AsyncFromSyncIteratorPrototype%":l,"%AsyncFunction%":w,"%AsyncGenerator%":w,"%AsyncGeneratorFunction%":w,"%AsyncIteratorPrototype%":w,"%Atomics%":typeof Atomics>"u"?l:Atomics,"%BigInt%":typeof BigInt>"u"?l:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?l:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?l:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?l:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":t,"%Float32Array%":typeof Float32Array>"u"?l:Float32Array,"%Float64Array%":typeof Float64Array>"u"?l:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?l:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":w,"%Int8Array%":typeof Int8Array>"u"?l:Int8Array,"%Int16Array%":typeof Int16Array>"u"?l:Int16Array,"%Int32Array%":typeof Int32Array>"u"?l:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":m&&b?b(b([][Symbol.iterator]())):l,"%JSON%":typeof JSON=="object"?JSON:l,"%Map%":typeof Map>"u"?l:Map,"%MapIteratorPrototype%":typeof Map>"u"||!m||!b?l:b(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?l:Promise,"%Proxy%":typeof Proxy>"u"?l:Proxy,"%RangeError%":i,"%ReferenceError%":r,"%Reflect%":typeof Reflect>"u"?l:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?l:Set,"%SetIteratorPrototype%":typeof Set>"u"||!m||!b?l:b(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?l:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":m&&b?b(""[Symbol.iterator]()):l,"%Symbol%":m?Symbol:l,"%SyntaxError%":n,"%ThrowTypeError%":d,"%TypedArray%":x,"%TypeError%":o,"%Uint8Array%":typeof Uint8Array>"u"?l:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?l:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?l:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?l:Uint32Array,"%URIError%":a,"%WeakMap%":typeof WeakMap>"u"?l:WeakMap,"%WeakRef%":typeof WeakRef>"u"?l:WeakRef,"%WeakSet%":typeof WeakSet>"u"?l:WeakSet};if(b)try{null.error}catch(G){var S=b(b(G));y["%Error.prototype%"]=S}var E=function G(Y){var ce;if(Y==="%AsyncFunction%")ce=c("async function () {}");else if(Y==="%GeneratorFunction%")ce=c("function* () {}");else if(Y==="%AsyncGeneratorFunction%")ce=c("async function* () {}");else if(Y==="%AsyncGenerator%"){var H=G("%AsyncGeneratorFunction%");H&&(ce=H.prototype)}else if(Y==="%AsyncIteratorPrototype%"){var oe=G("%AsyncGenerator%");oe&&b&&(ce=b(oe.prototype))}return y[Y]=ce,ce},_={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},O=bs(),k=Bh(),T=O.call(Function.call,Array.prototype.concat),P=O.call(Function.apply,Array.prototype.splice),A=O.call(Function.call,String.prototype.replace),U=O.call(Function.call,String.prototype.slice),I=O.call(Function.call,RegExp.prototype.exec),B=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,F=/\\(\\)?/g,D=function(G){var Y=U(G,0,1),ce=U(G,-1);if(Y==="%"&&ce!=="%")throw new n("invalid intrinsic syntax, expected closing `%`");if(ce==="%"&&Y!=="%")throw new n("invalid intrinsic syntax, expected opening `%`");var H=[];return A(G,B,function(oe,R,V,te){H[H.length]=V?A(te,F,"$1"):R||oe}),H},J=function(G,Y){var ce=G,H;if(k(_,ce)&&(H=_[ce],ce="%"+H[0]+"%"),k(y,ce)){var oe=y[ce];if(oe===w&&(oe=E(ce)),typeof oe>"u"&&!Y)throw new o("intrinsic "+G+" exists, but is not available. Please file an issue!");return{alias:H,name:ce,value:oe}}throw new n("intrinsic "+G+" does not exist!")};return cn=function(G,Y){if(typeof G!="string"||G.length===0)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Y!="boolean")throw new o('"allowMissing" argument must be a boolean');if(I(/^%?[^%]*%?$/,G)===null)throw new n("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var ce=D(G),H=ce.length>0?ce[0]:"",oe=J("%"+H+"%",Y),R=oe.name,V=oe.value,te=!1,se=oe.alias;se&&(H=se[0],P(ce,T([0,1],se)));for(var be=1,K=!0;be<ce.length;be+=1){var j=ce[be],ie=U(j,0,1),Z=U(j,-1);if((ie==='"'||ie==="'"||ie==="`"||Z==='"'||Z==="'"||Z==="`")&&ie!==Z)throw new n("property names with quotes must have matching quotes");if((j==="constructor"||!K)&&(te=!0),H+="."+j,R="%"+H+"%",k(y,R))V=y[R];else if(V!=null){if(!(j in V)){if(!Y)throw new o("base intrinsic for "+G+" exists, but the property is not available.");return}if(u&&be+1>=ce.length){var re=u(V,j);K=!!re,K&&"get"in re&&!("originalValue"in re.get)?V=re.get:V=V[j]}else K=k(V,j),V=V[j];K&&!te&&(y[R]=V)}}return V},cn}function vs(){if($o)return un;$o=!0;var l=mr(),e=l("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return un=e,un}function pc(){if(zo)return hn;zo=!0;var l=mr(),e=l("%Object.getOwnPropertyDescriptor%",!0);if(e)try{e([],"length")}catch{e=null}return hn=e,hn}function Uh(){if(qo)return fn;qo=!0;var l=vs(),e=dc(),t=Wr(),i=pc();return fn=function(r,n,o){if(!r||typeof r!="object"&&typeof r!="function")throw new t("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6?arguments[6]:!1,f=!!i&&i(r,n);if(l)l(r,n,{configurable:c===null&&f?f.configurable:!c,enumerable:a===null&&f?f.enumerable:!a,value:o,writable:s===null&&f?f.writable:!s});else if(u||!a&&!s&&!c)r[n]=o;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},fn}function Dh(){if(Ho)return dn;Ho=!0;var l=vs(),e=function(){return!!l};return e.hasArrayLengthDefineBug=function(){if(!l)return null;try{return l([],"length",{value:1}).length!==1}catch{return!0}},dn=e,dn}function Nh(){if(Go)return pn;Go=!0;var l=mr(),e=Uh(),t=Dh()(),i=pc(),r=Wr(),n=l("%Math.floor%");return pn=function(o,a){if(typeof o!="function")throw new r("`fn` is not a function");if(typeof a!="number"||a<0||a>4294967295||n(a)!==a)throw new r("`length` must be a positive 32-bit integer");var s=arguments.length>2&&!!arguments[2],c=!0,u=!0;if("length"in o&&i){var f=i(o,"length");f&&!f.configurable&&(c=!1),f&&!f.writable&&(u=!1)}return(c||u||!s)&&(t?e(o,"length",a,!0,!0):e(o,"length",a)),o},pn}function jh(){if(Ko)return lr;Ko=!0;var l=bs(),e=mr(),t=Nh(),i=Wr(),r=e("%Function.prototype.apply%"),n=e("%Function.prototype.call%"),o=e("%Reflect.apply%",!0)||l.call(n,r),a=vs(),s=e("%Math.max%");lr=function(u){if(typeof u!="function")throw new i("a function is required");var f=o(l,n,arguments);return t(f,1+s(0,u.length-(arguments.length-1)),!0)};var c=function(){return o(l,r,arguments)};return a?a(lr,"apply",{value:c}):lr.apply=c,lr}function Fh(){if(Yo)return mn;Yo=!0;var l=mr(),e=jh(),t=e(l("String.prototype.indexOf"));return mn=function(i,r){var n=l(i,!!r);return typeof n=="function"&&t(i,".prototype.")>-1?e(n):n},mn}var wo,_o,So,xo,Eo,Io,Ao,ko,To,Po,Mo,Oo,Co,Ro,Lo,Bo,nn,Uo,on,Do,sn,No,an,jo,ln,Fo,cn,Wo,un,$o,hn,zo,fn,qo,dn,Ho,pn,Go,lr,Ko,mn,Yo,Wh=ut(()=>{de(),me(),pe(),wo={},_o=!1,So={},xo=!1,Eo={},Io=!1,Ao={},ko=!1,To={},Po=!1,Mo={},Oo=!1,Co={},Ro=!1,Lo={},Bo=!1,nn={},Uo=!1,on={},Do=!1,sn={},No=!1,an={},jo=!1,ln={},Fo=!1,cn={},Wo=!1,un={},$o=!1,hn={},zo=!1,fn={},qo=!1,dn={},Ho=!1,pn={},Go=!1,lr={},Ko=!1,mn={},Yo=!1});function ws(l){throw new Error("Node.js process "+l+" is not supported by JSPM core outside of Node.js")}function $h(){!Qt||!Vt||(Qt=!1,Vt.length?gt=Vt.concat(gt):Rr=-1,gt.length&&mc())}function mc(){if(!Qt){var l=setTimeout($h,0);Qt=!0;for(var e=gt.length;e;){for(Vt=gt,gt=[];++Rr<e;)Vt&&Vt[Rr].run();Rr=-1,e=gt.length}Vt=null,Qt=!1,clearTimeout(l)}}function zh(l){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];gt.push(new yc(l,e)),gt.length===1&&!Qt&&setTimeout(mc,0)}function yc(l,e){this.fun=l,this.array=e}function nt(){}function qh(l){ws("_linkedBinding")}function Hh(l){ws("dlopen")}function Gh(){return[]}function Kh(){return[]}function Yh(l,e){if(!l)throw new Error(e||"assertion error")}function Vh(){return!1}function Xh(){return St.now()/1e3}function Yn(l){var e=Math.floor((Date.now()-St.now())*.001),t=St.now()*.001,i=Math.floor(t)+e,r=Math.floor(t%1*1e9);return l&&(i=i-l[0],r=r-l[1],r<0&&(i--,r+=yn)),[i,r]}function Ot(){return _s}function Jh(l){return[]}var gt,Qt,Vt,Rr,Os,Cs,Rs,Ls,Bs,Us,Ds,Ns,js,Fs,Ws,$s,zs,qs,Hs,Gs,Ks,Ys,Vs,Xs,Js,qr,Qs,Zs,ea,ta,ra,na,ia,oa,sa,aa,la,ca,ua,ha,fa,da,pa,ma,ya,ga,ba,va,wa,_a,Sa,St,Vn,yn,xa,Ea,Ia,Aa,ka,Ta,Pa,Ma,Oa,Ca,Ra,_s,gc=ut(()=>{de(),me(),pe(),gt=[],Qt=!1,Rr=-1,yc.prototype.run=function(){this.fun.apply(null,this.array)},Os="browser",Cs="x64",Rs="browser",Ls={PATH:"/usr/bin",LANG:navigator.language+".UTF-8",PWD:"/",HOME:"/home",TMP:"/tmp"},Bs=["/usr/bin/node"],Us=[],Ds="v16.8.0",Ns={},js=function(l,e){console.warn((e?e+": ":"")+l)},Fs=function(l){ws("binding")},Ws=function(l){return 0},$s=function(){return"/"},zs=function(l){},qs={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},Hs=nt,Gs=[],Ks={},Ys=!1,Vs={},Xs=nt,Js=nt,qr=function(){return{}},Qs=qr,Zs=qr,ea=nt,ta=nt,ra=nt,na={},ia={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},oa=nt,sa=nt,aa=nt,la=nt,ca=nt,ua=nt,ha=nt,fa=void 0,da=void 0,pa=void 0,ma=nt,ya=2,ga=1,ba="/bin/usr/node",va=9229,wa="node",_a=[],Sa=nt,St={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0},St.now===void 0&&(Vn=Date.now(),St.timing&&St.timing.navigationStart&&(Vn=St.timing.navigationStart),St.now=()=>Date.now()-Vn),yn=1e9,Yn.bigint=function(l){var e=Yn(l);return typeof BigInt>"u"?e[0]*yn+e[1]:BigInt(e[0]*yn)+BigInt(e[1])},xa=10,Ea={},Ia=0,Aa=Ot,ka=Ot,Ta=Ot,Pa=Ot,Ma=Ot,Oa=nt,Ca=Ot,Ra=Ot,_s={version:Ds,versions:Ns,arch:Cs,platform:Rs,release:qs,_rawDebug:Hs,moduleLoadList:Gs,binding:Fs,_linkedBinding:qh,_events:Ea,_eventsCount:Ia,_maxListeners:xa,on:Ot,addListener:Aa,once:ka,off:Ta,removeListener:Pa,removeAllListeners:Ma,emit:Oa,prependListener:Ca,prependOnceListener:Ra,listeners:Jh,domain:Ks,_exiting:Ys,config:Vs,dlopen:Hh,uptime:Xh,_getActiveRequests:Gh,_getActiveHandles:Kh,reallyExit:Xs,_kill:Js,cpuUsage:qr,resourceUsage:Qs,memoryUsage:Zs,kill:ea,exit:ta,openStdin:ra,allowedNodeEnvironmentFlags:na,assert:Yh,features:ia,_fatalExceptions:oa,setUncaughtExceptionCaptureCallback:sa,hasUncaughtExceptionCaptureCallback:Vh,emitWarning:js,nextTick:zh,_tickCallback:aa,_debugProcess:la,_debugEnd:ca,_startProfilerIdleNotifier:ua,_stopProfilerIdleNotifier:ha,stdout:fa,stdin:pa,stderr:da,abort:ma,umask:Ws,chdir:zs,cwd:$s,env:Ls,title:Os,argv:Bs,execArgv:Us,pid:ya,ppid:ga,execPath:ba,debugPort:va,hrtime:Yn,argv0:wa,_preload_modules:_a,setSourceMapsEnabled:Sa}});function Qh(){if(Vo)return gn;Vo=!0;var l=_s;function e(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}function t(n,o){for(var a="",s=0,c=-1,u=0,f,d=0;d<=n.length;++d){if(d<n.length)f=n.charCodeAt(d);else{if(f===47)break;f=47}if(f===47){if(!(c===d-1||u===1))if(c!==d-1&&u===2){if(a.length<2||s!==2||a.charCodeAt(a.length-1)!==46||a.charCodeAt(a.length-2)!==46){if(a.length>2){var m=a.lastIndexOf("/");if(m!==a.length-1){m===-1?(a="",s=0):(a=a.slice(0,m),s=a.length-1-a.lastIndexOf("/")),c=d,u=0;continue}}else if(a.length===2||a.length===1){a="",s=0,c=d,u=0;continue}}o&&(a.length>0?a+="/..":a="..",s=2)}else a.length>0?a+="/"+n.slice(c+1,d):a=n.slice(c+1,d),s=d-c-1;c=d,u=0}else f===46&&u!==-1?++u:u=-1}return a}function i(n,o){var a=o.dir||o.root,s=o.base||(o.name||"")+(o.ext||"");return a?a===o.root?a+s:a+n+s:s}var r={resolve:function(){for(var n="",o=!1,a,s=arguments.length-1;s>=-1&&!o;s--){var c;s>=0?c=arguments[s]:(a===void 0&&(a=l.cwd()),c=a),e(c),c.length!==0&&(n=c+"/"+n,o=c.charCodeAt(0)===47)}return n=t(n,!o),o?n.length>0?"/"+n:"/":n.length>0?n:"."},normalize:function(n){if(e(n),n.length===0)return".";var o=n.charCodeAt(0)===47,a=n.charCodeAt(n.length-1)===47;return n=t(n,!o),n.length===0&&!o&&(n="."),n.length>0&&a&&(n+="/"),o?"/"+n:n},isAbsolute:function(n){return e(n),n.length>0&&n.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var n,o=0;o<arguments.length;++o){var a=arguments[o];e(a),a.length>0&&(n===void 0?n=a:n+="/"+a)}return n===void 0?".":r.normalize(n)},relative:function(n,o){if(e(n),e(o),n===o||(n=r.resolve(n),o=r.resolve(o),n===o))return"";for(var a=1;a<n.length&&n.charCodeAt(a)===47;++a);for(var s=n.length,c=s-a,u=1;u<o.length&&o.charCodeAt(u)===47;++u);for(var f=o.length,d=f-u,m=c<d?c:d,g=-1,b=0;b<=m;++b){if(b===m){if(d>m){if(o.charCodeAt(u+b)===47)return o.slice(u+b+1);if(b===0)return o.slice(u+b)}else c>m&&(n.charCodeAt(a+b)===47?g=b:b===0&&(g=0));break}var w=n.charCodeAt(a+b),x=o.charCodeAt(u+b);if(w!==x)break;w===47&&(g=b)}var y="";for(b=a+g+1;b<=s;++b)(b===s||n.charCodeAt(b)===47)&&(y.length===0?y+="..":y+="/..");return y.length>0?y+o.slice(u+g):(u+=g,o.charCodeAt(u)===47&&++u,o.slice(u))},_makeLong:function(n){return n},dirname:function(n){if(e(n),n.length===0)return".";for(var o=n.charCodeAt(0),a=o===47,s=-1,c=!0,u=n.length-1;u>=1;--u)if(o=n.charCodeAt(u),o===47){if(!c){s=u;break}}else c=!1;return s===-1?a?"/":".":a&&s===1?"//":n.slice(0,s)},basename:function(n,o){if(o!==void 0&&typeof o!="string")throw new TypeError('"ext" argument must be a string');e(n);var a=0,s=-1,c=!0,u;if(o!==void 0&&o.length>0&&o.length<=n.length){if(o.length===n.length&&o===n)return"";var f=o.length-1,d=-1;for(u=n.length-1;u>=0;--u){var m=n.charCodeAt(u);if(m===47){if(!c){a=u+1;break}}else d===-1&&(c=!1,d=u+1),f>=0&&(m===o.charCodeAt(f)?--f===-1&&(s=u):(f=-1,s=d))}return a===s?s=d:s===-1&&(s=n.length),n.slice(a,s)}else{for(u=n.length-1;u>=0;--u)if(n.charCodeAt(u)===47){if(!c){a=u+1;break}}else s===-1&&(c=!1,s=u+1);return s===-1?"":n.slice(a,s)}},extname:function(n){e(n);for(var o=-1,a=0,s=-1,c=!0,u=0,f=n.length-1;f>=0;--f){var d=n.charCodeAt(f);if(d===47){if(!c){a=f+1;break}continue}s===-1&&(c=!1,s=f+1),d===46?o===-1?o=f:u!==1&&(u=1):o!==-1&&(u=-1)}return o===-1||s===-1||u===0||u===1&&o===s-1&&o===a+1?"":n.slice(o,s)},format:function(n){if(n===null||typeof n!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof n);return i("/",n)},parse:function(n){e(n);var o={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return o;var a=n.charCodeAt(0),s=a===47,c;s?(o.root="/",c=1):c=0;for(var u=-1,f=0,d=-1,m=!0,g=n.length-1,b=0;g>=c;--g){if(a=n.charCodeAt(g),a===47){if(!m){f=g+1;break}continue}d===-1&&(m=!1,d=g+1),a===46?u===-1?u=g:b!==1&&(b=1):u!==-1&&(b=-1)}return u===-1||d===-1||b===0||b===1&&u===d-1&&u===f+1?d!==-1&&(f===0&&s?o.base=o.name=n.slice(1,d):o.base=o.name=n.slice(f,d)):(f===0&&s?(o.name=n.slice(1,u),o.base=n.slice(1,d)):(o.name=n.slice(f,u),o.base=n.slice(f,d)),o.ext=n.slice(u,d)),f>0?o.dir=n.slice(0,f-1):s&&(o.dir="/"),o},sep:"/",delimiter:":",win32:null,posix:null};return r.posix=r,gn=r,gn}var gn,Vo,Xo,Zh=ut(()=>{de(),me(),pe(),gc(),gn={},Vo=!1,Xo=Qh()}),bc={};fr(bc,{URL:()=>Tc,Url:()=>xc,default:()=>it,fileURLToPath:()=>wc,format:()=>Ec,parse:()=>kc,pathToFileURL:()=>_c,resolve:()=>Ic,resolveObject:()=>Ac});function ef(){if(Jo)return bn;Jo=!0;var l=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&l?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=l&&e&&typeof e.get=="function"?e.get:null,i=l&&Map.prototype.forEach,r=typeof Set=="function"&&Set.prototype,n=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=r&&n&&typeof n.get=="function"?n.get:null,a=r&&Set.prototype.forEach,s=typeof WeakMap=="function"&&WeakMap.prototype,c=s?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,f=u?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,m=d?WeakRef.prototype.deref:null,g=Boolean.prototype.valueOf,b=Object.prototype.toString,w=Function.prototype.toString,x=String.prototype.match,y=String.prototype.slice,S=String.prototype.replace,E=String.prototype.toUpperCase,_=String.prototype.toLowerCase,O=RegExp.prototype.test,k=Array.prototype.concat,T=Array.prototype.join,P=Array.prototype.slice,A=Math.floor,U=typeof BigInt=="function"?BigInt.prototype.valueOf:null,I=Object.getOwnPropertySymbols,B=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,F=typeof Symbol=="function"&&typeof Symbol.iterator=="object",D=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===F||!0)?Symbol.toStringTag:null,J=Object.prototype.propertyIsEnumerable,G=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(q){return q.__proto__}:null);function Y(q,ae){if(q===1/0||q===-1/0||q!==q||q&&q>-1e3&&q<1e3||O.call(/e/,ae))return ae;var Te=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof q=="number"){var Ie=q<0?-A(-q):A(q);if(Ie!==q){var Re=String(Ie),Le=y.call(ae,Re.length+1);return S.call(Re,Te,"$&_")+"."+S.call(S.call(Le,/([0-9]{3})/g,"$&_"),/_$/,"")}}return S.call(ae,Te,"$&_")}var ce=Sc,H=ce.custom,oe=re(H)?H:null;bn=function q(ae,Te,Ie,Re){var Le=Te||{};if(he(Le,"quoteStyle")&&Le.quoteStyle!=="single"&&Le.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(he(Le,"maxStringLength")&&(typeof Le.maxStringLength=="number"?Le.maxStringLength<0&&Le.maxStringLength!==1/0:Le.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Ke=he(Le,"customInspect")?Le.customInspect:!0;if(typeof Ke!="boolean"&&Ke!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(he(Le,"indent")&&Le.indent!==null&&Le.indent!=="	"&&!(parseInt(Le.indent,10)===Le.indent&&Le.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(he(Le,"numericSeparator")&&typeof Le.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Ue=Le.numericSeparator;if(typeof ae>"u")return"undefined";if(ae===null)return"null";if(typeof ae=="boolean")return ae?"true":"false";if(typeof ae=="string")return ue(ae,Le);if(typeof ae=="number"){if(ae===0)return 1/0/ae>0?"0":"-0";var Ne=String(ae);return Ue?Y(ae,Ne):Ne}if(typeof ae=="bigint"){var De=String(ae)+"n";return Ue?Y(ae,De):De}var Ve=typeof Le.depth>"u"?5:Le.depth;if(typeof Ie>"u"&&(Ie=0),Ie>=Ve&&Ve>0&&typeof ae=="object")return te(ae)?"[Array]":"[Object]";var ze=N(Le,Ie);if(typeof Re>"u")Re=[];else if(le(Re,ae)>=0)return"[Circular]";function Fe(pt,Mt,qt){if(Mt&&(Re=P.call(Re),Re.push(Mt)),qt){var mt={depth:Le.depth};return he(Le,"quoteStyle")&&(mt.quoteStyle=Le.quoteStyle),q(pt,mt,Ie+1,Re)}return q(pt,Le,Ie+1,Re)}if(typeof ae=="function"&&!be(ae)){var tt=Q(ae),ft=fe(ae,Fe);return"[Function"+(tt?": "+tt:" (anonymous)")+"]"+(ft.length>0?" { "+T.call(ft,", ")+" }":"")}if(re(ae)){var lt=F?S.call(String(ae),/^(Symbol\(.*\))_[^)]*$/,"$1"):B.call(ae);return typeof ae=="object"&&!F?h(lt):lt}if(xe(ae)){for(var L="<"+_.call(String(ae.nodeName)),z=ae.attributes||[],Ee=0;Ee<z.length;Ee++)L+=" "+z[Ee].name+"="+R(V(z[Ee].value),"double",Le);return L+=">",ae.childNodes&&ae.childNodes.length&&(L+="..."),L+="</"+_.call(String(ae.nodeName))+">",L}if(te(ae)){if(ae.length===0)return"[]";var ke=fe(ae,Fe);return ze&&!C(ke)?"["+X(ke,ze)+"]":"[ "+T.call(ke,", ")+" ]"}if(K(ae)){var Me=fe(ae,Fe);return!("cause"in Error.prototype)&&"cause"in ae&&!J.call(ae,"cause")?"{ ["+String(ae)+"] "+T.call(k.call("[cause]: "+Fe(ae.cause),Me),", ")+" }":Me.length===0?"["+String(ae)+"]":"{ ["+String(ae)+"] "+T.call(Me,", ")+" }"}if(typeof ae=="object"&&Ke){if(oe&&typeof ae[oe]=="function"&&ce)return ce(ae,{depth:Ve-Ie});if(Ke!=="symbol"&&typeof ae.inspect=="function")return ae.inspect()}if(ye(ae)){var Xe=[];return i&&i.call(ae,function(pt,Mt){Xe.push(Fe(Mt,ae,!0)+" => "+Fe(pt,ae))}),v("Map",t.call(ae),Xe,ze)}if(ee(ae)){var ot=[];return a&&a.call(ae,function(pt){ot.push(Fe(pt,ae))}),v("Set",o.call(ae),ot,ze)}if(ge(ae))return p("WeakMap");if(_e(ae))return p("WeakSet");if(Se(ae))return p("WeakRef");if(ie(ae))return h(Fe(Number(ae)));if(ne(ae))return h(Fe(U.call(ae)));if(Z(ae))return h(g.call(ae));if(j(ae))return h(Fe(String(ae)));if(typeof window<"u"&&ae===window)return"{ [object Window] }";if(typeof globalThis<"u"&&ae===globalThis||typeof vn<"u"&&ae===vn)return"{ [object globalThis] }";if(!se(ae)&&!be(ae)){var dt=fe(ae,Fe),yr=G?G(ae)===Object.prototype:ae instanceof Object||ae.constructor===Object,gr=ae instanceof Object?"":"null prototype",br=!yr&&D&&Object(ae)===ae&&D in ae?y.call($(ae),8,-1):gr?"Object":"",$r=yr||typeof ae.constructor!="function"?"":ae.constructor.name?ae.constructor.name+" ":"",zt=$r+(br||gr?"["+T.call(k.call([],br||[],gr||[]),": ")+"] ":"");return dt.length===0?zt+"{}":ze?zt+"{"+X(dt,ze)+"}":zt+"{ "+T.call(dt,", ")+" }"}return String(ae)};function R(q,ae,Te){var Ie=(Te.quoteStyle||ae)==="double"?'"':"'";return Ie+q+Ie}function V(q){return S.call(String(q),/"/g,"&quot;")}function te(q){return $(q)==="[object Array]"&&(!D||!(typeof q=="object"&&D in q))}function se(q){return $(q)==="[object Date]"&&(!D||!(typeof q=="object"&&D in q))}function be(q){return $(q)==="[object RegExp]"&&(!D||!(typeof q=="object"&&D in q))}function K(q){return $(q)==="[object Error]"&&(!D||!(typeof q=="object"&&D in q))}function j(q){return $(q)==="[object String]"&&(!D||!(typeof q=="object"&&D in q))}function ie(q){return $(q)==="[object Number]"&&(!D||!(typeof q=="object"&&D in q))}function Z(q){return $(q)==="[object Boolean]"&&(!D||!(typeof q=="object"&&D in q))}function re(q){if(F)return q&&typeof q=="object"&&q instanceof Symbol;if(typeof q=="symbol")return!0;if(!q||typeof q!="object"||!B)return!1;try{return B.call(q),!0}catch{}return!1}function ne(q){if(!q||typeof q!="object"||!U)return!1;try{return U.call(q),!0}catch{}return!1}var ve=Object.prototype.hasOwnProperty||function(q){return q in(this||vn)};function he(q,ae){return ve.call(q,ae)}function $(q){return b.call(q)}function Q(q){if(q.name)return q.name;var ae=x.call(w.call(q),/^function\s*([\w$]+)/);return ae?ae[1]:null}function le(q,ae){if(q.indexOf)return q.indexOf(ae);for(var Te=0,Ie=q.length;Te<Ie;Te++)if(q[Te]===ae)return Te;return-1}function ye(q){if(!t||!q||typeof q!="object")return!1;try{t.call(q);try{o.call(q)}catch{return!0}return q instanceof Map}catch{}return!1}function ge(q){if(!c||!q||typeof q!="object")return!1;try{c.call(q,c);try{f.call(q,f)}catch{return!0}return q instanceof WeakMap}catch{}return!1}function Se(q){if(!m||!q||typeof q!="object")return!1;try{return m.call(q),!0}catch{}return!1}function ee(q){if(!o||!q||typeof q!="object")return!1;try{o.call(q);try{t.call(q)}catch{return!0}return q instanceof Set}catch{}return!1}function _e(q){if(!f||!q||typeof q!="object")return!1;try{f.call(q,f);try{c.call(q,c)}catch{return!0}return q instanceof WeakSet}catch{}return!1}function xe(q){return!q||typeof q!="object"?!1:typeof HTMLElement<"u"&&q instanceof HTMLElement?!0:typeof q.nodeName=="string"&&typeof q.getAttribute=="function"}function ue(q,ae){if(q.length>ae.maxStringLength){var Te=q.length-ae.maxStringLength,Ie="... "+Te+" more character"+(Te>1?"s":"");return ue(y.call(q,0,ae.maxStringLength),ae)+Ie}var Re=S.call(S.call(q,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Oe);return R(Re,"single",ae)}function Oe(q){var ae=q.charCodeAt(0),Te={8:"b",9:"t",10:"n",12:"f",13:"r"}[ae];return Te?"\\"+Te:"\\x"+(ae<16?"0":"")+E.call(ae.toString(16))}function h(q){return"Object("+q+")"}function p(q){return q+" { ? }"}function v(q,ae,Te,Ie){var Re=Ie?X(Te,Ie):T.call(Te,", ");return q+" ("+ae+") {"+Re+"}"}function C(q){for(var ae=0;ae<q.length;ae++)if(le(q[ae],`
`)>=0)return!1;return!0}function N(q,ae){var Te;if(q.indent==="	")Te="	";else if(typeof q.indent=="number"&&q.indent>0)Te=T.call(Array(q.indent+1)," ");else return null;return{base:Te,prev:T.call(Array(ae+1),Te)}}function X(q,ae){if(q.length===0)return"";var Te=`
`+ae.prev+ae.base;return Te+T.call(q,","+Te)+`
`+ae.prev}function fe(q,ae){var Te=te(q),Ie=[];if(Te){Ie.length=q.length;for(var Re=0;Re<q.length;Re++)Ie[Re]=he(q,Re)?ae(q[Re],q):""}var Le=typeof I=="function"?I(q):[],Ke;if(F){Ke={};for(var Ue=0;Ue<Le.length;Ue++)Ke["$"+Le[Ue]]=Le[Ue]}for(var Ne in q)he(q,Ne)&&(Te&&String(Number(Ne))===Ne&&Ne<q.length||F&&Ke["$"+Ne]instanceof Symbol||(O.call(/[^\w$]/,Ne)?Ie.push(ae(Ne,q)+": "+ae(q[Ne],q)):Ie.push(Ne+": "+ae(q[Ne],q))));if(typeof I=="function")for(var De=0;De<Le.length;De++)J.call(q,Le[De])&&Ie.push("["+ae(Le[De])+"]: "+ae(q[Le[De]],q));return Ie}return bn}function tf(){if(Qo)return wn;Qo=!0;var l=mr(),e=Fh(),t=ef(),i=Wr(),r=l("%WeakMap%",!0),n=l("%Map%",!0),o=e("WeakMap.prototype.get",!0),a=e("WeakMap.prototype.set",!0),s=e("WeakMap.prototype.has",!0),c=e("Map.prototype.get",!0),u=e("Map.prototype.set",!0),f=e("Map.prototype.has",!0),d=function(w,x){for(var y=w,S;(S=y.next)!==null;y=S)if(S.key===x)return y.next=S.next,S.next=w.next,w.next=S,S},m=function(w,x){var y=d(w,x);return y&&y.value},g=function(w,x,y){var S=d(w,x);S?S.value=y:w.next={key:x,next:w.next,value:y}},b=function(w,x){return!!d(w,x)};return wn=function(){var w,x,y,S={assert:function(E){if(!S.has(E))throw new i("Side channel does not contain "+t(E))},get:function(E){if(r&&E&&(typeof E=="object"||typeof E=="function")){if(w)return o(w,E)}else if(n){if(x)return c(x,E)}else if(y)return m(y,E)},has:function(E){if(r&&E&&(typeof E=="object"||typeof E=="function")){if(w)return s(w,E)}else if(n){if(x)return f(x,E)}else if(y)return b(y,E);return!1},set:function(E,_){r&&E&&(typeof E=="object"||typeof E=="function")?(w||(w=new r),a(w,E,_)):n?(x||(x=new n),u(x,E,_)):(y||(y={key:{},next:null}),g(y,E,_))}};return S},wn}function Ss(){if(Zo)return _n;Zo=!0;var l=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return _n={default:t.RFC3986,formatters:{RFC1738:function(i){return l.call(i,e,"+")},RFC3986:function(i){return String(i)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},_n}function vc(){if(es)return Sn;es=!0;var l=Ss(),e=Object.prototype.hasOwnProperty,t=Array.isArray,i=(function(){for(var w=[],x=0;x<256;++x)w.push("%"+((x<16?"0":"")+x.toString(16)).toUpperCase());return w})(),r=function(w){for(;w.length>1;){var x=w.pop(),y=x.obj[x.prop];if(t(y)){for(var S=[],E=0;E<y.length;++E)typeof y[E]<"u"&&S.push(y[E]);x.obj[x.prop]=S}}},n=function(w,x){for(var y=x&&x.plainObjects?Object.create(null):{},S=0;S<w.length;++S)typeof w[S]<"u"&&(y[S]=w[S]);return y},o=function w(x,y,S){if(!y)return x;if(typeof y!="object"){if(t(x))x.push(y);else if(x&&typeof x=="object")(S&&(S.plainObjects||S.allowPrototypes)||!e.call(Object.prototype,y))&&(x[y]=!0);else return[x,y];return x}if(!x||typeof x!="object")return[x].concat(y);var E=x;return t(x)&&!t(y)&&(E=n(x,S)),t(x)&&t(y)?(y.forEach(function(_,O){if(e.call(x,O)){var k=x[O];k&&typeof k=="object"&&_&&typeof _=="object"?x[O]=w(k,_,S):x.push(_)}else x[O]=_}),x):Object.keys(y).reduce(function(_,O){var k=y[O];return e.call(_,O)?_[O]=w(_[O],k,S):_[O]=k,_},E)},a=function(w,x){return Object.keys(x).reduce(function(y,S){return y[S]=x[S],y},w)},s=function(w,x,y){var S=w.replace(/\+/g," ");if(y==="iso-8859-1")return S.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(S)}catch{return S}},c=1024,u=function(w,x,y,S,E){if(w.length===0)return w;var _=w;if(typeof w=="symbol"?_=Symbol.prototype.toString.call(w):typeof w!="string"&&(_=String(w)),y==="iso-8859-1")return escape(_).replace(/%u[0-9a-f]{4}/gi,function(I){return"%26%23"+parseInt(I.slice(2),16)+"%3B"});for(var O="",k=0;k<_.length;k+=c){for(var T=_.length>=c?_.slice(k,k+c):_,P=[],A=0;A<T.length;++A){var U=T.charCodeAt(A);if(U===45||U===46||U===95||U===126||U>=48&&U<=57||U>=65&&U<=90||U>=97&&U<=122||E===l.RFC1738&&(U===40||U===41)){P[P.length]=T.charAt(A);continue}if(U<128){P[P.length]=i[U];continue}if(U<2048){P[P.length]=i[192|U>>6]+i[128|U&63];continue}if(U<55296||U>=57344){P[P.length]=i[224|U>>12]+i[128|U>>6&63]+i[128|U&63];continue}A+=1,U=65536+((U&1023)<<10|T.charCodeAt(A)&1023),P[P.length]=i[240|U>>18]+i[128|U>>12&63]+i[128|U>>6&63]+i[128|U&63]}O+=P.join("")}return O},f=function(w){for(var x=[{obj:{o:w},prop:"o"}],y=[],S=0;S<x.length;++S)for(var E=x[S],_=E.obj[E.prop],O=Object.keys(_),k=0;k<O.length;++k){var T=O[k],P=_[T];typeof P=="object"&&P!==null&&y.indexOf(P)===-1&&(x.push({obj:_,prop:T}),y.push(P))}return r(x),w},d=function(w){return Object.prototype.toString.call(w)==="[object RegExp]"},m=function(w){return!w||typeof w!="object"?!1:!!(w.constructor&&w.constructor.isBuffer&&w.constructor.isBuffer(w))},g=function(w,x){return[].concat(w,x)},b=function(w,x){if(t(w)){for(var y=[],S=0;S<w.length;S+=1)y.push(x(w[S]));return y}return x(w)};return Sn={arrayToObject:n,assign:a,combine:g,compact:f,decode:s,encode:u,isBuffer:m,isRegExp:d,maybeMap:b,merge:o},Sn}function rf(){if(ts)return xn;ts=!0;var l=tf(),e=vc(),t=Ss(),i=Object.prototype.hasOwnProperty,r={brackets:function(b){return b+"[]"},comma:"comma",indices:function(b,w){return b+"["+w+"]"},repeat:function(b){return b}},n=Array.isArray,o=Array.prototype.push,a=function(b,w){o.apply(b,n(w)?w:[w])},s=Date.prototype.toISOString,c=t.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,format:c,formatter:t.formatters[c],indices:!1,serializeDate:function(b){return s.call(b)},skipNulls:!1,strictNullHandling:!1},f=function(b){return typeof b=="string"||typeof b=="number"||typeof b=="boolean"||typeof b=="symbol"||typeof b=="bigint"},d={},m=function b(w,x,y,S,E,_,O,k,T,P,A,U,I,B,F,D,J,G){for(var Y=w,ce=G,H=0,oe=!1;(ce=ce.get(d))!==void 0&&!oe;){var R=ce.get(w);if(H+=1,typeof R<"u"){if(R===H)throw new RangeError("Cyclic object value");oe=!0}typeof ce.get(d)>"u"&&(H=0)}if(typeof P=="function"?Y=P(x,Y):Y instanceof Date?Y=I(Y):y==="comma"&&n(Y)&&(Y=e.maybeMap(Y,function($){return $ instanceof Date?I($):$})),Y===null){if(_)return T&&!D?T(x,u.encoder,J,"key",B):x;Y=""}if(f(Y)||e.isBuffer(Y)){if(T){var V=D?x:T(x,u.encoder,J,"key",B);return[F(V)+"="+F(T(Y,u.encoder,J,"value",B))]}return[F(x)+"="+F(String(Y))]}var te=[];if(typeof Y>"u")return te;var se;if(y==="comma"&&n(Y))D&&T&&(Y=e.maybeMap(Y,T)),se=[{value:Y.length>0?Y.join(",")||null:void 0}];else if(n(P))se=P;else{var be=Object.keys(Y);se=A?be.sort(A):be}var K=k?x.replace(/\./g,"%2E"):x,j=S&&n(Y)&&Y.length===1?K+"[]":K;if(E&&n(Y)&&Y.length===0)return j+"[]";for(var ie=0;ie<se.length;++ie){var Z=se[ie],re=typeof Z=="object"&&typeof Z.value<"u"?Z.value:Y[Z];if(!(O&&re===null)){var ne=U&&k?Z.replace(/\./g,"%2E"):Z,ve=n(Y)?typeof y=="function"?y(j,ne):j:j+(U?"."+ne:"["+ne+"]");G.set(w,H);var he=l();he.set(d,G),a(te,b(re,ve,y,S,E,_,O,k,y==="comma"&&D&&n(Y)?null:T,P,A,U,I,B,F,D,J,he))}}return te},g=function(b){if(!b)return u;if(typeof b.allowEmptyArrays<"u"&&typeof b.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof b.encodeDotInKeys<"u"&&typeof b.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(b.encoder!==null&&typeof b.encoder<"u"&&typeof b.encoder!="function")throw new TypeError("Encoder has to be a function.");var w=b.charset||u.charset;if(typeof b.charset<"u"&&b.charset!=="utf-8"&&b.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var x=t.default;if(typeof b.format<"u"){if(!i.call(t.formatters,b.format))throw new TypeError("Unknown format option provided.");x=b.format}var y=t.formatters[x],S=u.filter;(typeof b.filter=="function"||n(b.filter))&&(S=b.filter);var E;if(b.arrayFormat in r?E=b.arrayFormat:"indices"in b?E=b.indices?"indices":"repeat":E=u.arrayFormat,"commaRoundTrip"in b&&typeof b.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var _=typeof b.allowDots>"u"?b.encodeDotInKeys===!0?!0:u.allowDots:!!b.allowDots;return{addQueryPrefix:typeof b.addQueryPrefix=="boolean"?b.addQueryPrefix:u.addQueryPrefix,allowDots:_,allowEmptyArrays:typeof b.allowEmptyArrays=="boolean"?!!b.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:E,charset:w,charsetSentinel:typeof b.charsetSentinel=="boolean"?b.charsetSentinel:u.charsetSentinel,commaRoundTrip:b.commaRoundTrip,delimiter:typeof b.delimiter>"u"?u.delimiter:b.delimiter,encode:typeof b.encode=="boolean"?b.encode:u.encode,encodeDotInKeys:typeof b.encodeDotInKeys=="boolean"?b.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof b.encoder=="function"?b.encoder:u.encoder,encodeValuesOnly:typeof b.encodeValuesOnly=="boolean"?b.encodeValuesOnly:u.encodeValuesOnly,filter:S,format:x,formatter:y,serializeDate:typeof b.serializeDate=="function"?b.serializeDate:u.serializeDate,skipNulls:typeof b.skipNulls=="boolean"?b.skipNulls:u.skipNulls,sort:typeof b.sort=="function"?b.sort:null,strictNullHandling:typeof b.strictNullHandling=="boolean"?b.strictNullHandling:u.strictNullHandling}};return xn=function(b,w){var x=b,y=g(w),S,E;typeof y.filter=="function"?(E=y.filter,x=E("",x)):n(y.filter)&&(E=y.filter,S=E);var _=[];if(typeof x!="object"||x===null)return"";var O=r[y.arrayFormat],k=O==="comma"&&y.commaRoundTrip;S||(S=Object.keys(x)),y.sort&&S.sort(y.sort);for(var T=l(),P=0;P<S.length;++P){var A=S[P];y.skipNulls&&x[A]===null||a(_,m(x[A],A,O,k,y.allowEmptyArrays,y.strictNullHandling,y.skipNulls,y.encodeDotInKeys,y.encode?y.encoder:null,y.filter,y.sort,y.allowDots,y.serializeDate,y.format,y.formatter,y.encodeValuesOnly,y.charset,T))}var U=_.join(y.delimiter),I=y.addQueryPrefix===!0?"?":"";return y.charsetSentinel&&(y.charset==="iso-8859-1"?I+="utf8=%26%2310003%3B&":I+="utf8=%E2%9C%93&"),U.length>0?I+U:""},xn}function nf(){if(rs)return En;rs=!0;var l=vc(),e=Object.prototype.hasOwnProperty,t=Array.isArray,i={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:l.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},r=function(d){return d.replace(/&#(\d+);/g,function(m,g){return String.fromCharCode(parseInt(g,10))})},n=function(d,m){return d&&typeof d=="string"&&m.comma&&d.indexOf(",")>-1?d.split(","):d},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",s=function(d,m){var g={__proto__:null},b=m.ignoreQueryPrefix?d.replace(/^\?/,""):d;b=b.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var w=m.parameterLimit===1/0?void 0:m.parameterLimit,x=b.split(m.delimiter,w),y=-1,S,E=m.charset;if(m.charsetSentinel)for(S=0;S<x.length;++S)x[S].indexOf("utf8=")===0&&(x[S]===a?E="utf-8":x[S]===o&&(E="iso-8859-1"),y=S,S=x.length);for(S=0;S<x.length;++S)if(S!==y){var _=x[S],O=_.indexOf("]="),k=O===-1?_.indexOf("="):O+1,T,P;k===-1?(T=m.decoder(_,i.decoder,E,"key"),P=m.strictNullHandling?null:""):(T=m.decoder(_.slice(0,k),i.decoder,E,"key"),P=l.maybeMap(n(_.slice(k+1),m),function(U){return m.decoder(U,i.decoder,E,"value")})),P&&m.interpretNumericEntities&&E==="iso-8859-1"&&(P=r(P)),_.indexOf("[]=")>-1&&(P=t(P)?[P]:P);var A=e.call(g,T);A&&m.duplicates==="combine"?g[T]=l.combine(g[T],P):(!A||m.duplicates==="last")&&(g[T]=P)}return g},c=function(d,m,g,b){for(var w=b?m:n(m,g),x=d.length-1;x>=0;--x){var y,S=d[x];if(S==="[]"&&g.parseArrays)y=g.allowEmptyArrays&&(w===""||g.strictNullHandling&&w===null)?[]:[].concat(w);else{y=g.plainObjects?Object.create(null):{};var E=S.charAt(0)==="["&&S.charAt(S.length-1)==="]"?S.slice(1,-1):S,_=g.decodeDotInKeys?E.replace(/%2E/g,"."):E,O=parseInt(_,10);!g.parseArrays&&_===""?y={0:w}:!isNaN(O)&&S!==_&&String(O)===_&&O>=0&&g.parseArrays&&O<=g.arrayLimit?(y=[],y[O]=w):_!=="__proto__"&&(y[_]=w)}w=y}return w},u=function(d,m,g,b){if(d){var w=g.allowDots?d.replace(/\.([^.[]+)/g,"[$1]"):d,x=/(\[[^[\]]*])/,y=/(\[[^[\]]*])/g,S=g.depth>0&&x.exec(w),E=S?w.slice(0,S.index):w,_=[];if(E){if(!g.plainObjects&&e.call(Object.prototype,E)&&!g.allowPrototypes)return;_.push(E)}for(var O=0;g.depth>0&&(S=y.exec(w))!==null&&O<g.depth;){if(O+=1,!g.plainObjects&&e.call(Object.prototype,S[1].slice(1,-1))&&!g.allowPrototypes)return;_.push(S[1])}if(S){if(g.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+g.depth+" and strictDepth is true");_.push("["+w.slice(S.index)+"]")}return c(_,m,g,b)}},f=function(d){if(!d)return i;if(typeof d.allowEmptyArrays<"u"&&typeof d.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof d.decodeDotInKeys<"u"&&typeof d.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(d.decoder!==null&&typeof d.decoder<"u"&&typeof d.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof d.charset<"u"&&d.charset!=="utf-8"&&d.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var m=typeof d.charset>"u"?i.charset:d.charset,g=typeof d.duplicates>"u"?i.duplicates:d.duplicates;if(g!=="combine"&&g!=="first"&&g!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var b=typeof d.allowDots>"u"?d.decodeDotInKeys===!0?!0:i.allowDots:!!d.allowDots;return{allowDots:b,allowEmptyArrays:typeof d.allowEmptyArrays=="boolean"?!!d.allowEmptyArrays:i.allowEmptyArrays,allowPrototypes:typeof d.allowPrototypes=="boolean"?d.allowPrototypes:i.allowPrototypes,allowSparse:typeof d.allowSparse=="boolean"?d.allowSparse:i.allowSparse,arrayLimit:typeof d.arrayLimit=="number"?d.arrayLimit:i.arrayLimit,charset:m,charsetSentinel:typeof d.charsetSentinel=="boolean"?d.charsetSentinel:i.charsetSentinel,comma:typeof d.comma=="boolean"?d.comma:i.comma,decodeDotInKeys:typeof d.decodeDotInKeys=="boolean"?d.decodeDotInKeys:i.decodeDotInKeys,decoder:typeof d.decoder=="function"?d.decoder:i.decoder,delimiter:typeof d.delimiter=="string"||l.isRegExp(d.delimiter)?d.delimiter:i.delimiter,depth:typeof d.depth=="number"||d.depth===!1?+d.depth:i.depth,duplicates:g,ignoreQueryPrefix:d.ignoreQueryPrefix===!0,interpretNumericEntities:typeof d.interpretNumericEntities=="boolean"?d.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:typeof d.parameterLimit=="number"?d.parameterLimit:i.parameterLimit,parseArrays:d.parseArrays!==!1,plainObjects:typeof d.plainObjects=="boolean"?d.plainObjects:i.plainObjects,strictDepth:typeof d.strictDepth=="boolean"?!!d.strictDepth:i.strictDepth,strictNullHandling:typeof d.strictNullHandling=="boolean"?d.strictNullHandling:i.strictNullHandling}};return En=function(d,m){var g=f(m);if(d===""||d===null||typeof d>"u")return g.plainObjects?Object.create(null):{};for(var b=typeof d=="string"?s(d,g):d,w=g.plainObjects?Object.create(null):{},x=Object.keys(b),y=0;y<x.length;++y){var S=x[y],E=u(S,b[S],g,typeof d=="string");w=l.merge(w,E,g)}return g.allowSparse===!0?w:l.compact(w)},En}function of(){if(ns)return In;ns=!0;var l=rf(),e=nf(),t=Ss();return In={formats:t,parse:e,stringify:l},In}function sf(){if(is)return jt;is=!0;var l=Nt;function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var t=/^([a-z0-9.+-]+:)/i,i=/:[0-9]*$/,r=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,n=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(n),a=["'"].concat(o),s=["%","/","?",";","#"].concat(a),c=["/","?","#"],u=255,f=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},w=of();function x(_,O,k){if(_&&typeof _=="object"&&_ instanceof e)return _;var T=new e;return T.parse(_,O,k),T}e.prototype.parse=function(_,O,k){if(typeof _!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof _);var T=_.indexOf("?"),P=T!==-1&&T<_.indexOf("#")?"?":"#",A=_.split(P),U=/\\/g;A[0]=A[0].replace(U,"/"),_=A.join(P);var I=_;if(I=I.trim(),!k&&_.split("#").length===1){var B=r.exec(I);if(B)return this.path=I,this.href=I,this.pathname=B[1],B[2]?(this.search=B[2],O?this.query=w.parse(this.search.substr(1)):this.query=this.search.substr(1)):O&&(this.search="",this.query={}),this}var F=t.exec(I);if(F){F=F[0];var D=F.toLowerCase();this.protocol=D,I=I.substr(F.length)}if(k||F||I.match(/^\/\/[^@/]+@[^@/]+/)){var J=I.substr(0,2)==="//";J&&!(F&&g[F])&&(I=I.substr(2),this.slashes=!0)}if(!g[F]&&(J||F&&!b[F])){for(var G=-1,Y=0;Y<c.length;Y++){var ce=I.indexOf(c[Y]);ce!==-1&&(G===-1||ce<G)&&(G=ce)}var H,oe;G===-1?oe=I.lastIndexOf("@"):oe=I.lastIndexOf("@",G),oe!==-1&&(H=I.slice(0,oe),I=I.slice(oe+1),this.auth=decodeURIComponent(H)),G=-1;for(var Y=0;Y<s.length;Y++){var ce=I.indexOf(s[Y]);ce!==-1&&(G===-1||ce<G)&&(G=ce)}G===-1&&(G=I.length),this.host=I.slice(0,G),I=I.slice(G),this.parseHost(),this.hostname=this.hostname||"";var R=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!R)for(var V=this.hostname.split(/\./),Y=0,te=V.length;Y<te;Y++){var se=V[Y];if(se&&!se.match(f)){for(var be="",K=0,j=se.length;K<j;K++)se.charCodeAt(K)>127?be+="x":be+=se[K];if(!be.match(f)){var ie=V.slice(0,Y),Z=V.slice(Y+1),re=se.match(d);re&&(ie.push(re[1]),Z.unshift(re[2])),Z.length&&(I="/"+Z.join(".")+I),this.hostname=ie.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),R||(this.hostname=l.toASCII(this.hostname));var ne=this.port?":"+this.port:"",ve=this.hostname||"";this.host=ve+ne,this.href+=this.host,R&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),I[0]!=="/"&&(I="/"+I))}if(!m[D])for(var Y=0,te=a.length;Y<te;Y++){var he=a[Y];if(I.indexOf(he)!==-1){var $=encodeURIComponent(he);$===he&&($=escape(he)),I=I.split(he).join($)}}var Q=I.indexOf("#");Q!==-1&&(this.hash=I.substr(Q),I=I.slice(0,Q));var le=I.indexOf("?");if(le!==-1?(this.search=I.substr(le),this.query=I.substr(le+1),O&&(this.query=w.parse(this.query)),I=I.slice(0,le)):O&&(this.search="",this.query={}),I&&(this.pathname=I),b[D]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var ne=this.pathname||"",ye=this.search||"";this.path=ne+ye}return this.href=this.format(),this};function y(_){return typeof _=="string"&&(_=x(_)),_ instanceof e?_.format():e.prototype.format.call(_)}e.prototype.format=function(){var _=this.auth||"";_&&(_=encodeURIComponent(_),_=_.replace(/%3A/i,":"),_+="@");var O=this.protocol||"",k=this.pathname||"",T=this.hash||"",P=!1,A="";this.host?P=_+this.host:this.hostname&&(P=_+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(P+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(A=w.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var U=this.search||A&&"?"+A||"";return O&&O.substr(-1)!==":"&&(O+=":"),this.slashes||(!O||b[O])&&P!==!1?(P="//"+(P||""),k&&k.charAt(0)!=="/"&&(k="/"+k)):P||(P=""),T&&T.charAt(0)!=="#"&&(T="#"+T),U&&U.charAt(0)!=="?"&&(U="?"+U),k=k.replace(/[?#]/g,function(I){return encodeURIComponent(I)}),U=U.replace("#","%23"),O+P+k+U+T};function S(_,O){return x(_,!1,!0).resolve(O)}e.prototype.resolve=function(_){return this.resolveObject(x(_,!1,!0)).format()};function E(_,O){return _?x(_,!1,!0).resolveObject(O):O}return e.prototype.resolveObject=function(_){if(typeof _=="string"){var O=new e;O.parse(_,!1,!0),_=O}for(var k=new e,T=Object.keys(this),P=0;P<T.length;P++){var A=T[P];k[A]=this[A]}if(k.hash=_.hash,_.href==="")return k.href=k.format(),k;if(_.slashes&&!_.protocol){for(var U=Object.keys(_),I=0;I<U.length;I++){var B=U[I];B!=="protocol"&&(k[B]=_[B])}return b[k.protocol]&&k.hostname&&!k.pathname&&(k.pathname="/",k.path=k.pathname),k.href=k.format(),k}if(_.protocol&&_.protocol!==k.protocol){if(!b[_.protocol]){for(var F=Object.keys(_),D=0;D<F.length;D++){var J=F[D];k[J]=_[J]}return k.href=k.format(),k}if(k.protocol=_.protocol,!_.host&&!g[_.protocol]){for(var te=(_.pathname||"").split("/");te.length&&!(_.host=te.shift()););_.host||(_.host=""),_.hostname||(_.hostname=""),te[0]!==""&&te.unshift(""),te.length<2&&te.unshift(""),k.pathname=te.join("/")}else k.pathname=_.pathname;if(k.search=_.search,k.query=_.query,k.host=_.host||"",k.auth=_.auth,k.hostname=_.hostname||_.host,k.port=_.port,k.pathname||k.search){var G=k.pathname||"",Y=k.search||"";k.path=G+Y}return k.slashes=k.slashes||_.slashes,k.href=k.format(),k}var ce=k.pathname&&k.pathname.charAt(0)==="/",H=_.host||_.pathname&&_.pathname.charAt(0)==="/",oe=H||ce||k.host&&_.pathname,R=oe,V=k.pathname&&k.pathname.split("/")||[],te=_.pathname&&_.pathname.split("/")||[],se=k.protocol&&!b[k.protocol];if(se&&(k.hostname="",k.port=null,k.host&&(V[0]===""?V[0]=k.host:V.unshift(k.host)),k.host="",_.protocol&&(_.hostname=null,_.port=null,_.host&&(te[0]===""?te[0]=_.host:te.unshift(_.host)),_.host=null),oe=oe&&(te[0]===""||V[0]==="")),H)k.host=_.host||_.host===""?_.host:k.host,k.hostname=_.hostname||_.hostname===""?_.hostname:k.hostname,k.search=_.search,k.query=_.query,V=te;else if(te.length)V||(V=[]),V.pop(),V=V.concat(te),k.search=_.search,k.query=_.query;else if(_.search!=null){if(se){k.host=V.shift(),k.hostname=k.host;var be=k.host&&k.host.indexOf("@")>0?k.host.split("@"):!1;be&&(k.auth=be.shift(),k.hostname=be.shift(),k.host=k.hostname)}return k.search=_.search,k.query=_.query,(k.pathname!==null||k.search!==null)&&(k.path=(k.pathname?k.pathname:"")+(k.search?k.search:"")),k.href=k.format(),k}if(!V.length)return k.pathname=null,k.search?k.path="/"+k.search:k.path=null,k.href=k.format(),k;for(var K=V.slice(-1)[0],j=(k.host||_.host||V.length>1)&&(K==="."||K==="..")||K==="",ie=0,Z=V.length;Z>=0;Z--)K=V[Z],K==="."?V.splice(Z,1):K===".."?(V.splice(Z,1),ie++):ie&&(V.splice(Z,1),ie--);if(!oe&&!R)for(;ie--;ie)V.unshift("..");oe&&V[0]!==""&&(!V[0]||V[0].charAt(0)!=="/")&&V.unshift(""),j&&V.join("/").substr(-1)!=="/"&&V.push("");var re=V[0]===""||V[0]&&V[0].charAt(0)==="/";if(se){k.hostname=re?"":V.length?V.shift():"",k.host=k.hostname;var be=k.host&&k.host.indexOf("@")>0?k.host.split("@"):!1;be&&(k.auth=be.shift(),k.hostname=be.shift(),k.host=k.hostname)}return oe=oe||k.host&&V.length,oe&&!re&&V.unshift(""),V.length>0?k.pathname=V.join("/"):(k.pathname=null,k.path=null),(k.pathname!==null||k.search!==null)&&(k.path=(k.pathname?k.pathname:"")+(k.search?k.search:"")),k.auth=_.auth||k.auth,k.slashes=k.slashes||_.slashes,k.href=k.format(),k},e.prototype.parseHost=function(){var _=this.host,O=i.exec(_);O&&(O=O[0],O!==":"&&(this.port=O.substr(1)),_=_.substr(0,_.length-O.length)),_&&(this.hostname=_)},jt.parse=x,jt.resolve=S,jt.resolveObject=E,jt.format=y,jt.Url=e,jt}function wc(l){if(typeof l=="string")l=new URL(l);else if(!(l instanceof URL))throw new Deno.errors.InvalidData("invalid argument path , must be a string or URL");if(l.protocol!=="file:")throw new Deno.errors.InvalidData("invalid url scheme");return Rn?af(l):lf(l)}function af(l){let e=l.hostname,t=l.pathname;for(let i=0;i<t.length;i++)if(t[i]==="%"){let r=t.codePointAt(i+2)||32;if(t[i+1]==="2"&&r===102||t[i+1]==="5"&&r===99)throw new Deno.errors.InvalidData("must not include encoded \\ or / characters")}if(t=t.replace(Rc,"\\"),t=decodeURIComponent(t),e!=="")return`\\\\${e}${t}`;{let i=t.codePointAt(1)|32,r=t[2];if(i<Oc||i>Cc||r!==":")throw new Deno.errors.InvalidData("file url path must be absolute");return t.slice(1)}}function lf(l){if(l.hostname!=="")throw new Deno.errors.InvalidData("invalid file url hostname");let e=l.pathname;for(let t=0;t<e.length;t++)if(e[t]==="%"){let i=e.codePointAt(t+2)||32;if(e[t+1]==="2"&&i===102)throw new Deno.errors.InvalidData("must not include encoded / characters")}return decodeURIComponent(e)}function _c(l){let e=Xo.resolve(l),t=l.charCodeAt(l.length-1);(t===Mc||Rn&&t===Pc)&&e[e.length-1]!==Xo.sep&&(e+="/");let i=new URL("file://");return e.includes("%")&&(e=e.replace(Lc,"%25")),!Rn&&e.includes("\\")&&(e=e.replace(Bc,"%5C")),e.includes(`
`)&&(e=e.replace(Uc,"%0A")),e.includes("\r")&&(e=e.replace(Dc,"%0D")),e.includes("	")&&(e=e.replace(Nc,"%09")),i.pathname=e,i}var Sc,bn,Jo,vn,wn,Qo,_n,Zo,Sn,es,xn,ts,En,rs,In,ns,jt,is,it,La,xc,Ec,Ic,Ac,kc,Tc,Pc,Mc,Oc,Cc,Rn,Rc,Lc,Bc,Uc,Dc,Nc,cf=ut(()=>{de(),me(),pe(),Ih(),Wh(),Zh(),gc(),Sc=Object.freeze(Object.create(null)),bn={},Jo=!1,vn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:global,wn={},Qo=!1,_n={},Zo=!1,Sn={},es=!1,xn={},ts=!1,En={},rs=!1,In={},ns=!1,jt={},is=!1,it=sf(),it.parse,it.resolve,it.resolveObject,it.format,it.Url,La=typeof Deno<"u"?Deno.build.os==="windows"?"win32":Deno.build.os:void 0,it.URL=typeof URL<"u"?URL:null,it.pathToFileURL=_c,it.fileURLToPath=wc,xc=it.Url,Ec=it.format,Ic=it.resolve,Ac=it.resolveObject,kc=it.parse,Tc=it.URL,Pc=92,Mc=47,Oc=97,Cc=122,Rn=La==="win32",Rc=/\//g,Lc=/%/g,Bc=/\\/g,Uc=/\n/g,Dc=/\r/g,Nc=/\t/g}),uf=we((l,e)=>{de(),me(),pe(),e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}),xs=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0}),l.BufferedDuplex=void 0,l.writev=i;var e=tr(),t=(et(),We(Ze));function i(n,o){let a=new Array(n.length);for(let s=0;s<n.length;s++)typeof n[s].chunk=="string"?a[s]=t.Buffer.from(n[s].chunk,"utf8"):a[s]=n[s].chunk;this._write(t.Buffer.concat(a),"binary",o)}var r=class extends e.Duplex{constructor(o,a,s){super({objectMode:!0});M(this,"socket");M(this,"proxy");M(this,"isSocketOpen");M(this,"writeQueue");this.proxy=a,this.socket=s,this.writeQueue=[],o.objectMode||(this._writev=i.bind(this)),this.isSocketOpen=!1,this.proxy.on("data",c=>{!this.destroyed&&this.readable&&this.push(c)})}_read(o){this.proxy.read(o)}_write(o,a,s){this.isSocketOpen?this.writeToProxy(o,a,s):this.writeQueue.push({chunk:o,encoding:a,cb:s})}_final(o){this.writeQueue=[],this.proxy.end(o)}_destroy(o,a){this.writeQueue=[],this.proxy.destroy(),a(o)}socketReady(){this.emit("connect"),this.isSocketOpen=!0,this.processWriteQueue()}writeToProxy(o,a,s){this.proxy.write(o,a)===!1?this.proxy.once("drain",s):s()}processWriteQueue(){for(;this.writeQueue.length>0;){let{chunk:o,encoding:a,cb:s}=this.writeQueue.shift();this.writeToProxy(o,a,s)}}};l.BufferedDuplex=r}),Hr=we(l=>{de(),me(),pe();var e=l&&l.__importDefault||function(x){return x&&x.__esModule?x:{default:x}};Object.defineProperty(l,"__esModule",{value:!0}),l.streamBuilder=l.browserStreamBuilder=void 0;var t=(et(),We(Ze)),i=e(uf()),r=e(It()),n=tr(),o=e(Hn()),a=xs(),s=(0,r.default)("mqttjs:ws"),c=["rejectUnauthorized","ca","cert","key","pfx","passphrase"];function u(x,y){let S=`${x.protocol}://${x.hostname}:${x.port}${x.path}`;return typeof x.transformWsUrl=="function"&&(S=x.transformWsUrl(S,x,y)),S}function f(x){let y=x;return x.port||(x.protocol==="wss"?y.port=443:y.port=80),x.path||(y.path="/"),x.wsOptions||(y.wsOptions={}),!o.default&&!x.forceNativeWebSocket&&x.protocol==="wss"&&c.forEach(S=>{Object.prototype.hasOwnProperty.call(x,S)&&!Object.prototype.hasOwnProperty.call(x.wsOptions,S)&&(y.wsOptions[S]=x[S])}),y}function d(x){let y=f(x);if(y.hostname||(y.hostname=y.host),!y.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");let S=new URL(document.URL);y.hostname=S.hostname,y.port||(y.port=Number(S.port))}return y.objectMode===void 0&&(y.objectMode=!(y.binary===!0||y.binary===void 0)),y}function m(x,y,S){s("createWebSocket"),s(`protocol: ${S.protocolId} ${S.protocolVersion}`);let E=S.protocolId==="MQIsdp"&&S.protocolVersion===3?"mqttv3.1":"mqtt";s(`creating new Websocket for url: ${y} and protocol: ${E}`);let _;return S.createWebsocket?_=S.createWebsocket(y,[E],S):_=new i.default(y,[E],S.wsOptions),_}function g(x,y){let S=y.protocolId==="MQIsdp"&&y.protocolVersion===3?"mqttv3.1":"mqtt",E=u(y,x),_;return y.createWebsocket?_=y.createWebsocket(E,[S],y):_=new WebSocket(E,[S]),_.binaryType="arraybuffer",_}var b=(x,y)=>{s("streamBuilder");let S=f(y);S.hostname=S.hostname||S.host||"localhost";let E=u(S,x),_=m(x,E,S),O=i.default.createWebSocketStream(_,S.wsOptions);return O.url=E,_.on("close",()=>{O.destroy()}),O};l.streamBuilder=b;var w=(x,y)=>{s("browserStreamBuilder");let S,E=d(y).browserBufferSize||1024*512,_=y.browserBufferTimeout||1e3,O=!y.objectMode,k=g(x,y),T=A(y,D,J);y.objectMode||(T._writev=a.writev.bind(T)),T.on("close",()=>{k.close()});let P=typeof k.addEventListener<"u";k.readyState===k.OPEN?(S=T,S.socket=k):(S=new a.BufferedDuplex(y,T,k),P?k.addEventListener("open",U):k.onopen=U),P?(k.addEventListener("close",I),k.addEventListener("error",B),k.addEventListener("message",F)):(k.onclose=I,k.onerror=B,k.onmessage=F);function A(G,Y,ce){let H=new n.Transform({objectMode:G.objectMode});return H._write=Y,H._flush=ce,H}function U(){s("WebSocket onOpen"),S instanceof a.BufferedDuplex&&S.socketReady()}function I(G){s("WebSocket onClose",G),S.end(),S.destroy()}function B(G){s("WebSocket onError",G);let Y=new Error("WebSocket error");Y.event=G,S.destroy(Y)}async function F(G){if(!T||!T.readable||!T.writable)return;let{data:Y}=G;Y instanceof ArrayBuffer?Y=t.Buffer.from(Y):Y instanceof Blob?Y=t.Buffer.from(await new Response(Y).arrayBuffer()):Y=t.Buffer.from(Y,"utf8"),T.push(Y)}function D(G,Y,ce){if(k.bufferedAmount>E){setTimeout(D,_,G,Y,ce);return}O&&typeof G=="string"&&(G=t.Buffer.from(G,"utf8"));try{k.send(G)}catch(H){return ce(H)}ce()}function J(G){k.close(),G()}return S};l.browserStreamBuilder=w}),Es={};fr(Es,{Server:()=>He,Socket:()=>He,Stream:()=>He,_createServerHandle:()=>He,_normalizeArgs:()=>He,_setSimultaneousAccepts:()=>He,connect:()=>He,createConnection:()=>He,createServer:()=>He,default:()=>jc,isIP:()=>He,isIPv4:()=>He,isIPv6:()=>He});function He(){throw new Error("Node.js net module is not supported by JSPM core outside of Node.js")}var jc,Fc=ut(()=>{de(),me(),pe(),jc={_createServerHandle:He,_normalizeArgs:He,_setSimultaneousAccepts:He,connect:He,createConnection:He,createServer:He,isIP:He,isIPv4:He,isIPv6:He,Server:He,Socket:He,Stream:He}}),Wc=we((l,e)=>{de(),me(),pe(),e.exports={}}),Ba=we(l=>{de(),me(),pe();var e=l&&l.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(l,"__esModule",{value:!0});var t=e((Fc(),We(Es))),i=e(It()),r=e(Wc()),n=(0,i.default)("mqttjs:tcp"),o=(a,s)=>{if(s.port=s.port||1883,s.hostname=s.hostname||s.host||"localhost",s.socksProxy)return(0,r.default)(s.hostname,s.port,s.socksProxy,{timeout:s.socksTimeout});let{port:c,path:u}=s,f=s.hostname;return n("port %d and host %s",c,f),t.default.createConnection({port:c,host:f,path:u})};l.default=o}),$c={};fr($c,{default:()=>zc});var zc,hf=ut(()=>{de(),me(),pe(),zc={}}),Ua=we(l=>{de(),me(),pe();var e=l&&l.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(l,"__esModule",{value:!0});var t=(hf(),We($c)),i=e((Fc(),We(Es))),r=e(It()),n=e(Wc()),o=(0,r.default)("mqttjs:tls");function a(c){let{host:u,port:f,socksProxy:d,...m}=c;if(d!==void 0){let g=(0,n.default)(u,f,d,{timeout:c.socksTimeout});return(0,t.connect)({...m,socket:g})}return(0,t.connect)(c)}var s=(c,u)=>{u.port=u.port||8883,u.host=u.hostname||u.host||"localhost",i.default.isIP(u.host)===0&&(u.servername=u.host),u.rejectUnauthorized=u.rejectUnauthorized!==!1,delete u.path,o("port %d host %s rejectUnauthorized %b",u.port,u.host,u.rejectUnauthorized);let f=a(u);f.on("secureConnect",()=>{u.rejectUnauthorized&&!f.authorized?f.emit("error",new Error("TLS not authorized")):f.removeListener("error",d)});function d(m){u.rejectUnauthorized&&c.emit("error",m),f.end()}return f.on("error",d),f};l.default=s}),Da=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0});var e=(et(),We(Ze)),t=tr(),i=xs(),r,n,o;function a(){let d=new t.Transform;return d._write=(m,g,b)=>{r.send({data:m.buffer,success(){b()},fail(w){b(new Error(w))}})},d._flush=m=>{r.close({success(){m()}})},d}function s(d){d.hostname||(d.hostname="localhost"),d.path||(d.path="/"),d.wsOptions||(d.wsOptions={})}function c(d,m){let g=d.protocol==="wxs"?"wss":"ws",b=`${g}://${d.hostname}${d.path}`;return d.port&&d.port!==80&&d.port!==443&&(b=`${g}://${d.hostname}:${d.port}${d.path}`),typeof d.transformWsUrl=="function"&&(b=d.transformWsUrl(b,d,m)),b}function u(){r.onOpen(()=>{o.socketReady()}),r.onMessage(d=>{let{data:m}=d;m instanceof ArrayBuffer?m=e.Buffer.from(m):m=e.Buffer.from(m,"utf8"),n.push(m)}),r.onClose(()=>{o.emit("close"),o.end(),o.destroy()}),r.onError(d=>{let m=new Error(d.errMsg);o.destroy(m)})}var f=(d,m)=>{if(m.hostname=m.hostname||m.host,!m.hostname)throw new Error("Could not determine host. Specify host manually.");let g=m.protocolId==="MQIsdp"&&m.protocolVersion===3?"mqttv3.1":"mqtt";s(m);let b=c(m,d);r=wx.connectSocket({url:b,protocols:[g]}),n=a(),o=new i.BufferedDuplex(m,n,r),o._destroy=(x,y)=>{r.close({success(){y&&y(x)}})};let w=o.destroy;return o.destroy=(x,y)=>(o.destroy=w,setTimeout(()=>{r.close({fail(){o._destroy(x,y)}})},0),o),u(),o};l.default=f}),Na=we(l=>{de(),me(),pe(),Object.defineProperty(l,"__esModule",{value:!0});var e=(et(),We(Ze)),t=tr(),i=xs(),r,n,o,a=!1;function s(){let m=new t.Transform;return m._write=(g,b,w)=>{r.sendSocketMessage({data:g.buffer,success(){w()},fail(){w(new Error)}})},m._flush=g=>{r.closeSocket({success(){g()}})},m}function c(m){m.hostname||(m.hostname="localhost"),m.path||(m.path="/"),m.wsOptions||(m.wsOptions={})}function u(m,g){let b=m.protocol==="alis"?"wss":"ws",w=`${b}://${m.hostname}${m.path}`;return m.port&&m.port!==80&&m.port!==443&&(w=`${b}://${m.hostname}:${m.port}${m.path}`),typeof m.transformWsUrl=="function"&&(w=m.transformWsUrl(w,m,g)),w}function f(){a||(a=!0,r.onSocketOpen(()=>{o.socketReady()}),r.onSocketMessage(m=>{if(typeof m.data=="string"){let g=e.Buffer.from(m.data,"base64");n.push(g)}else{let g=new FileReader;g.addEventListener("load",()=>{if(g.result instanceof ArrayBuffer){n.push(e.Buffer.from(g.result));return}n.push(e.Buffer.from(g.result,"utf-8"))}),g.readAsArrayBuffer(m.data)}}),r.onSocketClose(()=>{o.end(),o.destroy()}),r.onSocketError(m=>{o.destroy(m)}))}var d=(m,g)=>{if(g.hostname=g.hostname||g.host,!g.hostname)throw new Error("Could not determine host. Specify host manually.");let b=g.protocolId==="MQIsdp"&&g.protocolVersion===3?"mqttv3.1":"mqtt";c(g);let w=u(g,m);return r=g.my,r.connectSocket({url:w,protocols:b}),n=s(),o=new i.BufferedDuplex(g,n,r),f(),o};l.default=d}),ff=we(l=>{de(),me(),pe();var e=l&&l.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(l,"__esModule",{value:!0}),l.connectAsync=u;var t=e(It()),i=e((cf(),We(bc))),r=e(bo()),n=e(Hn());typeof $e?.nextTick!="function"&&($e.nextTick=setImmediate);var o=(0,t.default)("mqttjs"),a=null;function s(f){let d;if(f.auth)if(d=f.auth.match(/^(.+):(.+)$/),d){let[,m,g]=d;f.username=m,f.password=g}else f.username=f.auth}function c(f,d){if(o("connecting to an MQTT broker..."),typeof f=="object"&&!d&&(d=f,f=""),d=d||{},f&&typeof f=="string"){let b=i.default.parse(f,!0),w={};if(b.port!=null&&(w.port=Number(b.port)),w.host=b.hostname,w.query=b.query,w.auth=b.auth,w.protocol=b.protocol,w.path=b.path,d={...w,...d},!d.protocol)throw new Error("Missing protocol");d.protocol=d.protocol.replace(/:$/,"")}if(d.unixSocket=d.unixSocket||d.protocol?.includes("+unix"),d.unixSocket?d.protocol=d.protocol.replace("+unix",""):!d.protocol?.startsWith("ws")&&!d.protocol?.startsWith("wx")&&delete d.path,s(d),d.query&&typeof d.query.clientId=="string"&&(d.clientId=d.query.clientId),n.default||d.unixSocket?d.socksProxy=void 0:d.socksProxy===void 0&&typeof $e<"u"&&(d.socksProxy=$e.env.MQTTJS_SOCKS_PROXY),d.cert&&d.key)if(d.protocol){if(["mqtts","wss","wxs","alis"].indexOf(d.protocol)===-1)switch(d.protocol){case"mqtt":d.protocol="mqtts";break;case"ws":d.protocol="wss";break;case"wx":d.protocol="wxs";break;case"ali":d.protocol="alis";break;default:throw new Error(`Unknown protocol for secure connection: "${d.protocol}"!`)}}else throw new Error("Missing secure protocol key");if(a||(a={},!n.default&&!d.forceNativeWebSocket?(a.ws=Hr().streamBuilder,a.wss=Hr().streamBuilder,a.mqtt=Ba().default,a.tcp=Ba().default,a.ssl=Ua().default,a.tls=a.ssl,a.mqtts=Ua().default):(a.ws=Hr().browserStreamBuilder,a.wss=Hr().browserStreamBuilder,a.wx=Da().default,a.wxs=Da().default,a.ali=Na().default,a.alis=Na().default)),!a[d.protocol]){let b=["mqtts","wss"].indexOf(d.protocol)!==-1;d.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter((w,x)=>b&&x%2===0?!1:typeof a[w]=="function")[0]}if(d.clean===!1&&!d.clientId)throw new Error("Missing clientId for unclean clients");d.protocol&&(d.defaultProtocol=d.protocol);function m(b){return d.servers&&((!b._reconnectCount||b._reconnectCount===d.servers.length)&&(b._reconnectCount=0),d.host=d.servers[b._reconnectCount].host,d.port=d.servers[b._reconnectCount].port,d.protocol=d.servers[b._reconnectCount].protocol?d.servers[b._reconnectCount].protocol:d.defaultProtocol,d.hostname=d.host,b._reconnectCount++),o("calling streambuilder for",d.protocol),a[d.protocol](b,d)}let g=new r.default(m,d);return g.on("error",()=>{}),g}function u(f,d,m=!0){return new Promise((g,b)=>{let w=c(f,d),x={connect:S=>{y(),g(w)},end:()=>{y(),g(w)},error:S=>{y(),w.end(),b(S)}};m===!1&&(x.close=()=>{x.error(new Error("Couldn't connect to server"))});function y(){Object.keys(x).forEach(S=>{w.off(S,x[S])})}Object.keys(x).forEach(S=>{w.on(S,x[S])})})}l.default=c}),ja=we(l=>{de(),me(),pe();var e=l&&l.__createBinding||(Object.create?function(m,g,b,w){w===void 0&&(w=b);var x=Object.getOwnPropertyDescriptor(g,b);(!x||("get"in x?!g.__esModule:x.writable||x.configurable))&&(x={enumerable:!0,get:function(){return g[b]}}),Object.defineProperty(m,w,x)}:function(m,g,b,w){w===void 0&&(w=b),m[w]=g[b]}),t=l&&l.__setModuleDefault||(Object.create?function(m,g){Object.defineProperty(m,"default",{enumerable:!0,value:g})}:function(m,g){m.default=g}),i=l&&l.__importStar||(function(){var m=function(g){return m=Object.getOwnPropertyNames||function(b){var w=[];for(var x in b)Object.prototype.hasOwnProperty.call(b,x)&&(w[w.length]=x);return w},m(g)};return function(g){if(g&&g.__esModule)return g;var b={};if(g!=null)for(var w=m(g),x=0;x<w.length;x++)w[x]!=="default"&&e(b,g,w[x]);return t(b,g),b}})(),r=l&&l.__exportStar||function(m,g){for(var b in m)b!=="default"&&!Object.prototype.hasOwnProperty.call(g,b)&&e(g,m,b)},n=l&&l.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(l,"__esModule",{value:!0}),l.ReasonCodes=l.KeepaliveManager=l.UniqueMessageIdProvider=l.DefaultMessageIdProvider=l.Store=l.MqttClient=l.connectAsync=l.connect=l.Client=void 0;var o=n(bo());l.MqttClient=o.default;var a=n(oc());l.DefaultMessageIdProvider=a.default;var s=n(xh());l.UniqueMessageIdProvider=s.default;var c=n($l());l.Store=c.default;var u=i(ff());l.connect=u.default,Object.defineProperty(l,"connectAsync",{enumerable:!0,get:function(){return u.connectAsync}});var f=n(fc());l.KeepaliveManager=f.default,l.Client=o.default,r(bo(),l),r(pr(),l);var d=zn();Object.defineProperty(l,"ReasonCodes",{enumerable:!0,get:function(){return d.ReasonCodes}})}),df=we(l=>{de(),me(),pe();var e=l&&l.__createBinding||(Object.create?function(o,a,s,c){c===void 0&&(c=s);var u=Object.getOwnPropertyDescriptor(a,s);(!u||("get"in u?!a.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return a[s]}}),Object.defineProperty(o,c,u)}:function(o,a,s,c){c===void 0&&(c=s),o[c]=a[s]}),t=l&&l.__setModuleDefault||(Object.create?function(o,a){Object.defineProperty(o,"default",{enumerable:!0,value:a})}:function(o,a){o.default=a}),i=l&&l.__importStar||(function(){var o=function(a){return o=Object.getOwnPropertyNames||function(s){var c=[];for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(c[c.length]=u);return c},o(a)};return function(a){if(a&&a.__esModule)return a;var s={};if(a!=null)for(var c=o(a),u=0;u<c.length;u++)c[u]!=="default"&&e(s,a,c[u]);return t(s,a),s}})(),r=l&&l.__exportStar||function(o,a){for(var s in o)s!=="default"&&!Object.prototype.hasOwnProperty.call(a,s)&&e(a,o,s)};Object.defineProperty(l,"__esModule",{value:!0});var n=i(ja());l.default=n,r(ja(),l)});const pf=df();/*! Bundled license information:

@jspm/core/nodelibs/browser/chunk-DtuTasat.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

@babel/runtime/helpers/regenerator.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE *)
*/const{floor:mf,random:yf}=Math,Ln="Trystero",Ur=(l,e)=>Array(l).fill().map(e),Fa="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",gf=l=>Ur(l,()=>Fa[mf(yf()*Fa.length)]).join(""),cr=gf(20),Kt=Promise.all.bind(Promise),bf=typeof window<"u",{entries:Wa,fromEntries:vf,keys:wf}=Object,Gt=()=>{},xt=l=>new Error(`${Ln}: ${l}`),_f=new TextEncoder,Sf=new TextDecoder,hr=l=>_f.encode(l),An=l=>Sf.decode(l),Gr=(...l)=>l.join("@"),xf=(l,e,t,i)=>(l.relayUrls||e).slice(0,l.relayUrls?l.relayUrls.length:l.relayRedundancy||t),Dr=JSON.stringify,os=JSON.parse,Is="AES-GCM",Xn={},Ef=l=>btoa(String.fromCharCode.apply(null,new Uint8Array(l))),If=l=>{const e=atob(l);return new Uint8Array(e.length).map((t,i)=>e.charCodeAt(i)).buffer},Af=async(l,e)=>new Uint8Array(await crypto.subtle.digest(l,hr(e))),Kr=async l=>Xn[l]||(Xn[l]=Array.from(await Af("SHA-1",l)).map(e=>e.toString(36)).join("")),kf=async(l,e,t)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},hr(`${l}:${e}:${t}`)),{name:Is},!1,["encrypt","decrypt"]),qc="$",Hc=",",Tf=async(l,e)=>{const t=crypto.getRandomValues(new Uint8Array(16));return t.join(Hc)+qc+Ef(await crypto.subtle.encrypt({name:Is,iv:t},await l,hr(e)))},Pf=async(l,e)=>{const[t,i]=e.split(qc);return An(await crypto.subtle.decrypt({name:Is,iv:new Uint8Array(t.split(Hc))},await l,If(i)))},Mf=5e3,$a="icegatheringstatechange",za="offer",Of="answer",qa=(l,{rtcConfig:e,rtcPolyfill:t,turnConfig:i})=>{const r=new(t||RTCPeerConnection)({iceServers:Cf.concat(i||[]),...e}),n={};let o=!1,a=!1,s=null;const c=f=>{f.binaryType="arraybuffer",f.bufferedAmountLowThreshold=65535,f.onmessage=d=>n.data?.(d.data),f.onopen=()=>n.connect?.(),f.onclose=()=>n.close?.(),f.onerror=d=>n.error?.(d)},u=f=>Promise.race([new Promise(d=>{const m=()=>{f.iceGatheringState==="complete"&&(f.removeEventListener($a,m),d())};f.addEventListener($a,m),m()}),new Promise(d=>setTimeout(d,Mf))]).then(()=>({type:f.localDescription.type,sdp:f.localDescription.sdp.replace(/a=ice-options:trickle\s\n/g,"")}));return l?(s=r.createDataChannel("data"),c(s)):r.ondatachannel=({channel:f})=>{s=f,c(f)},r.onnegotiationneeded=async()=>{try{o=!0,await r.setLocalDescription();const f=await u(r);n.signal?.(f)}catch(f){n.error?.(f)}finally{o=!1}},r.onconnectionstatechange=()=>{["disconnected","failed","closed"].includes(r.connectionState)&&n.close?.()},r.ontrack=f=>{n.track?.(f.track,f.streams[0]),n.stream?.(f.streams[0])},r.onremovestream=f=>n.stream?.(f.stream),l&&(r.canTrickleIceCandidates||r.onnegotiationneeded()),{created:Date.now(),connection:r,get channel(){return s},get isDead(){return r.connectionState==="closed"},async signal(f){if(!(s?.readyState==="open"&&!f.sdp?.includes("a=rtpmap")))try{if(f.type===za){if(o||r.signalingState!=="stable"&&!a){if(l)return;await Kt([r.setLocalDescription({type:"rollback"}),r.setRemoteDescription(f)])}else await r.setRemoteDescription(f);await r.setLocalDescription();const d=await u(r);return n.signal?.(d),d}else if(f.type===Of){a=!0;try{await r.setRemoteDescription(f)}finally{a=!1}}}catch(d){n.error?.(d)}},sendData:f=>s.send(f),destroy:()=>{s?.close(),r.close(),o=!1,a=!1},setHandlers:f=>Object.assign(n,f),offerPromise:l?new Promise(f=>n.signal=d=>{d.type===za&&f(d)}):Promise.resolve(),addStream:f=>f.getTracks().forEach(d=>r.addTrack(d,f)),removeStream:f=>r.getSenders().filter(d=>f.getTracks().includes(d.track)).forEach(d=>r.removeTrack(d)),addTrack:(f,d)=>r.addTrack(f,d),removeTrack:f=>{const d=r.getSenders().find(m=>m.track===f);d&&r.removeTrack(d)},replaceTrack:(f,d)=>{const m=r.getSenders().find(g=>g.track===f);if(m)return m.replaceTrack(d)}}},Cf=[...Ur(3,(l,e)=>`stun:stun${e||""}.l.google.com:19302`),"stun:stun.cloudflare.com:3478"].map(l=>({urls:l})),Rf=Object.getPrototypeOf(Uint8Array),kn=12,Gc=0,Tn=Gc+kn,Pn=Tn+1,Tr=Pn+1,Pr=Tr+1,Ht=16*2**10-Pr,Yr=255,Ha="bufferedamountlow",rr=l=>"@_"+l,Lf=(l,e,t)=>{const i={},r={},n={},o={},a={},s={},c={},u={onPeerJoin:Gt,onPeerLeave:Gt,onPeerStream:Gt,onPeerTrack:Gt},f=(I,B)=>(I?Array.isArray(I)?I:[I]:wf(i)).flatMap(F=>{const D=i[F];return D?B(F,D):(console.warn(`${Ln}: no peer with id ${F} found`),[])}),d=I=>{i[I]&&(i[I].destroy(),delete i[I],delete o[I],delete a[I],u.onPeerLeave(I),e(I))},m=I=>{if(r[I])return n[I];if(!I)throw xt("action type argument is required");const B=hr(I);if(B.byteLength>kn)throw xt(`action type string "${I}" (${B.byteLength}b) exceeds byte limit (${kn}). Hint: choose a shorter name.`);const F=new Uint8Array(kn);F.set(B);let D=0;return r[I]={onComplete:Gt,onProgress:Gt,setOnComplete:J=>r[I]={...r[I],onComplete:J},setOnProgress:J=>r[I]={...r[I],onProgress:J},send:async(J,G,Y,ce)=>{if(Y&&typeof Y!="object")throw xt("action meta argument must be an object");const H=typeof J;if(H==="undefined")throw xt("action data cannot be undefined");const oe=H!=="string",R=J instanceof Blob,V=R||J instanceof ArrayBuffer||J instanceof Rf;if(Y&&!V)throw xt("action meta argument can only be used with binary data");const te=V?new Uint8Array(R?await J.arrayBuffer():J):hr(oe?Dr(J):J),se=Y?hr(Dr(Y)):null,be=Math.ceil(te.byteLength/Ht)+(Y?1:0)||1,K=Ur(be,(j,ie)=>{const Z=ie===be-1,re=Y&&ie===0,ne=new Uint8Array(Pr+(re?se.byteLength:Z?te.byteLength-Ht*(be-(Y?2:1)):Ht));return ne.set(F),ne.set([D],Tn),ne.set([Z|re<<1|V<<2|oe<<3],Pn),ne.set([Math.round((ie+1)/be*Yr)],Tr),ne.set(Y?re?se:te.subarray((ie-1)*Ht,ie*Ht):te.subarray(ie*Ht,(ie+1)*Ht),Pr),ne});return D=D+1&Yr,Kt(f(G,async(j,ie)=>{const{channel:Z}=ie;let re=0;for(;re<be;){const ne=K[re];if(Z.bufferedAmount>Z.bufferedAmountLowThreshold&&await new Promise(ve=>{const he=()=>{Z.removeEventListener(Ha,he),ve()};Z.addEventListener(Ha,he)}),!i[j])break;ie.sendData(ne),re++,ce?.(ne[Tr]/Yr,j,Y)}}))}},n[I]||(n[I]=[r[I].send,r[I].setOnComplete,r[I].setOnProgress])},g=(I,B)=>{var be,K;const F=new Uint8Array(B),D=An(F.subarray(Gc,Tn)).replaceAll("\0",""),[J]=F.subarray(Tn,Pn),[G]=F.subarray(Pn,Tr),[Y]=F.subarray(Tr,Pr),ce=F.subarray(Pr),H=!!(G&1),oe=!!(G&2),R=!!(G&4),V=!!(G&8);if(!r[D]){console.warn(`${Ln}: received message with unregistered type (${D})`);return}o[I]||(o[I]={}),(be=o[I])[D]||(be[D]={});const te=(K=o[I][D])[J]||(K[J]={chunks:[]});if(oe?te.meta=os(An(ce)):te.chunks.push(ce),r[D].onProgress(Y/Yr,I,te.meta),!H)return;const se=new Uint8Array(te.chunks.reduce((j,ie)=>j+ie.byteLength,0));if(te.chunks.reduce((j,ie)=>(se.set(ie,j),j+ie.byteLength),0),delete o[I][D][J],R)r[D].onComplete(se,I,te.meta);else{const j=An(se);r[D].onComplete(V?os(j):j,I)}},b=async()=>{await A(""),await new Promise(I=>setTimeout(I,99)),Wa(i).forEach(([I,B])=>{B.destroy(),delete i[I]}),t()},[w,x]=m(rr("ping")),[y,S]=m(rr("pong")),[E,_]=m(rr("signal")),[O,k]=m(rr("stream")),[T,P]=m(rr("track")),[A,U]=m(rr("leave"));return l((I,B)=>{i[B]||(i[B]=I,I.setHandlers({data:F=>g(B,F),stream:F=>{u.onPeerStream(F,B,s[B]),delete s[B]},track:(F,D)=>{u.onPeerTrack(F,D,B,c[B]),delete c[B]},signal:F=>E(F,B),close:()=>d(B),error:F=>{console.error(F),d(B)}}),u.onPeerJoin(B))}),x((I,B)=>y("",B)),S((I,B)=>{a[B]?.(),delete a[B]}),_((I,B)=>i[B]?.signal(I)),k((I,B)=>s[B]=I),P((I,B)=>c[B]=I),U((I,B)=>d(B)),bf&&addEventListener("beforeunload",b),{makeAction:m,leave:b,ping:async I=>{if(!I)throw xt("ping() must be called with target peer ID");const B=Date.now();return w("",I),await new Promise(F=>a[I]=F),Date.now()-B},getPeers:()=>vf(Wa(i).map(([I,B])=>[I,B.connection])),addStream:(I,B,F)=>f(B,async(D,J)=>{F&&await O(F,D),J.addStream(I)}),removeStream:(I,B)=>f(B,(F,D)=>D.removeStream(I)),addTrack:(I,B,F,D)=>f(F,async(J,G)=>{D&&await T(D,J),G.addTrack(I,B)}),removeTrack:(I,B)=>f(B,(F,D)=>D.removeTrack(I)),replaceTrack:(I,B,F,D)=>f(F,async(J,G)=>{D&&await T(D,J),G.replaceTrack(I,B)}),onPeerJoin:I=>u.onPeerJoin=I,onPeerLeave:I=>u.onPeerLeave=I,onPeerStream:I=>u.onPeerStream=I,onPeerTrack:I=>u.onPeerTrack=I}},Bf=20,Uf=5333,Ga=57333,Df=({init:l,subscribe:e,announce:t})=>{const i={};let r=!1,n,o,a;return(s,c,u)=>{const{appId:f}=s;if(i[f]?.[c])return i[f][c];const d={},m={},g=Gr(Ln,f,c),b=Kr(g),w=Kr(Gr(g,cr)),x=kf(s.password||"",f,c),y=J=>async G=>({type:G.type,sdp:await J(x,G.sdp)}),S=y(Pf),E=y(Tf),_=()=>qa(!0,s),O=(J,G,Y)=>{if(m[G]){m[G]!==J&&J.destroy();return}m[G]=J,D(J,G),d[G]?.forEach((ce,H)=>{H!==Y&&ce.destroy()}),delete d[G]},k=(J,G)=>{m[G]===J&&delete m[G]},T=(J,G)=>{if(m[J])return;const Y=d[J]?.[G];Y&&(delete d[J][G],Y.destroy())},P=J=>(o.push(...Ur(J,_)),Kt(o.splice(0,J).map(G=>G.offerPromise.then(E).then(Y=>({peer:G,offer:Y}))))),A=(J,G)=>u?.({error:`incorrect password (${s.password}) when decrypting ${G}`,appId:f,peerId:J,roomId:c}),U=J=>async(G,Y,ce)=>{const[H,oe]=await Kt([b,w]);if(G!==H&&G!==oe)return;const{peerId:R,offer:V,answer:te,peer:se}=typeof Y=="string"?os(Y):Y;if(!(R===cr||m[R])){if(R&&!V&&!te){if(d[R]?.[J])return;const[[{peer:be,offer:K}],j]=await Kt([P(1),Kr(Gr(g,R))]);d[R]||(d[R]=[]),d[R][J]=be,setTimeout(()=>T(R,J),I[J]*.9),be.setHandlers({connect:()=>O(be,R,J),close:()=>k(be,R)}),ce(j,Dr({peerId:cr,offer:K}))}else if(V){if(d[R]?.[J]&&cr>R)return;const K=qa(!1,s);K.setHandlers({connect:()=>O(K,R,J),close:()=>k(K,R)});let j;try{j=await S(V)}catch{A(R,"offer");return}if(K.isDead)return;const[ie,Z]=await Kt([Kr(Gr(g,R)),K.signal(j)]);ce(ie,Dr({peerId:cr,answer:await E(Z)}))}else if(te){let be;try{be=await S(te)}catch{A(R,"answer");return}if(se)se.setHandlers({connect:()=>O(se,R,J),close:()=>k(se,R)}),se.signal(be);else{const K=d[R]?.[J];K&&!K.isDead&&K.signal(be)}}}};if(!s)throw xt("requires a config map as the first argument");if(!f&&!s.firebaseApp)throw xt("config map is missing appId field");if(!c)throw xt("roomId argument required");if(!r){const J=l(s);o=Ur(Bf,_),n=Array.isArray(J)?J:[J],r=!0,a=setInterval(()=>o=o.filter(G=>{const Y=Date.now()-G.created<Ga;return Y||G.destroy(),Y}),Ga*1.03)}const I=n.map(()=>Uf),B=[],F=n.map(async(J,G)=>e(await J,await b,await w,U(G),P));Kt([b,w]).then(([J,G])=>{const Y=async(ce,H)=>{const oe=await t(ce,J,G);typeof oe=="number"&&(I[H]=oe),B[H]=setTimeout(()=>Y(ce,H),I[H])};F.forEach(async(ce,H)=>{await ce,Y(await n[H],H)})});let D=Gt;return i[f]||(i[f]={}),i[f][c]=Lf(J=>D=J,J=>delete m[J],()=>{delete i[f][c],B.forEach(clearTimeout),F.forEach(async J=>(await J)()),clearInterval(a)})}},Nf=4,nr={},Ka=({options:l})=>l.host+l.path,jf=Df({init:l=>xf(l,Ff,Nf).map(e=>{const t=pf.connect(e),i=Ka(t);return t.stream.socket,nr[i]={},t.on("message",(r,n)=>nr[i][r]?.(r,n.toString())).on("error",r=>console.error(r)),new Promise(r=>t.on("connect",()=>r(t)))}),subscribe:(l,e,t,i)=>{const r=Ka(l);return nr[r][e]=nr[r][t]=(n,o)=>i(n,o,l.publish.bind(l)),l.subscribe(e),l.subscribe(t),()=>{l.unsubscribe(e),l.unsubscribe(t),delete nr[r][e],delete nr[r][t]}},announce:(l,e)=>l.publish(e,Dr({peerId:cr}))}),Ff=["test.mosquitto.org:8081/mqtt","broker.emqx.io:8084/mqtt","broker.hivemq.com:8884/mqtt"].map(l=>"wss://"+l),Wf="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Ya=(l=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(l|=0));for(;l--;)e+=Wf[t[l]&63];return e};const Mr={0:"#ff4444",1:"#44ff44",2:"#4444ff",3:"#ffff44"},Bn={purple:"#aa00aa",brown:"#aa6600"};function vr(l,e){return l==="ffa"?Mr[e]:e%2===0?Bn.purple:Bn.brown}function Xt(l){return{slotIndex:l,peerId:null,nickname:"",isHost:!1}}function $f(l,e){const t=[Xt(0),Xt(1),Xt(2),Xt(3)];return{roomId:l,hostPeerId:e,gameMode:"ffa",levelMode:"cycle",slots:t,chatMessages:[],spectators:[]}}function Kc(l){return l.slots.filter(e=>e.peerId!==null).length}function ir(l){const e=Kc(l);return l.gameMode==="ffa"?e>=2:e===4}function Yc(l){for(const e of l.slots)if(e.peerId===null)return e.slotIndex;return null}function wr(l,e){return l.slots.find(t=>t.peerId===e)??null}function zf(l){const e=l.length;let t=0,i=0;for(;i<e;){let r=l.charCodeAt(i++);if((r&4294967168)===0){t++;continue}else if((r&4294965248)===0)t+=2;else{if(r>=55296&&r<=56319&&i<e){const n=l.charCodeAt(i);(n&64512)===56320&&(++i,r=((r&1023)<<10)+(n&1023)+65536)}(r&4294901760)===0?t+=3:t+=4}}return t}function qf(l,e,t){const i=l.length;let r=t,n=0;for(;n<i;){let o=l.charCodeAt(n++);if((o&4294967168)===0){e[r++]=o;continue}else if((o&4294965248)===0)e[r++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&n<i){const a=l.charCodeAt(n);(a&64512)===56320&&(++n,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[r++]=o>>12&15|224,e[r++]=o>>6&63|128):(e[r++]=o>>18&7|240,e[r++]=o>>12&63|128,e[r++]=o>>6&63|128)}e[r++]=o&63|128}}const Hf=new TextEncoder,Gf=50;function Kf(l,e,t){Hf.encodeInto(l,e.subarray(t))}function Yf(l,e,t){l.length>Gf?Kf(l,e,t):qf(l,e,t)}const Vf=4096;function Vc(l,e,t){let i=e;const r=i+t,n=[];let o="";for(;i<r;){const a=l[i++];if((a&128)===0)n.push(a);else if((a&224)===192){const s=l[i++]&63;n.push((a&31)<<6|s)}else if((a&240)===224){const s=l[i++]&63,c=l[i++]&63;n.push((a&31)<<12|s<<6|c)}else if((a&248)===240){const s=l[i++]&63,c=l[i++]&63,u=l[i++]&63;let f=(a&7)<<18|s<<12|c<<6|u;f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|f&1023),n.push(f)}else n.push(a);n.length>=Vf&&(o+=String.fromCharCode(...n),n.length=0)}return n.length>0&&(o+=String.fromCharCode(...n)),o}const Xf=new TextDecoder,Jf=200;function Qf(l,e,t){const i=l.subarray(e,e+t);return Xf.decode(i)}function Zf(l,e,t){return t>Jf?Qf(l,e,t):Vc(l,e,t)}class Vr{constructor(e,t){M(this,"type");M(this,"data");this.type=e,this.data=t}}class ht extends Error{constructor(e){super(e);const t=Object.create(ht.prototype);Object.setPrototypeOf(this,t),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:ht.name})}}const _r=4294967295;function ed(l,e,t){const i=t/4294967296,r=t;l.setUint32(e,i),l.setUint32(e+4,r)}function Xc(l,e,t){const i=Math.floor(t/4294967296),r=t;l.setUint32(e,i),l.setUint32(e+4,r)}function Jc(l,e){const t=l.getInt32(e),i=l.getUint32(e+4);return t*4294967296+i}function td(l,e){const t=l.getUint32(e),i=l.getUint32(e+4);return t*4294967296+i}const rd=-1,nd=4294967296-1,id=17179869184-1;function od({sec:l,nsec:e}){if(l>=0&&e>=0&&l<=id)if(e===0&&l<=nd){const t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,l),t}else{const t=l/4294967296,i=l&4294967295,r=new Uint8Array(8),n=new DataView(r.buffer);return n.setUint32(0,e<<2|t&3),n.setUint32(4,i),r}else{const t=new Uint8Array(12),i=new DataView(t.buffer);return i.setUint32(0,e),Xc(i,4,l),t}}function sd(l){const e=l.getTime(),t=Math.floor(e/1e3),i=(e-t*1e3)*1e6,r=Math.floor(i/1e9);return{sec:t+r,nsec:i-r*1e9}}function ad(l){if(l instanceof Date){const e=sd(l);return od(e)}else return null}function ld(l){const e=new DataView(l.buffer,l.byteOffset,l.byteLength);switch(l.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const t=e.getUint32(0),i=e.getUint32(4),r=(t&3)*4294967296+i,n=t>>>2;return{sec:r,nsec:n}}case 12:{const t=Jc(e,4),i=e.getUint32(0);return{sec:t,nsec:i}}default:throw new ht(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${l.length}`)}}function cd(l){const e=ld(l);return new Date(e.sec*1e3+e.nsec/1e6)}const ud={type:rd,encode:ad,decode:cd},jn=class jn{constructor(){M(this,"__brand");M(this,"builtInEncoders",[]);M(this,"builtInDecoders",[]);M(this,"encoders",[]);M(this,"decoders",[]);this.register(ud)}register({type:e,encode:t,decode:i}){if(e>=0)this.encoders[e]=t,this.decoders[e]=i;else{const r=-1-e;this.builtInEncoders[r]=t,this.builtInDecoders[r]=i}}tryToEncode(e,t){for(let i=0;i<this.builtInEncoders.length;i++){const r=this.builtInEncoders[i];if(r!=null){const n=r(e,t);if(n!=null){const o=-1-i;return new Vr(o,n)}}}for(let i=0;i<this.encoders.length;i++){const r=this.encoders[i];if(r!=null){const n=r(e,t);if(n!=null){const o=i;return new Vr(o,n)}}}return e instanceof Vr?e:null}decode(e,t,i){const r=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return r?r(e,t,i):new Vr(t,e)}};M(jn,"defaultCodec",new jn);let Un=jn;function hd(l){return l instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&l instanceof SharedArrayBuffer}function ss(l){return l instanceof Uint8Array?l:ArrayBuffer.isView(l)?new Uint8Array(l.buffer,l.byteOffset,l.byteLength):hd(l)?new Uint8Array(l):Uint8Array.from(l)}const fd=100,dd=2048;class As{constructor(e){M(this,"extensionCodec");M(this,"context");M(this,"useBigInt64");M(this,"maxDepth");M(this,"initialBufferSize");M(this,"sortKeys");M(this,"forceFloat32");M(this,"ignoreUndefined");M(this,"forceIntegerToFloat");M(this,"pos");M(this,"view");M(this,"bytes");M(this,"entered",!1);this.extensionCodec=e?.extensionCodec??Un.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??fd,this.initialBufferSize=e?.initialBufferSize??dd,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new As({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){const t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(t*2)}resizeBuffer(e){const t=new ArrayBuffer(e),i=new Uint8Array(t),r=new DataView(t);i.set(this.bytes),this.view=r,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=zf(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),Yf(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,t){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,t);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw new Error(`Too large binary: ${t}`);const i=ss(e);this.writeU8a(i)}encodeArray(e,t){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const r of e)this.doEncode(r,t+1)}countWithoutUndefined(e,t){let i=0;for(const r of t)e[r]!==void 0&&i++;return i}encodeMap(e,t){const i=Object.keys(e);this.sortKeys&&i.sort();const r=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else if(r<4294967296)this.writeU8(223),this.writeU32(r);else throw new Error(`Too large map object: ${r}`);for(const n of i){const o=e[n];this.ignoreUndefined&&o===void 0||(this.encodeString(n),this.doEncode(o,t+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),r=i.length;if(r>=4294967296)throw new Error(`Too large extension object: ${r}`);this.writeU8(201),this.writeU32(r),this.writeI8(e.type),this.writeU8a(i);return}const t=e.data.length;if(t===1)this.writeU8(212);else if(t===2)this.writeU8(213);else if(t===4)this.writeU8(214);else if(t===8)this.writeU8(215);else if(t===16)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw new Error(`Too large extension object: ${t}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),ed(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Xc(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function pd(l,e){return new As(e).encodeSharedRef(l)}function Jn(l){return`${l<0?"-":""}0x${Math.abs(l).toString(16).padStart(2,"0")}`}const md=16,yd=16;class gd{constructor(e=md,t=yd){M(this,"hit",0);M(this,"miss",0);M(this,"caches");M(this,"maxKeyLength");M(this,"maxLengthPerKey");this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,i){const r=this.caches[i-1];e:for(const n of r){const o=n.bytes;for(let a=0;a<i;a++)if(o[a]!==e[t+a])continue e;return n.str}return null}store(e,t){const i=this.caches[e.length-1],r={bytes:e,str:t};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=r:i.push(r)}decode(e,t,i){const r=this.find(e,t,i);if(r!=null)return this.hit++,r;this.miss++;const n=Vc(e,t,i),o=Uint8Array.prototype.slice.call(e,t,t+i);return this.store(o,n),n}}const as="array",Lr="map_key",Qc="map_value",bd=l=>{if(typeof l=="string"||typeof l=="number")return l;throw new ht("The type of key must be string or number but "+typeof l)};class vd{constructor(){M(this,"stack",[]);M(this,"stackHeadPosition",-1)}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const t=this.getUninitializedStateFromPool();t.type=as,t.position=0,t.size=e,t.array=new Array(e)}pushMapState(e){const t=this.getUninitializedStateFromPool();t.type=Lr,t.readCount=0,t.size=e,t.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===as){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===Lr||e.type===Qc){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Sr=-1,ks=new DataView(new ArrayBuffer(0)),wd=new Uint8Array(ks.buffer);try{ks.getInt8(0)}catch(l){if(!(l instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Va=new RangeError("Insufficient data"),_d=new gd;class Ts{constructor(e){M(this,"extensionCodec");M(this,"context");M(this,"useBigInt64");M(this,"rawStrings");M(this,"maxStrLength");M(this,"maxBinLength");M(this,"maxArrayLength");M(this,"maxMapLength");M(this,"maxExtLength");M(this,"keyDecoder");M(this,"mapKeyConverter");M(this,"totalPos",0);M(this,"pos",0);M(this,"view",ks);M(this,"bytes",wd);M(this,"headByte",Sr);M(this,"stack",new vd);M(this,"entered",!1);this.extensionCodec=e?.extensionCodec??Un.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??_r,this.maxBinLength=e?.maxBinLength??_r,this.maxArrayLength=e?.maxArrayLength??_r,this.maxMapLength=e?.maxMapLength??_r,this.maxExtLength=e?.maxExtLength??_r,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:_d,this.mapKeyConverter=e?.mapKeyConverter??bd}clone(){return new Ts({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Sr,this.stack.reset()}setBuffer(e){const t=ss(e);this.bytes=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Sr&&!this.hasRemaining(1))this.setBuffer(e);else{const t=this.bytes.subarray(this.pos),i=ss(e),r=new Uint8Array(t.length+i.length);r.set(t),r.set(i,t.length),this.setBuffer(r)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:t,pos:i}=this;return new RangeError(`Extra ${t.byteLength-i} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let t=!1,i;for await(const a of e){if(t)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),t=!0}catch(s){if(!(s instanceof RangeError))throw s}this.totalPos+=this.pos}if(t){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:r,pos:n,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${Jn(r)} at ${o} (${n} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,t){if(this.entered){yield*this.clone().decodeMultiAsync(e,t);return}try{this.entered=!0;let i=t,r=-1;for await(const n of e){if(t&&r===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(n),i&&(r=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--r!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let t;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){const r=e-128;if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e<160){const r=e-144;if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else{const r=e-160;t=this.decodeString(r,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)this.useBigInt64?t=this.readU64AsBigInt():t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)this.useBigInt64?t=this.readI64AsBigInt():t=this.readI64();else if(e===217){const r=this.lookU8();t=this.decodeString(r,1)}else if(e===218){const r=this.lookU16();t=this.decodeString(r,2)}else if(e===219){const r=this.lookU32();t=this.decodeString(r,4)}else if(e===220){const r=this.readU16();if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else if(e===221){const r=this.readU32();if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else if(e===222){const r=this.readU16();if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e===223){const r=this.readU32();if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e===196){const r=this.lookU8();t=this.decodeBinary(r,1)}else if(e===197){const r=this.lookU16();t=this.decodeBinary(r,2)}else if(e===198){const r=this.lookU32();t=this.decodeBinary(r,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){const r=this.lookU8();t=this.decodeExtension(r,1)}else if(e===200){const r=this.lookU16();t=this.decodeExtension(r,2)}else if(e===201){const r=this.lookU32();t=this.decodeExtension(r,4)}else throw new ht(`Unrecognized type byte: ${Jn(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const r=i.top();if(r.type===as)if(r.array[r.position]=t,r.position++,r.position===r.size)t=r.array,i.release(r);else continue e;else if(r.type===Lr){if(t==="__proto__")throw new ht("The key __proto__ is not allowed");r.key=this.mapKeyConverter(t),r.type=Qc;continue e}else if(r.map[r.key]=t,r.readCount++,r.readCount===r.size)t=r.map,i.release(r);else{r.key=null,r.type=Lr;continue e}}return t}}readHeadByte(){return this.headByte===Sr&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Sr}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new ht(`Unrecognized array type byte: ${Jn(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new ht(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new ht(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,t){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,t):this.decodeBinary(e,t)}decodeUtf8String(e,t){if(e>this.maxStrLength)throw new ht(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw Va;const i=this.pos+t;let r;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?r=this.keyDecoder.decode(this.bytes,i,e):r=Zf(this.bytes,i,e),this.pos+=t+e,r}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Lr:!1}decodeBinary(e,t){if(e>this.maxBinLength)throw new ht(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw Va;const i=this.pos+t,r=this.bytes.subarray(i,i+e);return this.pos+=t+e,r}decodeExtension(e,t){if(e>this.maxExtLength)throw new ht(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+t),r=this.decodeBinary(e,t+1);return this.extensionCodec.decode(r,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=td(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Jc(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}}function Sd(l,e){return new Ts(e).decode(l)}function xd(l){const e=[];for(const t of l)e.push(t.x,t.y);return e}function Ed(l){const e=[];for(let t=0;t<l.length;t+=2)e.push({x:l[t],y:l[t+1]});return e}function Id(l){const e={...l,newTrailSegments:l.newTrailSegments.map(t=>({slotIndex:t.slotIndex,segments:xd(t.segments)}))};return pd(e)}function Ad(l){const e=Sd(l);return{...e,newTrailSegments:e.newTrailSegments.map(t=>({slotIndex:t.slotIndex,segments:Ed(t.segments)}))}}const kd="teratron-lobby",Xa=["red","blue","gold","jade","pink","gray","lime","plum","rose","teal","bear","bird","crab","deer","duck","fish","frog","goat","hawk","lion","moon","star","rain","snow","wind","fire","lake","rock","sand","wave","cake","drum","fork","harp","kite","lamp","mask","ring","vase","bell","arch","barn","cave","dome","gate","hill","mill","pier","tower","well"];function Td(){const l=[];for(let e=0;e<3;e++){const t=Math.floor(Math.random()*Xa.length);l.push(Xa[t])}return l.join("-")}const Pd=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"}];class Md{constructor(e){M(this,"room",null);M(this,"roomId",null);M(this,"isHost");M(this,"myPeerId",null);M(this,"status","disconnected");M(this,"callbacks",{});M(this,"sendLobbyMsg",null);M(this,"sendGameState",null);M(this,"sendGameInput",null);M(this,"sendBinaryState",null);M(this,"lobbyState",null);M(this,"hostNickname","Host");M(this,"mySlotIndex",null);this.isHost=e}setCallbacks(e){this.callbacks={...this.callbacks,...e}}getStatus(){return this.status}getRoomId(){return this.roomId}getMyPeerId(){return this.myPeerId}getMySlotIndex(){return this.mySlotIndex}getLobbyState(){return this.lobbyState}isHostMode(){return this.isHost}createRoom(e="Host"){if(!this.isHost)throw new Error("Only host can create room");const t=Td();return this.joinTrysteroRoom(t),t}joinRoom(e,t="Player"){this.joinTrysteroRoom(e)}joinTrysteroRoom(e){this.room&&this.disconnect(),this.roomId=e,this.setStatus("connecting");try{this.room=jf({appId:kd,rtcConfig:{iceServers:Pd}},e);const[t,i]=this.room.makeAction("lobby");this.sendLobbyMsg=(u,f)=>{console.log("[LobbyConnection] Sending lobby message:",u.type,f?`to ${f}`:"broadcast"),t(u,f)},i((u,f)=>{console.log("[LobbyConnection] Received lobby message:",u.type,"from:",f),this.handleLobbyMessage(u,f)});const[r,n]=this.room.makeAction("gameState");this.sendGameState=(u,f)=>r(u,f),n((u,f)=>{this.callbacks.onGameState?.(u)});const[o,a]=this.room.makeAction("gameInput");this.sendGameInput=(u,f)=>o(u,f),a((u,f)=>{this.callbacks.onPlayerInput?.(f,u.input)});const[s,c]=this.room.makeAction("binaryState");this.sendBinaryState=(u,f)=>s(u,f),c((u,f)=>{const d=Ad(u);this.callbacks.onGameState?.({positions:d})}),this.room.onPeerJoin(u=>{console.log("[LobbyConnection] Peer joined:",u,"isHost:",this.isHost),this.isHost?this.handlePeerJoin(u):console.log("[LobbyConnection] Guest connected to peer, requesting lobby state")}),this.room.onPeerLeave(u=>{console.log("[LobbyConnection] Peer left:",u),this.isHost?this.handlePeerLeave(u):this.lobbyState&&u===this.lobbyState.hostPeerId&&this.callbacks.onHostDisconnected?.()}),console.log("[LobbyConnection] Room joined, waiting for peers... (can take 10-30 seconds)"),this.isHost?(this.myPeerId=`host-${Ya(6)}`,this.lobbyState=$f(e,this.myPeerId),this.setStatus("connected"),this.callbacks.onLobbyStateUpdate?.(this.lobbyState)):this.setStatus("connected"),window.history.replaceState({},"",window.location.pathname)}catch(t){console.error("[LobbyConnection] Failed to join room:",t),this.callbacks.onError?.(`Failed to join room: ${t}`),this.setStatus("disconnected")}}disconnect(){this.room&&(!this.isHost&&this.sendLobbyMsg&&this.sendLobbyMsg({type:"leave"}),this.room.leave(),this.room=null,this.roomId=null,this.lobbyState=null,this.mySlotIndex=null,this.sendLobbyMsg=null,this.sendGameState=null,this.sendGameInput=null,this.sendBinaryState=null,this.setStatus("disconnected"),window.history.pushState({},"",window.location.pathname))}setGameMode(e){!this.isHost||!this.lobbyState||(this.lobbyState.gameMode=e,this.broadcastLobbyState())}setLevelMode(e){!this.isHost||!this.lobbyState||(this.lobbyState.levelMode=e,this.broadcastLobbyState())}announce(e){this.sendOrProcessLocally({type:"announce",nickname:e})}joinSlot(e,t){this.sendOrProcessLocally({type:"join_request",nickname:t,preferredSlot:e})}leaveSlot(){this.mySlotIndex=null,this.sendOrProcessLocally({type:"leave"})}changeSlot(e){this.sendOrProcessLocally({type:"slot_change",targetSlot:e})}sendNicknameChange(e){this.isHost&&(this.hostNickname=e),this.sendOrProcessLocally({type:"nickname_change",nickname:e})}sendChat(e){this.sendOrProcessLocally({type:"chat_send",text:e})}sendOrProcessLocally(e){this.isHost?this.myPeerId&&this.handleGuestMessage(e,this.myPeerId):this.sendLobbyMsg&&this.sendLobbyMsg(e)}startGame(){!this.isHost||!this.sendLobbyMsg||!this.lobbyState||(this.sendLobbyMsg({type:"game_start",countdown:3e3}),this.callbacks.onGameStart?.(3e3))}broadcastGameState(e){!this.isHost||!this.sendGameState||this.sendGameState({type:"game_state",positions:e,timestamp:Date.now()})}broadcastBinaryState(e){!this.isHost||!this.sendBinaryState||this.sendBinaryState(e)}sendInput(e){this.isHost||!this.sendGameInput||this.sendGameInput({type:"player_input",input:e})}handleLobbyMessage(e,t){console.log("[LobbyConnection] Received message:",e.type,"from:",t),this.isHost?this.handleGuestMessage(e,t):this.handleHostMessage(e,t)}handleGuestMessage(e,t){if(!this.lobbyState)return;const i=t===this.myPeerId;switch(e.type){case"announce":{const r=this.lobbyState.spectators.find(n=>n.peerId===t);r?r.nickname=e.nickname:this.lobbyState.spectators.push({peerId:t,nickname:e.nickname}),this.broadcastLobbyState();break}case"join_request":{let r=e.preferredSlot;if((r===void 0||this.lobbyState.slots[r].peerId!==null)&&(r=Yc(this.lobbyState)??void 0),r===void 0){i||this.sendLobbyMsg?.({type:"join_rejected",reason:"room_full"},t);return}this.lobbyState.spectators=this.lobbyState.spectators.filter(n=>n.peerId!==t),this.lobbyState.slots[r]={slotIndex:r,peerId:t,nickname:e.nickname,isHost:i},i?this.mySlotIndex=r:this.sendLobbyMsg?.({type:"join_accepted",yourPeerId:t,assignedSlot:r},t),this.broadcastLobbyState();break}case"slot_change":{const r=wr(this.lobbyState,t);if(!r||this.lobbyState.slots[e.targetSlot].peerId!==null)return;const o=r.isHost;this.lobbyState.slots[r.slotIndex]=Xt(r.slotIndex),this.lobbyState.slots[e.targetSlot]={slotIndex:e.targetSlot,peerId:t,nickname:r.nickname,isHost:o},i&&(this.mySlotIndex=e.targetSlot),this.broadcastLobbyState();break}case"nickname_change":{const r=wr(this.lobbyState,t);if(r){r.nickname=e.nickname,this.broadcastLobbyState();break}const n=this.lobbyState.spectators.find(o=>o.peerId===t);n&&(n.nickname=e.nickname,this.broadcastLobbyState());break}case"chat_send":{const r=wr(this.lobbyState,t);if(r){this.addChatMessage(r.slotIndex,r.nickname,e.text);break}const n=this.lobbyState.spectators.find(o=>o.peerId===t);n?this.addChatMessage(null,n.nickname,e.text):i&&this.addChatMessage(null,this.hostNickname,e.text);break}case"leave":{const r=wr(this.lobbyState,t);if(r){const n=r.nickname;this.lobbyState.slots[r.slotIndex]=Xt(r.slotIndex),this.lobbyState.spectators.some(o=>o.peerId===t)||this.lobbyState.spectators.push({peerId:t,nickname:n})}this.broadcastLobbyState();break}}}handleHostMessage(e,t){switch(e.type){case"lobby_state":this.lobbyState=e.state,this.callbacks.onLobbyStateUpdate?.(e.state);break;case"join_accepted":this.myPeerId=e.yourPeerId,this.mySlotIndex=e.assignedSlot,this.callbacks.onJoinAccepted?.(e.yourPeerId,e.assignedSlot);break;case"join_rejected":this.callbacks.onJoinRejected?.(e.reason);break;case"game_start":this.callbacks.onGameStart?.(e.countdown);break;case"host_disconnected":this.callbacks.onHostDisconnected?.();break}}handlePeerJoin(e){this.lobbyState&&this.sendLobbyMsg&&setTimeout(()=>{this.lobbyState&&this.sendLobbyMsg&&(console.log("[LobbyConnection] Sending lobby state to new peer:",e),this.sendLobbyMsg({type:"lobby_state",state:this.lobbyState},e))},500)}handlePeerLeave(e){if(!this.lobbyState)return;let t=!1;const i=wr(this.lobbyState,e);i&&!i.isHost&&(this.lobbyState.slots[i.slotIndex]=Xt(i.slotIndex),t=!0);const r=this.lobbyState.spectators.length;this.lobbyState.spectators=this.lobbyState.spectators.filter(n=>n.peerId!==e),this.lobbyState.spectators.length!==r&&(t=!0),t&&this.broadcastLobbyState()}addChatMessage(e,t,i){if(!this.lobbyState)return;const r={id:Ya(8),senderSlotIndex:e,senderNickname:t,text:i,timestamp:Date.now()};this.lobbyState.chatMessages.push(r),this.lobbyState.chatMessages.length>100&&(this.lobbyState.chatMessages=this.lobbyState.chatMessages.slice(-100)),this.broadcastLobbyState()}broadcastLobbyState(){!this.isHost||!this.lobbyState||!this.sendLobbyMsg||(this.sendLobbyMsg({type:"lobby_state",state:this.lobbyState}),this.callbacks.onLobbyStateUpdate?.(this.lobbyState))}setStatus(e){this.status=e,this.callbacks.onStatusChange?.(e)}}class Od{constructor(e,t,i){M(this,"connection");M(this,"callbacks",{});M(this,"slotByPeerId");M(this,"mySlotIndex");this.connection=e,this.slotByPeerId=t,this.mySlotIndex=i,this.setupCallbacks()}setupCallbacks(){this.connection.setCallbacks({onGameState:e=>{const t=e.positions;t?.round&&t?.match?this.callbacks.onTronState?.(t):Array.isArray(e.positions)&&this.callbacks.onGameState?.(e.positions)},onPlayerInput:(e,t)=>{const i=this.slotByPeerId.get(e);i!==void 0&&this.callbacks.onPlayerInput?.(i,t)},onHostDisconnected:()=>{this.callbacks.onHostDisconnected?.()}})}setCallbacks(e){this.callbacks={...this.callbacks,...e}}isHost(){return this.connection.isHostMode()}getMySlotIndex(){return this.mySlotIndex}broadcastPositions(e){this.connection.broadcastGameState(e)}broadcastBinaryState(e){this.connection.broadcastBinaryState(e)}sendInput(e){this.connection.sendInput(e)}disconnect(){this.connection.disconnect()}}const Xr=14,Jr=18,Ja=30,Cd=[{id:"blank",name:"Blank",imageFile:"blank.png"},{id:"pop-culture",name:"Pop Culture",imageFile:"pop-culture.png"},{id:"selva",name:"Selva",imageFile:"selva.png"},{id:"bricks",name:"Bricks",imageFile:"bricks.png"},{id:"bus",name:"Bus",imageFile:"bus.png"},{id:"dentistry",name:"Dentistry",imageFile:"dentistry.png"},{id:"warzone",name:"Warzone",imageFile:"warzone.png"},{id:"portals",name:"Portals",imageFile:"portals.png"}],Nr=Cd.map(l=>({id:l.id,name:l.name,imagePath:`/tron-revival/assets/levels/${l.imageFile}`})),ls=[{name:"Crossing",sprite:"crossing",category:"automatic",duration:2100,pickupSound:"shield"},{name:"Shield",sprite:"shield",category:"automatic",duration:2100,pickupSound:"shield"},{name:"Eraser",sprite:"eraser",category:"automatic",duration:0,pickupSound:"reset"},{name:"Swap",sprite:"random_item",category:"automatic",duration:0,pickupSound:"teleport"},{name:"Bodyguard",sprite:"bodyguard_item",category:"automatic",duration:0,pickupSound:"item_pickup"},{name:"Control Reversal",sprite:"reverse",category:"automatic",duration:700,pickupSound:"item_pickup"},{name:"Slow",sprite:"automatic_slow",category:"automatic",duration:1400,pickupSound:"slow"},{name:"Turbo",sprite:"automatic_turbo",category:"automatic",duration:1400,pickupSound:"turbo"}],Dn=[{name:"Glock",sprite:"glock",category:"weapon",ammo:20,useSound:"glock"},{name:"Rifle",sprite:"rifle",category:"weapon",ammo:200,useSound:"rifle"},{name:"Bomb",sprite:"bomb",category:"weapon",ammo:1,useSound:"bomb"},{name:"Lock Borders",sprite:"lock_borders",category:"weapon",ammo:1},{name:"Shotgun",sprite:"shotgun",category:"weapon",ammo:20,useSound:"shotgun"},{name:"Uzi",sprite:"uzi",category:"weapon",duration:700,useSound:"uzi",loopSound:!0},{name:"Turbo",sprite:"turbo",category:"weapon",duration:700,useSound:"slow"},{name:"Slow",sprite:"slow",category:"weapon",duration:700,useSound:"turbo"}],Ct=15,Rd=6,Ld=80,Qa=l=>{l=1831565813+(l|=0)|0;let e=Math.imul(l^l>>>15,1|l);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296};class Bd{constructor(e){this.dictionaries=void 0,this.length=void 0,this.separator=void 0,this.style=void 0,this.seed=void 0;const{length:t,separator:i,dictionaries:r,style:n,seed:o}=e;this.dictionaries=r,this.separator=i,this.length=t,this.style=n,this.seed=o}generate(){if(!this.dictionaries)throw new Error('Cannot find any dictionary. Please provide at least one, or leave the "dictionary" field empty in the config object');if(this.length<=0)throw new Error("Invalid length provided");if(this.length>this.dictionaries.length)throw new Error(`The length cannot be bigger than the number of dictionaries.
Length provided: ${this.length}. Number of dictionaries provided: ${this.dictionaries.length}`);let e=this.seed;return this.dictionaries.slice(0,this.length).reduce((t,i)=>{let r;e?(r=(o=>{if(typeof o=="string"){const a=o.split("").map(c=>c.charCodeAt(0)).reduce((c,u)=>c+u,1),s=Math.floor(Number(a));return Qa(s)}return Qa(o)})(e),e=4294967296*r):r=Math.random();let n=i[Math.floor(r*i.length)]||"";if(this.style==="lowerCase")n=n.toLowerCase();else if(this.style==="capital"){const[o,...a]=n.split("");n=o.toUpperCase()+a.join("")}else this.style==="upperCase"&&(n=n.toUpperCase());return t?`${t}${this.separator}${n}`:`${n}`},"")}}const Za={separator:"_",dictionaries:[]},Ud=l=>{const e=[...l&&l.dictionaries||Za.dictionaries],t={...Za,...l,length:l&&l.length||e.length,dictionaries:e};if(!l||!l.dictionaries||!l.dictionaries.length)throw new Error('A "dictionaries" array must be provided. This is a breaking change introduced starting from Unique Name Generator v4. Read more about the breaking change here: https://github.com/andreasonny83/unique-names-generator#migration-guide');return new Bd(t).generate()};var Dd=["able","above","absent","absolute","abstract","abundant","academic","acceptable","accepted","accessible","accurate","accused","active","actual","acute","added","additional","adequate","adjacent","administrative","adorable","advanced","adverse","advisory","aesthetic","afraid","aggregate","aggressive","agreeable","agreed","agricultural","alert","alive","alleged","allied","alone","alright","alternative","amateur","amazing","ambitious","amused","ancient","angry","annoyed","annual","anonymous","anxious","appalling","apparent","applicable","appropriate","arbitrary","architectural","armed","arrogant","artificial","artistic","ashamed","asleep","assistant","associated","atomic","attractive","automatic","autonomous","available","average","awake","aware","awful","awkward","back","bad","balanced","bare","basic","beautiful","beneficial","better","bewildered","big","binding","biological","bitter","bizarre","blank","blind","blonde","bloody","blushing","boiling","bold","bored","boring","bottom","brainy","brave","breakable","breezy","brief","bright","brilliant","broad","broken","bumpy","burning","busy","calm","capable","capitalist","careful","casual","causal","cautious","central","certain","changing","characteristic","charming","cheap","cheerful","chemical","chief","chilly","chosen","christian","chronic","chubby","circular","civic","civil","civilian","classic","classical","clean","clear","clever","clinical","close","closed","cloudy","clumsy","coastal","cognitive","coherent","cold","collective","colonial","colorful","colossal","coloured","colourful","combative","combined","comfortable","coming","commercial","common","communist","compact","comparable","comparative","compatible","competent","competitive","complete","complex","complicated","comprehensive","compulsory","conceptual","concerned","concrete","condemned","confident","confidential","confused","conscious","conservation","conservative","considerable","consistent","constant","constitutional","contemporary","content","continental","continued","continuing","continuous","controlled","controversial","convenient","conventional","convinced","convincing","cooing","cool","cooperative","corporate","correct","corresponding","costly","courageous","crazy","creative","creepy","criminal","critical","crooked","crowded","crucial","crude","cruel","cuddly","cultural","curious","curly","current","curved","cute","daily","damaged","damp","dangerous","dark","dead","deaf","deafening","dear","decent","decisive","deep","defeated","defensive","defiant","definite","deliberate","delicate","delicious","delighted","delightful","democratic","dependent","depressed","desirable","desperate","detailed","determined","developed","developing","devoted","different","difficult","digital","diplomatic","direct","dirty","disabled","disappointed","disastrous","disciplinary","disgusted","distant","distinct","distinctive","distinguished","disturbed","disturbing","diverse","divine","dizzy","domestic","dominant","double","doubtful","drab","dramatic","dreadful","driving","drunk","dry","dual","due","dull","dusty","dutch","dying","dynamic","eager","early","eastern","easy","economic","educational","eerie","effective","efficient","elaborate","elated","elderly","eldest","electoral","electric","electrical","electronic","elegant","eligible","embarrassed","embarrassing","emotional","empirical","empty","enchanting","encouraging","endless","energetic","enormous","enthusiastic","entire","entitled","envious","environmental","equal","equivalent","essential","established","estimated","ethical","ethnic","eventual","everyday","evident","evil","evolutionary","exact","excellent","exceptional","excess","excessive","excited","exciting","exclusive","existing","exotic","expected","expensive","experienced","experimental","explicit","extended","extensive","external","extra","extraordinary","extreme","exuberant","faint","fair","faithful","familiar","famous","fancy","fantastic","far","fascinating","fashionable","fast","fat","fatal","favourable","favourite","federal","fellow","female","feminist","few","fierce","filthy","final","financial","fine","firm","fiscal","fit","fixed","flaky","flat","flexible","fluffy","fluttering","flying","following","fond","foolish","foreign","formal","formidable","forthcoming","fortunate","forward","fragile","frail","frantic","free","frequent","fresh","friendly","frightened","front","frozen","full","fun","functional","fundamental","funny","furious","future","fuzzy","gastric","gay","general","generous","genetic","gentle","genuine","geographical","giant","gigantic","given","glad","glamorous","gleaming","global","glorious","golden","good","gorgeous","gothic","governing","graceful","gradual","grand","grateful","greasy","great","grieving","grim","gross","grotesque","growing","grubby","grumpy","guilty","handicapped","handsome","happy","hard","harsh","head","healthy","heavy","helpful","helpless","hidden","high","hilarious","hissing","historic","historical","hollow","holy","homeless","homely","hon","honest","horizontal","horrible","hostile","hot","huge","human","hungry","hurt","hushed","husky","icy","ideal","identical","ideological","ill","illegal","imaginative","immediate","immense","imperial","implicit","important","impossible","impressed","impressive","improved","inadequate","inappropriate","inc","inclined","increased","increasing","incredible","independent","indirect","individual","industrial","inevitable","influential","informal","inherent","initial","injured","inland","inner","innocent","innovative","inquisitive","instant","institutional","insufficient","intact","integral","integrated","intellectual","intelligent","intense","intensive","interested","interesting","interim","interior","intermediate","internal","international","intimate","invisible","involved","irrelevant","isolated","itchy","jealous","jittery","joint","jolly","joyous","judicial","juicy","junior","just","keen","key","kind","known","labour","large","late","latin","lazy","leading","left","legal","legislative","legitimate","lengthy","lesser","level","lexical","liable","liberal","light","like","likely","limited","linear","linguistic","liquid","literary","little","live","lively","living","local","logical","lonely","long","loose","lost","loud","lovely","low","loyal","ltd","lucky","mad","magic","magnetic","magnificent","main","major","male","mammoth","managerial","managing","manual","many","marginal","marine","marked","married","marvellous","marxist","mass","massive","mathematical","mature","maximum","mean","meaningful","mechanical","medical","medieval","melodic","melted","mental","mere","metropolitan","mid","middle","mighty","mild","military","miniature","minimal","minimum","ministerial","minor","miserable","misleading","missing","misty","mixed","moaning","mobile","moderate","modern","modest","molecular","monetary","monthly","moral","motionless","muddy","multiple","mushy","musical","mute","mutual","mysterious","naked","narrow","nasty","national","native","natural","naughty","naval","near","nearby","neat","necessary","negative","neighbouring","nervous","net","neutral","new","nice","noble","noisy","normal","northern","nosy","notable","novel","nuclear","numerous","nursing","nutritious","nutty","obedient","objective","obliged","obnoxious","obvious","occasional","occupational","odd","official","ok","okay","old","olympic","only","open","operational","opposite","optimistic","oral","ordinary","organic","organisational","original","orthodox","other","outdoor","outer","outrageous","outside","outstanding","overall","overseas","overwhelming","painful","pale","panicky","parallel","parental","parliamentary","partial","particular","passing","passive","past","patient","payable","peaceful","peculiar","perfect","permanent","persistent","personal","petite","philosophical","physical","plain","planned","plastic","pleasant","pleased","poised","polite","political","poor","popular","positive","possible","potential","powerful","practical","precious","precise","preferred","pregnant","preliminary","premier","prepared","present","presidential","pretty","previous","prickly","primary","prime","primitive","principal","printed","prior","private","probable","productive","professional","profitable","profound","progressive","prominent","promising","proper","proposed","prospective","protective","protestant","proud","provincial","psychiatric","psychological","public","puny","pure","purring","puzzled","quaint","qualified","quarrelsome","querulous","quick","quickest","quiet","quintessential","quixotic","racial","radical","rainy","random","rapid","rare","raspy","rational","ratty","raw","ready","real","realistic","rear","reasonable","recent","reduced","redundant","regional","registered","regular","regulatory","related","relative","relaxed","relevant","reliable","relieved","religious","reluctant","remaining","remarkable","remote","renewed","representative","repulsive","required","resident","residential","resonant","respectable","respective","responsible","resulting","retail","retired","revolutionary","rich","ridiculous","right","rigid","ripe","rising","rival","roasted","robust","rolling","romantic","rotten","rough","round","royal","rubber","rude","ruling","running","rural","sacred","sad","safe","salty","satisfactory","satisfied","scared","scary","scattered","scientific","scornful","scrawny","screeching","secondary","secret","secure","select","selected","selective","selfish","semantic","senior","sensible","sensitive","separate","serious","severe","sexual","shaggy","shaky","shallow","shared","sharp","sheer","shiny","shivering","shocked","short","shrill","shy","sick","significant","silent","silky","silly","similar","simple","single","skilled","skinny","sleepy","slight","slim","slimy","slippery","slow","small","smart","smiling","smoggy","smooth","social","socialist","soft","solar","sole","solid","sophisticated","sore","sorry","sound","sour","southern","soviet","spare","sparkling","spatial","special","specific","specified","spectacular","spicy","spiritual","splendid","spontaneous","sporting","spotless","spotty","square","squealing","stable","stale","standard","static","statistical","statutory","steady","steep","sticky","stiff","still","stingy","stormy","straight","straightforward","strange","strategic","strict","striking","striped","strong","structural","stuck","stupid","subjective","subsequent","substantial","subtle","successful","successive","sudden","sufficient","suitable","sunny","super","superb","superior","supporting","supposed","supreme","sure","surprised","surprising","surrounding","surviving","suspicious","sweet","swift","symbolic","sympathetic","systematic","tall","tame","tart","tasteless","tasty","technical","technological","teenage","temporary","tender","tense","terrible","territorial","testy","then","theoretical","thick","thin","thirsty","thorough","thoughtful","thoughtless","thundering","tight","tiny","tired","top","tory","total","tough","toxic","traditional","tragic","tremendous","tricky","tropical","troubled","typical","ugliest","ugly","ultimate","unable","unacceptable","unaware","uncertain","unchanged","uncomfortable","unconscious","underground","underlying","unemployed","uneven","unexpected","unfair","unfortunate","unhappy","uniform","uninterested","unique","united","universal","unknown","unlikely","unnecessary","unpleasant","unsightly","unusual","unwilling","upper","upset","uptight","urban","urgent","used","useful","useless","usual","vague","valid","valuable","variable","varied","various","varying","vast","verbal","vertical","very","vicarious","vicious","victorious","violent","visible","visiting","visual","vital","vitreous","vivacious","vivid","vocal","vocational","voiceless","voluminous","voluntary","vulnerable","wandering","warm","wasteful","watery","weak","wealthy","weary","wee","weekly","weird","welcome","well","western","wet","whispering","whole","wicked","wide","widespread","wild","wilful","willing","willowy","wily","wise","wispy","wittering","witty","wonderful","wooden","working","worldwide","worried","worrying","worthwhile","worthy","written","wrong","xenacious","xenial","xenogeneic","xenophobic","xeric","xerothermic","yabbering","yammering","yappiest","yappy","yawning","yearling","yearning","yeasty","yelling","yelping","yielding","yodelling","young","youngest","youthful","ytterbic","yucky","yummy","zany","zealous","zeroth","zestful","zesty","zippy","zonal","zoophagous","zygomorphic","zygotic"],Nd=["aardvark","aardwolf","albatross","alligator","alpaca","amphibian","anaconda","angelfish","anglerfish","ant","anteater","antelope","antlion","ape","aphid","armadillo","asp","baboon","badger","bandicoot","barnacle","barracuda","basilisk","bass","bat","bear","beaver","bedbug","bee","beetle","bird","bison","blackbird","boa","boar","bobcat","bobolink","bonobo","booby","bovid","bug","butterfly","buzzard","camel","canid","canidae","capybara","cardinal","caribou","carp","cat","caterpillar","catfish","catshark","cattle","centipede","cephalopod","chameleon","cheetah","chickadee","chicken","chimpanzee","chinchilla","chipmunk","cicada","clam","clownfish","cobra","cockroach","cod","condor","constrictor","coral","cougar","cow","coyote","crab","crane","crawdad","crayfish","cricket","crocodile","crow","cuckoo","damselfly","deer","dingo","dinosaur","dog","dolphin","donkey","dormouse","dove","dragon","dragonfly","duck","eagle","earthworm","earwig","echidna","eel","egret","elephant","elk","emu","ermine","falcon","felidae","ferret","finch","firefly","fish","flamingo","flea","fly","flyingfish","fowl","fox","frog","galliform","gamefowl","gayal","gazelle","gecko","gerbil","gibbon","giraffe","goat","goldfish","goose","gopher","gorilla","grasshopper","grouse","guan","guanaco","guineafowl","gull","guppy","haddock","halibut","hamster","hare","harrier","hawk","hedgehog","heron","herring","hippopotamus","hookworm","hornet","horse","hoverfly","hummingbird","hyena","iguana","impala","jackal","jaguar","jay","jellyfish","junglefowl","kangaroo","kingfisher","kite","kiwi","koala","koi","krill","ladybug","lamprey","landfowl","lark","leech","lemming","lemur","leopard","leopon","limpet","lion","lizard","llama","lobster","locust","loon","louse","lungfish","lynx","macaw","mackerel","magpie","mammal","manatee","mandrill","marlin","marmoset","marmot","marsupial","marten","mastodon","meadowlark","meerkat","mink","minnow","mite","mockingbird","mole","mollusk","mongoose","monkey","moose","mosquito","moth","mouse","mule","muskox","narwhal","newt","nightingale","ocelot","octopus","opossum","orangutan","orca","ostrich","otter","owl","ox","panda","panther","parakeet","parrot","parrotfish","partridge","peacock","peafowl","pelican","penguin","perch","pheasant","pig","pigeon","pike","pinniped","piranha","planarian","platypus","pony","porcupine","porpoise","possum","prawn","primate","ptarmigan","puffin","puma","python","quail","quelea","quokka","rabbit","raccoon","rat","rattlesnake","raven","reindeer","reptile","rhinoceros","roadrunner","rodent","rook","rooster","roundworm","sailfish","salamander","salmon","sawfish","scallop","scorpion","seahorse","shark","sheep","shrew","shrimp","silkworm","silverfish","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sole","sparrow","spider","spoonbill","squid","squirrel","starfish","stingray","stoat","stork","sturgeon","swallow","swan","swift","swordfish","swordtail","tahr","takin","tapir","tarantula","tarsier","termite","tern","thrush","tick","tiger","tiglon","toad","tortoise","toucan","trout","tuna","turkey","turtle","tyrannosaurus","unicorn","urial","vicuna","viper","vole","vulture","wallaby","walrus","warbler","wasp","weasel","whale","whippet","whitefish","wildcat","wildebeest","wildfowl","wolf","wolverine","wombat","woodpecker","worm","wren","xerinae","yak","zebra"];function Qn(){return Ud({dictionaries:[Dd,Nd],separator:"",style:"capital",length:2})}class jd{constructor(e,t,i){M(this,"container");M(this,"screenManager");M(this,"options");M(this,"connection");M(this,"lobbyState",null);M(this,"myNickname","");M(this,"connectionTimeoutId",null);this.container=e,this.screenManager=t,this.options=i,this.connection=new Md(i.mode==="host")}render(){this.myNickname=localStorage.getItem("teratron-nickname")||Qn(),this.container.innerHTML=`
      <style>
        .lobby-container {
          display: flex;
          flex-direction: column;
          min-height: 100vh;
          padding: 1rem;
        }
        .lobby-title {
          color: #0ff;
          text-shadow: 0 0 10px #0ff;
          margin-bottom: 1rem;
          text-align: center;
          font-size: 2rem;
        }
        .lobby-status {
          text-align: center;
          color: #ff0;
          margin-bottom: 1rem;
        }
        .lobby-grid {
          display: none;
          flex: 1;
          display: grid;
          grid-template-columns: 250px 350px 300px;
          gap: 1rem;
          max-width: 1200px;
          margin: 0 auto;
          width: 100%;
        }
        .lobby-panel {
          background: #111;
          padding: 1rem;
          border-radius: 4px;
          border: 1px solid #333;
        }
        .lobby-panel-chat {
          display: flex;
          flex-direction: column;
        }
        /* Tablet: 2 columns, chat below */
        @media (max-width: 950px) {
          .lobby-grid {
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
          }
          .lobby-panel-chat {
            grid-column: 1 / -1;
          }
        }
        /* Mobile: single column */
        @media (max-width: 600px) {
          .lobby-container {
            padding: 0.5rem;
          }
          .lobby-title {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
          }
          .lobby-grid {
            grid-template-columns: 1fr;
            gap: 0.75rem;
          }
          .lobby-panel {
            padding: 0.75rem;
          }
          .lobby-panel-chat {
            grid-column: auto;
            max-height: 300px;
          }
          /* Make buttons and inputs touch-friendly */
          .lobby-panel button {
            min-height: 44px;
            font-size: 0.9rem;
          }
          .lobby-panel input {
            min-height: 44px;
            font-size: 16px; /* Prevents iOS zoom */
          }
          .lobby-panel h3 {
            font-size: 1rem;
          }
          .lobby-panel label {
            font-size: 0.8rem;
          }
        }
      </style>
      <div class="lobby-container">
        <h1 class="lobby-title">LOBBY</h1>

        <div id="connectionStatus" class="lobby-status">Connecting...</div>

        <div id="lobbyContent" class="lobby-grid">
          <!-- Left Panel: Settings/Info -->
          <div id="settingsPanel" class="lobby-panel"></div>

          <!-- Center Panel: Player Slots -->
          <div id="playersPanel" class="lobby-panel"></div>

          <!-- Right Panel: Chat -->
          <div id="chatPanel" class="lobby-panel lobby-panel-chat"></div>
        </div>
      </div>
    `,this.setupConnection()}setupConnection(){if(this.connection.setCallbacks({onStatusChange:e=>{console.log("[NetworkLobby] Status changed:",e);const t=document.getElementById("connectionStatus");t&&(e==="connecting"?(t.textContent="Connecting...",t.style.color="#ff0"):e==="connected"?this.options.mode==="host"?(t.textContent="Room created - Waiting for players...",t.style.color="#0f0",document.getElementById("lobbyContent").style.display="grid"):(t.textContent="Connecting...",t.style.color="#ff0",document.getElementById("lobbyContent").style.display="grid",this.updateUI()):(t.textContent="Disconnected",t.style.color="#f44"))},onLobbyStateUpdate:e=>{console.log("[NetworkLobby] Received lobby state:",e);const t=this.lobbyState===null;this.lobbyState=e;const i=document.getElementById("lobbyContent");i&&(i.style.display="grid");const r=document.getElementById("connectionStatus");r&&(r.textContent="Connected",r.style.color="#0f0"),t&&this.options.mode==="guest"&&(this.connectionTimeoutId!==null&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.connection.announce(this.myNickname),this.autoJoinFirstSlot()),this.updateUI()},onJoinAccepted:(e,t)=>{console.log("[NetworkLobby] Joined as slot",t)},onJoinRejected:e=>{alert(`Could not join: ${e}`),this.screenManager.showMainMenu()},onGameStart:e=>{if(this.lobbyState){const{gameConfig:t,gameConnection:i}=this.createGameSession();this.screenManager.showGame(t,i)}},onHostDisconnected:()=>{alert("Host disconnected"),this.screenManager.showMainMenu()},onError:e=>{console.error("[NetworkLobby] Error:",e),alert(`Connection error: ${e}`)}}),this.options.mode==="host"){const e=this.connection.createRoom(this.myNickname);console.log("[NetworkLobby] Created room:",e),this.connection.announce(this.myNickname),this.autoJoinFirstSlot()}else this.options.roomId&&(this.connection.joinRoom(this.options.roomId,this.myNickname),this.connectionTimeoutId=window.setTimeout(()=>{this.lobbyState===null&&(console.log("[NetworkLobby] Connection timeout - no lobby data received"),this.connection.disconnect(),this.screenManager.showMainMenu())},2e4))}updateUI(){this.renderSettingsPanel(),this.renderPlayersPanel(),this.renderChatPanel()}renderSettingsPanel(){const e=document.getElementById("settingsPanel");if(!e)return;const t=this.connection.isHostMode(),i=!this.lobbyState,r=this.lobbyState?.roomId||this.options.roomId||"",n=this.lobbyState?.levelMode||"cycle",o=`${window.location.origin}${window.location.pathname}?room=${r}`;if(i&&!t){e.innerHTML=`
        <h3 style="color: #0ff; margin-bottom: 1rem;">Info</h3>

        <div style="margin-bottom: 1rem;">
          <label style="color: #888; display: block; margin-bottom: 0.5rem;">Game Mode:</label>
          <div style="display: flex; gap: 0.5rem;">
            <button disabled style="flex: 1; padding: 0.5rem; font-family: monospace; cursor: not-allowed; background: #111; color: #444; border: 1px solid #333;">FFA</button>
            <button disabled style="flex: 1; padding: 0.5rem; font-family: monospace; cursor: not-allowed; background: #111; color: #444; border: 1px solid #333;">TEAMS</button>
          </div>
        </div>

        <div style="margin-bottom: 1rem;">
          <label style="color: #888; display: block; margin-bottom: 0.5rem;">Level:</label>
          <select disabled style="width: 100%; padding: 0.5rem; font-family: monospace; background: #000; color: #666; border: 1px solid #333; cursor: not-allowed;">
            <option>Loading...</option>
          </select>
        </div>

        <div style="margin-bottom: 1rem;">
          <label style="color: #888; display: block; margin-bottom: 0.5rem;">Your Nickname:</label>
          <div style="display: flex; gap: 0.5rem;">
            <input id="nicknameInput" type="text" value="${this.myNickname}" disabled style="flex: 1; padding: 0.5rem; font-family: monospace; background: #000; color: #666; border: 1px solid #333; box-sizing: border-box;" />
            <button disabled style="padding: 0.5rem; font-family: monospace; cursor: not-allowed; background: #111; color: #444; border: 1px solid #333; font-size: 1rem;"></button>
          </div>
        </div>

        <div style="margin-bottom: 1rem;">
          <label style="color: #888; display: block; margin-bottom: 0.5rem;">Room Code:</label>
          <div style="background: #000; padding: 0.5rem; border: 1px solid #333; color: #0f0; font-family: monospace; text-align: center; letter-spacing: 0.1em;">${r}</div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
            <button id="copyCodeBtn" style="flex: 1; padding: 0.5rem; font-family: monospace; cursor: pointer; background: #002; color: #08f; border: 1px solid #08f;"> CODE</button>
            <button id="copyLinkBtn" style="flex: 1; padding: 0.5rem; font-family: monospace; cursor: pointer; background: #002; color: #08f; border: 1px solid #08f;"> LINK</button>
          </div>
        </div>

        <div style="background: #110; padding: 1rem; border: 1px solid #440; border-radius: 4px; color: #ff0; text-align: center; margin-bottom: 1rem;">
          Connecting to room...
        </div>

        <button id="disconnectBtn" style="width: 100%; padding: 0.5rem; font-family: monospace; cursor: pointer; background: #200; color: #f44; border: 1px solid #f44;">DISCONNECT</button>
      `,this.setupCopyButtons(r,o),document.getElementById("disconnectBtn")?.addEventListener("click",()=>{this.connection.disconnect(),this.screenManager.showMainMenu()});return}this.lobbyState&&(t?(e.innerHTML=`
        <h3 style="color: #0ff; margin-bottom: 1rem;">Settings</h3>

        <div style="margin-bottom: 1rem;">
          <label style="color: #888; display: block; margin-bottom: 0.5rem;">Game Mode:</label>
          <div style="display: flex; gap: 0.5rem;">
            <button id="ffaBtn" style="
              flex: 1;
              padding: 0.5rem;
              font-family: monospace;
              cursor: pointer;
              background: ${this.lobbyState.gameMode==="ffa"?"#030":"#111"};
              color: ${this.lobbyState.gameMode==="ffa"?"#0f0":"#666"};
              border: 1px solid ${this.lobbyState.gameMode==="ffa"?"#0f0":"#333"};
            ">FFA</button>
            <button id="teamBtn" style="
              flex: 1;
              padding: 0.5rem;
              font-family: monospace;
              cursor: pointer;
              background: ${this.lobbyState.gameMode==="team"?"#030":"#111"};
              color: ${this.lobbyState.gameMode==="team"?"#0f0":"#666"};
              border: 1px solid ${this.lobbyState.gameMode==="team"?"#0f0":"#333"};
            ">TEAMS</button>
          </div>
        </div>

        <div style="margin-bottom: 1rem;">
          <label style="color: #888; display: block; margin-bottom: 0.5rem;">Level:</label>
          <select id="levelSelect" style="
            width: 100%;
            padding: 0.5rem;
            font-family: monospace;
            background: #000;
            color: #0ff;
            border: 1px solid #0ff;
            cursor: pointer;
          ">
            <option value="cycle" ${n==="cycle"?"selected":""}>Cycle All</option>
            ${Nr.map(a=>`<option value="${a.id}" ${n===a.id?"selected":""}>${a.name}</option>`).join("")}
          </select>
        </div>

        <div style="margin-bottom: 1rem;">
          <label style="color: #888; display: block; margin-bottom: 0.5rem;">Your Nickname:</label>
          <div style="display: flex; gap: 0.5rem;">
            <input id="nicknameInput" type="text" value="${this.myNickname}" style="
              flex: 1;
              padding: 0.5rem;
              font-family: monospace;
              background: #000;
              color: #0ff;
              border: 1px solid #0ff;
              box-sizing: border-box;
            " />
            <button id="randomNicknameBtn" title="Generate random nickname" style="
              padding: 0.5rem;
              font-family: monospace;
              cursor: pointer;
              background: #002;
              color: #08f;
              border: 1px solid #08f;
              font-size: 1rem;
            "></button>
          </div>
        </div>

        <div style="margin-bottom: 1rem;">
          <label style="color: #888; display: block; margin-bottom: 0.5rem;">Room Code:</label>
          <div style="
            background: #000;
            padding: 0.5rem;
            border: 1px solid #333;
            color: #0f0;
            font-family: monospace;
            word-break: break-all;
            text-align: center;
            letter-spacing: 0.1em;
          ">${r}</div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
            <button id="copyCodeBtn" style="
              flex: 1;
              padding: 0.5rem;
              font-family: monospace;
              cursor: pointer;
              background: #002;
              color: #08f;
              border: 1px solid #08f;
            "> CODE</button>
            <button id="copyLinkBtn" style="
              flex: 1;
              padding: 0.5rem;
              font-family: monospace;
              cursor: pointer;
              background: #002;
              color: #08f;
              border: 1px solid #08f;
            "> LINK</button>
          </div>
        </div>

        <button id="startGameBtn" style="
          width: 100%;
          padding: 1rem;
          font-size: 1.1rem;
          font-family: monospace;
          cursor: ${ir(this.lobbyState)?"pointer":"not-allowed"};
          background: ${ir(this.lobbyState)?"#030":"#111"};
          color: ${ir(this.lobbyState)?"#0f0":"#666"};
          border: 2px solid ${ir(this.lobbyState)?"#0f0":"#333"};
          margin-bottom: 0.5rem;
        " ${ir(this.lobbyState)?"":"disabled"}>
          START GAME
          ${this.lobbyState.gameMode==="team"&&Kc(this.lobbyState)<4?'<br><span style="font-size: 0.7rem;">(needs 4 players)</span>':""}
        </button>

        <button id="disconnectBtn" style="
          width: 100%;
          padding: 0.5rem;
          font-family: monospace;
          cursor: pointer;
          background: #200;
          color: #f44;
          border: 1px solid #f44;
        ">DISCONNECT</button>
      `,document.getElementById("ffaBtn")?.addEventListener("click",()=>{this.connection.setGameMode("ffa")}),document.getElementById("teamBtn")?.addEventListener("click",()=>{this.connection.setGameMode("team")}),document.getElementById("levelSelect")?.addEventListener("change",a=>{const s=a.target.value;this.connection.setLevelMode(s)}),document.getElementById("nicknameInput")?.addEventListener("change",a=>{const s=a.target.value.trim();s&&(this.myNickname=s,localStorage.setItem("teratron-nickname",s),this.connection.sendNicknameChange(s))}),document.getElementById("randomNicknameBtn")?.addEventListener("click",()=>{const a=Qn();this.myNickname=a,localStorage.setItem("teratron-nickname",a),this.connection.sendNicknameChange(a);const s=document.getElementById("nicknameInput");s&&(s.value=a)}),document.getElementById("copyCodeBtn")?.addEventListener("click",()=>{navigator.clipboard.writeText(r).then(()=>{const a=document.getElementById("copyCodeBtn");a&&(a.textContent=" COPIED",setTimeout(()=>{a.textContent=" CODE"},2e3))})}),document.getElementById("copyLinkBtn")?.addEventListener("click",()=>{navigator.clipboard.writeText(o).then(()=>{const a=document.getElementById("copyLinkBtn");a&&(a.textContent=" COPIED",setTimeout(()=>{a.textContent=" LINK"},2e3))})}),document.getElementById("startGameBtn")?.addEventListener("click",()=>{ir(this.lobbyState)&&this.connection.startGame()}),document.getElementById("disconnectBtn")?.addEventListener("click",()=>{this.connection.disconnect(),this.screenManager.showMainMenu()})):(e.innerHTML=`
        <h3 style="color: #0ff; margin-bottom: 1rem;">Info</h3>

        <div style="margin-bottom: 1rem;">
          <label style="color: #888; display: block; margin-bottom: 0.5rem;">Game Mode:</label>
          <div style="display: flex; gap: 0.5rem;">
            <button disabled style="
              flex: 1;
              padding: 0.5rem;
              font-family: monospace;
              cursor: not-allowed;
              background: ${this.lobbyState.gameMode==="ffa"?"#020":"#111"};
              color: ${this.lobbyState.gameMode==="ffa"?"#0a0":"#444"};
              border: 1px solid ${this.lobbyState.gameMode==="ffa"?"#0a0":"#333"};
            ">FFA</button>
            <button disabled style="
              flex: 1;
              padding: 0.5rem;
              font-family: monospace;
              cursor: not-allowed;
              background: ${this.lobbyState.gameMode==="team"?"#020":"#111"};
              color: ${this.lobbyState.gameMode==="team"?"#0a0":"#444"};
              border: 1px solid ${this.lobbyState.gameMode==="team"?"#0a0":"#333"};
            ">TEAMS</button>
          </div>
        </div>

        <div style="margin-bottom: 1rem;">
          <label style="color: #888; display: block; margin-bottom: 0.5rem;">Level:</label>
          <select disabled style="
            width: 100%;
            padding: 0.5rem;
            font-family: monospace;
            background: #000;
            color: #666;
            border: 1px solid #333;
            cursor: not-allowed;
          ">
            <option>${n==="cycle"?"Cycle All":Nr.find(a=>a.id===n)?.name||n}</option>
          </select>
        </div>

        <div style="margin-bottom: 1rem;">
          <label style="color: #888; display: block; margin-bottom: 0.5rem;">Your Nickname:</label>
          <div style="display: flex; gap: 0.5rem;">
            <input id="nicknameInput" type="text" value="${this.myNickname}" style="
              flex: 1;
              padding: 0.5rem;
              font-family: monospace;
              background: #000;
              color: #0ff;
              border: 1px solid #0ff;
              box-sizing: border-box;
            " />
            <button id="randomNicknameBtn" title="Generate random nickname" style="
              padding: 0.5rem;
              font-family: monospace;
              cursor: pointer;
              background: #002;
              color: #08f;
              border: 1px solid #08f;
              font-size: 1rem;
            "></button>
          </div>
        </div>

        <div style="margin-bottom: 1rem;">
          <label style="color: #888; display: block; margin-bottom: 0.5rem;">Room Code:</label>
          <div style="
            background: #000;
            padding: 0.5rem;
            border: 1px solid #333;
            color: #0f0;
            font-family: monospace;
            word-break: break-all;
            text-align: center;
            letter-spacing: 0.1em;
          ">${r}</div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
            <button id="copyCodeBtn" style="
              flex: 1;
              padding: 0.5rem;
              font-family: monospace;
              cursor: pointer;
              background: #002;
              color: #08f;
              border: 1px solid #08f;
            "> CODE</button>
            <button id="copyLinkBtn" style="
              flex: 1;
              padding: 0.5rem;
              font-family: monospace;
              cursor: pointer;
              background: #002;
              color: #08f;
              border: 1px solid #08f;
            "> LINK</button>
          </div>
        </div>

        <div style="
          background: #110;
          padding: 1rem;
          border: 1px solid #440;
          border-radius: 4px;
          color: #ff0;
          text-align: center;
          margin-bottom: 1rem;
        ">
          Waiting for host to start...
        </div>

        <button id="disconnectBtn" style="
          width: 100%;
          padding: 0.5rem;
          font-family: monospace;
          cursor: pointer;
          background: #200;
          color: #f44;
          border: 1px solid #f44;
        ">DISCONNECT</button>
      `,document.getElementById("nicknameInput")?.addEventListener("change",a=>{const s=a.target.value.trim();s&&(this.myNickname=s,localStorage.setItem("teratron-nickname",s),this.connection.sendNicknameChange(s))}),document.getElementById("randomNicknameBtn")?.addEventListener("click",()=>{const a=Qn();this.myNickname=a,localStorage.setItem("teratron-nickname",a),this.connection.sendNicknameChange(a);const s=document.getElementById("nicknameInput");s&&(s.value=a)}),document.getElementById("copyCodeBtn")?.addEventListener("click",()=>{navigator.clipboard.writeText(r).then(()=>{const a=document.getElementById("copyCodeBtn");a&&(a.textContent=" COPIED",setTimeout(()=>{a.textContent=" CODE"},2e3))})}),document.getElementById("copyLinkBtn")?.addEventListener("click",()=>{navigator.clipboard.writeText(o).then(()=>{const a=document.getElementById("copyLinkBtn");a&&(a.textContent=" COPIED",setTimeout(()=>{a.textContent=" LINK"},2e3))})}),document.getElementById("disconnectBtn")?.addEventListener("click",()=>{this.connection.disconnect(),this.screenManager.showMainMenu()})))}setupCopyButtons(e,t){document.getElementById("copyCodeBtn")?.addEventListener("click",()=>{navigator.clipboard.writeText(e).then(()=>{const i=document.getElementById("copyCodeBtn");i&&(i.textContent=" COPIED",setTimeout(()=>{i.textContent=" CODE"},2e3))})}),document.getElementById("copyLinkBtn")?.addEventListener("click",()=>{navigator.clipboard.writeText(t).then(()=>{const i=document.getElementById("copyLinkBtn");i&&(i.textContent=" COPIED",setTimeout(()=>{i.textContent=" LINK"},2e3))})})}renderPlayersPanel(){const e=document.getElementById("playersPanel");if(!e)return;if(!this.lobbyState){e.innerHTML=`
        <h3 style="color: #0ff; margin-bottom: 1rem;">Players</h3>
        <div style="color: #666; text-align: center; padding: 2rem;">
          Waiting for lobby data...
        </div>
      `;return}const t=this.connection.isHostMode(),i=this.connection.getMySlotIndex(),r=this.lobbyState.gameMode;let n="";r==="team"?n=`
        <div style="margin-bottom: 1rem;">
          <h4 style="color: ${vr("team",0)}; margin-bottom: 0.5rem;">TEAM PURPLE</h4>
          ${this.renderSlot(0,r,i,t)}
          ${this.renderSlot(2,r,i,t)}
        </div>
        <hr style="border-color: #333; margin: 1rem 0;" />
        <div>
          <h4 style="color: ${vr("team",1)}; margin-bottom: 0.5rem;">TEAM BROWN</h4>
          ${this.renderSlot(1,r,i,t)}
          ${this.renderSlot(3,r,i,t)}
        </div>
      `:n=`
        ${this.renderSlot(0,r,i,t)}
        ${this.renderSlot(1,r,i,t)}
        ${this.renderSlot(2,r,i,t)}
        ${this.renderSlot(3,r,i,t)}
      `;const o=this.lobbyState.hostPeerId,a=this.lobbyState.spectators.map(s=>{const c=s.peerId===o;return`
        <div style="
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.75rem;
          margin-bottom: 0.5rem;
          background: #0a0a0a;
          border: 1px solid #333;
          border-radius: 4px;
        ">
          <div style="flex: 1;">
            <div style="color: #888;">${s.nickname}${c?" ":""}</div>
          </div>
        </div>
      `}).join("");e.innerHTML=`
      <h3 style="color: #0ff; margin-bottom: 1rem;">Players</h3>
      ${n}
      ${this.lobbyState.spectators.length>0?`
        <h3 style="color: #666; margin-top: 1.5rem; margin-bottom: 1rem;">Spectators</h3>
        ${a}
      `:""}
    `;for(let s=0;s<4;s++)document.getElementById(`joinSlot${s}`)?.addEventListener("click",()=>{this.connection.getMySlotIndex()===null?this.connection.joinSlot(s,this.myNickname):this.connection.changeSlot(s)}),document.getElementById(`leaveSlot${s}`)?.addEventListener("click",()=>{this.connection.leaveSlot()})}renderSlot(e,t,i,r){const n=this.lobbyState.slots[e],o=vr(t,e),a=n.peerId!==null,s=n.slotIndex===i;let c,u="";return a?(c=n.nickname||"Player",s&&(c+=" (You)"),n.isHost&&(c+=" "),s&&(u=`<button id="leaveSlot${e}" style="
          padding: 0.25rem 0.5rem;
          font-size: 0.8rem;
          font-family: monospace;
          cursor: pointer;
          background: #200;
          color: #f44;
          border: 1px solid #f44;
        ">LEAVE</button>`)):(c="Open",i!==e&&(u=`<button id="joinSlot${e}" style="
          padding: 0.25rem 0.5rem;
          font-size: 0.8rem;
          font-family: monospace;
          cursor: pointer;
          background: #002;
          color: #08f;
          border: 1px solid #08f;
        ">JOIN</button>`)),`
      <div style="
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        background: ${s?"#112":"#0a0a0a"};
        border: 1px solid ${s?"#08f":"#333"};
        border-radius: 4px;
      ">
        <div style="
          width: 20px;
          height: 20px;
          background: ${o};
          border-radius: 50%;
          box-shadow: ${a?`0 0 8px ${o}`:"none"};
        "></div>
        <div style="flex: 1;">
          <div style="color: ${a?"#fff":"#666"};">${c}</div>
        </div>
        ${u}
      </div>
    `}renderChatPanel(){const e=document.getElementById("chatPanel");if(!e)return;if(!this.lobbyState){e.innerHTML=`
        <h3 style="color: #0ff; margin-bottom: 0.5rem;">Chat</h3>
        <div style="flex: 1; overflow-y: auto; background: #000; padding: 0.5rem; border: 1px solid #333; border-radius: 4px; margin-bottom: 0.5rem; min-height: 200px;">
          <div style="color: #666; font-style: italic;">Connecting...</div>
        </div>
        <div style="display: flex; gap: 0.5rem;">
          <input disabled type="text" placeholder="Type a message..." style="flex: 1; padding: 0.5rem; font-family: monospace; background: #000; color: #666; border: 1px solid #333;" />
          <button disabled style="padding: 0.5rem 1rem; font-family: monospace; cursor: not-allowed; background: #111; color: #444; border: 1px solid #333;">SEND</button>
        </div>
      `;return}const t=this.lobbyState.gameMode,i=this.lobbyState.chatMessages;let r=i.map(s=>`
        <div style="margin-bottom: 0.5rem;">
          <span style="color: ${s.senderSlotIndex!==null?vr(t,s.senderSlotIndex):"#fff"};">${s.senderNickname}:</span>
          <span style="color: #fff;"> ${s.text}</span>
        </div>
      `).join("");i.length===0&&(r='<div style="color: #666; font-style: italic;">No messages yet...</div>'),e.innerHTML=`
      <h3 style="color: #0ff; margin-bottom: 0.5rem;">Chat</h3>
      <div id="chatMessages" class="lobby-chat-messages" style="
        flex: 1;
        overflow-y: auto;
        background: #000;
        padding: 0.5rem;
        border: 1px solid #333;
        border-radius: 4px;
        margin-bottom: 0.5rem;
        min-height: 150px;
        max-height: 300px;
      ">${r}</div>
      <div style="display: flex; gap: 0.5rem;">
        <input id="chatInput" type="text" placeholder="Type a message..." style="
          flex: 1;
          padding: 0.5rem;
          font-family: monospace;
          background: #000;
          color: #fff;
          border: 1px solid #333;
        " />
        <button id="chatSendBtn" style="
          padding: 0.5rem 1rem;
          font-family: monospace;
          cursor: pointer;
          background: #020;
          color: #0f0;
          border: 1px solid #0f0;
        ">SEND</button>
      </div>
    `;const n=document.getElementById("chatMessages");n&&(n.scrollTop=n.scrollHeight);const o=document.getElementById("chatInput"),a=()=>{const s=o.value.trim();s&&(this.connection.sendChat(s),o.value="")};document.getElementById("chatSendBtn")?.addEventListener("click",a),o?.addEventListener("keypress",s=>{s.key==="Enter"&&a()})}createGameSession(){const e=this.lobbyState,t=this.connection.getMyPeerId(),i=e.slots.filter(s=>s.peerId!==null).map(s=>({slotIndex:s.slotIndex,nickname:s.nickname,color:vr(e.gameMode,s.slotIndex),isLocal:s.peerId===t})),r=e.spectators.map(s=>({nickname:s.nickname})),n=new Map;for(const s of e.slots)s.peerId!==null&&n.set(s.peerId,s.slotIndex);const o={players:i,spectators:r,isHost:this.connection.isHostMode(),gameMode:e.gameMode,levelMode:e.levelMode},a=new Od(this.connection,n,this.connection.getMySlotIndex());return{gameConfig:o,gameConnection:a}}autoJoinFirstSlot(){if(!this.lobbyState)return;const e=Yc(this.lobbyState);e!==null&&this.connection.joinSlot(e,this.myNickname)}cleanup(){this.connectionTimeoutId!==null&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null)}}const Ae=750,Pe=600,Rt=1e3,Fd=4,el=1e3,Wd={2:[{x:50,y:50,direction:45},{x:700,y:550,direction:225}],3:[{x:50,y:50,direction:45},{x:700,y:50,direction:135},{x:50,y:550,direction:315}],4:[{x:50,y:50,direction:45},{x:700,y:50,direction:135},{x:50,y:550,direction:315},{x:700,y:550,direction:225}]},$d={x:375,y:300,direction:0};function Zn(l,e){return Wd[e]?.[l]??$d}class zd{constructor(e,t,i,r,n,o){M(this,"slotIndex");M(this,"x");M(this,"y");M(this,"direction");M(this,"alive");M(this,"color");M(this,"nickname");M(this,"trail",[]);M(this,"prevScreenX",-1);M(this,"prevScreenY",-1);M(this,"moveFrameCounter",0);M(this,"equippedWeapon",null);M(this,"activeEffects",[]);this.slotIndex=e,this.x=t*Rt,this.y=i*Rt,this.direction=r,this.alive=!0,this.color=n,this.nickname=o}getScreenX(){return Math.floor(this.x/Rt)}getScreenY(){return Math.floor(this.y/Rt)}update(e){if(!this.alive)return[];this.prevScreenX=this.getScreenX(),this.prevScreenY=this.getScreenY(),this.direction=(this.direction+e.steer*Fd+360)%360;const t=this.direction*Math.PI/180;this.x+=Math.cos(t)*el,this.y+=Math.sin(t)*el;const i=Ae*Rt,r=Pe*Rt;this.x>=i&&(this.x-=i),this.x<0&&(this.x+=i),this.y>=r&&(this.y-=r),this.y<0&&(this.y+=r);const n=this.getScreenX(),o=this.getScreenY(),a=[];if(n!==this.prevScreenX||o!==this.prevScreenY){const s={x:this.prevScreenX,y:this.prevScreenY};this.trail.push(s),a.push(s)}return a}checkCollision(e){if(!this.alive)return null;const t=this.getScreenX(),i=this.getScreenY(),r=`${t},${i}`;if(e.has(r))return r;if(this.prevScreenX<0)return null;const n=t-this.prevScreenX,o=i-this.prevScreenY;if(n!==0&&o!==0){const a=`${this.prevScreenX+n},${this.prevScreenY}`,s=`${this.prevScreenX},${this.prevScreenY+o}`;if(e.has(a))return a;if(e.has(s))return s}return null}kill(){this.alive=!1}reset(e,t,i){this.x=e*Rt,this.y=t*Rt,this.direction=i,this.alive=!0,this.trail=[],this.equippedWeapon=null,this.activeEffects=[],this.moveFrameCounter=0}equipWeapon(e,t,i){this.equippedWeapon={sprite:e,...t!==void 0&&{ammo:t},...i!==void 0&&{remainingFrames:i}}}activateEffect(e,t){t>0&&(this.activeEffects=[{sprite:e,remainingFrames:t}])}useWeapon(){return!this.equippedWeapon||!this.equippedWeapon.ammo||this.equippedWeapon.ammo<=0?!1:(this.equippedWeapon.ammo--,this.equippedWeapon.ammo<=0&&(this.equippedWeapon=null),!0)}tickWeapon(){this.equippedWeapon?.remainingFrames&&(this.equippedWeapon.remainingFrames--,this.equippedWeapon.remainingFrames<=0&&(this.equippedWeapon=null))}tickEffects(){for(const e of this.activeEffects)e.remainingFrames--;this.activeEffects=this.activeEffects.filter(e=>e.remainingFrames>0)}hasEffect(e){return this.activeEffects.some(t=>t.sprite===e)}serialize(){return{slotIndex:this.slotIndex,x:this.x,y:this.y,direction:this.direction,alive:this.alive,color:this.color,nickname:this.nickname,equippedWeapon:this.equippedWeapon,activeEffects:[...this.activeEffects]}}updateFromState(e){this.x=e.x,this.y=e.y,this.direction=e.direction,this.alive=e.alive,this.equippedWeapon=e.equippedWeapon,this.activeEffects=e.activeEffects?[...e.activeEffects]:[]}}const qd=6,tl=200,Hd=800,Gd=40;class Kd{constructor(){M(this,"nextItemId",0);M(this,"spawnTimer",0);M(this,"nextSpawnInterval",0)}spawnInitialItems(e,t){for(let i=0;i<qd;i++){const r=this.createItem(t);r&&e.push(r)}this.resetSpawnTimer()}tick(e,t){this.spawnTimer++;const i=e.filter(r=>r.active).length;if(this.spawnTimer>=this.nextSpawnInterval&&i<Rd){const r=this.createItem(t);r&&e.push(r),this.resetSpawnTimer()}}reset(){this.nextItemId=0,this.spawnTimer=0,this.nextSpawnInterval=0}resetSpawnTimer(){this.spawnTimer=0,this.nextSpawnInterval=tl+Math.floor(Math.random()*(Hd-tl))}createItem(e){const t=Math.random();let i,r;if(t<.4?(i="automatic",r=ls[Math.floor(Math.random()*ls.length)]):(i="weapon",r=Dn[Math.floor(Math.random()*Dn.length)]),!r)return null;const n=this.findValidPosition(e());if(!n)return null;const o=Math.random()<.1;return{id:this.nextItemId++,sprite:r.sprite,category:i,x:n.x,y:n.y,active:!0,hp:Gd,...o&&{mystery:o}}}findValidPosition(e){for(let r=0;r<50;r++){const n=20+Math.random()*(Ae-40),o=20+Math.random()*(Pe-40);let a=!1;for(const s of e)if(Math.sqrt((n-s.x)**2+(o-s.y)**2)<Ld){a=!0;break}if(!a)return{x:Math.floor(n),y:Math.floor(o)}}return null}}const rl={round_start:"round_start.mp3",laughs:"laughs.mp3",teleport:"teleport.mp3",panico:"panico.mp3",item_pickup:"item_pickup.mp3",shield:"shield.mp3",turbo:"turbo.mp3",slow:"slow.mp3",reset:"reset.mp3",glock:"glock.mp3",rifle:"rifle.mp3",shotgun:"shotgun.mp3",uzi:"uzi.mp3",drill:"drill.mp3",bomb:"bomb.mp3",explosion:"explosion.mp3",alarm:"alarm.mp3"},nl="teratron-muted";class Yd{constructor(){M(this,"sounds",new Map);M(this,"loadedCount",0);M(this,"totalCount",Object.keys(rl).length);M(this,"loopingSounds",new Map);M(this,"preloadPromise");M(this,"muted",!1);this.muted=localStorage.getItem(nl)==="true",this.preloadPromise=this.preloadSounds()}preloadSounds(){const e="/tron-revival/assets/sounds/",t=[];for(const[i,r]of Object.entries(rl)){const n=new Audio;n.preload="auto";const o=new Promise(a=>{n.addEventListener("canplaythrough",()=>{this.loadedCount++,a()},{once:!0}),n.addEventListener("error",()=>{console.warn(`Failed to load sound: ${i}`),this.loadedCount++,a()},{once:!0})});n.src=e+r,this.sounds.set(i,n),t.push(o)}return Promise.all(t).then(()=>{console.log(`[SoundManager] Loaded ${this.loadedCount}/${this.totalCount} sounds`)})}async waitForLoad(){await this.preloadPromise}isLoaded(){return this.loadedCount>=this.totalCount}play(e){if(this.muted)return;const t=this.sounds.get(e);if(t){const i=t.cloneNode();i.volume=.5,i.play().catch(()=>{})}}playLoop(e,t){if(this.loopingSounds.has(t)||this.muted)return;const i=this.sounds.get(e);if(i){const r=i.cloneNode();r.volume=.5,r.loop=!0,r.play().catch(()=>{}),this.loopingSounds.set(t,r)}}stopLoop(e){const t=this.loopingSounds.get(e);t&&(t.pause(),t.currentTime=0,this.loopingSounds.delete(e))}stopAllLoops(){for(const e of this.loopingSounds.values())e.pause(),e.currentTime=0;this.loopingSounds.clear()}toggleMute(){return this.muted=!this.muted,localStorage.setItem(nl,String(this.muted)),this.muted&&this.stopAllLoops(),this.muted}isMuted(){return this.muted}}let ei=null;function Ft(){return ei||(ei=new Yd),ei}const il=3;function Vd(l,e,t,i,r,n,o,a){const s=t-l,c=i-e,u=o-r,f=a-n,d=r-l,m=n-e,g=s*f-c*u;if(g===0)return!1;const b=(d*f-m*u)/g,w=(d*c-m*s)/g,x=.001;return b>x&&b<1-x&&w>x&&w<1-x}class ol{constructor(e,t,i){M(this,"players",[]);M(this,"phase","countdown");M(this,"countdown",il);M(this,"roundWinner",null);M(this,"scores",new Map);M(this,"currentRound",1);M(this,"currentLevelIndex",0);M(this,"playersReady",new Set);M(this,"gameMode");M(this,"levelMode");M(this,"pixelOwners",new Map);M(this,"ridiculousDeaths",new Map);M(this,"frameRidiculousDeaths",[]);M(this,"levelObstacles",new Map);M(this,"portals",[]);M(this,"nextPortalId",0);M(this,"PORTAL_MIN_DISTANCE",100);M(this,"PORTAL_MIN_PLAYER_DISTANCE",80);M(this,"PORTAL_ANIM_SPEED",3);M(this,"portalAnimTick",0);M(this,"items",[]);M(this,"itemLauncher",new Kd);M(this,"teleportCooldowns",new Map);M(this,"TELEPORT_COOLDOWN_FRAMES",35);M(this,"frameTrailSegments",new Map);M(this,"frameSoundEvents",[]);M(this,"prevActionState",new Map);M(this,"borderLocks",new Map);M(this,"frameBorderSegments",[]);M(this,"frameEraserUsed",!1);M(this,"frameClearedAreas",[]);M(this,"projectiles",[]);M(this,"explosions",[]);M(this,"nextProjectileId",0);M(this,"nextExplosionId",0);M(this,"BULLET_BASE_SPEED",5e3);M(this,"BULLET_KILL_RADIUS",6);M(this,"BULLET_CLEAR_RADIUS",5);M(this,"BULLET_ITEM_DAMAGE_RADIUS",16);M(this,"EXPLOSION_FRAMES",39);M(this,"rifleBurstState",new Map);M(this,"RIFLE_BURST_INTERVAL",20);M(this,"RIFLE_SHOTS_PER_BURST",5);M(this,"RIFLE_SHOT_DELAY",1);M(this,"PROJECTILE_OWNER_COOLDOWN",10);M(this,"TRACER_LIFESPAN",120);M(this,"TRACER_KILL_RADIUS",1);M(this,"TRACER_CLEAR_RADIUS",1);M(this,"UZI_TRACERS_PER_FRAME",20);M(this,"UZI_SPREAD_DEGREES",30);M(this,"UZI_MIN_SPEED",5e3);M(this,"UZI_MAX_SPEED",25e3);M(this,"UZI_TRACER_LIFESPAN",2);M(this,"SHOTGUN_PELLETS",30);M(this,"SHOTGUN_SPREAD_DEGREES",5);M(this,"SHOTGUN_MIN_SPEED",1e4);M(this,"SHOTGUN_MAX_SPEED",3e4);M(this,"SHOTGUN_PELLET_LIFESPAN",10);M(this,"BOMB_SPEED",2e3);M(this,"BOMB_CLEAR_RADIUS",60);M(this,"BOMB_KILL_RADIUS",50);M(this,"BOMB_ITEM_DAMAGE_RADIUS",70);M(this,"BOMB_EXPLOSION_SCALE",2);M(this,"BOMB_HP",100);M(this,"GLOCK_DAMAGE",50);M(this,"TRACER_DAMAGE",10);M(this,"colorBlindnessRemainingFrames",0);M(this,"COLOR_BLINDNESS_DURATION",280);M(this,"COLOR_BLINDNESS_PROBABILITY",.1);M(this,"whiteFlashRemainingFrames",0);M(this,"WHITE_FLASH_DURATION",308);M(this,"BODYGUARD_ORBIT_RADIUS",30);M(this,"BODYGUARD_ORBIT_PERIOD",140);M(this,"BODYGUARD_KILL_RADIUS",5);M(this,"BODYGUARD_INTERCEPT_RADIUS",50);M(this,"BODYGUARD_SPEED",8e3);M(this,"bodyguards",[]);M(this,"nextBodyguardId",0);M(this,"bodyguardBaseAngle",0);M(this,"playerConfigs");if(this.playerConfigs=e,this.gameMode=t,this.levelMode=i,i!=="cycle"){const r=Nr.findIndex(n=>n.id===i);r>=0&&(this.currentLevelIndex=r)}for(const r of e)this.scores.set(r.slotIndex,0),this.ridiculousDeaths.set(r.slotIndex,0);this.initRound()}queueSound(e){this.frameSoundEvents.push({sound:e})}queueLoopSound(e,t){this.frameSoundEvents.push({sound:e,loop:!0,loopKey:t})}queueStopLoop(e){this.frameSoundEvents.push({sound:"",stopLoop:e})}killPlayerWithSound(e,t){if(e.kill(),t){const i=(this.ridiculousDeaths.get(e.slotIndex)||0)+1;this.ridiculousDeaths.set(e.slotIndex,i),this.frameRidiculousDeaths.push(e.slotIndex),this.queueSound("panico")}else this.queueSound("laughs")}setLevelObstacles(e){this.levelObstacles=new Map(e);for(const[t,i]of e)this.pixelOwners.set(t,i)}initRound(){this.phase="countdown",this.countdown=il,this.roundWinner=null,this.pixelOwners.clear(),this.frameTrailSegments.clear(),this.playersReady.clear(),this.prevActionState.clear(),this.portals=[],this.teleportCooldowns.clear(),this.items=[],this.itemLauncher.reset(),this.borderLocks.clear(),this.frameBorderSegments.length=0,this.projectiles=[],this.explosions=[],this.rifleBurstState.clear(),this.colorBlindnessRemainingFrames=0,this.whiteFlashRemainingFrames=0,this.bodyguards=[],this.nextBodyguardId=0,this.bodyguardBaseAngle=0;const e=this.playerConfigs.length;this.players.length===0?this.playerConfigs.forEach((t,i)=>{const r=Zn(i,e),n=new zd(t.slotIndex,r.x,r.y,r.direction,t.color,t.nickname);this.players.push(n)}):this.players.forEach((t,i)=>{const r=Zn(i,e);t.reset(r.x,r.y,r.direction)}),this.spawnPortals(),this.itemLauncher.spawnInitialItems(this.items,()=>this.players.map(t=>({x:t.getScreenX(),y:t.getScreenY()})))}tick(e){switch(this.frameTrailSegments.clear(),this.phase){case"countdown":this.tickCountdown();break;case"playing":this.tickPlaying(e);break;case"waiting_ready":this.tickWaitingReady(e);break}}tickCountdown(){this.countdown-=1/70,this.countdown<=0&&(this.countdown=0,this.phase="playing",this.queueSound("round_start"))}tickPlaying(e){for(const[o,a]of this.teleportCooldowns)a>0&&this.teleportCooldowns.set(o,a-1);const t=this.calculateSpeedFactors(e),i=new Map;for(const o of this.players){if(!o.alive)continue;const a=t.get(o.slotIndex)??1;let s;if(a>=1)s=a;else{o.moveFrameCounter++;const c=2-a;o.moveFrameCounter>=c?(s=1,o.moveFrameCounter=0):s=0}i.set(o.slotIndex,s)}const r=Math.max(1,...Array.from(i.values())),n=new Map;for(const o of this.players)n.set(o.slotIndex,[]);for(let o=0;o<r;o++){for(const s of this.players){if(!s.alive)continue;const c=i.get(s.slotIndex)??1;if(o>=c)continue;let u=e.get(s.slotIndex)||{steer:0,action:!1};s.hasEffect("reverse")&&(u={...u,steer:-u.steer});const f=s.update(u),d=s.checkCollision(this.pixelOwners);if(d){const g=this.pixelOwners.get(d),b=s.hasEffect("shield"),w=s.hasEffect("crossing"),x=g===s.color;if(!(b||w&&x)){this.killPlayerWithSound(s,x);continue}}for(const g of f)this.pixelOwners.set(`${g.x},${g.y}`,s.color);const m=n.get(s.slotIndex)||[];m.push(...f),n.set(s.slotIndex,m)}const a=this.players.filter(s=>s.alive);for(let s=0;s<a.length;s++){const c=a[s];if(!(!c||c.prevScreenX<0))for(let u=s+1;u<a.length;u++){const f=a[u];if(!(!f||f.prevScreenX<0)&&Vd(c.prevScreenX,c.prevScreenY,c.getScreenX(),c.getScreenY(),f.prevScreenX,f.prevScreenY,f.getScreenX(),f.getScreenY())){const d=c.hasEffect("shield"),m=f.hasEffect("shield");d||c.kill(),m||f.kill(),(!d||!m)&&this.queueSound("laughs")}}}}for(const[o,a]of n)a.length>0&&this.frameTrailSegments.set(o,a);for(const o of this.players){if(!o.alive)continue;(this.teleportCooldowns.get(o.slotIndex)||0)===0&&this.checkTeleport(o)}this.itemLauncher.tick(this.items,()=>this.players.filter(o=>o.alive).map(o=>({x:o.getScreenX(),y:o.getScreenY()})));for(const o of this.players)o.alive&&this.checkItemPickup(o);for(const o of this.players)o.tickEffects();for(const[o,a]of e){const s=this.players.find(c=>c.slotIndex===o);if(s?.alive&&s.equippedWeapon){const c=Dn.find(f=>f.sprite===s.equippedWeapon.sprite),u=s.equippedWeapon.sprite;if(u==="rifle")if(a.action&&s.equippedWeapon){let f=this.rifleBurstState.get(o);if(f||(f={frameCounter:this.RIFLE_BURST_INTERVAL,shotsRemaining:0,shotDelay:0},this.rifleBurstState.set(o,f)),f.frameCounter++,f.shotsRemaining===0&&f.frameCounter>=this.RIFLE_BURST_INTERVAL&&(s.equippedWeapon.ammo??0)>=this.RIFLE_SHOTS_PER_BURST&&(f.shotsRemaining=this.RIFLE_SHOTS_PER_BURST,f.shotDelay=0,f.frameCounter=0,this.queueSound("rifle")),f.shotsRemaining>0)if(f.shotDelay===0){const d=t.get(s.slotIndex)??1;this.createTracerProjectile(s,d),s.useWeapon(),f.shotsRemaining--,f.shotDelay=this.RIFLE_SHOT_DELAY}else f.shotDelay--}else this.rifleBurstState.delete(o);else if(s.equippedWeapon.ammo!==void 0){const f=this.prevActionState.get(o)||!1;if(a.action&&!f&&s.useWeapon())if(u==="glock"){const d=t.get(s.slotIndex)??1;this.createProjectile(s,d),this.queueSound("glock")}else if(u==="shotgun")this.createShotgunPellets(s),this.queueSound("shotgun");else if(u==="bomb")this.createBombProjectile(s),this.queueSound("bomb");else if(u==="lock_borders"){const d=this.borderLocks.size===0;this.borderLocks.set(o,{color:s.color,progress:0}),d&&this.queueLoopSound("alarm","border-lock")}else c?.useSound&&this.queueSound(c.useSound)}else if(s.equippedWeapon.remainingFrames!==void 0){const f=`weapon-${o}`;a.action?(c?.sprite==="uzi"&&this.createUziTracers(s),s.tickWeapon(),c?.loopSound&&c.useSound&&this.queueLoopSound(c.useSound,f),s.equippedWeapon||this.queueStopLoop(f)):this.queueStopLoop(f)}}else this.queueStopLoop(`weapon-${o}`);this.prevActionState.set(o,a.action)}this.animateBorderLock(),this.tickVisualEffects(),this.checkRoundEnd()}animateBorderLock(){if(this.frameBorderSegments.length=0,this.borderLocks.size===0)return;const e=[];for(const[t,i]of this.borderLocks){const r=i.progress,n=[];for(let o=0;o<5;o++){const a=r+o*150;a<Ae&&(this.pixelOwners.set(`${a},0`,i.color),n.push({x:a,y:0}),this.pixelOwners.set(`${a},${Pe-1}`,i.color),n.push({x:a,y:Pe-1}))}for(let o=0;o<4;o++){const a=r+o*150;a<Pe&&(this.pixelOwners.set(`0,${a}`,i.color),n.push({x:0,y:a}),this.pixelOwners.set(`${Ae-1},${a}`,i.color),n.push({x:Ae-1,y:a}))}n.length>0&&this.frameBorderSegments.push({color:i.color,segments:n}),i.progress++,i.progress>=150&&e.push(t)}for(const t of e)this.borderLocks.delete(t);this.borderLocks.size===0&&e.length>0&&this.queueStopLoop("border-lock")}createProjectile(e,t){const i=e.direction*Math.PI/180,r=5e3,n=this.BULLET_BASE_SPEED*Math.max(.5,t);this.projectiles.push({id:this.nextProjectileId++,x:e.x+Math.cos(i)*r,y:e.y+Math.sin(i)*r,direction:e.direction,ownerSlot:e.slotIndex,speed:n,type:"bullet",ownerCooldown:this.PROJECTILE_OWNER_COOLDOWN})}createTracerProjectile(e,t){const i=e.direction*Math.PI/180,r=3e3,n=this.BULLET_BASE_SPEED*Math.max(.5,t);this.projectiles.push({id:this.nextProjectileId++,x:e.x+Math.cos(i)*r,y:e.y+Math.sin(i)*r,direction:e.direction,ownerSlot:e.slotIndex,speed:n,type:"tracer",remainingFrames:this.TRACER_LIFESPAN,ownerCooldown:this.PROJECTILE_OWNER_COOLDOWN})}createUziTracers(e){for(let i=0;i<this.UZI_TRACERS_PER_FRAME;i++){const r=(Math.random()*2-1)*this.UZI_SPREAD_DEGREES,n=e.direction+r,o=n*Math.PI/180,a=this.UZI_MIN_SPEED+Math.random()*(this.UZI_MAX_SPEED-this.UZI_MIN_SPEED);this.projectiles.push({id:this.nextProjectileId++,x:e.x+Math.cos(o)*3e3,y:e.y+Math.sin(o)*3e3,direction:n,ownerSlot:e.slotIndex,speed:a,type:"tracer",remainingFrames:this.UZI_TRACER_LIFESPAN,ownerCooldown:this.PROJECTILE_OWNER_COOLDOWN})}}createShotgunPellets(e){for(let i=0;i<this.SHOTGUN_PELLETS;i++){const r=(Math.random()*2-1)*this.SHOTGUN_SPREAD_DEGREES,n=e.direction+r,o=n*Math.PI/180,a=this.SHOTGUN_MIN_SPEED+Math.random()*(this.SHOTGUN_MAX_SPEED-this.SHOTGUN_MIN_SPEED);this.projectiles.push({id:this.nextProjectileId++,x:e.x+Math.cos(o)*3e3,y:e.y+Math.sin(o)*3e3,direction:n,ownerSlot:e.slotIndex,speed:a,type:"tracer",remainingFrames:this.SHOTGUN_PELLET_LIFESPAN,ownerCooldown:this.PROJECTILE_OWNER_COOLDOWN})}}createBombProjectile(e){const i=e.direction*Math.PI/180;this.projectiles.push({id:this.nextProjectileId++,x:e.x+Math.cos(i)*3e3,y:e.y+Math.sin(i)*3e3,direction:e.direction,ownerSlot:e.slotIndex,speed:this.BOMB_SPEED,type:"bomb",ownerCooldown:this.PROJECTILE_OWNER_COOLDOWN,hp:this.BOMB_HP})}tickProjectiles(){const e=[];for(const t of this.projectiles){const i=Math.floor(t.x/1e3),r=Math.floor(t.y/1e3),n=t.direction*Math.PI/180;t.x+=Math.cos(n)*t.speed,t.y+=Math.sin(n)*t.speed;const o=Math.floor(t.x/1e3),a=Math.floor(t.y/1e3);t.x>=Ae*1e3&&(t.x-=Ae*1e3),t.x<0&&(t.x+=Ae*1e3),t.y>=Pe*1e3&&(t.y-=Pe*1e3),t.y<0&&(t.y+=Pe*1e3);const s=Math.floor(t.x/1e3),c=Math.floor(t.y/1e3);let u=!1;for(const b of this.portals){if(Math.sqrt((s-b.x1)**2+(c-b.y1)**2)<Xr){this.teleportProjectile(t,b.x2,b.y2),u=!0;break}if(Math.sqrt((s-b.x2)**2+(c-b.y2)**2)<Xr){this.teleportProjectile(t,b.x1,b.y1),u=!0;break}}if(u)continue;const f=t.type==="bomb"?this.checkThickLineCollision(i,r,o,a,6):this.checkLineCollision(i,r,o,a);if(f){t.type==="bullet"?this.projectileImpact(f.x,f.y,t.ownerSlot):t.type==="bomb"?this.bombImpact(f.x,f.y,t.ownerSlot):(this.clearPixelPath(i,r,f.x,f.y),this.tracerExpire(f.x,f.y)),e.push(t.id);continue}if(t.type==="tracer"&&(this.clearPixelPath(i,r,o,a),t.remainingFrames!==void 0&&(t.remainingFrames--,t.remainingFrames<=0))){this.tracerExpire(s,c),e.push(t.id);continue}t.ownerCooldown!==void 0&&t.ownerCooldown>0&&t.ownerCooldown--;const d=t.ownerCooldown!==void 0&&t.ownerCooldown>0;let m=!1;if(this.phase!=="waiting_ready"){const b=t.type==="bullet"?this.BULLET_KILL_RADIUS:t.type==="bomb"?this.BULLET_KILL_RADIUS:this.TRACER_KILL_RADIUS;for(const w of this.players){if(!w.alive||d&&w.slotIndex===t.ownerSlot)continue;const x=w.getScreenX(),y=w.getScreenY();if(this.pointToLineDistance(x,y,i,r,s,c)<b){t.type==="bullet"?this.projectileImpact(x,y,t.ownerSlot):t.type==="bomb"?this.bombImpact(x,y,t.ownerSlot):(this.tracerExpire(x,y),this.killPlayerWithSound(w,w.slotIndex===t.ownerSlot)),e.push(t.id),m=!0;break}}}if(m)continue;let g=!1;for(const b of this.items){if(!b.active)continue;if(this.pointToLineDistance(b.x,b.y,i,r,s,c)<Ct)if(t.type==="bomb"){this.bombImpact(b.x,b.y,t.ownerSlot),e.push(t.id),g=!0;break}else{const x=t.type==="bullet"?this.GLOCK_DAMAGE:this.TRACER_DAMAGE;b.hp-=x,b.hp<=0&&(b.active=!1),t.type==="tracer"&&this.tracerExpire(b.x,b.y),e.push(t.id),g=!0;break}}if(!g){if(t.type==="bullet"||t.type==="tracer")for(const b of this.projectiles){if(b.id===t.id||e.includes(b.id))continue;const w=Math.floor(b.x/1e3),x=Math.floor(b.y/1e3);if(Math.sqrt((s-w)**2+(c-x)**2)<3){if(b.type==="bomb"&&b.hp!==void 0){const S=t.type==="bullet"?this.GLOCK_DAMAGE:this.TRACER_DAMAGE;b.hp-=S,e.push(t.id),b.hp<=0&&e.push(b.id);break}else if(t.type==="bullet"&&b.type==="bullet"){const S=Math.floor((s+w)/2),E=Math.floor((c+x)/2);this.projectileImpact(S,E,t.ownerSlot),e.push(t.id),e.push(b.id);break}}}if(t.type==="bomb")for(const b of this.projectiles){if(b.id===t.id||b.type!=="bomb"||e.includes(b.id))continue;const w=Math.floor(b.x/1e3),x=Math.floor(b.y/1e3);if(this.checkBombOBBCollision(s,c,t.direction,w,x,b.direction)){const y=Math.floor((s+w)/2),S=Math.floor((c+x)/2);this.megaBombImpact(y,S),e.push(t.id),e.push(b.id);break}}}}this.projectiles=this.projectiles.filter(t=>!e.includes(t.id))}teleportProjectile(e,t,i){const r=e.direction*Math.PI/180;e.x=(t+Math.cos(r)*Jr)*1e3,e.y=(i+Math.sin(r)*Jr)*1e3}clearPixelPath(e,t,i,r){const n=Math.abs(i-e),o=Math.abs(r-t),a=e<i?1:-1,s=t<r?1:-1;let c=n-o,u=e,f=t;for(;;){const d=(u%Ae+Ae)%Ae,m=(f%Pe+Pe)%Pe,g=`${d},${m}`;if(this.pixelOwners.delete(g),this.levelObstacles.delete(g),this.frameClearedAreas.push({x:d,y:m,radius:0}),u===i&&f===r)break;const b=2*c;b>-o&&(c-=o,u+=a),b<n&&(c+=n,f+=s)}}tracerExpire(e,t){for(let i=-this.TRACER_CLEAR_RADIUS;i<=this.TRACER_CLEAR_RADIUS;i++)for(let r=-this.TRACER_CLEAR_RADIUS;r<=this.TRACER_CLEAR_RADIUS;r++){const n=((e+i)%Ae+Ae)%Ae,o=((t+r)%Pe+Pe)%Pe,a=`${n},${o}`;this.pixelOwners.delete(a),this.levelObstacles.delete(a)}this.frameClearedAreas.push({x:e,y:t,radius:this.TRACER_CLEAR_RADIUS})}checkLineCollision(e,t,i,r){const n=Math.abs(i-e),o=Math.abs(r-t),a=e<i?1:-1,s=t<r?1:-1;let c=n-o,u=e,f=t;for(;;){const d=(u%Ae+Ae)%Ae,m=(f%Pe+Pe)%Pe,g=`${d},${m}`;if(this.pixelOwners.has(g)||this.levelObstacles.has(g))return{x:d,y:m};if(u===i&&f===r)break;const b=2*c;b>-o&&(c-=o,u+=a),b<n&&(c+=n,f+=s)}return null}checkThickLineCollision(e,t,i,r,n){const o=this.checkLineCollision(e,t,i,r);if(o)return o;const a=i-e,s=r-t,c=Math.sqrt(a*a+s*s);if(c===0)return null;const u=-s/c,f=a/c;for(let d=1;d<=n;d++){const m=this.checkLineCollision(Math.round(e+u*d),Math.round(t+f*d),Math.round(i+u*d),Math.round(r+f*d));if(m)return m;const g=this.checkLineCollision(Math.round(e-u*d),Math.round(t-f*d),Math.round(i-u*d),Math.round(r-f*d));if(g)return g}return null}pointToLineDistance(e,t,i,r,n,o){const a=n-i,s=o-r,c=a*a+s*s;if(c===0)return Math.sqrt((e-i)**2+(t-r)**2);let u=((e-i)*a+(t-r)*s)/c;u=Math.max(0,Math.min(1,u));const f=i+u*a,d=r+u*s;return Math.sqrt((e-f)**2+(t-d)**2)}checkBombOBBCollision(e,t,i,r,n,o){const c=i*Math.PI/180,u=o*Math.PI/180,f=[{x:Math.cos(c),y:Math.sin(c)},{x:-Math.sin(c),y:Math.cos(c)},{x:Math.cos(u),y:Math.sin(u)},{x:-Math.sin(u),y:Math.cos(u)}],d=(w,x,y)=>{const S=Math.cos(y),E=Math.sin(y),_=9*S,O=9*E,k=6*-E,T=6*S;return[{x:w+_+k,y:x+O+T},{x:w+_-k,y:x+O-T},{x:w-_-k,y:x-O-T},{x:w-_+k,y:x-O+T}]},m=d(e,t,c),g=d(r,n,u),b=(w,x)=>{let y=1/0,S=-1/0;for(const E of w){const _=E.x*x.x+E.y*x.y;y=Math.min(y,_),S=Math.max(S,_)}return{min:y,max:S}};for(const w of f){const x=b(m,w),y=b(g,w);if(x.max<y.min||y.max<x.min)return!1}return!0}projectileImpact(e,t,i){this.explosions.push({id:this.nextExplosionId++,x:e,y:t,frame:0});for(let r=-this.BULLET_CLEAR_RADIUS;r<this.BULLET_CLEAR_RADIUS;r++)for(let n=-this.BULLET_CLEAR_RADIUS;n<this.BULLET_CLEAR_RADIUS;n++){const o=((e+r)%Ae+Ae)%Ae,a=((t+n)%Pe+Pe)%Pe;this.pixelOwners.delete(`${o},${a}`)}this.frameClearedAreas.push({x:e,y:t,radius:this.BULLET_CLEAR_RADIUS});for(const r of this.players){if(!r.alive)continue;const n=r.getScreenX(),o=r.getScreenY();if(Math.sqrt((n-e)**2+(o-t)**2)<this.BULLET_KILL_RADIUS){const s=i!==void 0&&r.slotIndex===i;this.killPlayerWithSound(r,s)}}for(const r of this.items){if(!r.active)continue;Math.sqrt((r.x-e)**2+(r.y-t)**2)<this.BULLET_ITEM_DAMAGE_RADIUS&&(r.active=!1)}this.queueSound("explosion")}bombImpact(e,t,i){this.explosions.push({id:this.nextExplosionId++,x:e,y:t,frame:0,scale:this.BOMB_EXPLOSION_SCALE});for(let r=-this.BOMB_CLEAR_RADIUS;r<this.BOMB_CLEAR_RADIUS;r++)for(let n=-this.BOMB_CLEAR_RADIUS;n<this.BOMB_CLEAR_RADIUS;n++){const o=((e+r)%Ae+Ae)%Ae,a=((t+n)%Pe+Pe)%Pe;this.pixelOwners.delete(`${o},${a}`)}this.frameClearedAreas.push({x:e,y:t,radius:this.BOMB_CLEAR_RADIUS});for(const r of this.players){if(!r.alive)continue;const n=r.getScreenX(),o=r.getScreenY(),a=Math.abs(n-e),s=Math.abs(o-t),c=a>Ae/2?Ae-a:a,u=s>Pe/2?Pe-s:s;if(c<this.BOMB_KILL_RADIUS&&u<this.BOMB_KILL_RADIUS){const f=i!==void 0&&r.slotIndex===i;this.killPlayerWithSound(r,f)}}for(const r of this.items){if(!r.active)continue;const n=Math.abs(r.x-e),o=Math.abs(r.y-t),a=n>Ae/2?Ae-n:n,s=o>Pe/2?Pe-o:o;a<this.BOMB_ITEM_DAMAGE_RADIUS&&s<this.BOMB_ITEM_DAMAGE_RADIUS&&(r.active=!1)}for(const r of this.bodyguards){const n=r.x/1e3,o=r.y/1e3,a=Math.abs(n-e),s=Math.abs(o-t),c=a>Ae/2?Ae-a:a,u=s>Pe/2?Pe-s:s;c<this.BOMB_KILL_RADIUS&&u<this.BOMB_KILL_RADIUS&&(r.id=-1)}this.queueSound("explosion")}megaBombImpact(e,t){const i=this.BOMB_CLEAR_RADIUS*2,r=this.BOMB_KILL_RADIUS*2,n=this.BOMB_ITEM_DAMAGE_RADIUS*2,o=this.BOMB_EXPLOSION_SCALE*2;this.explosions.push({id:this.nextExplosionId++,x:e,y:t,frame:0,scale:o});for(let a=-i;a<i;a++)for(let s=-i;s<i;s++){const c=((e+a)%Ae+Ae)%Ae,u=((t+s)%Pe+Pe)%Pe;this.pixelOwners.delete(`${c},${u}`)}this.frameClearedAreas.push({x:e,y:t,radius:i});for(const a of this.players){if(!a.alive)continue;const s=a.getScreenX(),c=a.getScreenY(),u=Math.abs(s-e),f=Math.abs(c-t),d=u>Ae/2?Ae-u:u,m=f>Pe/2?Pe-f:f;d<r&&m<r&&this.killPlayerWithSound(a,!1)}for(const a of this.items){if(!a.active)continue;const s=Math.abs(a.x-e),c=Math.abs(a.y-t),u=s>Ae/2?Ae-s:s,f=c>Pe/2?Pe-c:c;u<n&&f<n&&(a.active=!1)}for(const a of this.bodyguards){const s=a.x/1e3,c=a.y/1e3,u=Math.abs(s-e),f=Math.abs(c-t),d=u>Ae/2?Ae-u:u,m=f>Pe/2?Pe-f:f;d<r&&m<r&&(a.id=-1)}this.whiteFlashRemainingFrames=this.WHITE_FLASH_DURATION,this.queueSound("explosion")}tickExplosions(){for(const e of this.explosions)e.frame++;this.explosions=this.explosions.filter(e=>e.frame<this.EXPLOSION_FRAMES)}tickVisualEffects(){if(this.portalAnimTick++,this.portalAnimTick>=this.PORTAL_ANIM_SPEED){this.portalAnimTick=0;for(const e of this.portals)e.animFrame=(e.animFrame+1)%Ja}this.colorBlindnessRemainingFrames>0&&this.colorBlindnessRemainingFrames--,this.whiteFlashRemainingFrames>0&&this.whiteFlashRemainingFrames--,this.tickProjectiles(),this.tickExplosions(),this.tickBodyguards()}tickWaitingReady(e){this.tickVisualEffects();for(const[t,i]of e){const r=this.prevActionState.get(t)||!1,n=i.action;n&&!r&&(this.playersReady.has(t)?this.playersReady.delete(t):this.playersReady.add(t)),this.prevActionState.set(t,n)}this.playersReady.size>=this.players.length&&(this.currentRound++,this.levelMode==="cycle"&&(this.currentLevelIndex=(this.currentLevelIndex+1)%Nr.length),this.initRound())}calculateSpeedFactors(e){const t=new Map;for(const i of this.players){let r=1;i.hasEffect("automatic_turbo")&&(r+=1),i.hasEffect("automatic_slow")&&(r-=1),t.set(i.slotIndex,r)}for(const[i,r]of e){const n=this.players.find(o=>o.slotIndex===i);if(n?.alive&&n.equippedWeapon&&r.action){if(n.equippedWeapon.sprite==="turbo")t.set(i,(t.get(i)??1)+1);else if(n.equippedWeapon.sprite==="slow")for(const o of this.players)o.slotIndex!==i&&t.set(o.slotIndex,(t.get(o.slotIndex)??1)-1)}}return t}spawnPortals(){const e=this.playerConfigs.length,t=[];for(let r=0;r<e;r++){const n=Zn(r,e);t.push({x:n.x,y:n.y})}const i=this.createPortal(t);i&&this.portals.push(i)}createPortal(e){for(let r=0;r<100;r++){const n=30+Math.random()*(Ae-60),o=30+Math.random()*(Pe-60),a=30+Math.random()*(Ae-60),s=30+Math.random()*(Pe-60),c=a-n,u=s-o;if(Math.sqrt(c*c+u*u)<this.PORTAL_MIN_DISTANCE)continue;let d=!1;for(const m of e){const g=Math.sqrt((n-m.x)**2+(o-m.y)**2),b=Math.sqrt((a-m.x)**2+(s-m.y)**2);if(g<this.PORTAL_MIN_PLAYER_DISTANCE||b<this.PORTAL_MIN_PLAYER_DISTANCE){d=!0;break}}if(!d)return{id:this.nextPortalId++,x1:Math.floor(n),y1:Math.floor(o),x2:Math.floor(a),y2:Math.floor(s),animFrame:Math.floor(Math.random()*Ja)}}return null}checkTeleport(e){const t=e.getScreenX(),i=e.getScreenY();for(const r of this.portals){if(Math.sqrt((t-r.x1)**2+(i-r.y1)**2)<Xr){this.teleportPlayer(e,r.x2,r.y2);return}if(Math.sqrt((t-r.x2)**2+(i-r.y2)**2)<Xr){this.teleportPlayer(e,r.x1,r.y1);return}}}teleportPlayer(e,t,i){const r=e.direction*Math.PI/180,n=t+Math.cos(r)*Jr,o=i+Math.sin(r)*Jr;e.x=Math.floor(n*1e3),e.y=Math.floor(o*1e3),this.teleportCooldowns.set(e.slotIndex,this.TELEPORT_COOLDOWN_FRAMES),this.queueSound("teleport")}checkItemPickup(e){const t=e.getScreenX(),i=e.getScreenY();for(const r of this.items){if(!r.active)continue;let n=!1;if(r.mystery)n=this.pointInTriangle(t,i,r.x,r.y-Ct,r.x-Ct,r.y+Ct,r.x+Ct,r.y+Ct);else if(r.category==="automatic")n=Math.sqrt((t-r.x)**2+(i-r.y)**2)<Ct;else{const o=Ct;n=t>=r.x-o&&t<=r.x+o&&i>=r.y-o&&i<=r.y+o}n&&(this.pickupItem(e,r),r.active=!1)}}pointInTriangle(e,t,i,r,n,o,a,s){const c=(b,w,x,y,S,E)=>(b-S)*(y-E)-(x-S)*(w-E),u=c(e,t,i,r,n,o),f=c(e,t,n,o,a,s),d=c(e,t,a,s,i,r),m=u<0||f<0||d<0,g=u>0||f>0||d>0;return!(m&&g)}pickupItem(e,t){const i=t.category==="automatic"?ls.find(r=>r.sprite===t.sprite):Dn.find(r=>r.sprite===t.sprite);i&&(t.category==="automatic"?t.sprite==="eraser"?this.activateEraser():t.sprite==="random_item"?this.activateSwap():t.sprite==="bodyguard_item"?this.activateBodyguard(e):e.activateEffect(t.sprite,i.duration||0):e.equipWeapon(t.sprite,i.ammo,i.duration),this.queueSound(i.pickupSound||"item_pickup"))}activateEraser(){for(const e of this.players)e.trail=[];this.pixelOwners=new Map(this.levelObstacles),this.borderLocks.size>0&&(this.borderLocks.clear(),this.queueStopLoop("border-lock")),this.frameEraserUsed=!0}activateSwap(){const e=this.players.filter(o=>o.alive);if(e.length<2)return;const t=Math.random()<this.COLOR_BLINDNESS_PROBABILITY;t&&(this.colorBlindnessRemainingFrames=this.COLOR_BLINDNESS_DURATION);const i=e.map(o=>({x:o.x,y:o.y,direction:o.direction}));let r=i.map((o,a)=>a);if(t&&Math.random()<1/(e.length+1))return;let n=0;do{for(let o=r.length-1;o>0;o--){const a=Math.floor(Math.random()*(o+1));[r[o],r[a]]=[r[a],r[o]]}n++}while(this.hasFixedPoint(r)&&n<100);for(let o=0;o<e.length;o++){const a=e[o],s=i[r[o]];a.x=s.x,a.y=s.y,a.direction=s.direction}}hasFixedPoint(e){return e.some((t,i)=>t===i)}activateBodyguard(e){this.bodyguards.push({id:this.nextBodyguardId++,ownerSlot:e.slotIndex,x:e.x,y:e.y,phaseOffset:0});const t=this.bodyguards.filter(r=>r.ownerSlot===e.slotIndex),i=t.length;t.forEach((r,n)=>{r.phaseOffset=360/i*n})}wrappedDistance(e,t,i,r){const n=Math.abs(i-e),o=Math.abs(r-t),a=n>Ae/2?Ae-n:n,s=o>Pe/2?Pe-o:o;return Math.sqrt(a*a+s*s)}moveBodyguardToward(e,t,i){const r=e.x/1e3,n=e.y/1e3;let o=t-r,a=i-n;Math.abs(o)>Ae/2&&(o=o>0?o-Ae:o+Ae),Math.abs(a)>Pe/2&&(a=a>0?a-Pe:a+Pe);const s=Math.sqrt(o*o+a*a);if(s<1)return;const c=Math.min(s,this.BODYGUARD_SPEED/1e3);e.x+=o/s*c*1e3,e.y+=a/s*c*1e3,e.x>=Ae*1e3&&(e.x-=Ae*1e3),e.x<0&&(e.x+=Ae*1e3),e.y>=Pe*1e3&&(e.y-=Pe*1e3),e.y<0&&(e.y+=Pe*1e3)}checkBodyguardProjectileCollision(e){const t=e.x/1e3,i=e.y/1e3,r=[];for(const n of this.projectiles){if(n.ownerSlot===e.ownerSlot)continue;const o=n.x/1e3,a=n.y/1e3;this.wrappedDistance(t,i,o,a)<this.BODYGUARD_KILL_RADIUS&&(n.type==="bomb"&&this.bombImpact(Math.floor(o),Math.floor(a),n.ownerSlot),r.push(n.id))}return r}checkBodyguardPlayerCollision(e){const t=e.x/1e3,i=e.y/1e3;for(const r of this.players){if(!r.alive||r.slotIndex===e.ownerSlot)continue;const n=r.getScreenX(),o=r.getScreenY();this.wrappedDistance(t,i,n,o)<this.BODYGUARD_KILL_RADIUS&&this.killPlayerWithSound(r,!1)}}tickBodyguards(){this.bodyguardBaseAngle=(this.bodyguardBaseAngle+360/this.BODYGUARD_ORBIT_PERIOD)%360;const e=[];for(const i of this.bodyguards){const r=this.players.find(f=>f.slotIndex===i.ownerSlot);if(!r||!r.alive){i.id=-1;continue}const n=r.x/1e3,o=r.y/1e3;let a,s,c=this.BODYGUARD_INTERCEPT_RADIUS,u=!1;for(const f of this.projectiles){if(f.ownerSlot===i.ownerSlot)continue;const d=f.x/1e3,m=f.y/1e3,g=this.wrappedDistance(n,o,d,m);g<c&&(c=g,a=d,s=m,u=!0)}if(!u){const d=(this.bodyguardBaseAngle+i.phaseOffset)*Math.PI/180;a=n+Math.cos(d)*this.BODYGUARD_ORBIT_RADIUS,s=o+Math.sin(d)*this.BODYGUARD_ORBIT_RADIUS}this.moveBodyguardToward(i,a,s),e.push(...this.checkBodyguardProjectileCollision(i)),this.phase!=="waiting_ready"&&this.checkBodyguardPlayerCollision(i)}e.length>0&&(this.projectiles=this.projectiles.filter(i=>!e.includes(i.id)));const t=new Set;for(const i of this.bodyguards)i.id<0&&t.add(i.ownerSlot);this.bodyguards=this.bodyguards.filter(i=>i.id>=0);for(const i of t){const r=this.bodyguards.filter(n=>n.ownerSlot===i);r.length>0&&r.forEach((n,o)=>{n.phaseOffset=360/r.length*o})}}checkRoundEnd(){const e=this.players.filter(t=>t.alive);if(this.gameMode==="ffa")e.length<=1&&this.endRound(e);else{const t=e.some(r=>r.slotIndex%2===0),i=e.some(r=>r.slotIndex%2===1);(!t||!i)&&this.endRound(e)}}endRound(e){this.phase="waiting_ready",Ft().stopAllLoops(),this.borderLocks.clear();const t=e[0];if(!t)this.roundWinner="draw";else if(this.gameMode==="ffa")this.roundWinner=t.slotIndex,this.scores.set(t.slotIndex,(this.scores.get(t.slotIndex)||0)+1);else{const i=t.slotIndex%2;this.roundWinner=t.slotIndex;for(const r of this.players)r.slotIndex%2===i&&this.scores.set(r.slotIndex,(this.scores.get(r.slotIndex)||0)+1)}}serialize(){const e={phase:this.phase,players:this.players.map(c=>c.serialize()),countdown:this.countdown,roundWinner:this.roundWinner,portals:this.portals,items:this.items,projectiles:this.projectiles,explosions:this.explosions,bodyguards:this.bodyguards},t={scores:Object.fromEntries(this.scores),currentRound:this.currentRound,currentLevelIndex:this.currentLevelIndex,playersReady:Array.from(this.playersReady),gameMode:this.gameMode,levelMode:this.levelMode,ridiculousDeath:Object.fromEntries(this.ridiculousDeaths)},i=Array.from(this.frameTrailSegments.entries()).map(([c,u])=>({slotIndex:c,segments:u})),r=[...this.frameSoundEvents];this.frameSoundEvents=[];const n=this.frameBorderSegments.length>0?[...this.frameBorderSegments]:void 0;this.frameBorderSegments.length=0;const o=this.frameEraserUsed||void 0;this.frameEraserUsed=!1;const a=this.frameRidiculousDeaths.length>0?[...this.frameRidiculousDeaths]:void 0;this.frameRidiculousDeaths=[];const s=this.frameClearedAreas.length>0?[...this.frameClearedAreas]:void 0;return this.frameClearedAreas=[],{round:e,match:t,newTrailSegments:i,borderSegments:n,soundEvents:r,eraserUsed:o,ridiculousDeathSlots:a,clearedAreas:s,colorBlindnessFrames:this.colorBlindnessRemainingFrames>0?this.colorBlindnessRemainingFrames:void 0,whiteFlashFrames:this.whiteFlashRemainingFrames>0?this.whiteFlashRemainingFrames:void 0}}updateFromState(e){this.phase=e.round.phase,this.countdown=e.round.countdown,this.roundWinner=e.round.roundWinner,this.portals=e.round.portals,this.items=e.round.items||[];for(const t of e.round.players){const i=this.players.find(r=>r.slotIndex===t.slotIndex);i&&i.updateFromState(t)}this.currentRound=e.match.currentRound,this.currentLevelIndex=e.match.currentLevelIndex,this.gameMode=e.match.gameMode,this.levelMode=e.match.levelMode,this.playersReady=new Set(e.match.playersReady);for(const[t,i]of Object.entries(e.match.scores))this.scores.set(Number(t),i);if(e.match.ridiculousDeath)for(const[t,i]of Object.entries(e.match.ridiculousDeath))this.ridiculousDeaths.set(Number(t),i);this.frameRidiculousDeaths=e.ridiculousDeathSlots??[];for(const{slotIndex:t,segments:i}of e.newTrailSegments){const r=this.players.find(n=>n.slotIndex===t);if(r)for(const n of i)r.trail.push(n),this.pixelOwners.set(`${n.x},${n.y}`,r.color)}}}class Xd{constructor(){M(this,"image",null);M(this,"frames",new Map);M(this,"loaded",!1)}async load(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to load atlas: ${e}`);const i=await t.json();for(const[n,o]of Object.entries(i.frames))this.frames.set(n,{x:o.frame.x,y:o.frame.y,width:o.frame.w,height:o.frame.h});const r=e.replace(/\.json$/,".png");this.image=new Image,await new Promise((n,o)=>{this.image.onload=()=>n(),this.image.onerror=()=>o(new Error(`Failed to load sprite image: ${r}`)),this.image.src=r}),this.loaded=!0}isLoaded(){return this.loaded}getFrame(e){return this.frames.get(e)}getFrameNames(){return Array.from(this.frames.keys())}getImage(){return this.image}draw(e,t,i,r,n){if(!this.image||!this.loaded)return;const o=this.frames.get(t);if(!o){console.warn(`Frame not found: ${t}`);return}const{rotation:a=0,scale:s=1,anchorX:c=.5,anchorY:u=.5}=n||{},f=o.width*s,d=o.height*s,m=f*c,g=d*u;e.save(),e.translate(i,r),a!==0&&e.rotate(a),e.drawImage(this.image,o.x,o.y,o.width,o.height,-m,-g,f,d),e.restore()}drawWrapped(e,t,i,r,n,o,a){if(!this.image||!this.loaded)return;const s=this.frames.get(t);if(!s)return;const{scale:c=1,anchorX:u=.5,anchorY:f=.5}=a||{},d=s.width*c*u,m=s.height*c*f,g=[{x:i,y:r}],b=i-d<0,w=i+d>n,x=r-m<0,y=r+m>o;b&&g.push({x:i+n,y:r}),w&&g.push({x:i-n,y:r}),x&&g.push({x:i,y:r+o}),y&&g.push({x:i,y:r-o}),b&&x&&g.push({x:i+n,y:r+o}),b&&y&&g.push({x:i+n,y:r-o}),w&&x&&g.push({x:i-n,y:r+o}),w&&y&&g.push({x:i-n,y:r-o});for(const S of g)this.draw(e,t,S.x,S.y,a)}}const Jd="0f654119",or=800,st=600,sl=50,ti=1;class al{constructor(e,t,i=!1){M(this,"canvas");M(this,"ctx");M(this,"trailCanvas");M(this,"trailCtx");M(this,"levelCanvas");M(this,"levelCtx");M(this,"currentLevelImage",null);M(this,"players");M(this,"spriteAtlas",null);M(this,"ridiculousDeathSlots",new Set);M(this,"colorBlindnessFrames",0);M(this,"COLOR_BLINDNESS_DURATION",280);M(this,"whiteFlashFrames",0);M(this,"WHITE_FLASH_FADE",280);M(this,"trailData",new Map);M(this,"resizeHandler");if(this.players=t,this.canvas=document.createElement("canvas"),this.canvas.width=or,this.canvas.height=st,this.canvas.style.display="block",this.canvas.style.imageRendering="pixelated",i)this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.objectFit="contain",this.canvas.style.border="none",this.resizeHandler=()=>{};else{this.canvas.style.border="2px solid #333";const r=Math.min(window.innerWidth*.9,1600),n=Math.min(window.innerHeight*.85,1200),o=r/or,a=n/st,s=Math.min(o,a);this.canvas.style.width=`${or*s}px`,this.canvas.style.height=`${st*s}px`,this.resizeHandler=()=>{const c=Math.min(window.innerWidth*.9,1600),u=Math.min(window.innerHeight*.85,1200),f=c/or,d=u/st,m=Math.min(f,d);this.canvas.style.width=`${or*m}px`,this.canvas.style.height=`${st*m}px`},window.addEventListener("resize",this.resizeHandler)}this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,e.appendChild(this.canvas),this.trailCanvas=document.createElement("canvas"),this.trailCanvas.width=Ae,this.trailCanvas.height=Pe,this.trailCtx=this.trailCanvas.getContext("2d"),this.trailCtx.imageSmoothingEnabled=!1,this.levelCanvas=document.createElement("canvas"),this.levelCanvas.width=Ae,this.levelCanvas.height=Pe,this.levelCtx=this.levelCanvas.getContext("2d"),this.levelCtx.imageSmoothingEnabled=!1,this.loadSprites()}async loadSprites(){try{this.spriteAtlas=new Xd,await this.spriteAtlas.load(`/tron-revival/assets/sprites/items.${Jd}.json`)}catch(e){console.error("Failed to load sprite atlas:",e)}}render(e,t,i,r){if(this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,Ae,st),this.ctx.drawImage(this.levelCanvas,0,0),this.colorBlindnessFrames>0){const n=this.COLOR_BLINDNESS_DURATION-this.colorBlindnessFrames,o=this.getColorBlindnessColors(),a=Math.floor(n/2)%o.length,s=o[a];this.trailCtx.clearRect(0,0,Ae,Pe),this.trailCtx.fillStyle=s;for(const c of this.trailData.values())for(const u of c)this.trailCtx.fillRect(u.x,u.y,1,1)}this.ctx.drawImage(this.trailCanvas,0,0);for(const n of e.portals)this.drawPortal(n);for(const n of e.items)n.active&&this.drawItem(n);for(const n of e.projectiles)this.drawProjectile(n);for(const n of e.explosions)this.drawExplosion(n);for(const n of e.bodyguards)this.drawBodyguard(n);for(const n of e.players)n.alive&&this.drawPlayerHead(Math.floor(n.x/1e3),Math.floor(n.y/1e3),n.color);if(this.colorBlindnessFrames>0&&this.spriteAtlas?.isLoaded()){const o=(this.COLOR_BLINDNESS_DURATION-this.colorBlindnessFrames)*3,a=o-100;this.spriteAtlas.draw(this.ctx,"color_blind_to_left",a,100);const s=Ae-o+100;this.spriteAtlas.draw(this.ctx,"color_blind_to_right",s,Pe-100)}switch(this.renderStatusPanel(e.players),e.phase){case"countdown":this.drawCountdownOverlay(e.countdown);break;case"waiting_ready":this.drawWaitingReadyOverlay(t,e.roundWinner);break}if(this.whiteFlashFrames>0){let n;this.whiteFlashFrames>this.WHITE_FLASH_FADE?n=1:n=this.whiteFlashFrames/this.WHITE_FLASH_FADE,this.ctx.fillStyle=`rgba(255, 255, 255, ${n})`,this.ctx.fillRect(0,0,or,st)}if(i!==void 0&&(this.ctx.font="12px monospace",this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.fillStyle=i<60?"#f44":i<68?"#ff0":"#0f0",this.ctx.fillText(`${i} FPS`,4,4),r)){const o=(r.bytesIn/1024).toFixed(1),a=(r.bytesOut/1024).toFixed(1),s=r.lagMs<50?"#0f0":r.lagMs<100?"#ff0":"#f44";this.ctx.fillStyle=s,this.ctx.fillText(`Lag: ${r.lagMs}ms`,4,18),this.ctx.fillStyle="#0ff",this.ctx.fillText(`In: ${o} KB/s  Out: ${a} KB/s`,4,32)}}addTrailSegments(e,t){const i=this.players.find(n=>n.slotIndex===e);if(!i)return;const r=this.trailData.get(e)||[];r.push(...t),this.trailData.set(e,r),this.trailCtx.fillStyle=i.color;for(const n of t)this.trailCtx.fillRect(n.x,n.y,1,1)}addBorderSegments(e,t){this.levelCtx.fillStyle=e;for(const i of t)this.levelCtx.fillRect(i.x,i.y,1,1)}clearTrails(){this.trailCtx.clearRect(0,0,Ae,Pe),this.ridiculousDeathSlots.clear(),this.trailData.clear(),this.colorBlindnessFrames=0,this.whiteFlashFrames=0,this.currentLevelImage&&this.levelCtx.drawImage(this.currentLevelImage,0,0,Ae,Pe)}restoreLevel(){this.trailCtx.clearRect(0,0,Ae,Pe),this.trailData.clear(),this.currentLevelImage&&this.levelCtx.drawImage(this.currentLevelImage,0,0,Ae,Pe)}clearArea(e,t,i){for(let r=-i;r<i;r++)for(let n=-i;n<i;n++){const o=((e+r)%Ae+Ae)%Ae,a=((t+n)%Pe+Pe)%Pe;this.trailCtx.clearRect(o,a,1,1)}}triggerRidiculousDeath(e){this.ridiculousDeathSlots.add(e)}updateColorBlindness(e){this.colorBlindnessFrames=e}updateWhiteFlash(e){this.whiteFlashFrames=e}getColorBlindnessColors(){return[Mr[0],Mr[1],Mr[2],Mr[3],Bn.purple,Bn.brown]}async loadLevel(e){const t=new Map,i=new Image;i.src=e.imagePath,await new Promise((o,a)=>{i.onload=()=>o(),i.onerror=()=>a(new Error(`Failed to load level image: ${e.imagePath}`))}),this.currentLevelImage=i,this.levelCtx.drawImage(i,0,0,Ae,Pe);const n=this.levelCtx.getImageData(0,0,Ae,Pe).data;for(let o=0;o<Pe;o++)for(let a=0;a<Ae;a++){const s=(o*Ae+a)*4,c=n[s]??0,u=n[s+1]??0,f=n[s+2]??0;if(c!==0||u!==0||f!==0){const d=`#${c.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}${f.toString(16).padStart(2,"0")}`;t.set(`${a},${o}`,d)}}return t}drawPortal(e){if(!this.spriteAtlas?.isLoaded())return;const i=`portal_${String(e.animFrame+1).padStart(2,"0")}`;this.spriteAtlas.drawWrapped(this.ctx,i,e.x1,e.y1,Ae,Pe),this.spriteAtlas.drawWrapped(this.ctx,i,e.x2,e.y2,Ae,Pe)}drawItem(e){if(!this.spriteAtlas?.isLoaded())return;const t=e.mystery?"random_item":e.sprite;this.spriteAtlas.drawWrapped(this.ctx,t,e.x,e.y,Ae,Pe)}drawProjectile(e){const t=Math.floor(e.x/1e3),i=Math.floor(e.y/1e3);if(e.type==="tracer")this.ctx.fillStyle="#fff",this.ctx.fillRect(t,i,1,1);else if(e.type==="bomb"){if(!this.spriteAtlas?.isLoaded())return;const r=(e.direction%360+360)%360,n=Math.round(r/30)*30,o=n%120,a=Math.floor(n/120)*120*Math.PI/180,s=`bomb_${o}`;this.spriteAtlas.drawWrapped(this.ctx,s,t,i,Ae,Pe,{rotation:a})}else{if(!this.spriteAtlas?.isLoaded())return;const r=e.direction*Math.PI/180;this.spriteAtlas.drawWrapped(this.ctx,"bullet",t,i,Ae,Pe,{rotation:r})}}drawExplosion(e){if(!this.spriteAtlas?.isLoaded())return;const i=`explosion_${String(e.frame+1).padStart(2,"0")}`,r=e.scale??.2;this.spriteAtlas.drawWrapped(this.ctx,i,e.x,e.y,Ae,Pe,{scale:r})}drawBodyguard(e){if(!this.spriteAtlas?.isLoaded())return;const t=Math.floor(e.x/1e3),i=Math.floor(e.y/1e3);this.spriteAtlas.drawWrapped(this.ctx,"bodyguard",t,i,Ae,Pe)}drawPlayerHead(e,t,i){const r=Math.floor(ti/2);this.ctx.shadowColor=i,this.ctx.shadowBlur=10,this.ctx.fillStyle="#fff",this.ctx.fillRect(e-r,t-r,ti,ti),this.ctx.shadowBlur=0}renderStatusPanel(e){const t=Ae,i=st/4;this.spriteAtlas?.isLoaded()&&this.spriteAtlas.draw(this.ctx,"sidebar",t+sl/2,st/2);for(let r=0;r<4;r++){const n=r*i,o=r,a=this.players.find(c=>c.slotIndex===o),s=e.find(c=>c.slotIndex===o);if(a&&s){const c=t+sl/2;if(this.ridiculousDeathSlots.has(o)&&this.spriteAtlas?.isLoaded()){this.spriteAtlas.draw(this.ctx,"ridiculous_death",c,n+i/2);continue}const u=!!s.equippedWeapon;if(s.activeEffects&&s.activeEffects.length>0){const d=s.activeEffects[0];if(d&&this.spriteAtlas?.isLoaded()){this.spriteAtlas.draw(this.ctx,d.sprite+"_sidebar",c,n+i*.25);const m=Math.ceil(d.remainingFrames/70);this.ctx.fillStyle="#000",this.ctx.font="bold 14px monospace",this.ctx.textAlign="center",this.ctx.textBaseline="top",this.ctx.fillText(`${m}s`,c,n+i*.25+22)}}if(u&&s.equippedWeapon&&this.spriteAtlas?.isLoaded()){this.spriteAtlas.draw(this.ctx,s.equippedWeapon.sprite+"_sidebar",c,n+i*.75);const{ammo:d,remainingFrames:m}=s.equippedWeapon;m!==void 0?(this.ctx.fillStyle="#000",this.ctx.font="bold 14px monospace",this.ctx.textAlign="center",this.ctx.textBaseline="top",this.ctx.fillText(`${Math.ceil(m/70)}s`,c,n+i*.75+22)):d!==void 0&&d>1&&(this.ctx.fillStyle="#000",this.ctx.font="bold 14px monospace",this.ctx.textAlign="center",this.ctx.textBaseline="top",this.ctx.fillText(String(d),c,n+i*.75+22))}}}}drawCountdownOverlay(e){this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,0,Ae,st);const t=Math.ceil(e),i=t>0?String(t):"GO!";this.ctx.fillStyle="#0ff",this.ctx.font="bold 120px monospace",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowColor="#0ff",this.ctx.shadowBlur=20,this.ctx.fillText(i,Ae/2,st/2),this.ctx.shadowBlur=0}drawWaitingReadyOverlay(e,t){this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,0,Ae,st),this.ctx.fillStyle="#0ff",this.ctx.font="bold 36px monospace",this.ctx.textAlign="center",this.ctx.textBaseline="middle";const i=e.currentRound>1?`ROUND ${e.currentRound}`:"GET READY";this.ctx.fillText(i,Ae/2,st/2-100);const r=Ae/2-200,n=Ae/2-160,o=Ae/2-120,a=Ae/2+140,s=240;this.ctx.fillStyle="#888",this.ctx.font="bold 14px monospace",this.ctx.textBaseline="alphabetic";const c=st/2-55;this.ctx.textAlign="right",this.ctx.fillText("Wins",r,c),this.ctx.fillText("MR",n,c),this.ctx.textAlign="left",this.ctx.fillText("Player",o,c);const u=st/2-30,f=g=>t===null||t==="draw"?!1:e.gameMode==="team"?g%2===t%2:g===t;[...this.players].sort((g,b)=>{const w=e.scores[g.slotIndex]||0,x=e.scores[b.slotIndex]||0;if(x!==w)return x-w;const y=e.ridiculousDeath?.[g.slotIndex]||0,S=e.ridiculousDeath?.[b.slotIndex]||0;return y-S}).forEach((g,b)=>{const w=e.playersReady.includes(g.slotIndex),x=e.scores[g.slotIndex]||0,y=e.ridiculousDeath?.[g.slotIndex]||0,S=u+b*35,E=f(g.slotIndex);this.ctx.fillStyle="#ff0",this.ctx.font="bold 20px monospace",this.ctx.textAlign="right",this.ctx.fillText(String(x),r,S),this.ctx.fillStyle=y>0?"#f44":"#666",this.ctx.fillText(String(y),n,S),this.ctx.fillStyle=g.color,this.ctx.font="20px monospace",this.ctx.textAlign="left";const _=t!==null?E?" ":" ":"";let O=_+g.nickname;for(;this.ctx.measureText(O).width>s&&O.length>_.length+3;)O=O.slice(0,-1);O!==_+g.nickname&&(O=O.slice(0,-2)+""),this.ctx.fillText(O,o,S);const k=w?"READY":"waiting...";this.ctx.fillStyle=w?"#0f0":"#666",this.ctx.textAlign="left",this.ctx.fillText(k,a,S)}),this.ctx.fillStyle="#888",this.ctx.font="16px monospace",this.ctx.textAlign="center";const m=u+this.players.length*35+40;this.ctx.fillText("Press ACTION when ready",Ae/2,m)}destroy(){window.removeEventListener("resize",this.resizeHandler),this.canvas.remove()}}const Mn=(l,e)=>{const t=e.x-l.x,i=e.y-l.y;return Math.sqrt(t*t+i*i)},Qd=(l,e)=>{const t=e.x-l.x,i=e.y-l.y;return ep(Math.atan2(i,t))},Zd=(l,e,t)=>{const i={x:0,y:0};return t=cs(t),i.x=l.x-e*Math.cos(t),i.y=l.y-e*Math.sin(t),i},cs=l=>l*(Math.PI/180),ep=l=>l*(180/Math.PI),tp=l=>isNaN(l.buttons)?l.pressure!==0:l.buttons!==0,ri=new Map,ll=l=>{ri.has(l)&&clearTimeout(ri.get(l)),ri.set(l,setTimeout(l,100))},Nn=(l,e,t)=>{const i=e.split(/[ ,]+/g);let r;for(let n=0;n<i.length;n+=1)r=i[n],l.addEventListener?l.addEventListener(r,t,!1):l.attachEvent&&l.attachEvent(r,t)},cl=(l,e,t)=>{const i=e.split(/[ ,]+/g);let r;for(let n=0;n<i.length;n+=1)r=i[n],l.removeEventListener?l.removeEventListener(r,t):l.detachEvent&&l.detachEvent(r,t)},Zc=l=>(l.preventDefault(),l.type.match(/^touch/)?l.changedTouches:l),ul=()=>{const l=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:l,y:e}},hl=(l,e)=>{e.top||e.right||e.bottom||e.left?(l.style.top=e.top,l.style.right=e.right,l.style.bottom=e.bottom,l.style.left=e.left):(l.style.left=e.x+"px",l.style.top=e.y+"px")},Ps=(l,e,t)=>{const i=eu(l);for(let r in i)if(i.hasOwnProperty(r))if(typeof e=="string")i[r]=e+" "+t;else{let n="";for(let o=0,a=e.length;o<a;o+=1)n+=e[o]+" "+t+", ";i[r]=n.slice(0,-2)}return i},rp=(l,e)=>{const t=eu(l);for(let i in t)t.hasOwnProperty(i)&&(t[i]=e);return t},eu=l=>{const e={};return e[l]="",["webkit","Moz","o"].forEach(function(i){e[i+l.charAt(0).toUpperCase()+l.slice(1)]=""}),e},ni=(l,e)=>{for(let t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);return l},np=(l,e)=>{const t={};for(let i in l)l.hasOwnProperty(i)&&e.hasOwnProperty(i)?t[i]=e[i]:l.hasOwnProperty(i)&&(t[i]=l[i]);return t},us=(l,e)=>{if(l.length)for(let t=0,i=l.length;t<i;t+=1)e(l[t]);else e(l)},ip=(l,e,t)=>({x:Math.min(Math.max(l.x,e.x-t),e.x+t),y:Math.min(Math.max(l.y,e.y-t),e.y+t)});var op="ontouchstart"in window,sp=!!window.PointerEvent,ap=!!window.MSPointerEvent,xr={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},ur,jr={};sp?ur=xr.pointer:ap?ur=xr.MSPointer:op?(ur=xr.touch,jr=xr.mouse):ur=xr.mouse;function Pt(){}Pt.prototype.on=function(l,e){var t=this,i=l.split(/[ ,]+/g),r;t._handlers_=t._handlers_||{};for(var n=0;n<i.length;n+=1)r=i[n],t._handlers_[r]=t._handlers_[r]||[],t._handlers_[r].push(e);return t};Pt.prototype.off=function(l,e){var t=this;return t._handlers_=t._handlers_||{},l===void 0?t._handlers_={}:e===void 0?t._handlers_[l]=null:t._handlers_[l]&&t._handlers_[l].indexOf(e)>=0&&t._handlers_[l].splice(t._handlers_[l].indexOf(e),1),t};Pt.prototype.trigger=function(l,e){var t=this,i=l.split(/[ ,]+/g),r;t._handlers_=t._handlers_||{};for(var n=0;n<i.length;n+=1)r=i[n],t._handlers_[r]&&t._handlers_[r].length&&t._handlers_[r].forEach(function(o){o.call(t,{type:r,target:t},e)})};Pt.prototype.config=function(l){var e=this;e.options=e.defaults||{},l&&(e.options=np(e.options,l))};Pt.prototype.bindEvt=function(l,e){var t=this;return t._domHandlers_=t._domHandlers_||{},t._domHandlers_[e]=function(){typeof t["on"+e]=="function"?t["on"+e].apply(t,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},Nn(l,ur[e],t._domHandlers_[e]),jr[e]&&Nn(l,jr[e],t._domHandlers_[e]),t};Pt.prototype.unbindEvt=function(l,e){var t=this;return t._domHandlers_=t._domHandlers_||{},cl(l,ur[e],t._domHandlers_[e]),jr[e]&&cl(l,jr[e],t._domHandlers_[e]),delete t._domHandlers_[e],this};function Je(l,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=l,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=Je.id,Je.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Je.prototype=new Pt;Je.constructor=Je;Je.id=0;Je.prototype.buildEl=function(l){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};Je.prototype.stylize=function(){if(this.options.dataOnly)return this;var l=this.options.fadeTime+"ms",e=rp("borderRadius","50%"),t=Ps("transition","opacity",l),i={};return i.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},i.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},i.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},ni(i.el,t),this.options.shape==="circle"&&ni(i.back,e),ni(i.front,e),this.applyStyles(i),this};Je.prototype.applyStyles=function(l){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var t in l[e])this.ui[e].style[t]=l[e][t];return this};Je.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};Je.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};Je.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};Je.prototype.show=function(l){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof l=="function"&&l.call(this)},e.options.fadeTime)),e};Je.prototype.hide=function(l){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var t=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=t,typeof l=="function"&&l.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){const t=e.options.restJoystick,i={};i.x=t===!0||t.x!==!1?0:e.instance.frontPosition.x,i.y=t===!0||t.y!==!1?0:e.instance.frontPosition.y,e.setPosition(l,i)}return e};Je.prototype.setPosition=function(l,e){var t=this;t.frontPosition={x:e.x,y:e.y};var i=t.options.fadeTime+"ms",r={};r.front=Ps("transition",["transform"],i);var n={front:{}};n.front={transform:"translate("+t.frontPosition.x+"px,"+t.frontPosition.y+"px)"},t.applyStyles(r),t.applyStyles(n),t.restTimeout=setTimeout(function(){typeof l=="function"&&l.call(t),t.restCallback()},t.options.fadeTime)};Je.prototype.restCallback=function(){var l=this,e={};e.front=Ps("transition","none",""),l.applyStyles(e),l.trigger("rested",l.instance)};Je.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};Je.prototype.computeDirection=function(l){var e=l.angle.radian,t=Math.PI/4,i=Math.PI/2,r,n,o;if(e>t&&e<t*3&&!l.lockX?r="up":e>-t&&e<=t&&!l.lockY?r="left":e>-t*3&&e<=-t&&!l.lockX?r="down":l.lockY||(r="right"),l.lockY||(e>-i&&e<i?n="left":n="right"),l.lockX||(e>0?o="up":o="down"),l.force>this.options.threshold){var a={},s;for(s in this.direction)this.direction.hasOwnProperty(s)&&(a[s]=this.direction[s]);var c={};this.direction={x:n,y:o,angle:r},l.direction=this.direction;for(s in a)a[s]===this.direction[s]&&(c[s]=!0);if(c.x&&c.y&&c.angle)return l;(!c.x||!c.y)&&this.trigger("plain",l),c.x||this.trigger("plain:"+n,l),c.y||this.trigger("plain:"+o,l),c.angle||this.trigger("dir dir:"+r,l)}else this.resetDirection();return l};function Ye(l,e){var t=this;t.nipples=[],t.idles=[],t.actives=[],t.ids=[],t.pressureIntervals={},t.manager=l,t.id=Ye.id,Ye.id+=1,t.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},t.config(e),(t.options.mode==="static"||t.options.mode==="semi")&&(t.options.multitouch=!1),t.options.multitouch||(t.options.maxNumberOfNipples=1);const i=getComputedStyle(t.options.zone.parentElement);return i&&i.display==="flex"&&(t.parentIsFlex=!0),t.updateBox(),t.prepareNipples(),t.bindings(),t.begin(),t.nipples}Ye.prototype=new Pt;Ye.constructor=Ye;Ye.id=0;Ye.prototype.prepareNipples=function(){var l=this,e=l.nipples;e.on=l.on.bind(l),e.off=l.off.bind(l),e.options=l.options,e.destroy=l.destroy.bind(l),e.ids=l.ids,e.id=l.id,e.processOnMove=l.processOnMove.bind(l),e.processOnEnd=l.processOnEnd.bind(l),e.get=function(t){if(t===void 0)return e[0];for(var i=0,r=e.length;i<r;i+=1)if(e[i].identifier===t)return e[i];return!1}};Ye.prototype.bindings=function(){var l=this;l.bindEvt(l.options.zone,"start"),l.options.zone.style.touchAction="none",l.options.zone.style.msTouchAction="none"};Ye.prototype.begin=function(){var l=this,e=l.options;if(e.mode==="static"){var t=l.createNipple(e.position,l.manager.getIdentifier());t.add(),l.idles.push(t)}};Ye.prototype.createNipple=function(l,e){var t=this,i=t.manager.scroll,r={},n=t.options,o={x:t.parentIsFlex?i.x:i.x+t.box.left,y:t.parentIsFlex?i.y:i.y+t.box.top};if(l.x&&l.y)r={x:l.x-o.x,y:l.y-o.y};else if(l.top||l.right||l.bottom||l.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=l.top,a.style.right=l.right,a.style.bottom=l.bottom,a.style.left=l.left,a.style.position="absolute",n.zone.appendChild(a);var s=a.getBoundingClientRect();n.zone.removeChild(a),r=l,l={x:s.left+i.x,y:s.top+i.y}}var c=new Je(t,{color:n.color,size:n.size,threshold:n.threshold,fadeTime:n.fadeTime,dataOnly:n.dataOnly,restJoystick:n.restJoystick,restOpacity:n.restOpacity,mode:n.mode,identifier:e,position:l,zone:n.zone,frontPosition:{x:0,y:0},shape:n.shape});return n.dataOnly||(hl(c.ui.el,r),hl(c.ui.front,c.frontPosition)),t.nipples.push(c),t.trigger("added "+c.identifier+":added",c),t.manager.trigger("added "+c.identifier+":added",c),t.bindNipple(c),c};Ye.prototype.updateBox=function(){var l=this;l.box=l.options.zone.getBoundingClientRect()};Ye.prototype.bindNipple=function(l){var e=this,t,i=function(r,n){t=r.type+" "+n.id+":"+r.type,e.trigger(t,n)};l.on("destroyed",e.onDestroyed.bind(e)),l.on("shown hidden rested dir plain",i),l.on("dir:up dir:right dir:down dir:left",i),l.on("plain:up plain:right plain:down plain:left",i)};Ye.prototype.pressureFn=function(l,e,t){var i=this,r=0;clearInterval(i.pressureIntervals[t]),i.pressureIntervals[t]=setInterval(function(){var n=l.force||l.pressure||l.webkitForce||0;n!==r&&(e.trigger("pressure",n),i.trigger("pressure "+e.identifier+":pressure",n),r=n)}.bind(i),100)};Ye.prototype.onstart=function(l){var e=this,t=e.options,i=l;l=Zc(l),e.updateBox();var r=function(n){e.actives.length<t.maxNumberOfNipples?e.processOnStart(n):i.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(o){if(Object.values(i.touches).findIndex(function(s){return s.identifier===o})<0){var a=[l[0]];a.identifier=o,e.processOnEnd(a)}}),e.actives.length<t.maxNumberOfNipples&&e.processOnStart(n))};return us(l,r),e.manager.bindDocument(),!1};Ye.prototype.processOnStart=function(l){var e=this,t=e.options,i,r=e.manager.getIdentifier(l),n=l.force||l.pressure||l.webkitForce||0,o={x:l.pageX,y:l.pageY},a=e.getOrCreate(r,o);a.identifier!==r&&e.manager.removeIdentifier(a.identifier),a.identifier=r;var s=function(u){u.trigger("start",u),e.trigger("start "+u.id+":start",u),u.show(),n>0&&e.pressureFn(l,u,u.identifier),e.processOnMove(l)};if((i=e.idles.indexOf(a))>=0&&e.idles.splice(i,1),e.actives.push(a),e.ids.push(a.identifier),t.mode!=="semi")s(a);else{var c=Mn(o,a.position);if(c<=t.catchDistance)s(a);else{a.destroy(),e.processOnStart(l);return}}return a};Ye.prototype.getOrCreate=function(l,e){var t=this,i=t.options,r;return/(semi|static)/.test(i.mode)?(r=t.idles[0],r?(t.idles.splice(0,1),r):i.mode==="semi"?t.createNipple(e,l):(console.warn("Coudln't find the needed nipple."),!1)):(r=t.createNipple(e,l),r)};Ye.prototype.processOnMove=function(l){var e=this,t=e.options,i=e.manager.getIdentifier(l),r=e.nipples.get(i),n=e.manager.scroll;if(!tp(l)){this.processOnEnd(l);return}if(!r){console.error("Found zombie joystick with ID "+i),e.manager.removeIdentifier(i);return}if(t.dynamicPage){var o=r.el.getBoundingClientRect();r.position={x:n.x+o.left,y:n.y+o.top}}r.identifier=i;var a=r.options.size/2,s={x:l.pageX,y:l.pageY};t.lockX&&(s.y=r.position.y),t.lockY&&(s.x=r.position.x);var c=Mn(s,r.position),u=Qd(s,r.position),f=cs(u),d=c/a,m={distance:c,position:s},g,b;if(r.options.shape==="circle"?(g=Math.min(c,a),b=Zd(r.position,g,u)):(b=ip(s,r.position,a),g=Mn(b,r.position)),t.follow){if(c>a){let S=s.x-b.x,E=s.y-b.y;r.position.x+=S,r.position.y+=E,r.el.style.top=r.position.y-(e.box.top+n.y)+"px",r.el.style.left=r.position.x-(e.box.left+n.x)+"px",c=Mn(s,r.position)}}else s=b,c=g;var w=s.x-r.position.x,x=s.y-r.position.y;r.frontPosition={x:w,y:x},t.dataOnly||(r.ui.front.style.transform="translate("+w+"px,"+x+"px)");var y={identifier:r.identifier,position:s,force:d,pressure:l.force||l.pressure||l.webkitForce||0,distance:c,angle:{radian:f,degree:u},vector:{x:w/a,y:-x/a},raw:m,instance:r,lockX:t.lockX,lockY:t.lockY};y=r.computeDirection(y),y.angle={radian:cs(180-u),degree:180-u},r.trigger("move",y),e.trigger("move "+r.id+":move",y)};Ye.prototype.processOnEnd=function(l){var e=this,t=e.options,i=e.manager.getIdentifier(l),r=e.nipples.get(i),n=e.manager.removeIdentifier(r.identifier);r&&(t.dataOnly||r.hide(function(){t.mode==="dynamic"&&(r.trigger("removed",r),e.trigger("removed "+r.id+":removed",r),e.manager.trigger("removed "+r.id+":removed",r),r.destroy())}),clearInterval(e.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),e.trigger("end "+r.id+":end",r),e.ids.indexOf(r.identifier)>=0&&e.ids.splice(e.ids.indexOf(r.identifier),1),e.actives.indexOf(r)>=0&&e.actives.splice(e.actives.indexOf(r),1),/(semi|static)/.test(t.mode)?e.idles.push(r):e.nipples.indexOf(r)>=0&&e.nipples.splice(e.nipples.indexOf(r),1),e.manager.unbindDocument(),/(semi|static)/.test(t.mode)&&(e.manager.ids[n.id]=n.identifier))};Ye.prototype.onDestroyed=function(l,e){var t=this;t.nipples.indexOf(e)>=0&&t.nipples.splice(t.nipples.indexOf(e),1),t.actives.indexOf(e)>=0&&t.actives.splice(t.actives.indexOf(e),1),t.idles.indexOf(e)>=0&&t.idles.splice(t.idles.indexOf(e),1),t.ids.indexOf(e.identifier)>=0&&t.ids.splice(t.ids.indexOf(e.identifier),1),t.manager.removeIdentifier(e.identifier),t.manager.unbindDocument()};Ye.prototype.destroy=function(){var l=this;l.unbindEvt(l.options.zone,"start"),l.nipples.forEach(function(t){t.destroy()});for(var e in l.pressureIntervals)l.pressureIntervals.hasOwnProperty(e)&&clearInterval(l.pressureIntervals[e]);l.trigger("destroyed",l.nipples),l.manager.unbindDocument(),l.off()};function Qe(l){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=ul(),e.config(l),e.prepareCollections();var t=function(){var r;e.collections.forEach(function(n){n.forEach(function(o){r=o.el.getBoundingClientRect(),o.position={x:e.scroll.x+r.left,y:e.scroll.y+r.top}})})};Nn(window,"resize",function(){ll(t)});var i=function(){e.scroll=ul()};return Nn(window,"scroll",function(){ll(i)}),e.collections}Qe.prototype=new Pt;Qe.constructor=Qe;Qe.prototype.prepareCollections=function(){var l=this;l.collections.create=l.create.bind(l),l.collections.on=l.on.bind(l),l.collections.off=l.off.bind(l),l.collections.destroy=l.destroy.bind(l),l.collections.get=function(e){var t;return l.collections.every(function(i){return t=i.get(e),!t}),t}};Qe.prototype.create=function(l){return this.createCollection(l)};Qe.prototype.createCollection=function(l){var e=this,t=new Ye(e,l);return e.bindCollection(t),e.collections.push(t),t};Qe.prototype.bindCollection=function(l){var e=this,t,i=function(r,n){t=r.type+" "+n.id+":"+r.type,e.trigger(t,n)};l.on("destroyed",e.onDestroyed.bind(e)),l.on("shown hidden rested dir plain",i),l.on("dir:up dir:right dir:down dir:left",i),l.on("plain:up plain:right plain:down plain:left",i)};Qe.prototype.bindDocument=function(){var l=this;l.binded||(l.bindEvt(document,"move").bindEvt(document,"end"),l.binded=!0)};Qe.prototype.unbindDocument=function(l){var e=this;(!Object.keys(e.ids).length||l===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)};Qe.prototype.getIdentifier=function(l){var e;return l?(e=l.identifier===void 0?l.pointerId:l.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]};Qe.prototype.removeIdentifier=function(l){var e={};for(var t in this.ids)if(this.ids[t]===l){e.id=t,e.identifier=this.ids[t],delete this.ids[t];break}return e};Qe.prototype.onmove=function(l){var e=this;return e.onAny("move",l),!1};Qe.prototype.onend=function(l){var e=this;return e.onAny("end",l),!1};Qe.prototype.oncancel=function(l){var e=this;return e.onAny("end",l),!1};Qe.prototype.onAny=function(l,e){var t=this,i,r="processOn"+l.charAt(0).toUpperCase()+l.slice(1);e=Zc(e);var n=function(a,s,c){c.ids.indexOf(s)>=0&&(c[r](a),a._found_=!0)},o=function(a){i=t.getIdentifier(a),us(t.collections,n.bind(null,a,i)),a._found_||t.removeIdentifier(i)};return us(e,o),!1};Qe.prototype.destroy=function(){var l=this;l.unbindDocument(!0),l.ids={},l.index=0,l.collections.forEach(function(e){e.destroy()}),l.off()};Qe.prototype.onDestroyed=function(l,e){var t=this;if(t.collections.indexOf(e)<0)return!1;t.collections.splice(t.collections.indexOf(e),1)};const fl=new Qe,lp={create:function(l){return fl.create(l)},factory:fl},cp={arrows:{left:"ArrowLeft",right:"ArrowRight",action:"Space"},wasd:{left:"KeyA",right:"KeyD",action:"KeyW"}};function dl(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function up(){return/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}class hp{constructor(e="arrows"){M(this,"steer",0);M(this,"action",!1);M(this,"keyMap");M(this,"leftKeyDown",!1);M(this,"rightKeyDown",!1);M(this,"joystick",null);M(this,"actionButton",null);M(this,"handleActionStart",e=>{e.preventDefault(),this.action=!0,this.actionButton&&(this.actionButton.style.transform="scale(0.9)",this.actionButton.style.opacity="1")});M(this,"handleActionEnd",()=>{this.action=!1,this.actionButton&&(this.actionButton.style.transform="scale(1)",this.actionButton.style.opacity="0.7")});M(this,"handleKeyDown",e=>{let t=!1;e.code===this.keyMap.left&&(this.leftKeyDown=!0,t=!0),e.code===this.keyMap.right&&(this.rightKeyDown=!0,t=!0),e.code===this.keyMap.action&&(this.action=!0,t=!0),this.updateSteerFromKeys(),t&&e.preventDefault()});M(this,"handleKeyUp",e=>{e.code===this.keyMap.left&&(this.leftKeyDown=!1),e.code===this.keyMap.right&&(this.rightKeyDown=!1),e.code===this.keyMap.action&&(this.action=!1),this.updateSteerFromKeys()});this.keyMap=cp[e],window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)}initTouchControls(e,t){this.actionButton=t,this.joystick=lp.create({zone:e,mode:"static",position:{left:"50%",top:"50%"},color:"#0ff",size:90,restOpacity:.7,lockX:!0}),this.joystick.on("move",(i,r)=>{const n=r.distance??0,a=(r.angle?.degree??0)*Math.PI/180,s=Math.cos(a),c=Math.min(n/45,1),u=s*c;this.steer=Math.sign(u)*Math.pow(Math.abs(u),2.5)}),this.joystick.on("end",()=>{this.steer=0}),t.addEventListener("touchstart",this.handleActionStart,{passive:!1}),t.addEventListener("touchend",this.handleActionEnd),t.addEventListener("touchcancel",this.handleActionEnd)}updateSteerFromKeys(){this.leftKeyDown&&!this.rightKeyDown?this.steer=-1:this.rightKeyDown&&!this.leftKeyDown?this.steer=1:this.steer=0}getInput(){return{steer:this.steer,action:this.action}}cleanup(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp),this.joystick&&(this.joystick.destroy(),this.joystick=null),this.actionButton&&(this.actionButton.removeEventListener("touchstart",this.handleActionStart),this.actionButton.removeEventListener("touchend",this.handleActionEnd),this.actionButton.removeEventListener("touchcancel",this.handleActionEnd),this.actionButton=null)}}class fp{constructor(e,t,i,r){M(this,"container");M(this,"screenManager");M(this,"config");M(this,"connection");M(this,"renderer",null);M(this,"inputHandler",null);M(this,"gameState",null);M(this,"animationId",null);M(this,"playerInputs",new Map);M(this,"receivedState",null);M(this,"pendingTrailSegments",new Map);M(this,"pendingRidiculousDeaths",new Set);M(this,"pendingClearedAreas",[]);M(this,"lastFrameTime",0);M(this,"TARGET_FRAME_TIME",1e3/70);M(this,"frameTimes",new Array(70).fill(0));M(this,"frameTimeIndex",0);M(this,"frameCount",0);M(this,"lastFpsUpdate",0);M(this,"currentFps",70);M(this,"showFps",localStorage.getItem("showFps")==="true");M(this,"fpsKeyHandler",null);M(this,"bytesSent",[]);M(this,"bytesReceived",[]);M(this,"currentLagMs",0);M(this,"lagSamples",[]);M(this,"latestPingTimestamp",0);M(this,"lastTapTime",0);M(this,"loadedLevelIndex",-1);M(this,"previousPhase",null);M(this,"levelLoading",!1);this.container=e,this.screenManager=t,this.config=i,this.connection=r}render(){const e=dl();if(e?this.renderMobileLayout():this.renderDesktopLayout(),this.inputHandler=new hp("arrows"),e){const t=document.getElementById("joystickZone"),i=document.getElementById("actionButton");t&&i&&this.inputHandler.initTouchControls(t,i)}this.setupNetworkHandlers(),this.config.isHost?this.gameState=new ol(this.config.players,this.config.gameMode,this.config.levelMode):this.gameState=new ol(this.config.players,this.config.gameMode,this.config.levelMode),document.getElementById("backBtn")?.addEventListener("click",()=>{this.cleanup(),this.screenManager.showMainMenu()}),document.getElementById("muteBtn")?.addEventListener("click",()=>{const i=Ft().toggleMute(),r=document.getElementById("muteBtn");r&&(dl()?r.textContent=i?"":"":r.textContent=i?" MUTED":" SOUND")}),document.getElementById("fullscreenBtn")?.addEventListener("click",()=>{if(up()){const o=document.getElementById("iosPopup");o&&(o.style.display="flex");return}const t=document.documentElement,i=document,r=t;i.fullscreenElement||i.webkitFullscreenElement||i.mozFullScreenElement?i.exitFullscreen?i.exitFullscreen():i.webkitExitFullscreen?i.webkitExitFullscreen():i.mozCancelFullScreen&&i.mozCancelFullScreen():r.requestFullscreen?r.requestFullscreen():r.webkitRequestFullscreen?r.webkitRequestFullscreen():r.mozRequestFullScreen&&r.mozRequestFullScreen()}),document.getElementById("iosPopupClose")?.addEventListener("click",()=>{const t=document.getElementById("iosPopup");t&&(t.style.display="none")}),document.getElementById("iosPopup")?.addEventListener("click",t=>{t.target===t.currentTarget&&(t.currentTarget.style.display="none")}),this.fpsKeyHandler=t=>{(t.key==="f"||t.key==="F")&&(this.showFps=!this.showFps,localStorage.setItem("showFps",this.showFps?"true":"false"))},document.addEventListener("keydown",this.fpsKeyHandler),e&&document.getElementById("gameCanvas")?.addEventListener("touchend",i=>{const r=Date.now();r-this.lastTapTime<300&&(this.showFps=!this.showFps,localStorage.setItem("showFps",this.showFps?"true":"false"),i.preventDefault()),this.lastTapTime=r}),this.lastFrameTime=performance.now(),this.startGameLoop()}renderDesktopLayout(){const e=Ft();this.container.innerHTML=`
      <div style="
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1rem;
        min-height: 100vh;
      ">
        <div style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          width: 800px;
          max-width: 100%;
          margin-bottom: 1rem;
        ">
          <h2 style="color: #0ff; margin: 0; text-shadow: 0 0 10px #0ff;">TERATRON</h2>
          <div style="display: flex; gap: 0.5rem;">
            <button id="muteBtn" style="
              padding: 0.5rem 1rem;
              font-family: monospace;
              cursor: pointer;
              background: #002;
              color: #0ff;
              border: 1px solid #0ff;
            ">${e.isMuted()?" MUTED":" SOUND"}</button>
            <button id="backBtn" style="
              padding: 0.5rem 1rem;
              font-family: monospace;
              cursor: pointer;
              background: #200;
              color: #f44;
              border: 1px solid #f44;
            ">BACK TO MENU</button>
          </div>
        </div>

        <div id="gameCanvas" style="
          display: flex;
          justify-content: center;
        "></div>

        <div style="
          color: #888;
          margin-top: 1rem;
          text-align: center;
        ">
          <div>LEFT/RIGHT: Turn | SPACE: Ready/Fire</div>
        </div>
      </div>
    `;const t=document.getElementById("gameCanvas");this.renderer=new al(t,this.config.players,!1)}renderMobileLayout(){const e=Ft();this.container.innerHTML=`
      <style>
        .mobile-game-container {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          height: 100dvh; /* Dynamic viewport height for mobile */
          display: flex;
          align-items: center;
          justify-content: center;
          background: #000;
          touch-action: none;
          user-select: none;
          -webkit-user-select: none;
          overflow: hidden;
        }
        .mobile-game-layout {
          position: relative;
          width: 100%;
          height: 100%;
        }
        .control-zone {
          position: absolute;
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 10;
        }
        .control-zone-left {
          left: 5px;
          bottom: 5px;
        }
        .control-zone-right {
          right: 5px;
          bottom: 5px;
        }
        .joystick-zone {
          width: 100px;
          height: 100px;
          position: relative;
          background: rgba(0, 255, 255, 0.15);
          border-radius: 50%;
          border: 2px solid rgba(0, 255, 255, 0.4);
        }
        .action-button {
          width: 60px;
          height: 60px;
          border-radius: 50%;
          background: rgba(0, 255, 0, 0.25);
          border: 3px solid rgba(0, 255, 0, 0.6);
          display: flex;
          align-items: center;
          justify-content: center;
          color: #0f0;
          font-family: monospace;
          font-size: 0.6rem;
          font-weight: bold;
          text-shadow: 0 0 5px #0f0;
          opacity: 0.8;
          transition: transform 0.1s, opacity 0.1s;
        }
        .canvas-container {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .canvas-container canvas {
          max-width: 100%;
          max-height: 100%;
          object-fit: contain;
        }
        .back-button-mobile {
          position: absolute;
          top: 5px;
          left: 5px;
          padding: 6px 10px;
          font-family: monospace;
          font-size: 0.7rem;
          background: rgba(32, 0, 0, 0.7);
          color: #f44;
          border: 1px solid #f44;
          border-radius: 4px;
          z-index: 100;
          cursor: pointer;
        }
        .top-button {
          position: absolute;
          top: 5px;
          padding: 6px;
          width: 32px;
          height: 32px;
          font-family: monospace;
          font-size: 1rem;
          line-height: 1;
          background: rgba(0, 32, 32, 0.7);
          color: #0ff;
          border: 1px solid #0ff;
          border-radius: 4px;
          z-index: 100;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .fullscreen-button {
          right: 5px;
        }
        .mute-button {
          right: 42px;
        }
        .ios-popup {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.85);
          z-index: 1000;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .ios-popup-content {
          background: #111;
          border: 2px solid #0ff;
          border-radius: 12px;
          padding: 1.5rem;
          max-width: 300px;
          text-align: left;
          position: relative;
          color: #fff;
          font-family: monospace;
        }
        .ios-popup-content h3 {
          color: #0ff;
          margin: 0 0 1rem 0;
          text-align: center;
        }
        .ios-popup-content p {
          margin: 0.5rem 0;
        }
        .ios-popup-content ol {
          margin: 1rem 0;
          padding-left: 1.5rem;
        }
        .ios-popup-content li {
          margin: 0.5rem 0;
        }
        .ios-popup-close {
          position: absolute;
          top: 8px;
          right: 8px;
          background: none;
          border: none;
          color: #888;
          font-size: 1.2rem;
          cursor: pointer;
          padding: 4px 8px;
        }
        /* Portrait orientation warning */
        @media (orientation: portrait) {
          .rotate-hint {
            display: flex !important;
          }
          .mobile-game-layout {
            display: none !important;
          }
        }
        @media (orientation: landscape) {
          .rotate-hint {
            display: none !important;
          }
        }
        .rotate-hint {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: #000;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          color: #0ff;
          font-family: monospace;
          text-align: center;
          padding: 2rem;
          z-index: 200;
        }
        .rotate-icon {
          font-size: 4rem;
          margin-bottom: 1rem;
          animation: rotate-phone 2s ease-in-out infinite;
        }
        @keyframes rotate-phone {
          0%, 100% { transform: rotate(0deg); }
          50% { transform: rotate(90deg); }
        }
      </style>

      <div class="mobile-game-container">
        <!-- Rotate hint for portrait mode -->
        <div class="rotate-hint">
          <div class="rotate-icon"></div>
          <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">Rotate your device</div>
          <div style="color: #888;">Play in landscape mode</div>
        </div>

        <!-- Game layout -->
        <div class="mobile-game-layout">
          <!-- Top buttons -->
          <button id="backBtn" class="back-button-mobile"></button>
          <button id="muteBtn" class="top-button mute-button">${e.isMuted()?"":""}</button>
          <button id="fullscreenBtn" class="top-button fullscreen-button"></button>

          <!-- iOS home screen popup -->
          <div id="iosPopup" class="ios-popup" style="display: none;">
            <div class="ios-popup-content">
              <button id="iosPopupClose" class="ios-popup-close"></button>
              <h3>Add to Home Screen</h3>
              <p>For fullscreen experience on iOS:</p>
              <ol>
                <li>Tap the <strong>Share</strong> button <span style="font-size: 1.2em;"></span></li>
                <li>Scroll down and tap <strong>"Add to Home Screen"</strong></li>
                <li>Tap <strong>Add</strong></li>
              </ol>
              <p style="color: #888; font-size: 0.8em;">Then open from your home screen</p>
            </div>
          </div>
          <!-- Full-screen Canvas -->
          <div id="gameCanvas" class="canvas-container"></div>

          <!-- Overlaid controls -->
          <!-- Left: Joystick -->
          <div class="control-zone control-zone-left">
            <div id="joystickZone" class="joystick-zone"></div>
          </div>

          <!-- Right: Action button -->
          <div class="control-zone control-zone-right">
            <div id="actionButton" class="action-button">ACTION</div>
          </div>
        </div>
      </div>
    `;const t=document.getElementById("gameCanvas");this.renderer=new al(t,this.config.players,!0)}setupNetworkHandlers(){this.config.isHost?this.connection.setCallbacks({onPlayerInput:(e,t)=>{const i=t;this.playerInputs.set(e,i),i.pingTimestamp&&(this.latestPingTimestamp=i.pingTimestamp)}}):this.connection.setCallbacks({onTronState:e=>{this.receivedState=e;const t=performance.now(),i=JSON.stringify(e).length;this.bytesReceived.push({time:t,bytes:i});const r=t-2e3;if(this.bytesReceived=this.bytesReceived.filter(n=>n.time>=r),e.pongTimestamp){const n=Date.now()-e.pongTimestamp,o=Math.max(0,Math.round(n/2));this.lagSamples.push(o),this.lagSamples.length>20&&this.lagSamples.shift();const a=[...this.lagSamples].sort((s,c)=>s-c);this.currentLagMs=a[Math.floor(a.length/2)]??0}for(const{slotIndex:n,segments:o}of e.newTrailSegments){const a=this.pendingTrailSegments.get(n)||[];a.push(...o),this.pendingTrailSegments.set(n,a)}if(e.ridiculousDeathSlots)for(const n of e.ridiculousDeathSlots)this.pendingRidiculousDeaths.add(n);e.clearedAreas&&this.pendingClearedAreas.push(...e.clearedAreas)},onHostDisconnected:()=>{Ft().stopAllLoops(),alert("Host disconnected"),this.cleanup(),this.screenManager.showMainMenu()}})}startGameLoop(){const e=t=>{let i=t-this.lastFrameTime,r=0;const n=5;for(;i>=this.TARGET_FRAME_TIME&&r<n;)this.lastFrameTime+=this.TARGET_FRAME_TIME,i-=this.TARGET_FRAME_TIME,this.processFrame(),r++;r>=n&&(this.lastFrameTime=t),this.animationId=requestAnimationFrame(e)};this.animationId=requestAnimationFrame(e)}processFrame(){if(!this.inputHandler||!this.renderer||!this.gameState)return;const e=performance.now();if(this.frameTimes[this.frameTimeIndex]=e,this.frameTimeIndex=(this.frameTimeIndex+1)%70,this.frameCount<70&&this.frameCount++,e-this.lastFpsUpdate>500&&this.frameCount>=2){const n=this.frameCount<70?0:this.frameTimeIndex,o=(this.frameTimeIndex+69)%70,a=this.frameTimes[o]-this.frameTimes[n];a>0&&(this.currentFps=Math.round((this.frameCount-1)*1e3/a)),this.lastFpsUpdate=e}const t=this.gameState.currentLevelIndex;t!==this.loadedLevelIndex&&!this.levelLoading&&this.loadLevel(t);const i=this.inputHandler.getInput(),r=this.connection.getMySlotIndex();if(this.config.isHost){r!==null&&this.playerInputs.set(r,i),this.gameState.tick(this.playerInputs);const n=this.gameState.serialize();for(const{slotIndex:a,segments:s}of n.newTrailSegments)this.renderer.addTrailSegments(a,s);if(n.borderSegments)for(const{color:a,segments:s}of n.borderSegments)this.renderer.addBorderSegments(a,s);if(n.clearedAreas)for(const{x:a,y:s,radius:c}of n.clearedAreas)this.renderer.clearArea(a,s,c);if(n.eraserUsed&&this.renderer.restoreLevel(),n.ridiculousDeathSlots)for(const a of n.ridiculousDeathSlots)this.renderer.triggerRidiculousDeath(a);this.renderer.updateColorBlindness(n.colorBlindnessFrames??0),this.renderer.updateWhiteFlash(n.whiteFlashFrames??0),this.playSoundEvents(n.soundEvents),this.broadcastState(n);const o=this.showFps?this.getNetworkStats():void 0;this.renderer.render(n.round,n.match,this.showFps?this.currentFps:void 0,o)}else{const n={...i,pingTimestamp:Date.now()};if(this.connection.sendInput(n),this.receivedState){this.gameState.updateFromState(this.receivedState);const o=this.receivedState.round.phase;this.previousPhase!==o&&((o==="waiting_ready"||o==="countdown")&&Ft().stopAllLoops(),this.previousPhase=o);for(const[s,c]of this.pendingTrailSegments)c.length>0&&this.renderer.addTrailSegments(s,c);if(this.pendingTrailSegments.clear(),this.receivedState.borderSegments){for(const{color:s,segments:c}of this.receivedState.borderSegments)this.renderer.addBorderSegments(s,c);this.receivedState.borderSegments=void 0}if(this.pendingClearedAreas.length>0){for(const{x:s,y:c,radius:u}of this.pendingClearedAreas)this.renderer.clearArea(s,c,u);this.pendingClearedAreas=[]}this.receivedState.eraserUsed&&(this.renderer.restoreLevel(),this.pendingTrailSegments.clear(),this.receivedState.eraserUsed=void 0);for(const s of this.pendingRidiculousDeaths)this.renderer.triggerRidiculousDeath(s);this.pendingRidiculousDeaths.clear(),this.renderer.updateColorBlindness(this.receivedState.colorBlindnessFrames??0),this.renderer.updateWhiteFlash(this.receivedState.whiteFlashFrames??0),this.receivedState.soundEvents&&this.receivedState.soundEvents.length>0&&(this.playSoundEvents(this.receivedState.soundEvents),this.receivedState.soundEvents=[]);const a=this.showFps?this.getNetworkStats():void 0;this.renderer.render(this.receivedState.round,this.receivedState.match,this.showFps?this.currentFps:void 0,a)}else{const o=this.gameState.serialize();this.renderer.render(o.round,o.match,this.showFps?this.currentFps:void 0)}}this.gameState.phase==="countdown"&&this.gameState.countdown>2.9&&(this.renderer.clearTrails(),this.pendingTrailSegments.clear())}getNetworkStats(){const e=performance.now(),t=2e3;let i=0;const r=e-t;for(const a of this.bytesSent)a.time>=r&&(i+=a.bytes);i=Math.round(i*1e3/t);let n=0;const o=e-t;for(const a of this.bytesReceived)a.time>=o&&(n+=a.bytes);return n=Math.round(n*1e3/t),{lagMs:this.currentLagMs,bytesIn:n,bytesOut:i}}broadcastState(e){e.sentAt=Date.now(),this.latestPingTimestamp&&(e.pongTimestamp=this.latestPingTimestamp);const t=Id(e),i=performance.now();this.bytesSent.push({time:i,bytes:t.length});const r=i-2e3;this.bytesSent=this.bytesSent.filter(n=>n.time>=r),this.connection.broadcastBinaryState(t)}playSoundEvents(e){const t=Ft();for(const i of e)i.stopLoop?t.stopLoop(i.stopLoop):i.loop&&i.loopKey?t.playLoop(i.sound,i.loopKey):i.sound&&t.play(i.sound)}loadLevel(e){if(!this.renderer||!this.gameState)return;const t=Nr[e];t&&(this.levelLoading=!0,this.renderer.loadLevel(t).then(i=>{this.config.isHost&&this.gameState&&this.gameState.setLevelObstacles(i),this.loadedLevelIndex=e,this.levelLoading=!1}).catch(i=>{console.error("Failed to load level:",i),this.levelLoading=!1}))}cleanup(){Ft().stopAllLoops(),this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.fpsKeyHandler&&(document.removeEventListener("keydown",this.fpsKeyHandler),this.fpsKeyHandler=null),this.inputHandler?.cleanup(),this.inputHandler=null,this.renderer?.destroy(),this.renderer=null,this.connection.disconnect()}}const On=document.querySelector("#app"),Or=new nu(On);Or.setScreenFactories({mainMenu:()=>new iu(On,Or),networkLobby:l=>new jd(On,Or,l),placeholderGame:(l,e)=>new fp(On,Or,l,e)});Or.init();
